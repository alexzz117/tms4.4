<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.auth.datacompare.title")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/commoncheck.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.url.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	var tableName = jQuery.url.param("table_name");
	var modelName = jQuery.url.param("modelName");
	var authId = jQuery.url.param("auth_id");
	var operateName = jQuery.url.param("operate_name");
	var flag = jQuery.url.param("flag");
	$("#table_name").val(tableName);
	$("#table_pk").val(jQuery.url.param("table_pk"));
	$("#table_pkvalue").val(jQuery.url.param("table_pkvalue"));
	var params = $("#dataForm").serialize();
	
	var title = operateName+'数据对比';
	
	var g = $("#boxdiv").grid({
		title:title,
		checkboxEnable:false,
		columns:[
			{name:'#springMessage("view.tms.auth.datacompare.colnum")', width: 45, dataIndex:'COL_NUM'},
			{name:'#springMessage("view.tms.auth.datacompare.fieldname")', width: 45, dataIndex:'FIELD_NAME'},
			{name:'#springMessage("view.tms.auth.datacompare.newvalue")', width: 45, dataIndex:'NEW_VALUE'},
			{name:'#springMessage("view.tms.auth.datacompare.oldvalue")', width: 45, dataIndex:'OLD_VALUE'}
		],
		ds:{
			url:"/tms/auth/dataCompare",
			params:params,
			callback:function(list){
				for(var i = 0; i < list.length; i++){
					var oldValue = list[i]['OLD_VALUE'];	//旧值
					var newValue = list[i]['NEW_VALUE'];	//新值
					//对日期和时间进行处理
					if(list[i]['TYPE'] == 'date'){
						if(oldValue=='0'){
							list[i]['OLD_VALUE'] = '';
						} else if(oldValue!='undefined' && oldValue!=null && oldValue!=''){
							list[i]['OLD_VALUE'] = jcl.util.convert.date(list[i]['OLD_VALUE']);
						}
						if(newValue=='0'){
							list[i]['NEW_VALUE'] = '';
						}else if(newValue!='undefined' && newValue!=null && newValue!=''){
							list[i]['NEW_VALUE'] = jcl.util.convert.date(list[i]['NEW_VALUE']);
						}
					} else if(list[i]['TYPE'] == 'datetime'){
						var oldValue = list[i]['OLD_VALUE'];
						var newValue = list[i]['NEW_VALUE'];
						
						if(oldValue=='0'){
							list[i]['OLD_VALUE'] = '';
						} else if(oldValue!='undefined' && oldValue!=null && oldValue!=''){
							list[i]['OLD_VALUE'] = oldValue=='0'?'':jcl.util.convert.datetime(list[i]['OLD_VALUE']);
						}
						
						if(newValue=='0'){
							list[i]['NEW_VALUE'] = '';
						}else if(newValue!='undefined' && newValue!=null && newValue!=''){
							list[i]['NEW_VALUE'] = newValue=='0'?'':jcl.util.convert.datetime(list[i]['NEW_VALUE']);
						}
					}
					
					if(oldValue && newValue && oldValue!=newValue){
						list[i]['NEW_VALUE'] = '<font color="red">'+list[i]['NEW_VALUE']+'</font>';
						list[i]['OLD_VALUE'] = '<font color="green">'+list[i]['OLD_VALUE']+'</font>';
					}
				}
			}
		},
		toolbar:[
			{id:"btn-back", icon:"icon-tb-aw-l", text:'#springMessage("view.tms.pub.btn.banck")'}
		],
		pagebar: false,
		qform: {}
	});
	g.goPage();
	
	$("#btn-back").click(function(){
		if(flag=='1'){
			jcl.go('/tms/auth/authDataList?modelName='+ modelName);
		} else {
			var param = "authId="+authId+"&modelName="+modelName;
			jcl.go('/tms/auth/listSubOperate?'+param,"子操作列表");
		}
	});
});

</script>
</head>

<body>
	<div id="boxdiv" class="box"></div>
	<form name="dataForm" id="dataForm" method="post">
		<input name="table_name" id="table_name" type="hidden" />
		<input name="table_pk" id="table_pk" type="hidden" />
		<input name="table_pkvalue" id="table_pkvalue" type="hidden" />
	</form>
		
	<div id="logDiv" class="box"></div>
</body>
</html>