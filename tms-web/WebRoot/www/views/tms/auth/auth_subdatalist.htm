<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.auth.authList.sub.title")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/commoncheck.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.url.js"></script>
<script type="text/javascript">
var g = "";
var modelName = jQuery.url.param("modelName");
var authId = jQuery.url.param("authId");
$(document).ready(function(){
	g = new jcl.ui.Grid({
		title:'#springMessage("view.tms.auth.authList.sub.title")',
		checkboxEnable:false,
		table:{
			columns:[
			    {name:'#springMessage("view.tms.auth.authList.operateData")', width: 30, dataIndex:'OPERATEDATA_VALUE'},
			    {name:'#springMessage("view.tms.auth.authList.isMain")', width: 30, dataIndex:'IS_MAIN',render:'common.is'},
				{name:'#springMessage("view.tms.auth.authList.suboperateName")', width: 30, dataIndex:'OPERATE_NAME'},
				{name:'#springMessage("view.tms.auth.authList.operatorName")', width: 30, dataIndex:'REAL_NAME'},
				{name:'#springMessage("view.tms.auth.authList.operateTime")', width: 40, dataIndex:'OPERATE_TIME'}
			],
			ds:{
				url:"/tms/auth/listSubOperate",
				params:{'authId':authId},
				callback:function(list){
					for(var i = 0; i < list.length; i++){
						var auth_id = list[i]['AUTH_ID'];
						var operate_data = list[i]['OPERATE_DATAVALUE'];
						var table_name = list[i]['TABLE_NAME'];
						var table_pk = list[i]['TABLE_PK'];
						var table_pkvalue = list[i]['TABLE_PKVALUE'];
						var operate_name = list[i]['OPERATE_NAME'];
						if(table_name != 'TMS_COM_MTRAIN'){// 模型训练没有对比页面
							list[i]['OPERATEDATA_VALUE'] = '<a href="#'+(new Date().getTime())+'" onclick="toCompare(\''+operate_name+'\',\''+table_name+'\',\''+table_pk+'\',\''+table_pkvalue+'\',\''+auth_id+'\')">'+list[i]['OPERATEDATA_VALUE']+'</a>';
						}
						list[i]['OPERATE_TIME'] = jcl.util.convert.datetime(list[i]['OPERATE_TIME']);
					}
				}
			},
			pagebar: true
		},
		toolbar:[
			{id:"btn-back", icon:"icon-tb-aw-l", text:'#springMessage("view.tms.pub.btn.banck")'}
		],
		qform: {display:false}

	});
	g.goPage();
	
	//单击返回按钮
	g.toolbar.onClick('#btn-back', function(){
		jcl.go('/tms/auth/authDataList?modelName='+ modelName);
	});
});

//跳转到数据对比页面
function toCompare(operate_name,table_name,table_pk,table_pkvalue,auth_id){
	var params = "operate_name="+operate_name+"&table_name="+table_name+"&table_pk="+table_pk+"&table_pkvalue="+table_pkvalue+"&auth_id="+auth_id+"&modelName="+modelName;
	jcl.go('/tms/auth/dataCompare?'+params,'#springMessage("view.tms.auth.datacompare.title")');
}
</script>
</head>

<body></body>
</html>
