<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.dp.pattern.list")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="$rc.contextPath/s/tms/css/Style.css" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionCharts/FusionCharts.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionMaps/FusionMaps.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionWidgets/FusionCharts.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/PowerCharts/FusionCharts.js"></script>
<script type="text/javascript">
var dataAlertModel;
var dataRuleModel;
var dataTxnModel;
var dataRiskModel;
var startTime;//日期
var nowTime;//long型时间
var endTime;//long型时间
var chartLoaded = false;
var alermChartData;
var dataXmlArr = new Array();
var chart;
$(document).ready(function(){
	var rulefrm = document.getElementById("scope_0");
	var rulevalue = rulefrm.options[rulefrm.selectedIndex].value; 
	var txnfrm = document.getElementById("scope_1");
	var txnvalue = txnfrm.options[txnfrm.selectedIndex].value;
	var riskfrm = document.getElementById("scope_2");
	var riskvalue = riskfrm.options[riskfrm.selectedIndex].value;
	
	
	//表格数据
	//告警表格数据
	var alertGrid = $("#boxdiv_alarm").grid({
		title: '#springMessage("view.tms.monitor.center.alertnumst")',
		//width:1150,height:50,checkboxEnable:false,
		width:900,height:50,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.alertnum")', width: 50, dataIndex:'NUMALERTS'},
			{name:'#springMessage("view.tms.monitor.center.salertnum")', width: 30, dataIndex:'NUMALERTSERIOUS'},
			{name:'#springMessage("view.tms.monitor.center.halertnum")', width: 30, dataIndex:'NUMALERTHIGN'},
			{name:'#springMessage("view.tms.monitor.center.malertnum")', width: 30, dataIndex:'NUMALERTMID'},
			{name:'#springMessage("view.tms.monitor.center.lalertnum")', width: 30, dataIndex:'NUMALERTLOW'},
			{name:'#springMessage("view.tms.monitor.center.alertsucnum")', width: 60, dataIndex:'NUMSUCCESS'},
			{name:'#springMessage("view.tms.monitor.center.salertsucnum")', width: 80, dataIndex:'NUMSUCCESSSERIOUS'},
			{name:'#springMessage("view.tms.monitor.center.halertsucnum")', width: 70, dataIndex:'NUMSUCCESSHIGN'},
			{name:'#springMessage("view.tms.monitor.center.malertsucnum")', width: 70, dataIndex:'NUMSUCCESSMID'},
			{name:'#springMessage("view.tms.monitor.center.lalertsucnum")', width: 70, dataIndex:'NUMSUCCESSLOW'},
			{name:'#springMessage("view.tms.monitor.center.trafficrate")', width: 60, dataIndex:'ALERTRATE'},
			{name:'#springMessage("view.tms.monitor.center.alarmsuccrate")', width: 60, dataIndex:'SUCCESSRATE'},
			{name:'#springMessage("view.tms.monitor.center.trafficnum")', width: 60, dataIndex:'NUMTXNS'}
		],
		ds:{
		},
		pagebar: false,
		qform: {id:"qform", display:false}
		
	});
	//alertGrid.goPage();
	
	var ruleGrid = $("#boxdiv_rule").grid({
		title: '#springMessage("view.tms.monitor.center.rulenumst")',
		width:900,height:150,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.rulename")', width: 40, dataIndex:'RULENAME'},
			{name:'#springMessage("view.tms.monitor.center.ruletrigger")', width: 50, dataIndex:'NUMTRIGS'},
			{name:'#springMessage("view.tms.monitor.center.rulehit")', width: 50, dataIndex:'NUMHITS'},
			{name:'#springMessage("view.tms.monitor.center.rulehitrate")', width: 50, dataIndex:'RULERATE'}
			//{name:'#springMessage("view.tms.monitor.center.ruleresponsetime")', width: 50, dataIndex:'AVGEXECTIMES'}
		],
		ds:{
		},
		// 分页条没有用，去掉 maxiao 2011-8-30
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//ruleGrid.goPage();
	
	var txnGrid = $("#boxdiv_traffic").grid({
		title: '#springMessage("view.tms.monitor.center.trafficnumst")',
		width:1150,height:200,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.trafficname")', width: 40, dataIndex:'TXNNAME'},
			{name:'#springMessage("view.tms.monitor.center.trafficnum")', width: 50, dataIndex:'NUMTXNS'},
			{name:'#springMessage("view.tms.monitor.center.trafficmintime")', width: 50, dataIndex:'MINEXECTIMES'},
			{name:'#springMessage("view.tms.monitor.center.trafficmaxtime")', width: 50, dataIndex:'MAXEXECTIMES'},
			{name:'#springMessage("view.tms.monitor.center.trafficavgtime")', width: 50, dataIndex:'AVGEXECTIMES'}
		],
		ds:{
		},
		// 分页条没有用，去掉 maxiao 2011-8-30
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//txnGrid.goPage();
	
	var riskGrid = $("#boxdiv_risk").grid({
		title: '#springMessage("view.tms.monitor.center.risknumst")',
		width:230,height:190,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.st")', width: 40, dataIndex:'STNAME'},
			{name:'#springMessage("view.tms.monitor.center.statistics")', width: 50, dataIndex:'STVALUE'}
		],
		ds:{
		},
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//riskGrid.goPage();
	
	//数据准备
	//告警事件监控
	jcl.postJSON('/tms/monitor/grid/all/alert', "", function(data){
		dataAlertModel = data;
		alertGrid.renderPage(data.page);
		alarmrmmonitor();
		changeAlarmNum();
		changeAlarm();
	});
	//规则事件监控
	jcl.postJSON('/tms/monitor/grid/all/rule?frm='+rulevalue, "", function(data){
		dataRuleModel = data;
		ruleGrid.renderPage(data.page);
		//规则命中率
		rulehitrate();
		//规则运行监控
		changerule();
	});
	//交易事件监控
	jcl.postJSON('/tms/monitor/grid/all/txn?frm='+txnvalue, "", function(data){
		dataTxnModel = data;
		//alert(data.page);
		txnGrid.renderPage(data.page);
		//交易运行监控
		changetraffic();
	});
	//风险统计数据
	jcl.postJSON('/tms/monitor/grid/all/rmriskst?frm='+riskvalue, "", function(data){
		dataRiskModel = data;
		riskGrid.renderPage(data.page);
		//风险统计数
		strisk();
	});
	
	// 取系统时间，之后进行后续的工作
	jcl.postJSON('/tms/monitor/alarm/time','',function(data){
		var currentTime = data.row.currentTime;//yyyy-MM-dd HH:mm:ss
		// 根据服务器时间算出开始时间
		startTime = new Date(currentTime.substr(0,4),currentTime.substr(5,2)-1,currentTime.substr(8,2),currentTime.substr(11,2),currentTime.substr(14,2),currentTime.substr(17,2));
		if(startTime=='NaN')startTime = new Date();
		nowTime = startTime.getTime();
		var refresh  = document.getElementById("refresh"); 
		var seconds = refresh.options[refresh.selectedIndex].value;
		if(seconds == undefined){
			seconds = "1";
		}
        endTime=startTime.getTime()+Number(seconds)*1000;
    
    	// 定义计时触发器
		getRemainTime();
	});
	
	
});

//告警事件监控
//告警事件监控表格
function alarmgrid(){
	
}
//告警数实时监控柱状图
function alarmrmmonitor(){
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/StackedColumn2D.swf", "ChartId","450", "270", "0", "0");
	chart.setDataXML(dataAlertModel.row[0]);
	chart.render("chartdiv_rmalert");
}
//交易告警率仪表盘/告警成功率仪表盘
function changeAlarm(){
	var datatxn;
	var dataSuc;
	//var frm = document.getElementById("alarm");
	//var radioValue = frm.options[frm.selectedIndex].value;
	var radioValue = "NUMALERTS_NUMSUCCESS";
	if(radioValue=="NUMALERTS_NUMSUCCESS"){
		datatxn = dataAlertModel.row[3];
		dataSuc = dataAlertModel.row[4];
	}else if(radioValue=="NUMALERTSERIOUS_NUMSUCCESSSERIOUS"){
		datatxn = dataAlertModel.row[5];
		dataSuc = dataAlertModel.row[6];
	}else if(radioValue=="NUMALERTHIGN_NUMSUCCESSHIGN"){
		datatxn = dataAlertModel.row[7];
		dataSuc = dataAlertModel.row[8];
	}else if(radioValue=="NUMALERTMID_NUMSUCCESSMID"){
		datatxn = dataAlertModel.row[9];
		dataSuc = dataAlertModel.row[10];
	}else if(radioValue=="NUMALERTLOW_NUMSUCCESSLOW"){
		datatxn = dataAlertModel.row[11];
		dataSuc = dataAlertModel.row[12];
	}
	//交易告警率仪表盘
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/AngularGauge.swf", "ChartId","240", "150", "0", "0");
	chart.setDataXML(datatxn);
	chart.render("chartdiv_rmtraffic");
	//告警成功率仪表盘
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/AngularGauge.swf", "ChartId","240", "150", "0", "0");
	chart.setDataXML(dataSuc);
	chart.render("chartdiv_rmalertsuc");
}

//告警数/告警成功趋势图
function changeAlarmNum(){
	var alertData;
	var radioValue = "";
	var frm = document.getElementsByName("alarmnum");
	for(var i=0;i<frm.length;i++)
	{
    	if(frm[i].checked==true)
		{
        	radioValue= frm[i].value;
            break;
        }
    }
    if(radioValue=="alarmnum"){
    	alertData = dataAlertModel.row[1];
    }else if (radioValue=="alarmsucnum"){
    	alertData = dataAlertModel.row[2];
    }
	
	// 为处理返回值的串做准备 maxiao 2011-9-14
	chartLoaded = true;
	alermChartData = alertData;
	
	// 通过更新方法渲染，加入选择类型的区分
	updateChart();
	//chart = new FusionCharts("$rc.contextPath/s/tms/chart/ScrollLine2D.swf", "ChartAlarmNum","450", "220", "0", "0");
	//chart.setDataXML(alertData);
	//chart.render("chartdiv_rmtrend");
	
	$('#alarmlist').click(function(){
		jcl.go('/tms/monitor/alarm/get_alarmlist');
	});
	$('#ruleTrafficList').click(function(){
		jcl.go('/tms/monitor/alarm/get_ruletrafficlist');
	});
	$('#transactionTrafficList').click(function(){
		jcl.go('/tms/monitor/alarm/get_transactiontrafficlist');
	});
}
		
//规则运行监控表格
function rulegrid(){
	var frm = document.getElementById("scope_0");
	var value = frm.options[frm.selectedIndex].value; 
	
}
//规则命中率
function rulehitrate(){
	var frm = document.getElementById("scope_0");
	var value = frm.options[frm.selectedIndex].value; 
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/AngularGauge.swf", "ChartId","240", "150", "0", "0");
	chart.setDataXML(dataRuleModel.row[1]);
	chart.render("chartdiv_rmrulehit");
}
//规则运行监控
function changerule(){
	var rulefrm = document.getElementById("scope_0");
	var value = rulefrm.options[rulefrm.selectedIndex].value; 
	var radioValue = "";
	var frm = document.getElementsByName("ruleradio");
	for(var i=0;i<frm.length;i++)
	{
           if(frm[i].checked==true)
			{
              radioValue= frm[i].value;
              break;
           }
     }
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/ScrollColumn2D.swf", "ChartId","1150", "250", "0", "0");
	chart.setDataXML(dataRuleModel.row[0]);
	chart.render("chartdiv_rmrule");
}		

//交易运行监控
//交易运行监控表格
function trafficgrid(){
	var rulefrm = document.getElementById("scope_1");
	var value = rulefrm.options[rulefrm.selectedIndex].value; 
	
}
//交易运行监控
function changetraffic(){
	var rulefrm = document.getElementById("scope_1");
	var value = rulefrm.options[rulefrm.selectedIndex].value; 
	var radioValue = "";
	var frm = document.getElementsByName("trafficopt");
	for(var i=0;i<frm.length;i++)
	{
           if(frm[i].checked==true)
			{
              radioValue= frm[i].value;
              break;
           }
     }
	if(radioValue=="trafficnum"){
		//交易运行监控--交易数
		var chart = new FusionCharts("$rc.contextPath/s/tms/chart/Column2D.swf", "ChartId","1150", "200", "0", "0");
		chart.setDataXML(dataTxnModel.row[0]);
		chart.render("chartdiv_rmtrafficnum");
	}else if(radioValue=="trafficrestime"){
		//交易运行监控--交易响应时间
		var chart = new FusionCharts("$rc.contextPath/s/tms/chart/MSColumn2D.swf", "ChartId","1150", "200", "0", "0");
		chart.setDataXML(dataTxnModel.row[1]);
		chart.render("chartdiv_rmtrafficnum");
	}
}

//风险统计数
//风险运行监控表格
function riskgrid(){
	var rulefrm = document.getElementById("scope_2");
	var value = rulefrm.options[rulefrm.selectedIndex].value; 
	
}

//风险统计数
function strisk(){
	var rulefrm = document.getElementById("scope_2");
	var value = rulefrm.options[rulefrm.selectedIndex].value; 
	var chart = new FusionCharts("$rc.contextPath/s/tms/chart/StackedBar2D.swf", "ChartId","900", "225", "0", "0");
	chart.setDataXML(dataRiskModel.row[0]);
	chart.render("chartdiv_rmriskst");
}

//告警数据修改
function alertmonitor(){
	//告警表格数据
	var g = $("#boxdiv_alarm").grid({
		title: '#springMessage("view.tms.monitor.center.alertnumst")',
		//width:1150,height:50,checkboxEnable:false,
		width:900,height:50,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.alertnum")', width: 50, dataIndex:'NUMALERTS'},
			{name:'#springMessage("view.tms.monitor.center.salertnum")', width: 30, dataIndex:'NUMALERTSERIOUS'},
			{name:'#springMessage("view.tms.monitor.center.halertnum")', width: 30, dataIndex:'NUMALERTHIGN'},
			{name:'#springMessage("view.tms.monitor.center.malertnum")', width: 30, dataIndex:'NUMALERTMID'},
			{name:'#springMessage("view.tms.monitor.center.lalertnum")', width: 30, dataIndex:'NUMALERTLOW'},
			{name:'#springMessage("view.tms.monitor.center.alertsucnum")', width: 60, dataIndex:'NUMSUCCESS'},
			{name:'#springMessage("view.tms.monitor.center.salertsucnum")', width: 80, dataIndex:'NUMSUCCESSSERIOUS'},
			{name:'#springMessage("view.tms.monitor.center.halertsucnum")', width: 70, dataIndex:'NUMSUCCESSHIGN'},
			{name:'#springMessage("view.tms.monitor.center.malertsucnum")', width: 70, dataIndex:'NUMSUCCESSMID'},
			{name:'#springMessage("view.tms.monitor.center.lalertsucnum")', width: 70, dataIndex:'NUMSUCCESSLOW'},
			{name:'#springMessage("view.tms.monitor.center.trafficrate")', width: 60, dataIndex:'ALERTRATE'},
			{name:'#springMessage("view.tms.monitor.center.alarmsuccrate")', width: 60, dataIndex:'SUCCESSRATE'},
			{name:'#springMessage("view.tms.monitor.center.trafficnum")', width: 60, dataIndex:'NUMTXNS'}
		],
		ds:{
		},
		pagebar: false,
		qform: {id:"qform", display:false}
		
	});
	//g.goPage();
	
	//告警事件监控
	jcl.postJSON('/tms/monitor/grid/all/alert', "", function(data){
		dataAlertModel = data;
		g.renderPage(data.page);
		alarmrmmonitor();
		changeAlarmNum();
		changeAlarm();
	});
}

//改变规则运行监控的时间范围
function changerulemonitor(){
	var rulefrm = document.getElementById("scope_0");
	var rulevalue = rulefrm.options[rulefrm.selectedIndex].value; 
	var ruleGrid = $("#boxdiv_rule").grid({
		title: '#springMessage("view.tms.monitor.center.rulenumst")',
		width:900,height:150,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.rulename")', width: 40, dataIndex:'RULENAME'},
			{name:'#springMessage("view.tms.monitor.center.ruletrigger")', width: 50, dataIndex:'NUMTRIGS'},
			{name:'#springMessage("view.tms.monitor.center.rulehit")', width: 50, dataIndex:'NUMHITS'},
			{name:'#springMessage("view.tms.monitor.center.rulehitrate")', width: 50, dataIndex:'RULERATE'}
			//{name:'#springMessage("view.tms.monitor.center.ruleresponsetime")', width: 50, dataIndex:'AVGEXECTIMES'}
		],
		ds:{
		},
		// 分页条没有用，去掉 maxiao 2011-8-30
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//ruleGrid.goPage();
	
	//规则事件监控
	jcl.postJSON('/tms/monitor/grid/all/rule?frm='+rulevalue, "", function(data){
		dataRuleModel = data;
		ruleGrid.renderPage(data.page);
		//规则命中率
		rulehitrate();
		//规则运行监控
		changerule();
	});
}

//改变交易运行监控的时间范围
function changetrafficmonitor(){
	var txnfrm = document.getElementById("scope_1");
	var txnvalue = txnfrm.options[txnfrm.selectedIndex].value;
	
	var txnGrid = $("#boxdiv_traffic").grid({
		title: '#springMessage("view.tms.monitor.center.trafficnumst")',
		width:1150,height:200,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.trafficname")', width: 40, dataIndex:'TXNNAME'},
			{name:'#springMessage("view.tms.monitor.center.trafficnum")', width: 50, dataIndex:'NUMTXNS'},
			{name:'#springMessage("view.tms.monitor.center.trafficmintime")', width: 50, dataIndex:'MINEXECTIMES'},
			{name:'#springMessage("view.tms.monitor.center.trafficmaxtime")', width: 50, dataIndex:'MAXEXECTIMES'},
			{name:'#springMessage("view.tms.monitor.center.trafficavgtime")', width: 50, dataIndex:'AVGEXECTIMES'}
		],
		ds:{
		},
		// 分页条没有用，去掉 maxiao 2011-8-30
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//txnGrid.goPage();
	//交易事件监控
	jcl.postJSON('/tms/monitor/grid/all/txn?frm='+txnvalue, "", function(data){
		dataTxnModel = data;
		//alert(data.page);
		txnGrid.renderPage(data.page);
		//交易运行监控
		changetraffic();
	});
	
}

//改变风险统计的时间范围
function changestmonitor(){
	var riskfrm = document.getElementById("scope_2");
	var riskvalue = riskfrm.options[riskfrm.selectedIndex].value;
	var riskGrid = $("#boxdiv_risk").grid({
		title: '#springMessage("view.tms.monitor.center.risknumst")',
		width:230,height:190,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.monitor.center.st")', width: 40, dataIndex:'STNAME'},
			{name:'#springMessage("view.tms.monitor.center.statistics")', width: 50, dataIndex:'STVALUE'}
		],
		ds:{
		},
		pagebar: false,
		qform: {id:"qform", display:false}

	});
	//riskGrid.goPage();
	//风险统计数据
	jcl.postJSON('/tms/monitor/grid/all/rmriskst?frm='+riskvalue, "", function(data){
		dataRiskModel = data;
		riskGrid.renderPage(data.page);
		//风险统计数
		strisk();
	});
}

function change(){
	// 更新开始时间
	startTime.setTime(nowTime);
	var refresh  = document.getElementById("refresh"); 
	var seconds = refresh.options[refresh.selectedIndex].value;
	if(seconds == undefined){
		seconds = "1";
	}
    endTime=startTime.getTime()+Number(seconds)*1000;
        
    //告警事件监控
	//告警事件监控表格
	alertmonitor();
	//规则实时监控
	changerulemonitor();
	//交易实时监控
	changetrafficmonitor();
	//风险统计数
	changestmonitor();
}

function getRemainTime(){
	// 差距时间
	var nMS =endTime - nowTime;
	var nM=Math.floor(nMS/(1000*60)) % 60;
	var nS=Math.floor(nMS/1000) % 60;
	if(nM==0&&nS==0&&nMS<1000) //当倒计时结束
	{
		window.focus();
	    //window.location.reload();
		change();
	}
	if(nS < 10) nS = "0" + nS;
	if(nMS >= 0){
		document.getElementById("remainTime").innerHTML="上次更新时间："+ startTime.getHours()+"时"+startTime.getMinutes()+"分"+startTime.getSeconds() + "秒(" + nM + "分" + nS + "秒)";
	    // 当前时间加1秒
	    nowTime = nowTime +1*1000;
	    setTimeout("getRemainTime()",1000);
	}
}	


// 按选择更新趋势图
function updateChart(){			
	if (chartLoaded){
		var chars = alermChartData.split("</categories>");
		var begin = chars[0]+"</categories>";
		var dataXml = (chars[1].split("</chart>"))[0];
		dataXmlArr = dataXml.split("</dataset>");
		var end = dataXmlArr.length-1>1?dataXmlArr[dataXmlArr.length-1]:"";
		end += "</chart>";
		
		// 更新图表
		chart = new FusionCharts("$rc.contextPath/s/tms/chart/ScrollLine2D.swf", "ChartAlarmNum","450", "220", "0", "0");
		chart.setDataXML(begin + generateXML()+end);
		chart.render("chartdiv_rmtrend");
		this.document.all.choice.style.display="block";
	}
}

// 利用第一次初始化的全部数据，筛选需要显示的数据种类
function generateXML(){	
		
	var strXML="";

	strXML = (this.document.all.total.checked==true)?(strXML + getAlertXML(0)):(strXML);
	strXML = (this.document.all.numS.checked==true)?(strXML + getAlertXML(1)):(strXML);
	strXML = (this.document.all.numH.checked==true)?(strXML + getAlertXML(2)):(strXML);
	strXML = (this.document.all.numM.checked==true)?(strXML + getAlertXML(3)):(strXML);		
	strXML = (this.document.all.numL.checked==true)?(strXML + getAlertXML(4)):(strXML);		
		
	if(strXML=="")	strXML = "<dataset seriesName='无' color='CC9966' anchorBorderColor='CC9966'></dataset>"		
	return strXML;			
}

// 获取第i个xml数据类
function getAlertXML(index){		
	var alertXML="";
	if(index < dataXmlArr.length){
		// 从总集合中选取
		alertXML = dataXmlArr[index]+"</dataset>";	
	}	
	return alertXML;			
}
</script>
</head>
	<body>
		<table width="98%" border="0" cellspacing="0" cellpadding="1" align="center">
		  <tr >
		    <td height="28" width="40%" colspan="1" ><div id="refress" style="font-size:13px">刷新：
		    	<select name="refresh" id="refresh" onchange="change()">
			    	<option value="30" selected>30秒</option>
			    	<option value="60">1分钟</option>
			    	<option value="600">10分钟</option>
			    </select>
			</div></td>
			<td align="right" height="28" width="60%" ><div id="remainTime" style="font-weight:bold;font-size:13px"></div></td>
		  </tr>
		  <tr>
		    <td width="124" height="28" ><a href="javascript:;" id="alarmlist">告警事件监控</a></td>
    		<td height="28" width="1100" colspan="2"><hr /></td>
		  </tr>
		  <tr>
		    <td width="126" height="350" align="center" valign="top" ><table height="348" width="125" border="0" cellspacing="0" cellpadding="1" >
		      <tr>
		        <td height="28" align="left" valign="top" width="126" >
		        <div id="al001" style="font-size:13px">告警总数
		        <!--<div id="al001" style="font-size:13px">数据：
		    	<select name="alarm" id="alarm" onchange="changeAlarm()">
			    	<option value="NUMALERTS_NUMSUCCESS" selected>告警总数</option>
			    	<option value="NUMALERTSERIOUS_NUMSUCCESSSERIOUS" >严重告警数</option>
			    	<option value="NUMALERTHIGN_NUMSUCCESSHIGN" >高告警数</option>
			    	<option value="NUMALERTMID_NUMSUCCESSMID" >中告警数</option>
			    	<option value="NUMALERTLOW_NUMSUCCESSLOW" >低告警数</option>
			    </select>-->
			    </div></td>
		      </tr>
		      <tr>
		      	<!-- 交易告警率仪表盘 -->
		        <td height="160" align="left" valign="bottom" width="350" ><div class="button-box" id="chartdiv_rmtraffic" align="center"></div></td>
		      </tr>
		      <tr>
		      	<!-- 告警成功率仪表盘 -->
		        <td height="160" align="left" valign="bottom" width="350" ><div class="button-box" id="chartdiv_rmalertsuc" align="center"></div></td>
		      </tr>
    	</table></td>
	    <td width="910" height="350" align="center" valign="bottom"><table width="908" height="348" border="0" cellpadding="1" cellspacing="0">
	      <tr>
	      	<!-- 告警数实时监控柱状图 -->
	        <td rowspan="2" width="456" height="280" align="center" valign="bottom"><div class="button-box" id="chartdiv_rmalert" align="center"></div></td>
	        <td height="28" align="left" valign="bottom" >
	        	<div id="al002" style="font-size:13px"><input type="radio" value="alarmnum" name="alarmnum" onclick="changeAlarmNum()" checked/>告警数
		    	<input type="radio" value="alarmsucnum" name="alarmnum" onclick="changeAlarmNum()"/>告警成功数</div></td>
	      </tr>
	      <tr>
	      	<!-- 告警数/告警成功数趋势图 -->
	        <td height="250" width="456" align="left" valign="top"><div class="button-box" id="chartdiv_rmtrend" align="center"></div>
	        	<div align="center" id="choice" name="choice" style="display:none;font-size:13px">
	        	<INPUT TYPE='Checkbox' name='total' onClick="JavaScript:updateChart();" checked>&nbsp;总数&nbsp;&nbsp;
				<INPUT TYPE='Checkbox' name='numS'  onClick="JavaScript:updateChart();" checked>&nbsp;严重&nbsp;&nbsp;
				<INPUT TYPE='Checkbox' name='numH'  onClick="JavaScript:updateChart();" checked>&nbsp;高&nbsp;&nbsp;
				<INPUT TYPE='Checkbox' name='numM'  onClick="JavaScript:updateChart();" checked>&nbsp;中&nbsp;&nbsp;
				<INPUT TYPE='Checkbox' name='numL'  onClick="JavaScript:updateChart();" checked>&nbsp;低&nbsp;&nbsp;
				</div>
			</td>
	      </tr>
	      <tr align="left" valign="bottom">
	      	<!-- 表格展示 -->
	        <td height="50" colspan="2" width="1910" align="left"><div class="button-box" id="boxdiv_alarm" class="box"></div></td>
	        </tr>
	    </table></td>
	  </tr>
	</table>
	
	<table width="98%" border="0" cellspacing="0" cellpadding="1" align="center">
	  <tr>
	    <td width="124" height="28" style="font-weight:bold"><a href="javascript:;" id="ruleTrafficList">规则运行监控</a></td>
	    <td colspan="2" width="1100" height="28"><hr /></td>
	  </tr>
	  <tr>
	    <td width="170" height="28" ><div id="al003" style="font-size:13px">范围：
	    	<select name="scope_0" id="scope_0" onchange="changerulemonitor()">
		    	<option value="currentTime" selected>当前1小时</option>
		    	<option value="4">过去4小时</option>
		    	<option value="12">过去12小时</option>
		    	<option value="24">过去24小时</option>
		    	<option value="yesterday">过去1天</option>
		    </select>
	    </div></td>
	  </tr>
	  <tr>
	  	<!-- 规则运行监控/平均响应时间 -->
	    <td height="200" colspan="3" width="1150" align="left"><div class="button-box" id="chartdiv_rmrule" align="center"></div></td>
	  </tr>
	  <tr>
	  	<!-- 规则命中率 -->
	    <td height="200" colspan="2" width="360"><div class="button-box" id="chartdiv_rmrulehit" align="left"></div></td>
	    <!-- 表格展示 -->
	    <td width="794" height="200"><div class="button-box" id="boxdiv_rule" class="box"></div></td>
	  </tr>
	</table>
	<table width="98%" border="0" cellspacing="0" cellpadding="1">
	  <tr>
	    <td width="124" height="28" style="font-weight:bold"><a href="javascript:;" id="transactionTrafficList">交易运行监控</a></td>
	    <td width="1026" height="28"><hr /></td>
	  </tr>
	  <tr>
	    <td colspan="2" width="1150" height="28" ><div id="al005" style="font-size:13px">范围：
	    	<select name="scope_1" id="scope_1" onchange="changetrafficmonitor()">
		    	<option value="currentTime" selected>当前1小时</option>
		    	<option value="4">过去4小时</option>
		    	<option value="12">过去12小时</option>
		    	<option value="24">过去24小时</option>
		    	<option value="yesterday">过去1天</option>
		    </select>
		    <input type="radio" name="trafficopt" value="trafficnum" onclick="changetraffic()" checked/>交易数
	    	<input type="radio" name="trafficopt" value="trafficrestime" onclick="changetraffic()" />执行时间
	    </div></td>
	  </tr>
	  <tr>
	  	<!-- 交易运行监控-交易数/平均响应时间  -->
	    <td height="200" colspan="2" width="1150"><div class="button-box" id="chartdiv_rmtrafficnum" align="center"></div></td>
	  </tr>
	  <tr>
	  	<!-- 交易运行监控表格展示 -->
	    <td height="200" width="1150" colspan="2"><div class="button-box" id="boxdiv_traffic" class="box"></div></td>
	  </tr>
	</table>
	<table width="98%" border="0" cellspacing="0" cellpadding="1">
	  <tr>
	    <td width="124" height="28" style="font-weight:bold"><div id="al006" style="font-size:13px">风险统计数</div></td>
	    <td colspan="2" width="1000" height="28"><hr /></td>
	  </tr>
	  <tr>
	    <td colspan="2" height="28" width="1150" ><div id="al007" style="font-size:13px">范围：
	    	<select name="scope_2" id="scope_2" onchange="changestmonitor()">
		    	<option value="currentTime" selected>当前1小时</option>
		    	<option value="4">过去4小时</option>
		    	<option value="12">过去12小时</option>
		    	<option value="24">过去24小时</option>
		    	<option value="yesterday">过去1天</option>
		    </select>
	    </div></td>
	    <!-- 风险统计数 -->
	    <td height="225" width="900" rowspan="2"><div class="button-box" id="chartdiv_rmriskst" align="center"></div></td>
	  </tr>
	  <tr>
	  	<!-- 风险统计数表格展示 -->
	    <td height="200" colspan="2" width="230"><div class="button-box" id="boxdiv_risk" class="box"></div></td>
	  </tr>
	</table>
	</body>
</html>
