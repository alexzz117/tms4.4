<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.mgr.namelist.title")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery-ui.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/commoncheck.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	//组装表格     
	var g = new jcl.ui.Grid({
		title:'#springMessage("view.tms.mgr.nameviewlist.title")',
		qform:{
			display: false,
			items:[
				{label: '#springMessage("view.tms.mgr.namelist.rosterdesc")', name: 'ROSTERDESC'},
				{label: '#springMessage("view.tms.mgr.namelist.datatype")', name: 'DATATYPE', type:'selector',
					items:[{text:'--请选择--', value:''}], ds:{type:'code', category:'tms.model.datatype.roster'}
				},
				{label: '#springMessage("view.tms.mgr.namelist.rostertype")', name: 'ROSTERTYPE', type:'selector',
					items:[{text:'--请选择--', value:''}], ds:{type:'code', category:'tms.mgr.rostertype'}
				}
			],btns:[
				{id: 'quick_search_btn', text: '#springMessage("view.cmc.but.find")'}
			]
		},
		toolbar:[
			{id:"btn-find", icon:"icon-tb-find", text:'#springMessage("view.tms.pub.btn.find")', action:'toggleQform'},
			{id:"btn-view", icon:"icon-tb-edit", text:'#springMessage("view.tms.pub.btn.view")', enable:'oneRowSelected'},
			{id:"btn-valueMgr", icon:"icon-tb-edit", text:'#springMessage("view.tms.pub.btn.valueMgr")', enable:'oneRowSelected'}
		],
		table:{
			columns:[
			    {name:'#springMessage("view.tms.mgr.namelist.rostername")', width: 60, dataIndex:'ROSTERNAME'},
				{name:'#springMessage("view.tms.mgr.namelist.rosterdesc")', width: 60, dataIndex:'ROSTERDESC'},
				{name:'#springMessage("view.tms.mgr.namelist.datatype")', width: 40, dataIndex:'DATATYPE', render: 'tms.model.datatype.roster'},
				{name:'#springMessage("view.tms.mgr.namelist.rostertype")', width: 30, dataIndex:'ROSTERTYPE', render:'tms.mgr.rostertype'},
				{name:'#springMessage("view.tms.mgr.namelist.valuecount")', width: 25, dataIndex:'VALUECOUNT'},
				{name:'#springMessage("view.tms.mgr.namelist.createtime")', width: 50, dataIndex:'CREATETIME', render:'datetime'},
				{name:'#springMessage("view.tms.mgr.namelist.iscache")', width: 30, dataIndex:'ISCACHE', render:'tms.mgr.iscache'},
				{name:'#springMessage("view.tms.mgr.namelist.remark")', width: 80, dataIndex:'REMARK'}
			],
			ds:{
				url:"/tms/mgrView/list",
				params:{}
			},
			pagebar: true
		}
	});
	g.goPage();
	
	// 查询
	$("#quick_search_btn").click(function(){
		var params = g.qform.jqDom.serialize();
		g.setDsParams(params);
		g.goPage();
	});
	
	//对话框显示
	var dialog = new jcl.ui.Dialog({draggable: true});
	var viewForm = new jcl.ui.Form({
		display: false,
		layout: 'list',
		items:[
			{label: 'rosterId', name: 'rosterId', type: 'hidden'},
			{label: '#springMessage("view.tms.mgr.namelist.rostername")', name: 'rostername', type:'text'},
			{label: '#springMessage("view.tms.mgr.namelist.rosterdesc")', name: 'rosterdesc', type:'text'},
			{label: '#springMessage("view.tms.mgr.namelist.datatype")', name: 'datatype', type:'selector',
				items:[{text:'--请选择--', value:''}], ds:{type:'code', category:'tms.model.datatype.roster'}
			},
			{label: '#springMessage("view.tms.mgr.namelist.rostertype")', name: 'rostertype', type:'selector',
				items:[{text:'--请选择--', value:''}], ds:{type:'code', category:'tms.mgr.rostertype'}
			},
			{label: '#springMessage("view.tms.mgr.namelist.iscache")', name: 'iscache', type:'radio',value: '1', items:[
				{text: '是', value: '1'},
				{text: '否', value: '0'}
			]},
			{label: '#springMessage("view.tms.mgr.namelist.remark")', name:'remark', type: 'textarea'}
		],
		btns:[
			{text: '#springMessage("view.tms.pub.btn.cancel")', cls: 'cancelBtn'}
		]
	});
	
	dialog.addDom(viewForm.jqDom);
	
	//不可编辑
	viewForm.getItem('rostername').disable(true);
	viewForm.getItem('rosterdesc').disable(true);
	viewForm.getItem('datatype').disable(true);
	viewForm.getItem('rostertype').disable(true);
	viewForm.getItem('iscache').disable(true);
	viewForm.getItem('remark').disable(true);
	
	viewForm.jqDom.find('.cancelBtn').click(function(){
		dialog.hide();
	});
	
	g.toolbar.onClick('#btn-view', function(){
		var rows = g.selectedRows();
		
		var rosterId = rows[0]["ROSTERID"];
		var valuecount = rows[0]["VALUECOUNT"];
		dialog.setTitle('#springMessage("view.tms.mgr.nameviewlist.title")');
		viewForm.jqDom.show();
		dialog.show();
		
		jcl.postJSON('/tms/mgrView/get', 'rosterId='+rosterId, function(data){
			viewForm.set(data.row, {
				'rosterId': 'ROSTERID',
				'rostername': 'ROSTERNAME',
				'rosterdesc': 'ROSTERDESC',
				'datatype': 'DATATYPE',
				'rostertype': 'ROSTERTYPE',
				'rostername_span': 'ROSTERNAME',
				'rosterdesc_span': 'ROSTERDESC',
				'datatype_span': 'DATATYPE',
				'rostertype_span': 'ROSTERTYPE',
				'iscache': 'ISCACHE',
				'remark': 'REMARK'
			});
		});
	});
	
	// 值维护
	g.toolbar.onClick('#btn-valueMgr', function(){
		var rows = g.selectedRows();
		var rosterId = '';
		var dataType = [];
		$.each(rows, function(i,row){
			rosterId = row['ROSTERID'];
			dataType.push('datatype=' + row['DATATYPE']);
		});
		var params = dataType[0] + "&rosterId=" + rosterId;
		jcl.go('/tms/mgrView/valuelist?'+params);
	});
	
	// 名单数据类型下拉列表
	jcl.code.selector('DATATYPE','tms.model.datatype.roster',{text:'--请选择--',value:''});
	// 名单类型下拉列表
	jcl.code.selector('ROSTERTYPE','tms.mgr.rostertype',{text:'--请选择--',value:''});
});	
</script>

</head>
<body>

</body>
</html>
