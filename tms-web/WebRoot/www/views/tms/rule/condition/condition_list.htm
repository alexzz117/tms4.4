<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.rule.condition.list")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/commoncheck.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	
	//组装表格
	var g = $("#boxdiv").grid({
		title:'#springMessage("view.tms.rule.condition.list")',
		columns:[
			//{name:'序号', width: 15, dataIndex:'CONDID'},
	        {name:'#springMessage("view.tms.rule.condition.add.condname")', width: 50, dataIndex:'CONDNAME'},
			{name:'#springMessage("view.tms.rule.condition.add.type")', width: 30, dataIndex:'RISKTYPE'},
			{name:'#springMessage("view.tms.rule.condition.add.gloid")', width: 30, dataIndex:'GLOBALID'},
			{name:'#springMessage("view.tms.rule.condition.add.desc")', width: 80, dataIndex:'CONDDESC'}
		],
		ds:{
			url:"/tms/rule/condition/list",
			params:{}
		},
		toolbar:[
			{id:"btn-find", icon:"icon-tb-find", text:'#springMessage("view.tms.pub.btn.find")', toggleQform:true},
			{id:"btn-view", icon:"icon-tb-aw-r", text:'#springMessage("view.tms.pub.btn.view")'},
			{id:"btn-import", icon:"icon-tb-edit", text:'#springMessage("view.tms.pub.btn.import")'},
			{id:"btn-del", icon:"icon-tb-del", text:'#springMessage("view.tms.pub.btn.del")'}
		],
		pagebar: true,
		qform: {id:"qform", display:false}

	});
	g.goPage();
	
	
	//转向查看页面
	$("#btn-view").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		var conditionId = [];
		$.each(rows, function(i,row){
			conditionId.push('conditionId='+row['CONDID']);
		});       
		jcl.go('/tms/rule/condition/view?'+conditionId[0]);
	});
	
	$("#quick_search_btn").click(function(){
		var condname = $('#CONDNAME').val();
		var globalid = $('#GLOBALID').val();

		if(Trim(condname).length > 0 && !checkeSpecialCode(Trim(condname))){
			alert('#springMessage("view.tms.rule.condition.add.condname")'+'不能包含特殊字符');
			return $('#CONDNAME').focus();
		}
		if(Trim(globalid).length > 0 && !checkeSpecialCode(Trim(globalid))){
			alert('#springMessage("view.tms.rule.condition.add.gloid")'+'不能包含特殊字符');
			return $('#GLOBALID').focus();
		}

		var params = $('#qform').serialize();
		g.setDsParams(params);
		g.goPage();
	});
	$("#btn-import").click(function(){
		jcl.go('/tms/rule/condition/import');
	});
	
	
	
	$("#btn-del").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		//TODO: 安全起见，应逐条删除
		if(confirm('#springMessage("view.tms.pub.del.confirm")?')){
			var rows = g.selectedRows();
			if(rows.length == 0){ 
				alert('#springMessage("view.tms.pub.checkbox.msg0")!');
				return;
			}
			var conditionId = [];
			$.each(rows, function(i, row){
				conditionId.push('conditionId='+row['CONDID']);
			});
			var params = conditionId.join('&');
			jcl.postJSON('/tms/rule/condition/del', params, function(data){
				var err = data.errorMsg;
				if(err != null && err.length > 0){
					alert(err);
				}else{
					alert('#springMessage("view.tms.pub.del.success")!');
				}
				g.goPage();
			});
		}else{
			return ;
		}
	});
});
</script>

</head>
<body> 

<div id="boxdiv" class="box"></div>
<form id="qform" name="qform">
   <table>
       <tr>
           <td width="60">#springMessage("view.tms.rule.condition.add.condname")</td>
           <td width="215">
               <input name="CONDNAME" id="CONDNAME" type="text" class="itext" value=""/>
           </td>
           <td width="60">#springMessage("view.tms.rule.condition.add.gloid")</td>
           <td width="215">
              <input name="GLOBALID" id="GLOBALID" type="text" class="itext" value=""/>
           </td>
       
           <td width="60">&nbsp;</td>
           <td width="215">&nbsp;</td>
           <td  align="center"><input id="quick_search_btn" type="button" value="#springMessage("ui.common.btn.qquery")" class="btn"/></td>
       </tr>
	</table>
</form>

</body>
</html>
