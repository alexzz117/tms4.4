<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.rule.condition.import.title")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.url.js"></script>
<script type="text/javascript">
$(document).ready(function(){

	//组装表格
	var g = $("#boxdiv").grid({
		title:'#springMessage("view.tms.rule.condition.impbody.upzip")',
		width:1150,
		height:375,
		columns:[
		    {name:'#springMessage("view.tms.pub.view.no")', width: 5, dataIndex:'id'},
			{name:'#springMessage("view.tms.rule.condition.add.successname")', width: 35, dataIndex:'temp'}
		],
		ds:{
			url:"/tms/rule/condition/getfileArray",
			params:{}
		},
		pagebar: true,
		qform: {id:"qform", display:false}

	});
	g.goPage();
	
	
	
	$("#importfile").click(function(){
	
			var rows = g.selectedRows();
			if(rows.length == 0){ 
				alert('#springMessage("view.tms.pub.checkbox.msg0")!');
				return;
			}
			var conditionId = [];
			$.each(rows, function(i, row){
				conditionId.push('conditionId='+row['temp']);
			});
			var params = conditionId.join('&');
			jcl.postJSON('/tms/rule/condition/importCond', params, function(data){
			g.goPage();
			
			
			    if(data.row.fileerrortemp!=null)
               {
               jcl.go('/tms/rule/condition/geterrorlist');
	           }
			    
			   if(data.row.fileerrortemp==null&&data.row.filesuccesstemp!=null)
               {
	            var data = data.row.filesuccesstemp.split(",");
	            var dataStr='';
	            for(var i=0;i<data.length;i++){
	            dataStr+=data[i]+"<br>";
	            }
	            // dataStr=dataStr.substring(0,dataStr.length-6);
	             document.getElementById("condnumber").innerHTML=(data.length);
	             document.getElementById("conditionxml").innerHTML=dataStr;
	             dialog.show();
	          }
	          
	           
	          
	          

			});
	
	});
	
	
	
	$('#cancelBtn').click(function(){
		jcl.go('/tms/rule/condition/import');
	});
	
	var dialog = jcl.ui.Dialog({
		closeable: false,
		title:'#springMessage("view.tms.pub.imp.success")'
	});
	dialog.addDom('succesInfo');
	

	
	
		
    $('#goonBtn').click(function(){
		jcl.go('/tms/rule/condition/import');
	});
	$('#backBtn').click(function(){
		jcl.go('/tms/rule/condition/list');
	});
});


</script>

</head>
<body>
<div id="succesInfo">
	<div>#springMessage("view.tms.pub.dialog.title")
		<ul class="list-box">
	<li class="list-box-item">
		<label class="list-box-item-label">#springMessage("view.tms.rule.condition.add.success")：</label> 
		<span class="list-box-item-content" id="condnumber"></span>#springMessage("view.tms.rule.condition.add.successnum")
	</li>
	<li class="list-box-item">
		<label class="list-box-item-label">#springMessage("view.tms.rule.condition.add.successname")：</label> 
		<span class="list-box-item-content" id="conditionxml"></span>
	</li>
   </ul>
	</div>
	<div class="button-box">
		<input type="button" value="#springMessage("view.tms.pub.btn.continueImp")" class="btn" id="goonBtn"/>
		<input type="button" value="#springMessage("view.tms.pub.btn.banck")" class="btn" id="backBtn"/>
	</div>
</div>
<form name="dataForm" id="dataForm" method="post">
<ul class="list-box">
<div id="boxdiv" class="box"></div>
<div class="button-box">
    <input type="button" value='#springMessage("view.tms.pub.btn.save")' class="btn" id="importfile"/>
	<input type="button" value='#springMessage("view.cmc.pub.btn.banck")' class="btn" id="cancelBtn"/>
</div>
</form>

</body>
</html>
