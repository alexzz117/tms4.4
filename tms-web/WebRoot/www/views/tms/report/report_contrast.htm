<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.report.center.alert")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="$rc.contextPath/s/tms/css/Style.css" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionCharts/FusionCharts.js"></script>
<!-- <script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionMaps/FusionCharts.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/FusionWidgets/FusionCharts.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/PowerCharts/FusionCharts.js"></script>-->
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.url.js"></script>
<script type="text/javascript">
var citycode = jQuery.url.param("citycode");
// 时间改为后台传值 maxiao 2011-9-2
//var start_time = jQuery.url.param("operate_time");
//var end_time = jQuery.url.param("end_time");  
var flag = jQuery.url.param("flag"); 
//alert(flag);
$(document).ready(function(){

	var g = $("#boxdiv_cityalarm").grid({
		title: '#springMessage("view.tms.monitor.center.alertnumst")',
		//width:1150,height:50,checkboxEnable:false,
		width:document.body.clientWidth-30,height:250,checkboxEnable:false,
		columns:[
			//{name:'序号', width: 15, dataIndex:'PATTERNID'},
			{name:'#springMessage("view.tms.report.center.city")', width: 80, dataIndex:'CITYNAME'},
			{name:'#springMessage("view.tms.report.center.usernum")', width: 50, dataIndex:'NUMUSERS'},
			{name:'#springMessage("view.tms.report.center.sessionnum")', width: 50, dataIndex:'NUMSESSIONS'},
			{name:'#springMessage("view.tms.monitor.center.trafficnum")', width: 60, dataIndex:'NUMTXNS'},
			{name:'#springMessage("view.tms.report.center.ruletrig")', width: 60, dataIndex:'NUMTRIGS'},
			{name:'#springMessage("view.tms.report.center.rulehit")', width: 60, dataIndex:'NUMHITS'},
			{name:'#springMessage("view.tms.monitor.center.alertnum")', width: 60, dataIndex:'NUMALERTS'},
			{name:'#springMessage("view.tms.monitor.center.salertnum")', width: 30, dataIndex:'NUMALERTSERIOUS'},
			{name:'#springMessage("view.tms.monitor.center.halertnum")', width: 30, dataIndex:'NUMALERTHIGN'},
			{name:'#springMessage("view.tms.monitor.center.malertnum")', width: 30, dataIndex:'NUMALERTMID'},
			{name:'#springMessage("view.tms.monitor.center.lalertnum")', width: 30, dataIndex:'NUMALERTLOW'},
			{name:'#springMessage("view.tms.monitor.center.nalertnum")', width: 50, dataIndex:'NUMALERTNOR'},
			{name:'#springMessage("view.tms.monitor.center.rulehitrate")', width: 60, dataIndex:'HIT'},
			{name:'#springMessage("view.tms.monitor.center.trafficrate")', width: 60, dataIndex:'ALERT'}
		],
		ds:{
		},
		pagebar: false,
		qform: {id:"qform", display:false}
	});
	
	$("#quick_search_btn").click(function(){
		
		var startTime = $('#operate_time').val();
		var end_time = $('#end_time').val();
		if(startTime==""){
			alert('#springMessage("view.tms.report.center.msg.beginTime")');
			return ;
		}
		if(end_time==""){
			alert('#springMessage("view.tms.report.center.msg.endTime")');
			return ;
		}
		if(startTime!="" && end_time!="" && startTime>end_time){
			alert('#springMessage("view.cmc.log.list.msg.endTimeEarly")');
			return ;
		}
		contrast(g);
		//var params = $('#qformdate').serialize();
		//g.setDsParams(params);
		//g.goPage();
	});
	
	// 取系统时间，之后进行后续的工作
	jcl.postJSON('/tms/report/contrast/time','',function(data){
		$('#operate_time').val(data.row.startTime);
		$('#end_time').val(data.row.endTime);
		initParams();
		contrast(g);
	});
});

//
function contrast(g){
	// 时间改为后台取
	//if(flag=="city" || flag=="region"){
		jcl.postJSON('/tms/report/chart/condition/all', "citycode="+$('#citycode').val()+"&operate_time="+$('#operate_time').val()+"&end_time="+$('#end_time').val()+"&flag="+$('#flag').val(), function(data){
		//jcl.postJSON('/tms/report/chart/condition/all', "citycode="+$('#citycode').val()+"&flag="+$('#flag').val(), function(data){
			g.renderPage(data.page);
			var chart = new FusionCharts("$rc.contextPath/s/tms/chart/MSColumn3D.swf", "ChartId",document.body.clientWidth-30, "270", "0", "0");
			chart.setDataXML(data.row);
			chart.render("chartdiv_contrast");
			
		});
	/*}else {
		jcl.postJSON('/tms/report/chart/contrast/all', "citycode="+$('#citycode').val()+"&operate_time="+$('#operate_time').val()+"&end_time="+$('#end_time').val()+"&flag="+$('#flag').val(), function(data){
		//jcl.postJSON('/tms/report/chart/contrast/all', "citycode="+$('#citycode').val()+"&flag="+$('#flag').val(), function(data){
			g.renderPage(data.page);
			var chart = new FusionCharts("$rc.contextPath/s/tms/chart/MSColumn3D.swf", "ChartId",document.body.clientWidth-30, "270", "0", "0");
			chart.setDataXML(data.row);
			chart.render("chartdiv_contrast");
		});
	}*/
}

function initParams(){
	//var nowDate = new Date();
	//var year = nowDate.getFullYear();
	//var month = nowDate.getMonth()+1;//获取本月
	//var lastDay = new Date(year, month, 0).getDate();//获取本年最后一天
	//if(month < 10) month = "0" + month;
	//$('#operate_time').val(start_time);
	//$('#end_time').val(end_time);
	$('#citycode').val(citycode);
	$('#flag').val(flag);
}
</script>
</head>
  <body>
    <table width="98%" border="0" cellspacing="0" cellpadding="1" align="center">
    <form name="qformdate" id="qformdate" method="post">
	  <tr>
	    <td height="28"><div id="al006" style="font-size:13px">#springMessage("view.tms.report.center.timescope")：
	    	<input name="operate_time" id="operate_time" onfocus="jcl.datepicker(this)" readonly="readonly"  type="text" class="itext" value=""/>
	    	-- <input name="end_time" id="end_time" onfocus="jcl.datepicker(this)" readonly="readonly"  type="text" class="itext" value=""/> 
	    	<input id="quick_search_btn" type="button" value='#springMessage("view.tms.report.center.query")' class="btn"/>
	    	<input id="back" name="back" type="button" value="返回" onclick="window.history.go(-1)" class="btn"/>
	    	<input id="citycode" name="citycode" type="hidden" value=""/>
	    	<input id="type" name="type" type="hidden" value="citycode"/>
	    	<input id="flag" name="flag" type="hidden" value=""/>
	    </div></td>
	  </tr>
	  </form>
	  <tr>
	    <td height="280"><div id="chartdiv_contrast" align="center"></div></td>
	  </tr>
	  <tr>
	    <td height="280"><div id="boxdiv_cityalarm" class="box"></div></td>
	  </tr>
	</table>
  </body>
</html>
