<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>#springMessage("view.tms.metaobj.objlist")</title>
<link href="$rc.contextPath/s/common/css/page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.min.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/browser.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jcl.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/env.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/env/message.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/common/js/jquery.url.js"></script>
<script type="text/javascript" src="$rc.contextPath/s/tms/js/commoncheck.js"></script>
<script type="text/javascript">
var versionId = jQuery.url.param("versionId");
var versionName = jQuery.url.param("versionName");
$(document).ready(function(){
	//组装表格
	var g = $("#boxdiv").grid({
		title:'#springMessage("view.tms.metaobj.objlist")(#springMessage("view.tms.metaobj.obj")：'+versionName+')',
		columns:[
			{name:'#springMessage("view.tms.metaobj.name")', width: 100, dataIndex:'OBJNAME'},
			{name:'#springMessage("view.tms.metaobj.order")', width: 30, dataIndex:'ORDERBY'},
			{name:'#springMessage("view.tms.metaobj.createTime")', width: 80, dataIndex:'CREATETIME'},
			{name:'#springMessage("view.tms.metaobj.isextend")', width: 50, dataIndex:'ISEXTEND', render:'tms.common.extend'},
			{name:'#springMessage("view.tms.metaobj.isdisplay")', width: 40, dataIndex:'ISDISPLAY', render:'tms.common.display'}
			//{name:'是否启用', width: 30, dataIndex:'STATUS', render:'tms.common.used'},
		],
		ds:{
			url:"/tms/mgr/meta/objlist",
			params:{versionId:''+versionId}
		},
		toolbar:[
			{id:"btn-find", icon:"icon-tb-find", text:'#springMessage("view.tms.pub.btn.find")', toggleQform:true},
			{id:"btn-add", icon:"icon-tb-add", text:'#springMessage("view.tms.pub.btn.new")'},
			{id:"btn-edit", icon:"icon-tb-edit", text:'#springMessage("view.tms.pub.btn.edit")'},
			{id:"btn-del", icon:"icon-tb-del", text:'#springMessage("view.tms.pub.btn.del")'},
			//{id:"btn-used", icon:"icon-tb-gear", text:'#springMessage("view.tms.pub.btn.used")'},
			//{id:"btn-unused", icon:"icon-tb-del", text:'#springMessage("view.tms.pub.btn.unused")'},
			{id:"btn-grant", icon:"icon-tb-gear", text:'#springMessage("view.tms.pub.btn.attr")'}
		],
		pagebar: true,
		qform: {id:"qform", display:false}

	});
	g.goPage();
	
	
	$("#quick_search_btn").click(function(){
		var objname = $('#OBJNAME').val();
		var flag = checkeSpecialCode(objname);
		if(!flag){
			alert('类别名称含有特殊字符');
			return;
		}
		var params = $('#qform').serialize();
		g.setDsParams(params);
		g.goPage();
	});
	$("#btn-add").click(function(){
		jcl.go('/tms/mgr/meta/objadd?versionId='+versionId+'&versionName='+versionName);
	});
	
	$("#btn-edit").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		var objId = [];
		$.each(rows, function(i,row){
			objId.push('objId='+row['METAOBJID']);
		});                  
		jcl.go('/tms/mgr/meta/objmod?'+objId[0]+'&versionId='+versionId+'&versionName='+versionName);
	});
	
	
	$("#btn-del").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		if(confirm('#springMessage("view.cmc.pub.del.confirm")?')){
			var versionId = $("#versionId").val();
			var objId = [];
			$.each(rows, function(i,row){
				objId.push('objId='+row['METAOBJID']);
			});  
			var params = objId.join('&');
			params+='&versionId='+versionId;
			//alert(params);
			jcl.postJSON('/tms/mgr/meta/delobj', params, function(data){
				if(data.success){
					alert('#springMessage("view.cmc.pub.del.success")!');
					g.goPage();
				}
			});
		}else{
			return ;
		}
	});
	
	
	//属性配置
	$("#btn-grant").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		var objId = rows[0]['METAOBJID'];
		var objName = rows[0]['OBJNAME'];
		jcl.go('/tms/mgr/meta/objparamlist?versionId='+versionId+'&versionName='+versionName+'&objId='+objId+'&typeName='+objName);
	});
	
	jcl.code.selector('ISEXTEND','tms.common.extend',{text:'--请选择--',value:''});
	jcl.code.selector('ISDISPLAY','tms.common.display',{text:'--请选择--',value:''});
	$("#versionId").val(versionId);
	$("#versionName").val(versionName);
	
});


///无使用，启用和停用按钮被注释。将启用停用方法暂且放到此处。别删除
function temp(){
	//启用
	$("#btn-used").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		var objId = [];
		var status;
		$.each(rows, function(i,row){
			status=row['STATUS'];
			objId.push('objId='+row['METAOBJID']);
		});
		if(status=='1'){
			alert("已经处于启用状态！");
			return;
		}
		var params = objId[0]+"&status=1";
		
		jcl.postJSON('/tms/mgr/meta/updateStatus', params, function(data){
			if(data.success){
				alert('操作成功!');
				g.goPage();
			}
		});
	});
	
	//停用
	$("#btn-unused").click(function(){
		var rows = g.selectedRows();
		if(rows.length == 0){ 
			alert('#springMessage("view.cmc.pub.checkbox.msg0")!');
			return;
		}
		if(rows.length>1){
			alert('#springMessage("view.cmc.pub.checkbox.msg1")!');
			return;
		}
		var objId = [];
		var status ;
		$.each(rows, function(i,row){
			status=row['STATUS'];
			objId.push('objId='+row['METAOBJID']);
		});
		if(status=='0'){
			alert("已经处于停用状态！");
			return;
		}
		var params = objId[0]+"&status=0";
		
		jcl.postJSON('/tms/mgr/meta/updateStatus', params, function(data){
			if(data.success){
				alert('操作成功!');
				g.goPage();
			}
		});
	});
}

//查看类别信息
function viewObj(objId){
	//jcl.go('/tms/mgr/meta/objview?objId='+objId+'&versionId='+versionId+'&versionName='+versionName);
}

</script>

</head>
<body>

<div id="boxdiv" class="box"></div>

<form id="qform" name="qform">
<input style="display: none"/>
   <table   width="99%" >
       <tr>
           <td width="100" align="right">#springMessage("view.tms.metaobj.name")</td>
           <td width="150">
           	   <input name="versionId" id="versionId" type="hidden" class="itext" value=""/>
           	   <input name="versionName" id="versionName" type="hidden" class="itext" value=""/>
               <input name="OBJNAME" id="OBJNAME" type="text"  class="itext" value=""/>
           </td>
           <td width="120" align="right">#springMessage("view.tms.metaobj.isextend")</td>
           <td width="100">
               <select name="ISEXTEND" id="ISEXTEND"  style="width: 100">
               </select>
           </td>
           <td width="100" align="right">#springMessage("view.tms.metaobj.isdisplay")</td>
           <td width="140" >
               <select name="ISDISPLAY" id="ISDISPLAY"  style="width: 120">
               </select>
           </td>
           <td  align="center"  >
           <input id="quick_search_btn" type="button" value='#springMessage("ui.common.btn.qquery")' class="btn"/>
           </td>
       </tr>
    
	</table>
</form>

</body>
</html>
