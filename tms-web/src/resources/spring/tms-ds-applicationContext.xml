<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
			http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
			http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">

	<!--<context:property-placeholder location="classpath:resources/db/db.properties" ignore-unresolvable="true" /> -->
	<tx:annotation-driven />

	<!-- official 正式数据源配置 -->
	<bean id="officialTmsDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>jdbc/tmsDS_on</value>
		</property>
		<property name="resourceRef">
			<value>true</value>
		</property>
	</bean>

	<!-- tms 临时数据源配置 -->
	<!-- jndi resourceRef=true 'java:comp/env/'前缀不用写 -->
	<bean id="tmpTmsDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>jdbc/tmsDS_off</value>
		</property>
		<property name="resourceRef">
			<value>true</value>
		</property>
	</bean>

	<!-- report 报表数据源配置 -->
	<bean id="reportDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>jdbc/tmsDS_off</value>
		</property>
		<property name="resourceRef">
			<value>true</value>
		</property>
	</bean>
	
	<!-- 规则迭代系统数据源 -->
	<bean id="iteratorDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>jdbc/tmsDS_iterator</value>
		</property>
		<property name="resourceRef">
			<value>true</value>
		</property>
	</bean>
	<!-- facade data source -->
	<bean id="dynamicDataSource" class="cn.com.higinet.cmc.common.DynamicDataSource">
		<property name="targetDataSources">
			<map key-type="cn.com.higinet.cmc.common.DSType">
				<entry key="DS_TEMP" value-ref="tmpTmsDataSource" />
				<entry key="DS_OFFICIAL" value-ref="officialTmsDataSource" />
			</map>
		</property>
		<property name="defaultTargetDataSource" ref="officialTmsDataSource" />
	</bean>

	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="dynamicDataSource"></property>
	</bean>

	<!-- 动态数据源数据访问配置 -->
	<bean id="tmsJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="dynamicDataSource" />
	</bean>
	<bean id="tmsSimpleDao" name="tmsSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="tmsJdbcTemplate" />
	</bean>

	<!-- 临时表数据访问配置 -->
	<bean id="tmpJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="tmpTmsDataSource" />
	</bean>
	<bean id="tmpSimpleDao" name="tmpSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="tmpJdbcTemplate" />
	</bean>
	<bean id="tmpTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" p:dataSource-ref="tmpTmsDataSource">
		<qualifier value="tmp" />
	</bean>

	<!-- 正式表数据访问配置 -->
	<bean id="officialJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="officialTmsDataSource" />
	</bean>
	<bean id="officialSimpleDao" name="officialSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="officialJdbcTemplate" />
	</bean>
	<bean id="officialTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" p:dataSource-ref="officialTmsDataSource">
		<qualifier value="official" />
	</bean>

	<!-- cmc 数据访问配置 -->
	<bean id="cmcJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="tmpTmsDataSource"></property>
	</bean>
	<bean id="cmcSimpleDao" name="cmcSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="cmcJdbcTemplate"></property>
	</bean>
	<bean id="cmcTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" p:dataSource-ref="tmpTmsDataSource">
		<qualifier value="cmc" />
	</bean>

	<!-- 报表数据访问配置 -->
	<bean id="reportJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="reportDataSource"></property>
	</bean>
	<bean id="reportSimpleDao" name="reportSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="reportJdbcTemplate"></property>
	</bean>
	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" p:dataSource-ref="dynamicDataSource">
	</bean>

	<!-- 规则迭代系统数据访问配置 -->
	<bean id="iteratorJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="iteratorDataSource"></property>
	</bean>
	<bean id="iteratorSimpleDao" name="iteratorSimpleDao" class="cn.com.higinet.rapid.base.dao.impl.OracleSimpleDaoImpl">
		<property name="jdbcTemplate" ref="iteratorJdbcTemplate"></property>
	</bean>
	<bean id="iteratorTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" p:dataSource-ref="iteratorDataSource">
		<qualifier value="iterator" />
	</bean>
</beans>