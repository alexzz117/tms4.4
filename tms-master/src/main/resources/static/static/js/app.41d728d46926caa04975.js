webpackJsonp([1],{0:function(e,t,a){a("briU"),e.exports=a("NHnr")},"0Q3I":function(e,t){},"2SXd":function(e,t){},"5b3A":function(e,t){},"7/a6":function(e,t){},"70tm":function(e,t){},"7QJy":function(e,t){},"7bSW":function(e,t){},"7tEl":function(e,t){},"9Hxr":function(e,t){},Achy:function(e,t){},"F+RQ":function(e,t){},F69p:function(e,t){},FWz2:function(e,t){},"G/rv":function(e,t){},JG4Z:function(e,t){},Kz57:function(e,t){},N74T:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("VCXJ"),l=a("mwE6"),o=a.n(l),i=(a("F+RQ"),a("zO6J")),n=a("aA9S"),s=a.n(n),c=a("2sCs"),u=a.n(c),d=a("hRKE"),m=a.n(d),p=a("HzJ8"),f=a.n(p),h=0,g="=";function v(e){return _(b(F(e)))}function b(e){return w(D(x(e),8*e.length))}function _(e){for(var t,a=h?"0123456789ABCDEF":"0123456789abcdef",r="",l=0;l<e.length;l++)t=e.charCodeAt(l),r+=a.charAt(t>>>4&15)+a.charAt(15&t);return r}function y(e){for(var t="",a=e.length,r=0;r<a;r+=3)for(var l=e.charCodeAt(r)<<16|(r+1<a?e.charCodeAt(r+1)<<8:0)|(r+2<a?e.charCodeAt(r+2):0),o=0;o<4;o++)8*r+6*o>8*e.length?t+=g:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6*(3-o)&63);return t}function F(e){for(var t,a,r="",l=-1;++l<e.length;)t=e.charCodeAt(l),a=l+1<e.length?e.charCodeAt(l+1):0,55296<=t&&t<=56319&&56320<=a&&a<=57343&&(t=65536+((1023&t)<<10)+(1023&a),l++),t<=127?r+=String.fromCharCode(t):t<=2047?r+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r}function x(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function w(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function D(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,r=-271733879,l=-1732584194,o=271733878,i=0;i<e.length;i+=16){var n=a,s=r,c=l,u=o;r=I(r=I(r=I(r=I(r=T(r=T(r=T(r=T(r=C(r=C(r=C(r=C(r=k(r=k(r=k(r=k(r,l=k(l,o=k(o,a=k(a,r,l,o,e[i+0],7,-680876936),r,l,e[i+1],12,-389564586),a,r,e[i+2],17,606105819),o,a,e[i+3],22,-1044525330),l=k(l,o=k(o,a=k(a,r,l,o,e[i+4],7,-176418897),r,l,e[i+5],12,1200080426),a,r,e[i+6],17,-1473231341),o,a,e[i+7],22,-45705983),l=k(l,o=k(o,a=k(a,r,l,o,e[i+8],7,1770035416),r,l,e[i+9],12,-1958414417),a,r,e[i+10],17,-42063),o,a,e[i+11],22,-1990404162),l=k(l,o=k(o,a=k(a,r,l,o,e[i+12],7,1804603682),r,l,e[i+13],12,-40341101),a,r,e[i+14],17,-1502002290),o,a,e[i+15],22,1236535329),l=C(l,o=C(o,a=C(a,r,l,o,e[i+1],5,-165796510),r,l,e[i+6],9,-1069501632),a,r,e[i+11],14,643717713),o,a,e[i+0],20,-373897302),l=C(l,o=C(o,a=C(a,r,l,o,e[i+5],5,-701558691),r,l,e[i+10],9,38016083),a,r,e[i+15],14,-660478335),o,a,e[i+4],20,-405537848),l=C(l,o=C(o,a=C(a,r,l,o,e[i+9],5,568446438),r,l,e[i+14],9,-1019803690),a,r,e[i+3],14,-187363961),o,a,e[i+8],20,1163531501),l=C(l,o=C(o,a=C(a,r,l,o,e[i+13],5,-1444681467),r,l,e[i+2],9,-51403784),a,r,e[i+7],14,1735328473),o,a,e[i+12],20,-1926607734),l=T(l,o=T(o,a=T(a,r,l,o,e[i+5],4,-378558),r,l,e[i+8],11,-2022574463),a,r,e[i+11],16,1839030562),o,a,e[i+14],23,-35309556),l=T(l,o=T(o,a=T(a,r,l,o,e[i+1],4,-1530992060),r,l,e[i+4],11,1272893353),a,r,e[i+7],16,-155497632),o,a,e[i+10],23,-1094730640),l=T(l,o=T(o,a=T(a,r,l,o,e[i+13],4,681279174),r,l,e[i+0],11,-358537222),a,r,e[i+3],16,-722521979),o,a,e[i+6],23,76029189),l=T(l,o=T(o,a=T(a,r,l,o,e[i+9],4,-640364487),r,l,e[i+12],11,-421815835),a,r,e[i+15],16,530742520),o,a,e[i+2],23,-995338651),l=I(l,o=I(o,a=I(a,r,l,o,e[i+0],6,-198630844),r,l,e[i+7],10,1126891415),a,r,e[i+14],15,-1416354905),o,a,e[i+5],21,-57434055),l=I(l,o=I(o,a=I(a,r,l,o,e[i+12],6,1700485571),r,l,e[i+3],10,-1894986606),a,r,e[i+10],15,-1051523),o,a,e[i+1],21,-2054922799),l=I(l,o=I(o,a=I(a,r,l,o,e[i+8],6,1873313359),r,l,e[i+15],10,-30611744),a,r,e[i+6],15,-1560198380),o,a,e[i+13],21,1309151649),l=I(l,o=I(o,a=I(a,r,l,o,e[i+4],6,-145523070),r,l,e[i+11],10,-1120210379),a,r,e[i+2],15,718787259),o,a,e[i+9],21,-343485551),a=$(a,n),r=$(r,s),l=$(l,c),o=$(o,u)}return Array(a,r,l,o)}function S(e,t,a,r,l,o){return $((i=$($(t,e),$(r,o)))<<(n=l)|i>>>32-n,a);var i,n}function k(e,t,a,r,l,o,i){return S(t&a|~t&r,e,t,l,o,i)}function C(e,t,a,r,l,o,i){return S(t&r|a&~r,e,t,l,o,i)}function T(e,t,a,r,l,o,i){return S(t^a^r,e,t,l,o,i)}function I(e,t,a,r,l,o,i){return S(a^(t|~r),e,t,l,o,i)}function $(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}var L={md5:function(e){return v(e).toUpperCase()},base64:function(e){return y(F(e))}},q=Object.prototype.toString,P=Object.prototype.hasOwnProperty,R=(Array.prototype.push,Array.prototype.slice,String.prototype.trim),V=(Array.prototype.indexOf,{});function z(e){return null!=e&&e==e.window}function N(e){return null==e?String(e):V[q.call(e)]||"object"}function E(e){if(!e||"object"!==N(e)||z(e))return!1;try{if(e.constructor&&!P.call(e,"constructor")&&!P.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e);return void 0===t||P.call(e,t)}function O(e){throw new Error(e)}function A(e,t,a){if("lower"===a)for(var r in e)M.isPlainObject(e[r])||M.isArray(e[r])?t[r.toLowerCase()]=B(e[r],a):t[r.toLowerCase()]=e[r];else if("upper"===a)for(var r in e)M.isPlainObject(e[r])||M.isArray(e[r])?t[r.toUpperCase()]=B(e[r],a):t[r.toUpperCase()]=e[r];return t}function B(e,t){var a;return a=t||"lower",E(e)?A(e,{},a):M.isArray(e)?A(e,[],a):e}var W=["\\","$","(",")","*","+",".","[","]","?","^","{","}","|"];var M={escapeExprSpecialWord:function(e){if(!e||""===e)return"";var t=!0,a=!1,r=void 0;try{for(var l,o=f()(W);!(t=(l=o.next()).done);t=!0){var i=l.value;e.includes(i)&&(e=e.replace(i,"\\"+i))}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return e},getWebRootPath:function(){var e=window.document.location.pathname;return e.substring(0,e.substr(1).indexOf("/")+1)},isFunction:function(e){return"function"===N(e)},renderDate:function(e){if(0==e||"undefined"==e||null==e||""==e)return"";try{var t=new Date(parseInt(e,10)),a=(t.getMonth()+1).toString(),r=t.getFullYear().toString(),l=t.getDate().toString();return[r,a.length<2?"-0":"-",a,l.length<2?"-0":"-",l].join("")}catch(t){return e}},renderDateTime:function(e){if(0==e||"undefined"==e||null==e||""==e)return"";try{var t=new Date(parseInt(e,10)),a=(t.getMonth()+1).toString(),r=t.getFullYear().toString(),l=t.getDate().toString(),o=t.getHours().toString(),i=t.getMinutes().toString(),n=t.getSeconds().toString();return[r,a.length<2?"-0":"-",a,l.length<2?"-0":"-",l,o.length<2?" 0":" ",o,i.length<2?":0":":",i,n.length<2?":0":":",n].join("")}catch(t){return e}},isArray:Array.isArray||function(e){return"array"===N(e)},isWindow:z,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isNumber:function(e,t,a){var r="^";return t?"-"==t&&(r+="-"):r+="-?",r+=a?"0"==a?"(0|([1-9]+\\d*))$":"\\d+(\\.\\d{1,"+a+"})?$":"\\d+(\\.\\d+)?$",new RegExp(r,"g").test(e)},type:N,isPlainObject:E,isEmptyObject:function(e){for(var t in e)return!1;return!0},error:O,parseJSON:function(e){return"string"==typeof e&&e?(e=M.trim(e),window.JSON&&window.JSON.parse?window.JSON.parse(e):rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+e)():void O("Invalid JSON: "+e)):null},noop:function(){},orderList:function(e,t){var a=[];if(void 0!==e&&void 0!==t)for(var r=(a=a.concat(e)).length;r>1;){for(var l=0;l<r-1;l++){var o=null,i=a[l],n=a[l+1];Number(i[t])<Number(n[t])&&(o=i,a[l]=n,a[l+1]=o)}r--}return a},trim:R?function(e){return null==e?"":R.call(e)}:function(e){return null==e?"":e.toString().replace(trimLeft,"").replace(trimRight,"")},toggleObjKey:B,formatMoney:function(e,t,a){if(IsNumber(e)){t=t>0&&t<=20?t:2,a=void 0===a?"":a,e=parseFloat((e+"").replace(/[^\d\.-]/g,""));for(var r=new Number(e+1).toFixed(t),l=(e=new Number(r-1).toFixed(t)+"").split(".")[0].split("").reverse(),o=e.split(".")[1],i="",n=0;n<l.length;n++)i+=l[n]+((n+1)%3==0&&n+1!=l.length?a:"");return i.split("").reverse().join("")+"."+o.substring(0,t)}return""},isEmpty:function(e){return""===e||null===e||void 0===e},extend:function(){var e,t,a,r,l,o,i=arguments[0]||{},n=1,s=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},n=2),"object"===(void 0===i?"undefined":m()(i))||M.isFunction(i)||(i={}),s===n&&(i=this,--n);n<s;n++)if(null!=(e=arguments[n]))for(t in e)a=i[t],i!==(r=e[t])&&(c&&r&&(M.isPlainObject(r)||(l=M.isArray(r)))?(l?(l=!1,o=a&&M.isArray(a)?a:[]):o=a&&M.isPlainObject(a)?a:{},i[t]=M.extend(c,o,r)):void 0!==r&&(i[t]=r));return i},serializeObj:function(e){var t="";if(M.isPlainObject(e))for(var a in e)t+="&"+a+"="+e[a];return t},crypt:L,formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid&&"-1"!==e[r].fid||void 0!==e[r].id&&null!==e[r].id&&""!==e[r].id&&t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},expendNodesByLevel:function(e,t){var a=[];if(t>0){t--;for(var r=0;r<e.length;r++)a.push(e[r].id),t>0&&e[r].children&&e[r].children.length>0&&(a=a.concat(M.expendNodesByLevel(e[r].children,t)))}return a},checkKeys:function(e,t,a){for(var r=[],l=0;l<e.length;l++){var o=e[l];o[t]===a&&r.push(o.id),o.children&&(r=r.concat(M.checkKeys(o.children,t,a)))}return r},renderCellValue:function(e,t){t+="";for(var a=0;a<e.length;a++)if(e[a].value===t)return e[a].label;return t},getCookie:function(e){var t,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?t[2]:null},setCookie:function(e,t,a){var r=new Date;r.setDate(r.getDate()+a),document.cookie=e+"="+escape(t)+(null==a?"":";expires="+r.toGMTString())},delCookie:function(e){var t=new Date;t.setTime(t.getTime()-1);var a=getCookie(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())}},j=M,U=new r.default({}),X={prefix:"/context"},K={none:"/",manager:"/manager",dualaudit:"/dualaudit/manager",timer:"",plus:"/plus"},G={url:"",param:{},model:K.manager,toLowerCase:!0,loading:!1,success:function(e){},error:function(e){var t="";t=e.error&&Array.isArray(e.error)?e.error.join(","):e.error;var a="";a=Array.isArray(t)?t.join(","):t,U.$message({showClose:!0,message:a,type:"error"})},fail:function(e){var t=e.response,a=void 0;a=t&&t.data&&t.data.message?t.data.message:e.message;var r="";r=Array.isArray(a)?a.join(","):a,U.$message({showClose:!0,message:r,type:"error"})}};var H={post:function(e){var t={};if(s()(t,G,e),t.loading)var a=U.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var r=X.prefix+t.model+t.url;u.a.post(r,t.param).then(function(e){var r;200===e.status&&(e.data&&!0===e.data.success?(r=t.toLowerCase?j.toggleObjKey(e.data):e.data,t.success(r)):t.error(e.data)),a&&a.close()}).catch(function(e){t.fail(e),a&&a.close()})},get:function(e){var t={};if(s()(t,G,e),t.loading)var a=U.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var r=X.prefix+t.model+t.url;u.a.get(r).then(function(e){var r;200===e.status&&(e.data&&!0===e.data.success?(r=t.toLowerCase?j.toggleObjKey(e.data):e.data,t.success(r)):t.error(e.data)),a&&a.close()}).catch(function(e){t.fail(e),a&&a.close()})},syncGet:function(e){var t={};s()(t,G,e);var a=X.prefix+t.model+t.url;window.location.href=a},model:K},Q={data:function(){return{loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},checked:!0}},mounted:function(){this.$nextTick(function(){if(window.Storage&&window.localStorage&&window.localStorage instanceof Storage){var e=localStorage.getItem("loginUserName");e&&(this.loginForm.username=e)}})},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.login()})},resetForm:function(e){this.$refs[e].resetFields()},login:function(){var e=this,t={username:this.loginForm.username,password:j.crypt.md5(this.loginForm.password)};H.post({url:"/login",param:t,success:function(t){sessionStorage.setItem("userName",e.loginForm.username),window.Storage&&window.localStorage&&window.localStorage instanceof Storage&&(e.checked?localStorage.setItem("loginUserName",e.loginForm.username):localStorage.removeItem("loginUserName")),e.$router.push({name:"main"})}})},pressKey:function(e){13===e.keyCode&&this.submitForm("loginForm")}}},Y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-bg"},[a("section",{staticClass:"content-box"},[a("div",{staticClass:"form-head"},[e._v("登录")]),e._v(" "),a("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.rules,size:"large"}},[a("el-form-item",{attrs:{label:"",prop:"username"}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"password"}},[a("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"请输入密码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.pressKey(t)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("记住用户名")])],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){e.submitForm("loginForm")}}},[e._v("登录")])],1)],1)],1)])},staticRenderFns:[]};var Z=a("X4nt")(Q,Y,!1,function(e){a("X5WZ")},null,null).exports,J={checkSpecialCode:function(e){if(j.isEmpty(e))return!0;for(var t="~`#$￥%^&*{}=][【】《》><?？/\\'",a=0;a<t.length;a++)if(-1!=e.indexOf(t.charAt(a)))return!1;return!0},checkFormSpecialCode:function(e,t,a){if(!J.checkSpecialCode(t))return a(new Error("请不要输入特殊字符！如($,%)"));a()},checkFormEnSpecialCharacter:function(e,t,a){if(!J.checkSpecialCharacter(t,1))return a(new Error("请以字母开头，包括字母、数字和下划线"));a()},checkFormZhSpecialCharacter:function(e,t,a){if(!J.checkSpecialCharacter(t,2))return a(new Error("只能包含汉字,字母,数字和下划线"));a()},checkFormZhSpecialCharacterHasPunctuation:function(e,t,a){if(!J.checkSpecialCharacterHasPunctuation(t))return a(new Error("只能包含汉字,字母,数字,下划线,逗号,句号,问号"));a()},checkFormIp:function(e,t,a){if(null!=t&&""!==t||a(),!/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)/.test(t))return a(new Error("请输入正确的IP地址"));a()},checkSpecialCharacter:function(e,t){return"1"==t?/^[a-zA-Z][\w]*$/.test(e):/^[\w\u4e00-\u9fa5]*$/.test(e)},checkSpecialCharacterHasPunctuation:function(e){return/^[\w\u4e00-\u9fa5,\.，。!！\?？]*$/.test(e)},checkSpecialCharacterInTxn:function(e,t,a){var r=J.checkSpecialCharacter(t,a);return r||alert(e+"只能包含汉字,字母,数字和下划线"),r},isIP:function(e){return!!(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/g.test(e)&&RegExp.$1<256&&RegExp.$2<256&&RegExp.$3<256&&RegExp.$4<256)},checkStrength:function(e){var t=0;return e.length<1?t:(/\d/.test(e)&&t++,/[a-z]/.test(e)&&t++,/[A-Z]/.test(e)&&t++,/\W/.test(e)&&t++,t>=3&&e.length>10&&(t=4),t)}},ee=J,te={name:"items",created:function(){var e=this;this.Hub.$on("changeModeName",function(t){e.modeName=t}),this.getMeuns(),this.userName=sessionStorage.getItem("userName")},data:function(){var e=this,t=function(t,a,r){if(""==e.passwordDialogform.r_new_pwd&&r(),e.passwordDialogform.new_pwd!==e.passwordDialogform.r_new_pwd)return r(new Error("两次输入的新密码不一致"));r()};return{funData:[],menus:[],modeName:"",userName:"",closeOnClickModal:!1,formLabelWidth:"100px",updPassDialogVisible:!1,passwordDialogform:this.initFormData(),rules:{old_pwd:[{required:!0,message:"请输入旧密码",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"}],new_pwd:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码不能少于6位",trigger:"blur"},{max:20,message:"密码不能大于20位",trigger:"blur"},{validator:function(t,a,r){if(e.passwordDialogform.old_pwd===e.passwordDialogform.new_pwd)return r(new Error("新密码与旧密码不能相同"));r()},trigger:"blur"},{validator:t,trigger:"blur"},{validator:function(e,t,a){if(ee.checkStrength(t)<2)return a(new Error("密码要同时包括数字和字母"));a()},trigger:"blur"}],r_new_pwd:[{required:!0,message:"请输入确认新密码",trigger:"blur"},{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:t,trigger:"blur"}]}}},methods:{initFormData:function(){return{old_pwd:"",new_pwd:"",r_new_pwd:""}},handleSelect:function(e,t){for(var a=e.split("-"),r={},l=0;l<a.length;l++)r=0===l?this.menus[a[l]]:r.children[a[l]];this.modeName=r.text},getMeuns:function(){var e=this;H.post({url:"/menu",param:{},success:function(t){j.isArray(t.list)&&t.list.length>0&&(e.menus=j.formatTreeData(t.list))}})},handleCommand:function(e){switch(e){case"openDialog":return this.passwordDialogform=this.initFormData(),this.$refs.passwordDialogform&&this.$refs.passwordDialogform.clearValidate(),this.updPassDialogVisible=!0;case"logout":return this.logout()}},updatePassword:function(){var e=this,t=s()({},this.passwordDialogform,{old_password:j.crypt.md5(this.passwordDialogform.old_pwd),new_password:j.crypt.md5(this.passwordDialogform.new_pwd)});H.post({url:"/profile/pwd/update",param:t,success:function(t){e.$message({type:"success",message:"修改成功"}),e.passwordDialogform=this.initFormData(),e.updPassDialogVisible=!1}})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.updatePassword()})},logout:function(){this.$router.push({name:"login"}),H.post({url:"/logout"})}}},ae={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"wrapper",staticStyle:{height:"100%",border:"1px solid #eee"}},[a("el-container",[a("el-aside",{staticStyle:{overflow:"hidden",height:"100%","padding-top":"60px","box-sizing":"border-box"},attrs:{width:"220px"}},[a("div",{staticClass:"title"},[e._v("TMS")]),e._v(" "),a("div",{staticClass:"scroll",staticStyle:{overflow:"auto",height:"100%",margin:"60px 0px 10px 0px"}},[a("el-menu",{on:{select:e.handleSelect}},e._l(e.menus,function(t,r){return a("el-submenu",{key:t.id,attrs:{index:r.toString()}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-message"}),e._v(e._s(t.text))]),e._v(" "),e._l(t.children,function(t,l){return a("div",[t.children&&t.children.length>0?a("el-submenu",{key:t.id,attrs:{index:l.toString()}},[a("template",{slot:"title"},[e._v(e._s(t.text))]),e._v(" "),a("el-menu-item",{attrs:{index:r.toString()+"-"+l.toString()}},[e._v(e._s(t.text))])],2):a("router-link",{attrs:{to:{name:t.conf},tag:"li",replace:""}},[a("el-menu-item",{attrs:{index:r.toString()+"-"+l.toString()}},[e._v(e._s(t.text))])],1)],1)})],2)}))],1)]),e._v(" "),a("el-main",{staticClass:"scroll"},[a("div",{staticClass:"toolbar"},[a("div",{staticClass:"page-title"},[e._v(e._s(e.modeName))]),e._v(" "),a("el-dropdown",{staticStyle:{float:"right","margin-right":"20px"},on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[e._v("\n            "+e._s(e.userName)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{staticStyle:{float:"none"},attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"openDialog"}},[a("span",{staticClass:"el-icon-setting",staticStyle:{color:"#3a8ee6"}}),e._v(" 修改密码")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"logout"}},[a("span",{staticClass:"el-icon-circle-close",staticStyle:{color:"#3a8ee6"}}),e._v(" 退出")])],1)],1)],1),e._v(" "),a("router-view")],1),e._v(" "),a("el-dialog",{attrs:{title:"修改密码",visible:e.updPassDialogVisible,width:"35%","close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.updPassDialogVisible=t}}},[a("el-form",{ref:"passwordDialogform",attrs:{model:e.passwordDialogform,rules:e.rules}},[a("el-form-item",{attrs:{label:"旧密码","label-width":e.formLabelWidth,prop:"old_pwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.passwordDialogform.old_pwd,callback:function(t){e.$set(e.passwordDialogform,"old_pwd",t)},expression:"passwordDialogform.old_pwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth,prop:"new_pwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.passwordDialogform.new_pwd,callback:function(t){e.$set(e.passwordDialogform,"new_pwd",t)},expression:"passwordDialogform.new_pwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认新密码","label-width":e.formLabelWidth,prop:"r_new_pwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.passwordDialogform.r_new_pwd,callback:function(t){e.$set(e.passwordDialogform,"r_new_pwd",t)},expression:"passwordDialogform.r_new_pwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("passwordDialogform")}}},[e._v("保 存")]),e._v(" "),a("el-button",{on:{click:function(t){e.updPassDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var re=a("X4nt")(te,ae,!1,function(e){a("dLq/")},null,null).exports,le=a("NUMX"),oe=a.n(le),ie=a("3cXf"),ne=a.n(ie),se={};function ce(e){(j.isEmptyObject(se)||"reload"===e)&&H.get({url:"/common/dict",loading:!1,success:function(e){se=e.codes?e.codes:{},void 0!==window.localStorage&&sessionStorage.setItem("_dictCode",ne()(se))}})}setInterval(function(){ce("reload")},3e5),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var ue={getCodeData:ce,rendCode:function(e,t){j.isEmptyObject(se)&&void 0!==window.localStorage&&(se=JSON.parse(sessionStorage.getItem("_dictCode")));var a=se[e]?se[e].items:[];t+="";for(var r=0;r<a.length;r++)if(a[r].value===t)return a[r].label;return t},getCodeItems:function(e){j.isEmptyObject(se)&&void 0!==window.localStorage&&(se=JSON.parse(sessionStorage.getItem("_dictCode")));var t=se[e]?se[e].items:[];return oe()(t).slice(0)},getCode:function(e){return j.isEmptyObject(se)&&void 0!==window.localStorage&&(se=JSON.parse(sessionStorage.getItem("_dictCode"))),se[e]},rendDatetime:function(e){return e=parseInt(e),new Date(e).format("yyyy-MM-dd hh:mm:ss")}},de={created:function(){this.selUser(),this.selRole(),this.credentialList=ue.getCodeItems("tms.certificate.type"),this.flagList=ue.getCodeItems("cmc.cmc_operate.flag")},methods:{handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selUser()},handleCurrentChange:function(e){this.currentPage=e,this.selUser()},handleSelectionChange:function(e){this.multipleSelection=e},renderFlag:function(e,t,a){return ue.rendCode("cmc.cmc_operate.flag",a)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"add"===t.flag?t.addUser():"edit"===t.flag&&t.updateUser()})},bindGridData:function(e){this.roleData=e.page.list,this.currentPage=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},selRole:function(){var e=this;H.post({url:"/role/listNormalRole",success:function(t){e.roles=t.row},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},selUser:function(){var e=this;H.post({url:"/operator/list",loading:!0,param:{login_name:this.userForm.login_name,real_name:this.userForm.real_name,flag:this.userForm.flag,role:this.userForm.role,pageindex:e.currentPage,pagesize:e.pagesize},success:function(t){t.page&&e.bindGridData(t)},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},openDialog:function(e,t,a){var r=this;this.flag=e,"edit"===e?(this.dialogTitle="编辑用户",H.post({url:"/operator/get",loading:!0,param:{operatorId:a.operator_id},success:function(e){var t=e.row;r.multipleSelection=[t],r.userDialogForm={operator_id:t.operator_id,login_name:t.login_name,flag:t.flag,real_name:t.real_name,role:t.role,credentialtype:t.credentialtype,credentialnum:t.credentialnum,phone:t.phone,mobile:t.mobile,email:t.email,address:t.address,memo:t.memo,repwd:t.password,password:t.password,failed_login_attempts:t.failed_login_attempts||0,lockout:t.lockout||0}},fail:function(e){e.response.data.message&&r.$message.error(e.response.data.message)}})):"add"===e&&(this.dialogTitle="新建用户",this.userDialogForm={operator_id:"",login_name:"",flag:"1",real_name:"",role:"",credentialtype:"",credentialnum:"",phone:"",mobile:"",email:"",address:"",memo:"",repwd:L.md5("123456"),password:L.md5("123456")}),this.roleDialogVisible=!0,this.$refs.userDialogForm&&this.$refs.userDialogForm.clearValidate()},addUser:function(){var e=this;H.post({url:"/operator/add",loading:!0,param:this.userDialogForm,success:function(t){e.$message.success("创建成功。"),e.roleDialogVisible=!1,e.selUser()},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},updateUser:function(){var e=this;H.post({url:"/operator/mod",loading:!0,param:this.userDialogForm,success:function(t){e.$message.success("编辑成功。"),e.roleDialogVisible=!1,e.selUser()},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},delUser:function(e,t){var a=this;this.$confirm("确定删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/operator/del",loading:!0,param:[t.operator_id],success:function(e){a.$message.success("删除成功。"),a.selUser()},fail:function(e){e.response.data.message&&a.$message.error(e.response.data.message)}})}).catch(function(){})},resetPwd:function(e,t){var a=this,r=L.md5("123456");this.$confirm("确定重置密码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/operator/reset",loading:!0,param:{operatorId:t.operator_id,loginName:t.login_name,passWord:r},success:function(e){a.$message.success("密码重置成功。"),a.selUser()},fail:function(e){e.response.data.message&&a.$message.error(e.response.data.message)}})}).catch(function(){})},resetFlag:function(e,t){var a=this;this.$confirm("确定解锁？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/operator/resetLoginFailedAttempts",loading:!0,param:{operatorId:t.operator_id},success:function(e){e.result?a.$message.success("解锁成功。"):a.$message.success("解锁失败。"),a.selUser()},fail:function(e){e.response.data.message&&a.$message.error(e.response.data.message)}})}).catch(function(){})},emptyCheck:function(e,t){return e[t.property]||0}},data:function(){var e=this;return{formItemStyle:{width:"400px"},formItemContentStyle:{width:"250px"},inline:!0,roles:[],credentialList:[],flagList:[],userForm:{login_name:"",real_name:"",flag:"",role:""},roleData:[],currentPage:1,pagesize:10,total:0,roleDialogVisible:!1,userDialogForm:{operator_id:"",login_name:"",flag:"1",real_name:"",role:"",credentialtype:"",credentialnum:"",phone:"",mobile:"",email:"",address:"",memo:"",repwd:"123456",password:"123456"},dialogTitle:"",formLabelWidth:"100px",rules:{login_name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:6,max:50,message:"用户名只能由6-50位数字或字母组成",trigger:"blur"},{validator:function(e,t,a){if(!/^[0-9a-zA-Z]*$/.test(t))return a(new Error("用户名只能由6-50位数字或字母组成"));a()},trigger:"blur"},{validator:function(t,a,r){var l=e;"edit"===e.flag&&e.multipleSelection[0].login_name===a?r():H.post({url:"/operator/check/username",param:{username:a},success:function(e){if("false"===e.checke_result)return r(new Error("用户名已被占用"));r()},fail:function(e){e.response.data.message&&l.$message.error(e.response.data.message)}})},trigger:"blur"}],real_name:[{required:!0,message:"请输入姓名",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}],credentialtype:[{validator:function(t,a,r){var l=e;if(""===a.trim()&&""!==l.userDialogForm.credentialnum)return r(new Error("请选择证件类型"));""!==a.trim()&&l.userDialogForm.credentialnum,r()},trigger:"blur"}],credentialnum:[{max:50,message:"长度在32个字符以内",trigger:"blur"},{validator:function(e,t,a){if(!/^[0-9a-zA-Z]*$/.test(t))return a(new Error("证件号码只能有数字和字母组成"));a()},trigger:"blur"},{validator:function(t,a,r){var l=e;if(""===a.trim()&&""!==l.userDialogForm.credentialtype)return r(new Error("证件号码不能为空"));if(""!==a.trim()){var o=l.userDialogForm.credentialtype.toString();if("0"===o&&!/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[A-Z])$/.test(o))return r(new Error("身份证号码格式错误"));l.$refs.userDialogForm.validateField("credentialtype"),r()}else r()},trigger:"blur"}],phone:[{validator:function(e,t,a){if(""!==t.trim()&&!/^(([0+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/.test(t))return a(new Error("固定电话号码不正确"));a()},trigger:"blur"}],mobile:[{required:!0,message:"请输入移动电话",trigger:"blur"},{validator:function(e,t,a){if(!/(^13\d{9}$)|(^15\d{9}$)|(^18\d{9}$)/.test(t))return a(new Error("移动电话号码不正确"));a()},trigger:"blur"}],email:[{required:!0,message:"请输入电子邮件",trigger:"blur"},{type:"email",message:"请输入正确的电子邮件",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"}],address:[{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],memo:[{max:300,message:"长度在300个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},multipleSelection:[],flag:""}}},me={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"toolbar"},[a("div",{staticStyle:{float:"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")])],1),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"80px",model:e.userForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"用户名",prop:"login_name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.userForm.login_name,callback:function(t){e.$set(e.userForm,"login_name",t)},expression:"userForm.login_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{clearable:"",placeholder:"状态"},model:{value:e.userForm.flag,callback:function(t){e.$set(e.userForm,"flag",t)},expression:"userForm.flag"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.flagList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),e._v(" "),a("el-form-item",[a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.selUser}},[e._v("查询")])],1)],1)],1)])])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{attrs:{data:e.roleData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openDialog("edit",t.$index,t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(a){e.delUser(t.$index,t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-refresh",title:"重置密码"},on:{click:function(a){e.resetPwd(t.$index,t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-circle-check-outline",title:"解锁",disabled:"0"!==t.row.flag},on:{click:function(a){e.resetFlag(t.$index,t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"login_name",label:"用户名",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"real_name",label:"姓名",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role_name",label:"角色",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"flag",label:"状态",align:"left",formatter:e.renderFlag}}),e._v(" "),a("el-table-column",{attrs:{prop:"lockout_date",label:"锁定时间",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:"电子邮件",align:"left","min-width":"170"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile",label:"移动电话",align:"left","min-width":"85"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.roleDialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(t){e.roleDialogVisible=t}}},[a("el-form",{ref:"userDialogForm",attrs:{model:e.userDialogForm,rules:e.rules,inline:!0}},[a("el-form-item",{style:e.formItemStyle,attrs:{label:"用户名","label-width":e.formLabelWidth,prop:"login_name"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.login_name,callback:function(t){e.$set(e.userDialogForm,"login_name",t)},expression:"userDialogForm.login_name"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"姓名","label-width":e.formLabelWidth,prop:"real_name"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.real_name,callback:function(t){e.$set(e.userDialogForm,"real_name",t)},expression:"userDialogForm.real_name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"left"},style:e.formItemStyle,attrs:{label:"角色","label-width":e.formLabelWidth,prop:"role"}},[a("el-select",{style:e.formItemContentStyle,attrs:{clearable:"",placeholder:"角色"},model:{value:e.userDialogForm.role,callback:function(t){e.$set(e.userDialogForm,"role",t)},expression:"userDialogForm.role"}},e._l(e.roles,function(e){return a("el-option",{key:e.role_id,attrs:{label:e.role_name,value:e.role_id}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"left"},style:e.formItemStyle,attrs:{label:"状态","label-width":e.formLabelWidth}},[a("el-switch",{attrs:{"active-text":"正常","inactive-text":"停用","active-value":"1","inactive-value":"0"},model:{value:e.userDialogForm.flag,callback:function(t){e.$set(e.userDialogForm,"flag",t)},expression:"userDialogForm.flag"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"left"},style:e.formItemStyle,attrs:{label:"证件类型","label-width":e.formLabelWidth,prop:"credentialtype"}},[a("el-select",{style:e.formItemContentStyle,attrs:{clearable:"",placeholder:"证件类型"},model:{value:e.userDialogForm.credentialtype,callback:function(t){e.$set(e.userDialogForm,"credentialtype",t)},expression:"userDialogForm.credentialtype"}},e._l(e.credentialList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"证件号码","label-width":e.formLabelWidth,prop:"credentialnum"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.credentialnum,callback:function(t){e.$set(e.userDialogForm,"credentialnum",t)},expression:"userDialogForm.credentialnum"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"固定电话","label-width":e.formLabelWidth,prop:"phone"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.phone,callback:function(t){e.$set(e.userDialogForm,"phone",t)},expression:"userDialogForm.phone"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"移动电话","label-width":e.formLabelWidth,prop:"mobile"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.mobile,callback:function(t){e.$set(e.userDialogForm,"mobile",t)},expression:"userDialogForm.mobile"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"电子邮件","label-width":e.formLabelWidth,prop:"email"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.email,callback:function(t){e.$set(e.userDialogForm,"email",t)},expression:"userDialogForm.email"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"通讯地址","label-width":e.formLabelWidth,prop:"address"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",clearable:""},model:{value:e.userDialogForm.address,callback:function(t){e.$set(e.userDialogForm,"address",t)},expression:"userDialogForm.address"}})],1),e._v(" "),""!==e.userDialogForm.operator_id?a("el-form-item",{style:e.formItemStyle,attrs:{label:"登录失败次数","label-width":e.formLabelWidth,prop:"failed_login_attempts"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:!0,clearable:""},model:{value:e.userDialogForm.failed_login_attempts,callback:function(t){e.$set(e.userDialogForm,"failed_login_attempts",t)},expression:"userDialogForm.failed_login_attempts"}})],1):e._e(),e._v(" "),""!==e.userDialogForm.operator_id?a("el-form-item",{style:e.formItemStyle,attrs:{label:"锁定次数","label-width":e.formLabelWidth,prop:"lockout"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:!0,clearable:""},model:{value:e.userDialogForm.lockout,callback:function(t){e.$set(e.userDialogForm,"lockout",t)},expression:"userDialogForm.lockout"}})],1):e._e(),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"备注信息","label-width":e.formLabelWidth,prop:"memo"}},[a("el-input",{style:e.formItemContentStyle,attrs:{type:"textarea",clearable:""},model:{value:e.userDialogForm.memo,callback:function(t){e.$set(e.userDialogForm,"memo",t)},expression:"userDialogForm.memo"}})],1),e._v(" "),a("el-form-item",{staticStyle:{display:"none"},style:e.formItemStyle,attrs:{label:"密码1","label-width":e.formLabelWidth,prop:"repwd"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off"},model:{value:e.userDialogForm.repwd,callback:function(t){e.$set(e.userDialogForm,"repwd",t)},expression:"userDialogForm.repwd"}})],1),e._v(" "),a("el-form-item",{staticStyle:{display:"none"},style:e.formItemStyle,attrs:{label:"密码2","label-width":e.formLabelWidth,prop:"password"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off"},model:{value:e.userDialogForm.password,callback:function(t){e.$set(e.userDialogForm,"password",t)},expression:"userDialogForm.password"}})],1),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitForm("userDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.roleDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var pe=a("X4nt")(de,me,!1,function(e){a("7QJy")},null,null).exports,fe={created:function(){this.sel()},methods:{flagChange:function(e){this.flagBtnDisabled=!0;var t=this,a="编辑成功";a="1"===e.flag?"已启用":"已停用",H.post({url:"/role/mod",loading:!0,param:e,success:function(e){t.flagBtnDisabled=!1,t.$message.success(a)},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?t.$message.error(e.error.join("|")):t.$message.error(e.error),t.flagBtnDisabled=!1},fail:function(){t.flagBtnDisabled=!1}})},handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},openDialog:function(e){this.flag=e,"edit"===e?(this.dialogTitle="编辑角色",this.roleDialogform=s()({},this.selectedRow)):"add"===e&&(this.dialogTitle="新建角色",this.$refs.roleDialogform?this.$refs.roleDialogform.resetFields():this.roleDialogform={role_name:"",flag:"1",info:""}),this.roleDialogVisible=!0,this.$refs.roleDialogform&&this.$refs.roleDialogform.clearValidate()},handleSelectionChange:function(e){this.multipleSelection=e,1===e.length?this.btnStatus=!1:(e.length,this.btnStatus=!0)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"add"===t.flag?t.add():"edit"===t.flag&&t.update()})},bindGridData:function(e){this.roleData=e.page.list,this.currentPage=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},add:function(){var e=this;H.post({url:"/role/add",loading:!0,param:this.roleDialogform,success:function(t){e.$message({type:"success",message:"创建成功"}),e.roleDialogVisible=!1,e.sel()}})},del:function(){var e=this,t=this.selectedRow;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/role/del",loading:!0,param:{roleid:t.role_id},success:function(t){e.$message({type:"success",message:"删除成功"}),e.sel()}})}).catch(function(){})},sel:function(e){var t,a=this;t=e&&(e.pageindex||e.pagesize)?j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.roleForm,e):j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.roleForm),H.post({url:"/role/list",loading:!0,param:t,success:function(e){e.page&&a.bindGridData(e)}})},update:function(){var e=this;H.post({url:"/role/mod",loading:!0,param:this.roleDialogform,success:function(t){e.$message({type:"success",message:"编辑成功"}),e.roleDialogVisible=!1,e.sel()}})},grant:function(){var e=this,t=this.selectedRow;H.post({url:"/role/grant/list",param:{roleid:t.role_id},success:function(t){if(t.list){e.grantData=j.formatTreeData(t.list,[{id:"-1",fid:"",func_type:"-1",flag:"1",ftype_name:"",text:"功能树",icon:"ticon-root",onum:0}]),e.expendKey=j.expendNodesByLevel(e.grantData,2),e.checkedKeys=j.checkKeys(e.grantData,"grant","1"),e.grantDialogVisible=!0}}})},saveGrant:function(){var e=this;H.post({url:"/role/grant/mod",param:{roleid:this.selectedRow.role_id,funcs:this.$refs.grantTree.getCheckedNodes(!0)},success:function(t){e.$message({type:"success",message:"编辑成功"}),e.grantDialogVisible=!1,e.sel()}})},selectFocus:function(){this.flagOptions=ue.getCodeItems("cmc.cmc_role.flag")},formatter:function(e,t,a){switch(t.property){case"flag":return ue.rendCode("cmc.cmc_role.flag",a);default:return a}},handleRow:function(e,t,a){switch(this.selectedRow=t,a){case"edit":return this.openDialog("edit");case"del":return this.del();case"grant":return this.grant();default:return}}},data:function(){var e=this;return{flagBtnDisabled:!1,inline:!0,roleForm:{role_name:""},roleData:[],pageindex:1,pagesize:10,total:100,roleDialogVisible:!1,grantDialogVisible:!1,roleDialogform:{role_name:"",flag:"1",info:""},dialogTitle:"",formLabelWidth:"100px",btnStatus:!0,rules:{role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"},{validator:function(t,a,r){if(a===e.selectedRow.role_name)return r();H.post({url:"/role/checkUserName",param:{role_name:e.roleDialogform.role_name},success:function(e){"false"===e.check_result?r(new Error("角色名称已被占用")):r()}})},trigger:"blur"}],info:[{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},multipleSelection:[],flag:"",flagOptions:[],clearable:!0,grantData:[],expendKey:["-1"],checkedKeys:[],defaultProps:{children:"children",label:"text"},selectedRow:{},closeOnClickModal:!1,showOverflow:!0}}},he={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"80px",model:e.roleForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{attrs:{clearable:e.clearable},model:{value:e.roleForm.role_name,callback:function(t){e.$set(e.roleForm,"role_name",t)},expression:"roleForm.role_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},on:{focus:function(t){e.selectFocus()}},model:{value:e.roleForm.flag,callback:function(t){e.$set(e.roleForm,"flag",t)},expression:"roleForm.flag"}},e._l(e.flagOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.sel}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{attrs:{data:e.roleData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text",title:"编辑"},on:{click:function(a){e.handleRow(t.$index,t.row,"edit")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-delete",type:"text",title:"删除"},on:{click:function(a){e.handleRow(t.$index,t.row,"del")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",title:"功能授权"},on:{click:function(a){e.handleRow(t.$index,t.row,"grant")}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"role_name",label:"角色名称",align:"left",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"info",label:"描述信息",align:"left","show-overflow-tooltip":e.showOverflow}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"left",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0",disabled:e.flagBtnDisabled},on:{change:function(a){e.flagChange(t.row)}},model:{value:t.row.flag,callback:function(a){e.$set(t.row,"flag",a)},expression:"scope.row.flag"}})]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.roleDialogVisible,width:"35%","close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.roleDialogVisible=t}}},[a("el-form",{ref:"roleDialogform",attrs:{model:e.roleDialogform,rules:e.rules}},[a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"role_name"}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.roleDialogform.role_name,callback:function(t){e.$set(e.roleDialogform,"role_name",t)},expression:"roleDialogform.role_name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"状态","label-width":e.formLabelWidth}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.roleDialogform.flag,callback:function(t){e.$set(e.roleDialogform,"flag",t)},expression:"roleDialogform.flag"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息","label-width":e.formLabelWidth,prop:"info"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.roleDialogform.info,callback:function(t){e.$set(e.roleDialogform,"info",t)},expression:"roleDialogform.info"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("roleDialogform")}}},[e._v("保 存")]),e._v(" "),a("el-button",{on:{click:function(t){e.roleDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"功能授权",visible:e.grantDialogVisible,width:"35%","close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.grantDialogVisible=t}}},[a("div",{staticStyle:{overflow:"auto","max-height":"500px"}},[a("el-tree",{ref:"grantTree",attrs:{data:e.grantData,"default-expanded-keys":e.expendKey,"default-checked-keys":e.checkedKeys,"show-checkbox":"","node-key":"id","highlight-current":"",props:e.defaultProps}}),e._v(" "),a("div",{staticStyle:{"text-align":"left",margin:"20px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.saveGrant}},[e._v("保 存")]),e._v(" "),a("el-button",{on:{click:function(t){e.grantDialogVisible=!1}}},[e._v("取 消")])],1)],1)])],1)},staticRenderFns:[]},ge=a("X4nt")(fe,he,!1,null,null,null).exports,ve={created:function(){this.selTree()},data:function(){var e=this;return{toolBtn:{addBtn:!0,editBtn:!0,delBtn:!0},treeList:[],treeData:[{id:"-1",func_type:"-1",flag:"1",ftype_name:"",text:"功能树",icon:"ticon-root",onum:0}],nodeTypes:["子系统","模块","功能","子功能"],defaultProps:{children:"children",label:"text"},expendKey:["-1"],formLabelWidth:"120px",funcFormReadonly:!0,funcFormVisible:{form:!0,func_id:!0,parent_id:!0,func_type:!0,func_name:!0,conf:!0,ftype_name:!0,isgrant:!0,menu:!0,flag:!0,onum:!0,info:!0,islog:!0,logconf:!0},funcForm:{func_id:"",parent_id:"",func_type:"",func_name:"",conf:"",ftype_name:"",isgrant:"",menu:"1",flag:"1",onum:"",info:"",islog:"",logconf:"",logurlMethod:"",loguri:""},breadcrumbData:[],rules:{func_name:[{required:!0,message:"请输入节点名称",trigger:"blur"},{max:32,message:"长度在32个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"},{validator:function(t,a,r){var l=e.funcForm,o=e.treeList;for(var i in o){var n=o[i];if(n.text===a&&n.id!==l.func_id)return r(new Error("[节点名称]不能重复"))}return r()},trigger:"blur"}],conf:[{max:500,message:"长度在500个字符以内",trigger:"blur"}],onum:[{required:!0,message:"请输入节点顺序",trigger:"blur"},{validator:function(t,a,r){var l=e;if(!/^(0|[1-9]\d{0,1})$/.test(a))return r(new Error("[顺序]必须为小于100的正整数"));var o=l.$refs.tree.currentNode.node,i=l.funcForm;if(""===i.func_id){var n=o.childNodes;for(var s in n)if(n[s].data.onum===a)return r(new Error("[顺序]不能重复"))}else{var c=o.parent.childNodes;for(var u in c)if(c[u].data.onum===Number(a)&&c[u].data.id!==i.func_id)return r(new Error("[顺序]不能重复"))}return r()},trigger:"blur"}],info:[{max:300,message:"长度在300个字符以内",trigger:"blur"}],logconf:[{validator:function(t,a,r){var l=e;if(""===j.trim(a))return r();if(0===a.indexOf("GET:"))l.funcForm.logurlMethod="0",l.funcForm.loguri=a.substring(4);else{if(0!==a.indexOf("POST:"))return r(new Error("[日志记录配置]只支持GET: 或POST:开头"));l.funcForm.logurlMethod="1",l.funcForm.loguri=a.substring(5)}},trigger:"blur"}]}}},methods:{renderContent:function(e,t){var a=t.node;t.data,t.store;return"0"===a.data.flag?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this;H.post({url:"/func/tree",loading:!0,param:{},success:function(t){if(t.list){e.treeData=j.formatTreeData(t.list,[{id:"-1",fid:"",func_type:"-1",flag:"1",ftype_name:"",text:"功能树",icon:"ticon-root",onum:0}]),e.expendNodesByLevel(2)}},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},expendNodesByLevel:function(e){for(var t=[],a=this.treeData[0],r=1;r<=e;)t.push(a.id),a=a.children[0],r++;this.expendKey=t},handleNodeClick:function(e,t){if(this.funcForm.func_id!==e.id){this.$refs.funcForm.clearValidate();var a=e.func_type;a<"3"&&"1"===e.flag?this.toolBtn.addBtn=!1:this.toolBtn.addBtn=!0,"-1"===a?(this.toolBtn.editBtn=!0,this.toolBtn.delBtn=!0):(this.toolBtn.editBtn=!1,this.toolBtn.delBtn=!1),this.syncBreadcrumb(t),this.funcFormReadonly=!0,this.showNodeAttr(t.data.func_type),this.showNodeValue(e)}},syncBreadcrumb:function(e){for(var t=[];null!==e.parent;)t.unshift({text:e.data.text}),e=e.parent;this.breadcrumbData=t},showNodeAttr:function(e){var t={form:!1,func_id:!0,parent_id:!0,func_type:!0,func_name:!1,conf:!1,ftype_name:!1,isgrant:!1,menu:!1,flag:!1,onum:!1,info:!1,islog:!1,logconf:!1};"-1"===e?(t.ftype_name=!0,t.isgrant=!0,t.menu=!0,t.flag=!0,t.onum=!0,t.islog=!0,t.logconf=!0,this.funcFormVisible=t):"0"===e||"1"===e?(t.isgrant=!0,t.islog=!0,t.logconf=!0,this.funcFormVisible=t):"2"===e?this.funcFormVisible=t:"3"===e?(t.isgrant=!0,t.menu=!0,this.funcFormVisible=t):this.funcFormVisible=t},showNodeValue:function(e){var t={func_id:e.id,parent_id:e.fid,func_type:e.func_type,func_name:e.text,conf:e.conf,ftype_name:this.nodeTypes[e.func_type],isgrant:"1"===e.isgrant,menu:e.menu?e.menu:"1",flag:e.flag?e.flag:"1",onum:e.onum,info:e.info,islog:"1"===e.islog,logconf:"",logurlMethod:e.logurlmethod,loguri:e.loguri};switch(e.logurlmethod){case"0":t.logconf="GET:"+e.loguri;break;case"1":t.logconf="POST:"+e.loguri}this.funcForm=t},resetPage:function(){this.funcFormVisible.form=!0,this.breadcrumbData=[],this.toolBtn={addBtn:!0,editBtn:!0,delBtn:!0}},addFunc:function(){this.$refs.funcForm.resetFields();var e=this.$refs.tree.getCurrentNode(),t=Number(e.func_type)+1;this.funcForm.parent_id=e.id,this.funcForm.func_type=t,this.funcForm.ftype_name=this.nodeTypes[t],this.funcFormReadonly=!1,this.showNodeAttr(t+"")},editFunc:function(){this.funcFormReadonly=!1},delFunc:function(){var e=this,t=e.$refs.tree.currentNode.node;this.$confirm("确定要删除功能节点吗？其下级节点将都会被删除！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/func/del",loading:!0,param:{funcId:t.data.id,rf:"json"},success:function(a){t.visible=!1,e.resetPage(),e.$message.success("删除成功")},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})}).catch(function(){})},closeFuncForm:function(){""===this.funcForm.func_id?this.resetPage():this.funcFormReadonly=!0},submitFunc:function(){var e=this;this.$refs.funcForm.validate(function(t){if(t){var a="",r="";""===e.funcForm.func_id?(a="/func/add",r="创建"):(a="/func/mod",r="编辑"),H.post({url:a,loading:!0,param:e.funcForm,success:function(t){e.$message.success(r+"成功"),e.selTree(),e.resetPage()},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})}})}}},be={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",disabled:e.toolBtn.addBtn},on:{click:e.addFunc}},[e._v("新建\n    ")]),e._v(" "),a("el-button",{staticClass:"el-icon-edit",attrs:{plain:"",disabled:e.toolBtn.editBtn},on:{click:e.editFunc}},[e._v("编辑\n    ")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{plain:"",disabled:e.toolBtn.delBtn},on:{click:e.delFunc}},[e._v("删除\n    ")])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{height:"650px"},attrs:{span:6}},[a("section",{staticClass:"section"},[a("el-tree",{ref:"tree",attrs:{data:e.treeData,"node-key":"id","default-expanded-keys":e.expendKey,props:e.defaultProps,"highlight-current":!0,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),a("el-col",{staticStyle:{height:"650px"},attrs:{span:18}},[a("section",{staticClass:"section"},[a("div",{staticStyle:{height:"38px",width:"100%","text-align":"left"}},[a("el-breadcrumb",{staticStyle:{padding:"10px 15px"},attrs:{id:"funcPath",separator:">"}},e._l(e.breadcrumbData,function(t){return a("el-breadcrumb-item",{key:t.text},[e._v("\n              "+e._s(t.text)+"\n            ")])}))],1),e._v(" "),a("el-form",{ref:"funcForm",class:{hidden:e.funcFormVisible.form},staticStyle:{"text-align":"left"},attrs:{model:e.funcForm,rules:e.rules,"label-suffix":"：","label-width":e.formLabelWidth}},[a("el-form-item",{class:{hidden:e.funcFormVisible.func_id},attrs:{label:"功能编号",prop:"func_id"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.funcForm.func_id,callback:function(t){e.$set(e.funcForm,"func_id",t)},expression:"funcForm.func_id"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.parent_id},attrs:{label:"父节点编号",prop:"parent_id"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.funcForm.parent_id,callback:function(t){e.$set(e.funcForm,"parent_id",t)},expression:"funcForm.parent_id"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.func_type},attrs:{label:"功能类型",prop:"func_type"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.funcForm.func_type,callback:function(t){e.$set(e.funcForm,"func_type",t)},expression:"funcForm.func_type"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.func_name},attrs:{label:"节点名称",prop:"func_name"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.funcFormReadonly},model:{value:e.funcForm.func_name,callback:function(t){e.$set(e.funcForm,"func_name",t)},expression:"funcForm.func_name"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.conf},attrs:{label:"节点配置",prop:"conf"}},[a("el-input",{attrs:{type:"textarea",readonly:e.funcFormReadonly},model:{value:e.funcForm.conf,callback:function(t){e.$set(e.funcForm,"conf",t)},expression:"funcForm.conf"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.ftype_name},attrs:{label:"节点类型",prop:"ftype_name"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.funcFormReadonly},model:{value:e.funcForm.ftype_name,callback:function(t){e.$set(e.funcForm,"ftype_name",t)},expression:"funcForm.ftype_name"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.isgrant},attrs:{label:"访问授权",prop:"isgrant"}},[a("el-checkbox",{attrs:{label:"需要授权",name:"type",disabled:e.funcFormReadonly},model:{value:e.funcForm.isgrant,callback:function(t){e.$set(e.funcForm,"isgrant",t)},expression:"funcForm.isgrant"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.menu},attrs:{label:"是否菜单"}},[a("el-switch",{attrs:{"active-text":"是","inactive-text":"否","active-value":"1","inactive-value":"0",disabled:e.funcFormReadonly},model:{value:e.funcForm.menu,callback:function(t){e.$set(e.funcForm,"menu",t)},expression:"funcForm.menu"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.flag},attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-text":"正常","inactive-text":"停用","active-value":"1","inactive-value":"0",disabled:e.funcFormReadonly},model:{value:e.funcForm.flag,callback:function(t){e.$set(e.funcForm,"flag",t)},expression:"funcForm.flag"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.onum},attrs:{label:"顺序",prop:"onum"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.funcFormReadonly},model:{value:e.funcForm.onum,callback:function(t){e.$set(e.funcForm,"onum",t)},expression:"funcForm.onum"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.info},attrs:{label:"描述信息",prop:"info"}},[a("el-input",{attrs:{type:"textarea",readonly:e.funcFormReadonly},model:{value:e.funcForm.info,callback:function(t){e.$set(e.funcForm,"info",t)},expression:"funcForm.info"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.islog},attrs:{label:"记录日志",prop:"islog"}},[a("el-checkbox",{attrs:{label:"记录",name:"type",disabled:e.funcFormReadonly},model:{value:e.funcForm.islog,callback:function(t){e.$set(e.funcForm,"islog",t)},expression:"funcForm.islog"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormVisible.logconf},attrs:{label:"日志记录配置",prop:"logconf"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.funcFormReadonly},model:{value:e.funcForm.logconf,callback:function(t){e.$set(e.funcForm,"logconf",t)},expression:"funcForm.logconf"}})],1),e._v(" "),a("el-form-item",{class:{hidden:e.funcFormReadonly}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitFunc}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:e.closeFuncForm}},[e._v("取 消")])],1)],1)],1)])],1)],1)},staticRenderFns:[]};var _e=a("X4nt")(ve,be,!1,function(e){a("7/a6")},null,null).exports,ye=a("rVsN"),Fe=a.n(ye),xe={computed:{showItemParent:function(){return this.showItem}},data:function(){return{userDialogVisible:!1,selectedRow:{},detailData:{}}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderConfirmrisk:function(e){return void 0===e||""===e?"":ue.rendCode("tms.confirmrisk.status",e)},renderPsStatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.status",e)}},props:["showItem"],mounted:function(){this.$nextTick(function(){})},methods:{loadData:function(e){this.selectedRow=e;var t=this;t.detailData={},console.log(e),H.post({url:"/query/alarmEvent/operateDetail",param:{txncode:e.txncode,txnTypeShowFields:e.txntype},success:function(e){t.detailData=e.row[0]}})},showUserDetail:function(){var e=this;this.userDialogVisible=!0,setTimeout(function(){e.$refs.userDetail.loadData(e.selectedRow)},200)}}},we={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:6}},[e._v("是否进行风险评估:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderIs")(e.detailData.iseval))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("规则触发数:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.trigrulenum)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("规则命中数:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.hitrulenum)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("处置方式:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.disposal)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("报警是否正确:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderIs")(e.detailData.iscorrect))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("IS_MAIN:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.is_main)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("风险人工确认:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderConfirmrisk")(e.detailData.confirmrisk))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("所属模型:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.modelid)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("是否模型风险:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderIs")(e.detailData.ismodelrisk))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("是否有风险:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderIs")(e.detailData.isrisk))+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("报警处理状态:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderPsStatus")(e.detailData.psstatus))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("策略标识:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.strategy)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("批次号:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.batchno)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("操作流水号:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.txncode)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("操作确认时间:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderDateTime")(e.detailData.finishtime))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("操作识别时间:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderDateTime")(e.detailData.createtime))+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("操作状态:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderTxnstatus")(e.detailData.txnstatus))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("用户标识:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.userid)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("操作标识:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.txnid)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("互联网服务提供商:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.ispcode)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("设备相似度:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.m_num53)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("设备信息:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.deviceid)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("操作时间:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e._f("renderDateTime")(e.detailData.txntime))+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("操作类型:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.txntype)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("IP地址:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.ipaddr)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("风险分值:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.score)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("会话标识:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.sessionid)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("渠道代码:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.chancode)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("设备用户关系:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.m_num23)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("支付金额1:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.m_text10)+" ")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[e._v("登录手机号码:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.m_text1)+" ")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v("地理位置:")]),e._v(" "),a("el-col",{attrs:{span:6}},[e._v(e._s(e.detailData.location)+" ")])],1),e._v(" "),a("el-dialog",{attrs:{title:"报警操作用户信息",visible:e.userDialogVisible,width:"900px",modal:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.userDialogVisible=t}}},[a("AlarmEventQueryUserDetail",{ref:"userDetail"}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.userDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var De=null,Se={computed:{showItemParent:function(){return this.showItem}},data:function(){return{strategyList:[],strategyRuleEvalList:[],transHitRuleList:[],disposalList:[]}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderEvalType:function(e){return void 0===e||""===e?"":ue.rendCode("tms.rule.evaltype",e)},renderDisposal:function(e){if(void 0===e||""===e)return"";var t=!0,a=!1,r=void 0;try{for(var l,o=f()(De.disposalList);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.dp_code===e)return i.dp_name}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""}},props:["showItem"],mounted:function(){this.$nextTick(function(){De=this})},methods:{loadData:function(e){var t=this;t.transHitRuleList=[],H.post({url:"/rule/disposal",param:{},success:function(a){t.disposalList=a.row,H.post({url:"/alarmevent/alarmStrategy",param:{txncode:e.txncode,txntype:e.txntype,stid:e.strategy},success:function(e){e.row&&(t.strategyList=e.row),e.list&&(t.strategyRuleEvalList=e.list),e.rulelist&&(t.transHitRuleList=e.rulelist)}})}})}}},ke={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.transHitRuleList}},[a("el-table-column",{attrs:{prop:"rule_shortdesc",label:"规则名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rule_cond_in",label:"规则条件",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"风险类型",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderEvalType")(t.row.eval_type)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rule_score",label:"分值",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"处置方式",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDisposal")(t.row.disposal)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"numtimes",label:"执行耗时",align:"left"}})],1)],1)])},staticRenderFns:[]};var Ce=null,Te={computed:{showItemParent:function(){return this.showItem}},data:function(){return{tableData:[]}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderPsResult:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.result",e)},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderPsType:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.type",e)},renderDisposal:function(e){if(void 0===e||""===e)return"";var t=!0,a=!1,r=void 0;try{for(var l,o=f()(Ce.disposalListParent);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.dp_code===e)return i.dp_name}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""}},props:["showItem"],mounted:function(){this.$nextTick(function(){Ce=this})},methods:{loadData:function(e){var t=this;t.transHitRuleList=[],H.post({url:"/query/alarmEvent/handleDetail",param:{txncode:e.txncode},success:function(e){e.row&&(t.tableData=e.row)}})}}},Ie={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"ps_time",label:"处理时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.ps_time)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"处理类型",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderPsType")(t.row.ps_type)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ps_opername",label:"处理人员",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"处理结果",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderPsResult")(t.row.ps_result)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ps_info",label:"处理信息",align:"left"}})],1)],1)])},staticRenderFns:[]};var $e=null,Le={computed:{showItemParent:function(){return this.showItem}},data:function(){return{detailData:{},hasUser:!1}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderCerttype:function(e){return void 0===e||""===e?"":ue.rendCode("tms.certificate.type",e.toString())},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderSex:function(e){return void 0===e||""===e?"":ue.rendCode("common.sex",e)},renderDisposal:function(e){if(void 0===e||""===e)return"";var t=!0,a=!1,r=void 0;try{for(var l,o=f()($e.disposalListParent);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.dp_code===e)return i.dp_name}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""}},props:["showItem"],mounted:function(){this.$nextTick(function(){$e=this})},methods:{loadData:function(e){var t=this;console.log(e),t.transHitRuleList=[],H.post({url:"/query/alarmEvent/userDetail",param:{userid:e.userid},success:function(e){e.row&&e.row.length>0?(t.hasUser=!0,t.detailData=e.row[0]):t.hasUser=!1}})}}},qe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasUser,expression:"!hasUser"}]},[e._v("\n    无信息记录\n  ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.hasUser,expression:"hasUser"}],staticClass:"info-item"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          用户ID:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.userid)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          用户名:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.username)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          客户姓名:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.cusname)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          证件号码:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.certno)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          证件类型:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderCerttype")(e.detailData.certtype))+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          手机号码:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.cellphoneno)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          渠道用户开户行:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.opennode)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          开户时间:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.opentime))+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          用户类型:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.acctype)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          性别:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderSex")(e.detailData.sex))+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          出生日期:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.birthdate))+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          累计分值:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.sumscore)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          条件类型:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.risktype)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          风险分值:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.riskscore)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          连续无风险次数:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.norisknum)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          开户城市:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.opennodecity)+" \n        ")])],1)],1)],1)])},staticRenderFns:[]};var Pe={name:"alarmEventDeviceDetail",computed:{showItemParent:function(){return this.showItem}},data:function(){return{detailData:{},hasData:!1}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderCerttype:function(e){return void 0===e||""===e?"":ue.rendCode("tms.certificate.type",e.toString())},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderSex:function(e){return void 0===e||""===e?"":ue.rendCode("common.sex",e)}},props:["showItem"],mounted:function(){this.$nextTick(function(){})},methods:{loadData:function(e){var t=this;H.post({url:"/query/alarmEvent/deviceDetail",param:{deviceid:e.deviceid},success:function(e){e.row&&e.row.length>0?(t.hasData=!0,t.detailData=e.row[0]):t.hasData=!1}})}}},Re={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasData,expression:"!hasData"}]},[e._v("\n    无信息记录\n  ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.hasData,expression:"hasData"}],staticClass:"info-item"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          设备标识:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.device_id)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          渠道代码:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.app_id)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          创建时间:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.create_time))+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          最后使用时间:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.lastmodified))+" \n        ")])],1)],1)],1)])},staticRenderFns:[]};var Ve={computed:{showItemParent:function(){return this.showItem}},data:function(){return{tableData:[],currentPage:1,pageSize:5,total:0}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderPsResult:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.result",e)},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderPsType:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.type",e)}},props:["showItem"],mounted:function(){this.$nextTick(function(){})},methods:{bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.loadData(this.showItemParent)},handleCurrentChange:function(e){this.currentPage=e,this.loadData(this.showItemParent)},loadData:function(e){var t=this;H.post({url:"/query/alarmEvent/deviceFingerDetail",modal:H.model.dualaudit,param:{device_id:e.deviceid,pageindex:this.currentPage,pagesize:this.pageSize},success:function(e){e.page&&t.bindGridData(e)}})}}},ze={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"device_id",label:"设备标识",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_name",label:"属性名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_type",label:"属性类型",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_value",label:"属性值",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_comment",label:"属性声明",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[5],"page-size":e.pageSize,layout:"total, prev, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var Ne={name:"alarmEventDeviceDetail",computed:{showItemParent:function(){return this.showItem}},data:function(){return{detailData:{},hasData:!1}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderCerttype:function(e){return void 0===e||""===e?"":ue.rendCode("tms.certificate.type",e.toString())},renderIs:function(e){return void 0===e||""===e?"":ue.rendCode("common.is",e)},renderSex:function(e){return void 0===e||""===e?"":ue.rendCode("common.sex",e)}},props:["showItem"],mounted:function(){this.$nextTick(function(){})},methods:{loadData:function(e){console.log(e);var t=this;H.post({url:"/query/alarmEvent/sessionDetail",loading:!0,param:{sessionid:e.sessionid},success:function(e){e.row&&e.row.length>0?(t.hasData=!0,t.detailData=e.row[0]):t.hasData=!1}})}}},Ee={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasData,expression:"!hasData"}]},[e._v("\n    无信息记录\n  ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.hasData,expression:"hasData"}],staticClass:"info-item"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          会话标识:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.sessionid)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          用户标识:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.userid)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          设备标识:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.deviceid)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          IP地址:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.ipaddr)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          互联网服务提供商:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.ispcode)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          地理位置:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.location)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          最大分值:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.maxscore)+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          累计分值:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e.detailData.sumscore)+" \n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          开始时间:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.starttime))+" \n        ")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n          结束时间:\n        ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n          "+e._s(e._f("renderDateTime")(e.detailData.finishtime))+" \n        ")])],1)],1)],1)])},staticRenderFns:[]};var Oe={props:["showItem"],created:function(){this.initTable()},data:function(){return{pTnxCode:this.showItem.txncode,txnStatTableData:[],formLabelWidth:"120px"}},watch:{"showItem.txncode":function(e){this.pTnxCode=e,this.initTable(e)}},methods:{initTable:function(e){var t=this;e=e||t.pTnxCode,H.post({url:"/query/tnxEvent/txnStatQuery",param:{txnCode:e},success:function(e){e&&!0===e.success&&(t.txnStatTableData=e.list)}})}}},Ae={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:this.txnStatTableData}},[t("el-table-column",{attrs:{prop:"stat_desc",label:"统计名称",align:"left"}}),this._v(" "),t("el-table-column",{attrs:{prop:"storecolumn",label:"存储字段",align:"left"}}),this._v(" "),t("el-table-column",{attrs:{prop:"storevalue",label:"当前统计值",align:"left"}})],1)],1)},staticRenderFns:[]};var Be={computed:{showItemParent:function(){return this.showItem}},data:function(){return{userDialogVisible:!1,selectedRow:{},info:{},showFields:[]}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)}},props:["showItem"],mounted:function(){this.$nextTick(function(){})},methods:{loadData:function(e){this.selectedRow=e;var t=this;t.infoList={},H.post({url:"/query/alarmEvent/operateDetail",loading:!0,param:{txncode:e.txncode,txnTypeShowFields:e.txntype},success:function(e){var a=e.row[0],r=[],l=e.showfields,o=["TXNCODE","USERID","CREATETIME","FINISHTIME","TXNSTATUS","TXNID","TXNTYPE","ISRISK","DEVICEID","IPADDR","COUNTRYCODE","REGIONCODE","CITYCODE","CHANCODE","M_NUM53","M_NUM23","SESSIONID","ISEVAL","HITRULENUM","TRIGRULENUM","DISPOSAL","CONFIRMRISK","MODELID","PSSTATUS","BATCHNO"],i=[];for(var n in o){var s=o[n];for(var c in l){var u=l[c];if(u.fd_name===s){i.push(u),l.splice(Number(c),1);break}}}for(var d in l=i.concat(l)){var m=l[d],p="";switch(m.type){case"code":var f=m.code,h=a[m.fd_name.toLowerCase()];h&&(p=ue.rendCode(f,h));break;case"datetime":p=j.renderDateTime(a[m.fd_name.toLowerCase()]);break;default:p=a[m.fd_name.toLowerCase()]}m.fd_value=p,r.push(m)}t.showFields=r}})},showUserDetail:function(){var e=this;this.userDialogVisible=!0,setTimeout(function(){e.$refs.userDetail.loadData(e.selectedRow)},200)}}},We={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"info-item"},e._l(e.showFields,function(t){return a("el-col",{key:t.fd_name,attrs:{span:12}},[a("el-col",{staticClass:"info-item-label",attrs:{span:9,tag:"label"}},[e._v("\n        "+e._s(t.name)+"\n      ")]),e._v(" "),a("el-col",{staticClass:"info-item-value",attrs:{span:15,tag:"label"}},[e._v("\n        "+e._s(t.fd_value)+" \n      ")])],1)}))],1)},staticRenderFns:[]};var Me={name:"txnDetail",computed:{selectedRow:function(){return this.txn}},data:function(){return{infoDialogVisible:!1,tabActiveName:"operate",tabShowItem:["operate","strategy","count","user","handle","device","deviceFinger","session"],firstActive:{operate:!0,strategy:!0,count:!0,user:!0,handle:!0,device:!0,deviceFinger:!0,session:!0}}},props:["txn","defaultTab","showItem"],methods:{handleTabClick:function(e,t){this.tabClick(e.name)},open:function(){var e=this;for(var t in this.infoDialogVisible=!0,this.showItem&&(this.tabShowItem=this.showItem),this.defaultTab?this.tabActiveName=this.defaultTab:this.tabActiveName="operate",this.firstActive)this.firstActive[t]=!0;setTimeout(function(){e.defaultTab?e.tabClick(e.defaultTab):e.$refs.operateDetail.loadData(e.selectedRow)},200)},tabClick:function(e){switch(e){case"operate":if(this.firstActive.operate){var t=this;setTimeout(function(){t.$refs.operateDetail.loadData(t.selectedRow),t.firstActive.operate=!1},200)}break;case"strategy":if(this.firstActive.strategy){var a=this;setTimeout(function(){a.$refs.strategyDetail.loadData(a.selectedRow),a.firstActive.strategy=!1},200)}break;case"count":if(this.firstActive.count){var r=this;setTimeout(function(){r.firstActive.count=!1},200)}break;case"user":if(this.firstActive.user){var l=this;setTimeout(function(){l.$refs.userDetail.loadData(l.selectedRow),l.firstActive.user=!1},200)}break;case"handle":if(this.firstActive.handle){var o=this;setTimeout(function(){o.$refs.handleDetail.loadData(o.selectedRow),o.firstActive.handle=!1},200)}break;case"device":if(this.firstActive.device){var i=this;setTimeout(function(){i.$refs.deviceDetail.loadData(i.selectedRow),i.firstActive.device=!1},200)}break;case"deviceFinger":if(this.firstActive.deviceFinger){var n=this;setTimeout(function(){n.$refs.deviceFingerDetail.loadData(n.selectedRow),n.firstActive.deviceFinger=!1},200)}break;case"session":if(this.firstActive.session){var s=this;setTimeout(function(){s.$refs.sessionDetail.loadData(s.selectedRow),s.firstActive.session=!1},200)}}},getTabItemShow:function(e){return this.tabShowItem.indexOf(e)>-1}},components:{"alarm-event-query-operate-detail":a("X4nt")(xe,we,!1,function(e){a("srFV")},null,null).exports,"alarm-event-query-strategy-detail":a("X4nt")(Se,ke,!1,function(e){a("G/rv")},null,null).exports,"alarm-event-query-handle-detail":a("X4nt")(Te,Ie,!1,function(e){a("bqlI")},null,null).exports,"alarm-event-query-user-detail":a("X4nt")(Le,qe,!1,function(e){a("2SXd")},null,null).exports,"alarm-event-query-device-detail":a("X4nt")(Pe,Re,!1,function(e){a("RWDL")},"data-v-27e3db74",null).exports,"alarm-event-query-device-finger-detail":a("X4nt")(Ve,ze,!1,function(e){a("TyaY")},null,null).exports,"alarm-event-query-session-detail":a("X4nt")(Ne,Ee,!1,function(e){a("NV/4")},"data-v-14731f5c",null).exports,"txn-stat-query":a("X4nt")(Oe,Ae,!1,function(e){a("F69p")},"data-v-25614fda",null).exports,"txn-info-query":a("X4nt")(Be,We,!1,function(e){a("0Q3I")},"data-v-1d9be216",null).exports}},je={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"交易流水详细信息",visible:e.infoDialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(t){e.infoDialogVisible=t}}},[a("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.tabActiveName,callback:function(t){e.tabActiveName=t},expression:"tabActiveName"}},[e.getTabItemShow("operate")?a("el-tab-pane",{attrs:{label:"交易信息",name:"operate"}},[a("txn-info-query",{ref:"operateDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("strategy")?a("el-tab-pane",{attrs:{label:"规则命中信息",name:"strategy"}},[a("alarm-event-query-strategy-detail",{ref:"strategyDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("count")?a("el-tab-pane",{attrs:{label:"统计信息",name:"count"}},[a("txn-stat-query",{ref:"txnStatQuery",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("user")?a("el-tab-pane",{attrs:{label:"交易用户信息",name:"user"}},[a("alarm-event-query-user-detail",{ref:"userDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("handle")?a("el-tab-pane",{attrs:{label:"报警处置信息",name:"handle"}},[a("alarm-event-query-handle-detail",{ref:"handleDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("device")?a("el-tab-pane",{attrs:{label:"设备信息",name:"device"}},[a("alarm-event-query-device-detail",{ref:"deviceDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("deviceFinger")?a("el-tab-pane",{attrs:{label:"设备指纹信息",name:"deviceFinger"}},[a("alarm-event-query-device-finger-detail",{ref:"deviceFingerDetail",attrs:{showItem:e.selectedRow}})],1):e._e(),e._v(" "),e.getTabItemShow("session")?a("el-tab-pane",{attrs:{label:"会话信息",name:"session"}},[a("alarm-event-query-session-detail",{ref:"sessionDetail",attrs:{showItem:e.selectedRow}})],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.infoDialogVisible=!1}}},[e._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var Ue=a("X4nt")(Me,je,!1,function(e){a("htzw")},null,null).exports,Xe=[{label:"未认证",value:"2"},{label:"认证通过",value:"1"},{label:"认证未通过",value:"0"}],Ke={name:"alarmEventQuery",data:function(){return{listDialogVisible:!1,txntypeDialogVisible:!1,infoDialogVisible:!1,btnStatus:!1,oldOperIdShow:!1,sendBtnDisabled:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],userData:[],queryFormShow:!1,operidList:[],alarmSendForm:{old_operid:"",operid:""},queryShowForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryRules:{ipaddr:[{validator:ee.checkFormIp,trigger:"blur"}]},alarmSendRules:{operid:[{required:!0,message:"分派人员不能为空",trigger:"blur"}]},dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectedRows:[],selectedRow:{},tabActiveName:"operate",tableData:[],txntypeList:[],disposalList:[],iscorrectList:Xe,txnstatusList:[],psstatusList:[{label:"未分派",value:"00"},{label:"待处理",value:"02"}],countrycodeList:[],regioncodeList:[],citycodeList:[]}},watch:{"queryShowForm.countrycode":function(e){var t=this;H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regioncodeList=e.row}})},"queryShowForm.regioncode":function(e){var t=this;H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.citycodeList=e.row}})}},mounted:function(){this.$nextTick(function(){var e=this;this.initSelectData().then(function(){H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countrycodeList=t.row}})}).then(this.getData())})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)},renderIscorrect:function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=f()(Xe);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.value===e)return i.label}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""},renderPsStatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.status",e)}},methods:{handleSelectionChange:function(e){this.selectedRows=e},initDateRange:function(){var e=new Date;return e.setHours((new Date).getHours()-1),[e,new Date]},tableRowClass:function(e){if(0===e.columnIndex)return{};var t=e.row,a=t.currenttime,r=t.timeout,l=t.psstatus,o=null;return"02"===l?o=t.m_assigntime:"04"===l&&(o=t.m_audittime),null!=o&&1*a-1*o>1*r?{color:"#f56c6c"}:void 0},formatter:function(e,t,a){switch(t.property){case"psstatus":return ue.rendCode("tms.alarm.process.status",a);case"txntime":return ue.rendDatetime(a);case"iscorrect":var r=!0,l=!1,o=void 0;try{for(var i,n=f()(Xe);!(r=(i=n.next()).done);r=!0){var s=i.value;if(s.value===a)return s.label}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}return"";default:return a}},initSelectData:function(){this.txnstatusList=ue.getCodeItems("tms.common.txnstatus");var e=this;return this.selTree(),H.post({url:"/rule/disposal",param:{},success:function(t){e.disposalList=t.row}}),new Fe.a(function(e,t){e()})},searchData:function(){var e=this;this.$refs.queryShowForm.validate(function(t){t&&(s()(e.queryForm,e.queryShowForm),e.getData())})},getData:function(){var e=this,t={modelType:"alarmEventSend",pageindex:this.currentPage,pagesize:this.pageSize};s()(t,this.queryForm),this.queryForm.queryDate&&this.queryForm.queryDate.length>1&&(t.startDate=this.queryForm.queryDate[0].getTime(),t.endDate=this.queryForm.queryDate[1].getTime()),H.post({url:"/query/alarmEvent/result",model:H.model.dualaudit,loading:!0,param:t,success:function(t){t.page&&e.bindGridData(t)}})},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txntypeShow=l.join(","),this.queryShowForm.txntype=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},showAlarmEventInfo:function(e){this.selectedRow=e,this.infoDialogVisible=!0;this.$refs.txnDetail.open()},handleInfoOpen:function(){},setQueryShowForm:function(e){this.queryShowForm=e},openDialog:function(e){var t=this;console.log(e);var a=[],r=!0,l=!1,o=void 0;try{for(var i,n=f()(this.selectedRows);!(r=(i=n.next()).done);r=!0){var s=i.value;a.push(s.txncode)}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}var c={txn_code:a.join(",")};this.alarmSendForm={old_operid:"",operid:""},t.selectedRow=e,this.sendBtnDisabled=!1,H.post({url:"/alarmevent/assign",loading:!0,param:c,success:function(e){if(e.list){var a=e.txnmap[0],r=e.list,l=null;if(a){var o=a.psstatus;a.timeout;l=a.operid,"00"!==o&&"02"!==o&&"04"!==o&&(t.btnStatus=!0)}var i=!1;if(r){for(var n=[],s=0,c=r.length;s<c;s++){var u=r[s];1*u.isenable==1?n.push(u):u.operator_id===l&&(i=!0,t.alarmSendForm.old_operid=u.login_name)}t.userData=n,t.operidList=n,t.oldOperIdShow=!!i}}t.listDialogVisible=!0}})},onSaveAssign:function(){var e=this,t=[],a=!0,r=!1,l=void 0;try{for(var o,i=f()(this.selectedRows);!(a=(o=i.next()).done);a=!0){var n=o.value;t.push(n.txncode)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}var s={TXNCODES:t.join(","),OPERATER:this.alarmSendForm.operid};this.sendBtnDisabled=!0,H.post({url:"/alarmevent/onsaveAssign",loading:!0,param:s,success:function(t){this.sendBtnDisabled=!1,e.$message({message:"分派成功。",type:"success"}),e.listDialogVisible=!1,e.getData()}})}},components:{"txn-detail":Ue}},Ge={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户号:",prop:"userid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.userid,callback:function(t){e.$set(e.queryShowForm,"userid",t)},expression:"queryShowForm.userid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户名称:",prop:"username"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.username,callback:function(t){e.$set(e.queryShowForm,"username",t)},expression:"queryShowForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"监控操作:",prop:"txntypeShow"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:""},model:{value:e.queryShowForm.txntypeShow,callback:function(t){e.$set(e.queryShowForm,"txntypeShow",t)},expression:"queryShowForm.txntypeShow"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"处置方式:",prop:"disposal"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.disposal,callback:function(t){e.$set(e.queryShowForm,"disposal",t)},expression:"queryShowForm.disposal"}},e._l(e.disposalList,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处置结果:",prop:"iscorrect"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.iscorrect,callback:function(t){e.$set(e.queryShowForm,"iscorrect",t)},expression:"queryShowForm.iscorrect"}},e._l(e.iscorrectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处理状态:",prop:"psstatus"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.psstatus,callback:function(t){e.$set(e.queryShowForm,"psstatus",t)},expression:"queryShowForm.psstatus"}},e._l(e.psstatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("el-button",{attrs:{plain:"",icon:"el-icon-sort"},on:{click:function(t){e.openDialog()}}},[e._v("分派")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:!e.queryFormShow,expression:"!queryFormShow"}],attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark","cell-style":e.tableRowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"40",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txncode",label:"流水号",width:"240",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showAlarmEventInfo(t.row)}}},[e._v(e._s(t.row.txncode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userid",label:"客户号",width:"150",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"客户名称",width:"120",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txntime",label:"交易时间",width:"150",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控操作",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"disposal",label:"处置方式",width:"140",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"iscorrect",label:"处置结果",width:"80",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"psstatus",label:"处理状态",width:"80",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"oper_name",label:"处理人",width:"100",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"监控交易",visible:e.txntypeDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("txn-detail",{ref:"txnDetail",attrs:{txn:e.selectedRow}}),e._v(" "),a("el-dialog",{attrs:{title:"报警事件分派",visible:e.listDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.listDialogVisible=t}}},[a("div",[a("el-table",{attrs:{data:e.userData,height:"280"}},[a("el-table-column",{attrs:{prop:"login_name",label:"登录名",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"assign_number",label:"总量",width:"100",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"process_number",label:"已处理",width:"100",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unprocess_number",label:"未处理",width:"100",align:"left"}})],1),e._v(" "),a("el-form",{ref:"alarmSendForm",staticStyle:{"text-align":"left","margin-top":"15px"},attrs:{"label-position":"right","label-width":"120px",model:e.alarmSendForm,rules:e.alarmSendRules,inline:!0}},[a("el-form-item",{attrs:{label:"分派人员:",prop:"operid"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.alarmSendForm.operid,callback:function(t){e.$set(e.alarmSendForm,"operid",t)},expression:"alarmSendForm.operid"}},e._l(e.operidList,function(e){return a("el-option",{key:e.operator_id,attrs:{label:e.login_name,value:e.operator_id}})}))],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" "}},[a("el-button",{attrs:{type:"primary",disabled:e.sendBtnDisabled,size:"large"},on:{click:function(t){e.onSaveAssign()}}},[e._v("分 派")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.listDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)])],1)},staticRenderFns:[]};var He=a("X4nt")(Ke,Ge,!1,function(e){a("9Hxr")},"data-v-4852c702",null).exports,Qe=a("zsLt"),Ye=a.n(Qe),Ze={computed:{txnIdParent:function(){return this.txnId}},data:function(){return{firstOpen:!0,statCondInDialogVisible:!1,formItemStyle:{width:"330px"},formItemContentStyle:{width:"200px"},textareaContentStyle:{width:"540px"},formLabelWidth:"120px",statFnDialogVisible:!1,selectArea:[0,0],statCondInDictDialogForm:this.initStatCondInDictDialogForm(),treeData:[],defaultProps:{children:"children",label:"text"},itemShow:{stat_datafd:!0,stat_fn:!0,date_func:!0,str_func:!0,oper_func:!0,roster_func:!0,diy_func:!0,rule_func:!0,ac_func:!0},expendKey:["T"],statDatafdList:[],dateFuncList:[],strFuncList:[],operFuncList:[],rosterFuncList:[],diyFuncList:[],ruleFuncList:[],acFuncList:[],allSelectData:new Ye.a}},props:{statCond:{type:String,default:""},statCondIn:{type:String,default:""},txnId:{type:String,default:""},hideItems:{type:Array,default:function(){return[]}}},watch:{"statCondInDictDialogForm.stat_cond_value":function(e){this.searchCondName(e,1)}},mounted:function(){this.$nextTick(function(){this.statCondInDictDialogForm.stat_cond_value=this.statCond,this.statCondInDictDialogForm.stat_cond_in=this.statCondIn;var e=this.hideItems,t=!0,a=!1,r=void 0;try{for(var l,o=f()(e);!(t=(l=o.next()).done);t=!0){var i=l.value;this.itemShow[i]=!1}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}})},methods:{getSelectedPostion:function(e){var t=[0,0],a=e;if("number"==typeof a.selectionStart)t=[a.selectionStart,a.selectionEnd];else if(document.selection){var r=0,l=0,o=document.selection.createRange();if(o.parentElement()==a){var i;for((i=document.body.createTextRange()).moveToElementText(a),r=0;i.compareEndPoints("StartToStart",o)<0;r++)i.moveStart("character",1);for(var n=0;n<=r;n++)"\n"==a.value.charAt(n)&&r++;for((i=document.body.createTextRange()).moveToElementText(a),l=0;i.compareEndPoints("StartToEnd",o)<0;l++)i.moveStart("character",1);for(var s=0;s<=l;s++)"\n"==a.value.charAt(s)&&l++}t=[r,l]}this.selectArea=t},selectChange:function(e){this.selectChangeCommon(e)},selectChangeAddBracket:function(e){this.selectChangeCommon(e+"()")},selectChangeCommon:function(e){var t=this,a=this.statCondInDictDialogForm.stat_cond_value,r=this.selectArea,l=[a.substr(0,r[0]),e,a.substr(r[1])];this.statCondInDictDialogForm=this.initStatCondInDictDialogForm(),this.statCondInDictDialogForm.stat_cond_value=l.join(""),setTimeout(function(){var e=t.$refs.statCondValue.$refs.textarea;e.focus(),t.getSelectedPostion(e)},300)},initStatCondInDictDialogForm:function(){return{stat_datafd:"",stat_fn:"",date_func:"",str_func:"",oper_func:"",roster_func:"",diy_func:"",rule_func:"",ac_func:"",stat_cond_value:"",stat_cond_in:""}},initData:function(){this.selTree(),this.getStatDataFdSelectData(),this.getRuleFuncList(),this.getCodeData("operFuncList","tms.pub.func","3",!0),this.getCodeData("diyFuncList","tms.pub.func","1"),this.getCodeData("acFuncList","tms.pub.func","7"),this.getCodeData("dateFuncList","tms.pub.func","4"),this.getCodeData("strFuncList","tms.pub.func","5"),this.getCodeData("rosterFuncList","tms.pub.roster");var e=this;setTimeout(function(){e.searchCondName(e.statCondInDictDialogForm.stat_cond_value,1)},500)},reloadData:function(){this.getStatDataFdSelectData(),this.getRuleFuncList()},getStatDataFdSelectData:function(){var e=this;H.post({url:"/stat/txnFeature",param:{txn_id:this.txnIdParent},success:function(t){if(t.row){e.statDatafdList=[];var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.row);!(a=(o=i.next()).done);a=!0){var n=o.value;e.allSelectData.add({code_key:n.code_key,code_value:n.code_value}),n.code_value=n.code_value+"("+n.code_key+")",e.statDatafdList.push(n)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}e.statDatafdList.sort(function(e,t){return e.code_value.localeCompare(t.code_value,"zh")})}}})},getRuleFuncList:function(){var e=this;H.post({url:"/stat/txnrulelist",param:{txn_id:this.txnIdParent},success:function(t){if(t.row){e.ruleFuncList=[];var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.row);!(a=(o=i.next()).done);a=!0){var n=o.value;e.allSelectData.add({code_key:n.code_key,code_value:n.code_value}),n.code_value=n.code_value+"("+n.code_key+")",e.ruleFuncList.push(n)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}}}})},getCodeData:function(e,t,a,r){var l=this,o={};o.category_id=t,a&&(o.args=a),H.post({url:"/stat/code",param:o,success:function(t){if(t.row){l[e]=[];var a=!0,o=!1,i=void 0;try{for(var n,s=f()(t.row);!(a=(n=s.next()).done);a=!0){var c=n.value;r||l.allSelectData.add({code_key:c.code_key,code_value:c.code_value}),c.code_value=c.code_value+"("+c.code_key+")",l[e].push(c)}}catch(e){o=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}}}})},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/stat/statfunc",success:function(t){if(t.row){e.treeList=t.row,e.treeData=e.formatTreeData(t.row);var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.row);!(a=(o=i.next()).done);a=!0){var n=o.value;2==n.ftype&&e.allSelectData.add({code_key:n.code_key,code_value:n.code_value})}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}}}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},searchCondName:function(e,t){if(""===e||null==e)return this.statCondInDictDialogForm.stat_cond_value="",void(this.statCondInDictDialogForm.stat_cond_in="");var a="code_key",r="code_value";2===t&&(r="code_key",a="code_value");var l=e,o=!0,i=!1,n=void 0;try{for(var s,c=f()(this.allSelectData);!(o=(s=c.next()).done);o=!0){var u=s.value;u[a]&&(l=l.replace(new RegExp(j.escapeExprSpecialWord(u[a]),"g"),u[r]))}}catch(e){i=!0,n=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw n}}2===t?this.statCondInDictDialogForm.stat_cond_value=l:this.statCondInDictDialogForm.stat_cond_in=l},handleNodeClick:function(e,t){t.isLeaf&&this.selectChangeCommon(e.code_key)},closeDialog:function(){this.statCondInDialogVisible=!1},callback:function(){var e={stat_cond_value:this.statCondInDictDialogForm.stat_cond_value,stat_cond_in:this.statCondInDictDialogForm.stat_cond_in};this.$emit("valueCallback",e),this.statCondInDialogVisible=!1},reset:function(){this.statCondInDictDialogForm.stat_cond_value="",this.statCondInDictDialogForm.stat_cond_in=""},setValue:function(e){this.statCondInDictDialogForm.stat_cond_value=e.stat_cond_value,this.statCondInDictDialogForm.stat_cond_in=e.stat_cond_in},open:function(){if(this.firstOpen){var e=this;this.initData(),setTimeout(function(){var t=e.$refs.statCondValue.$refs.textarea;t.addEventListener("keydown",function(){e.getSelectedPostion(t)}),t.addEventListener("keyup",function(){e.getSelectedPostion(t)}),t.addEventListener("mousedown",function(){e.getSelectedPostion(t)}),t.addEventListener("mouseup",function(){e.getSelectedPostion(t)}),t.addEventListener("focus",function(){e.getSelectedPostion(t)})},300)}this.firstOpen=!1,this.statCondInDialogVisible=!0}}},Je={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"StatCondDialog",attrs:{title:"条件",visible:e.statCondInDialogVisible,width:"770px",modal:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.statCondInDialogVisible=t}}},[a("el-form",{ref:"statCondInDictDialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.statCondInDictDialogForm,inline:!0}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.stat_datafd,expression:"itemShow.stat_datafd"}],style:e.formItemStyle,attrs:{label:"交易属性:","label-width":e.formLabelWidth,prop:"stat_datafd"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChange},model:{value:e.statCondInDictDialogForm.stat_datafd,callback:function(t){e.$set(e.statCondInDictDialogForm,"stat_datafd",t)},expression:"statCondInDictDialogForm.stat_datafd"}},e._l(e.statDatafdList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.stat_fn,expression:"itemShow.stat_fn"}],style:e.formItemStyle,attrs:{label:"交易统计:","label-width":e.formLabelWidth,prop:"stat_fn"}},[a("div",{on:{dblclick:function(t){e.statFnDialogVisible=!0}}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:""},model:{value:e.statCondInDictDialogForm.stat_fn,callback:function(t){e.$set(e.statCondInDictDialogForm,"stat_fn",t)},expression:"statCondInDictDialogForm.stat_fn"}})],1)]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.date_func,expression:"itemShow.date_func"}],style:e.formItemStyle,attrs:{label:"日期函数:","label-width":e.formLabelWidth,prop:"date_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChangeAddBracket},model:{value:e.statCondInDictDialogForm.date_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"date_func",t)},expression:"statCondInDictDialogForm.date_func"}},e._l(e.dateFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.str_func,expression:"itemShow.str_func"}],style:e.formItemStyle,attrs:{label:"字符函数:","label-width":e.formLabelWidth,prop:"str_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChangeAddBracket},model:{value:e.statCondInDictDialogForm.str_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"str_func",t)},expression:"statCondInDictDialogForm.str_func"}},e._l(e.strFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.oper_func,expression:"itemShow.oper_func"}],style:e.formItemStyle,attrs:{label:"关系函数:","label-width":e.formLabelWidth,prop:"oper_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChange},model:{value:e.statCondInDictDialogForm.oper_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"oper_func",t)},expression:"statCondInDictDialogForm.oper_func"}},e._l(e.operFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.roster_func,expression:"itemShow.roster_func"}],style:e.formItemStyle,attrs:{label:"名单:","label-width":e.formLabelWidth,prop:"roster_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChange},model:{value:e.statCondInDictDialogForm.roster_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"roster_func",t)},expression:"statCondInDictDialogForm.roster_func"}},e._l(e.rosterFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.diy_func,expression:"itemShow.diy_func"}],style:e.formItemStyle,attrs:{label:"自定义函数:","label-width":e.formLabelWidth,prop:"diy_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChangeAddBracket},model:{value:e.statCondInDictDialogForm.diy_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"diy_func",t)},expression:"statCondInDictDialogForm.diy_func"}},e._l(e.diyFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.rule_func,expression:"itemShow.rule_func"}],style:e.formItemStyle,attrs:{label:"交易规则:","label-width":e.formLabelWidth,prop:"rule_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChange},model:{value:e.statCondInDictDialogForm.rule_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"rule_func",t)},expression:"statCondInDictDialogForm.rule_func"}},e._l(e.ruleFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.itemShow.ac_func,expression:"itemShow.ac_func"}],style:e.formItemStyle,attrs:{label:"动作函数:","label-width":e.formLabelWidth,prop:"ac_func"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",clearable:""},on:{change:e.selectChangeAddBracket},model:{value:e.statCondInDictDialogForm.ac_func,callback:function(t){e.$set(e.statCondInDictDialogForm,"ac_func",t)},expression:"statCondInDictDialogForm.ac_func"}},e._l(e.acFuncList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"条件表达式:","label-width":e.formLabelWidth,prop:"stat_cond_value"}},[a("el-input",{ref:"statCondValue",style:e.textareaContentStyle,attrs:{type:"textarea",rows:5},model:{value:e.statCondInDictDialogForm.stat_cond_value,callback:function(t){e.$set(e.statCondInDictDialogForm,"stat_cond_value",t)},expression:"statCondInDictDialogForm.stat_cond_value"}})],1)],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"解释:","label-width":e.formLabelWidth,prop:"stat_cond_in"}},[a("el-input",{ref:"statCondIn",style:e.textareaContentStyle,attrs:{type:"textarea",rows:5},model:{value:e.statCondInDictDialogForm.stat_cond_in,callback:function(t){e.$set(e.statCondInDictDialogForm,"stat_cond_in",t)},expression:"statCondInDictDialogForm.stat_cond_in"}})],1)],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.callback}},[e._v("确 定")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:e.reset}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:e.closeDialog}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易统计",visible:e.statFnDialogVisible,width:"400px",modal:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.statFnDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id",props:e.defaultProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"node-click":e.handleNodeClick}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.statFnDialogVisible=!1}}},[e._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var et=a("X4nt")(Ze,Je,!1,function(e){a("YHXL")},null,null).exports,tt=[{label:"未认证",value:"2"},{label:"认证通过",value:"1"},{label:"认证未通过",value:"0"}],at={name:"alarmEventQuery",computed:{actionSelect:function(){return this.selectedRows.length>0}},data:function(){return{collapseActiveNames:[],txntypeDialogVisible:!1,infoDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},listDialogVisible:!1,expendKey:["T"],treeData:[],queryFormShow:!1,executeForm:{fraud_type:"",ps_info:""},actionForm:{},txnIdParent:"",actionDialogTitle:"",actionDialogVisible:!1,actionFormSureBtnDisabled:!1,actionDialogType:"",actionDialogForm:{ac_desc:"",ac_cond:"",ac_cond_in:"",ac_expr:"",ac_expr_in:""},actionRules:{ac_desc:[{required:!0,message:"请输入动作名称",trigger:"blur"},{max:128,message:"长度在128个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"}],ac_cond_in:[{validator:this.checkAcCond,trigger:"blur"}],ac_expr_in:[{validator:this.checkAcRxpr,trigger:"blur"}],ac_enable:[{required:!0,message:"请输入有效性",trigger:"change"}]},executeRules:{fraud_type:[{required:!0,message:"请输入欺诈类型",trigger:"blur"}],ps_info:[{required:!0,message:"请输入处理信息",trigger:"blur"},{max:255,message:"长度在255个字符以内",trigger:"blur"}]},datatypeOptions:[],queryShowForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryRules:{ipaddr:[{validator:ee.checkFormIp,trigger:"blur"}]},dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",formItemStyle:{width:"600px"},actionFormItemStyle:{width:"400px"},actionFormItemContentStyle:{width:"250px"},textareaFormItemStyle:{width:"600px"},formItemContentStyle:{width:"400px"},textareaContentStyle:{width:"300px"},dialogType:"",currentPage:1,pageSize:10,total:0,selectedRow:{},tabActiveName:"operate",tableData:[],actionData:[],selectedRows:[],txntypeList:[],disposalList:[],iscorrectList:tt,txnstatusList:[],psstatusList:[],countrycodeList:[],regioncodeList:[],citycodeList:[]}},watch:{"queryShowForm.countrycode":function(e){var t=this;H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regioncodeList=e.row}})},"queryShowForm.regioncode":function(e){var t=this;H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.citycodeList=e.row}})}},mounted:function(){this.$nextTick(function(){var e=this;this.datatypeOptions=ue.getCodeItems("tms.alarm.fraudtype"),this.initSelectData().then(function(){H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countrycodeList=t.row}})}).then(this.getData())})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)},renderIscorrect:function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=f()(tt);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.value===e)return i.label}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""},renderPsStatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.status",e)}},methods:{initDateRange:function(){var e=new Date;return e.setHours((new Date).getHours()-1),[e,new Date]},tableRowClass:function(e){if(0===e.columnIndex)return{};var t=e.row,a=t.currenttime,r=t.timeout,l=t.psstatus,o=null;return"02"===l?o=t.m_assigntime:"04"===l&&(o=t.m_audittime),null!=o&&1*a-1*o>1*r?{color:"#f56c6c"}:void 0},formatter:function(e,t,a){switch(t.property){case"psstatus":return ue.rendCode("tms.alarm.process.status",a);case"txntime":case"assigntime":return ue.rendDatetime(a);case"iscorrect":var r=!0,l=!1,o=void 0;try{for(var i,n=f()(tt);!(r=(i=n.next()).done);r=!0){var s=i.value;if(s.value===a)return s.label}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}return"";default:return a}},handleSelectionChange:function(e){this.selectedRows=e},initSelectData:function(){this.txnstatusList=ue.getCodeItems("tms.common.txnstatus"),this.psstatusList=ue.getCodeItems("tms.alarm.process.status");var e=this;return this.selTree(),H.post({url:"/rule/disposal",param:{},success:function(t){e.disposalList=t.row}}),new Fe.a(function(e,t){e()})},searchData:function(e){var t=this;this.$refs.queryShowForm.validate(function(e){e&&(s()(t.queryForm,t.queryShowForm),t.getData())})},getData:function(){var e=this,t={modelType:"alarmEventExecute",pageindex:this.currentPage,pagesize:this.pageSize};s()(t,this.queryForm),this.queryForm.queryDate&&this.queryForm.queryDate.length>1&&(t.startDate=this.queryForm.queryDate[0].getTime(),t.endDate=this.queryForm.queryDate[1].getTime()),H.post({url:"/query/alarmEvent/result",loading:!0,model:H.model.dualaudit,param:t,success:function(t){t.page&&e.bindGridData(t)}})},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txntypeShow=l.join(","),this.queryShowForm.txntype=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},openTxnTypedialog:function(){this.txntypeDialogVisible=!0,this.$refs.executeForm&&this.$refs.executeForm.clearValidate()},showAlarmEventInfo:function(e){this.selectedRow=e,this.infoDialogVisible=!0;this.$refs.txnDetail.open()},handleInfoOpen:function(){},setQueryShowForm:function(e){this.queryShowForm=e},openDialog:function(e){this.selectedRow=e;var t=e.txncode;this.vTxncode=t,this.executeForm={fraud_type:"",ps_info:""},this.getActionData(t)},getActionData:function(e){this.actionData=[];var t=this;H.post({url:"/alarmevent/process",loading:!0,param:{TXN_CODE:e},success:function(e){t.listDialogVisible=!0,t.$refs.executeForm&&t.$refs.executeForm.clearValidate(),e.list&&(t.actionData=e.list),t.txnIdParent=e.txnmap.txntype}})},addPsAct:function(e){this.actionDialogVisible=!0,this.actionDialogType="add",this.actionDialogForm={ac_desc:"",ac_cond:"",ac_cond_in:"",ac_expr:"",ac_expr_in:""}},editPsAct:function(e,t,a){console.log(t);this.actionDialogType="edit",this.actionDialogVisible=!0,this.actionDialogForm=s()({},t),this.actionDialogForm.ac_desc=t.ac_name},delPsAct:function(){var e=this,t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r=[],l=!0,o=!1,i=void 0;try{for(var n,s=f()(e.selectedRows);!(l=(n=s.next()).done);l=!0){var c=n.value;r.push(c.ac_id)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}a.psActs=r.join(","),H.post({url:"/alarmevent/delPsAct",loading:!0,param:a,success:function(e){t.getActionData(t.selectedRow.txncode),t.$message.success("删除成功")}})})},acCondInPopup:function(){this.$refs.acCondDialog.open(),this.$refs.acCondDialog.setValue({stat_cond_value:this.actionDialogForm.ac_cond,stat_cond_in:this.actionDialogForm.ac_cond_in})},acExprInPopup:function(){this.$refs.acExprDialog.open(),this.$refs.acExprDialog.setValue({stat_cond_value:this.actionDialogForm.ac_expr,stat_cond_in:this.actionDialogForm.ac_expr_in})},acCondInValueCallBack:function(e){this.actionDialogForm.ac_cond=e.stat_cond_value,this.actionDialogForm.ac_cond_in=e.stat_cond_in},acExprValueCallBack:function(e){this.actionDialogForm.ac_expr=e.stat_cond_value,this.actionDialogForm.ac_expr_in=e.stat_cond_in,this.$refs.actionDialogForm.validateField("ac_expr_in",function(e){})},submitActionForm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.actionFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.actionDialogForm),console.log(t.selectedRow),r.TXN_CODE=t.selectedRow.txncode,r.ac_name=r.ac_desc;var l="提交成功",o="";"add"===t.actionDialogType?(o="/alarmevent/addPsAct",l="新建成功"):(o="/alarmevent/updPsAct",l="编辑成功"),H.post({url:o,loading:!0,param:r,success:function(e){a.getActionData(a.selectedRow.txncode),a.$message.success(l),a.actionDialogVisible=!1,a.actionFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.actionFormSureBtnDisabled=!1},fail:function(){a.actionFormSureBtnDisabled=!1}})}})},saveProcess:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return!1;console.log(a.selectedRow);var r=j.extend({TXN_CODE:a.selectedRow.txncode,TXNCODE:a.selectedRow.txncode,PS_TYPE:"1",PSSTATUS:"03",PS_RESULT:"1"},t.executeForm);r=j.toggleObjKey(r,"upper"),H.post({url:"/alarmevent/saveProcess",loading:!0,param:r,success:function(e){a.$message({message:"处理成功",type:"success"}),a.listDialogVisible=!1,a.getData()}})})}},components:{"txn-detail":Ue,StatCondPicker:et}},rt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",clearable:"",maxlength:32},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户号:",prop:"userid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",clearable:"",maxlength:32},model:{value:e.queryShowForm.userid,callback:function(t){e.$set(e.queryShowForm,"userid",t)},expression:"queryShowForm.userid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户名称:",prop:"username"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",clearable:"",maxlength:32},model:{value:e.queryShowForm.username,callback:function(t){e.$set(e.queryShowForm,"username",t)},expression:"queryShowForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"监控交易:",prop:"txntypeShow"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:""},model:{value:e.queryShowForm.txntypeShow,callback:function(t){e.$set(e.queryShowForm,"txntypeShow",t)},expression:"queryShowForm.txntypeShow"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"处置方式:",prop:"disposal"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.disposal,callback:function(t){e.$set(e.queryShowForm,"disposal",t)},expression:"queryShowForm.disposal"}},e._l(e.disposalList,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处置结果:",prop:"iscorrect"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.iscorrect,callback:function(t){e.$set(e.queryShowForm,"iscorrect",t)},expression:"queryShowForm.iscorrect"}},e._l(e.iscorrectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处理状态:",prop:"psstatus"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.psstatus,callback:function(t){e.$set(e.queryShowForm,"psstatus",t)},expression:"queryShowForm.psstatus"}},e._l(e.psstatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:!e.queryFormShow,expression:"!queryFormShow"}],attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)]),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark","cell-style":e.tableRowClass}},[a("el-table-column",{attrs:{label:"操作",width:"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",title:"处理",icon:"el-icon-edit-outline"},on:{click:function(a){e.openDialog(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"txncode",label:"流水号",width:"240",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showAlarmEventInfo(t.row)}}},[e._v(e._s(t.row.txncode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userid",label:"客户号",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"客户名称",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txntime",label:"交易时间",width:"135",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控操作"}}),e._v(" "),a("el-table-column",{attrs:{prop:"disposal",label:"处置方式",width:"140",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"iscorrect",label:"处置结果",width:"80",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"assign_name",label:"分派人",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"assigntime",label:"分派时间",width:"135",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"psstatus",label:"处理状态",width:"80",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"oper_name",label:"处理人",width:"80"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"监控交易",visible:e.txntypeDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("txn-detail",{ref:"txnDetail",attrs:{txn:e.selectedRow}}),e._v(" "),a("el-dialog",{attrs:{title:"报警事件处理",visible:e.listDialogVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.listDialogVisible=t}}},[a("div",[a("el-form",{ref:"executeForm",staticStyle:{"text-align":"left"},attrs:{model:e.executeForm,inline:!0,rules:e.executeRules}},[a("el-form-item",{style:e.formItemStyle,attrs:{label:"欺诈类型:","label-width":e.formLabelWidth,prop:"fraud_type"}},[a("el-select",{staticClass:"stat-query-form-item",style:e.textareaContentStyle,attrs:{placeholder:"请选择",clearable:""},model:{value:e.executeForm.fraud_type,callback:function(t){e.$set(e.executeForm,"fraud_type",t)},expression:"executeForm.fraud_type"}},e._l(e.datatypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{style:e.textareaFormItemStyle,attrs:{label:"处理信息:","label-width":e.formLabelWidth,prop:"fraud_type"}},[a("el-input",{style:e.textareaContentStyle,attrs:{type:"textarea",maxlength:200},model:{value:e.executeForm.ps_info,callback:function(t){e.$set(e.executeForm,"ps_info",t)},expression:"executeForm.ps_info"}})],1),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveProcess("executeForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{data:"cancelBtn",type:"primary"},on:{click:function(t){e.listDialogVisible=!1}}},[e._v("取消")])],1)],1)],1),e._v(" "),a("el-collapse",{model:{value:e.collapseActiveNames,callback:function(t){e.collapseActiveNames=t},expression:"collapseActiveNames"}},[a("el-collapse-item",{attrs:{title:"动作信息",name:"1"}},[a("div",{staticStyle:{"text-align":"left"}},[a("div",[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.addPsAct("add")}}},[e._v("新建")]),e._v(" "),a("el-button",{attrs:{plain:"",icon:"el-icon-delete",disabled:!e.actionSelect},on:{click:e.delPsAct}},[e._v("删除")])],1)]),e._v(" "),a("el-table",{attrs:{data:e.actionData,height:"200"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{label:"操 作",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){e.editPsAct(t.$index,t.row,"edit")}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_name",label:"动作名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_cond_in",label:"条件",align:"left",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_expr_in",label:"表达式",align:"left",width:"150"}})],1)],1)],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:e.actionDialogTitle,visible:e.actionDialogVisible,width:"450px",modal:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.actionDialogVisible=t}}},[a("el-form",{ref:"actionDialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.actionDialogForm,rules:e.actionRules,inline:!0}},[a("el-form-item",{style:e.actionFormItemStyle,attrs:{label:"动作名称:","label-width":e.formLabelWidth,prop:"ac_desc"}},[a("el-input",{style:e.actionFormItemContentStyle,attrs:{"auto-complete":"off",maxlength:128},model:{value:e.actionDialogForm.ac_desc,callback:function(t){e.$set(e.actionDialogForm,"ac_desc",t)},expression:"actionDialogForm.ac_desc"}})],1),e._v(" "),a("el-form-item",{style:e.actionFormItemStyle,attrs:{label:"动作条件:","label-width":e.formLabelWidth,prop:"ac_cond_in"}},[a("div",{on:{dblclick:e.acCondInPopup}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.actionFormItemContentStyle,attrs:{"auto-complete":"off",readonly:""},model:{value:e.actionDialogForm.ac_cond,callback:function(t){e.$set(e.actionDialogForm,"ac_cond",t)},expression:"actionDialogForm.ac_cond"}}),e._v(" "),a("el-input",{style:e.actionFormItemContentStyle,attrs:{"auto-complete":"off",readonly:""},model:{value:e.actionDialogForm.ac_cond_in,callback:function(t){e.$set(e.actionDialogForm,"ac_cond_in",t)},expression:"actionDialogForm.ac_cond_in"}})],1)]),e._v(" "),a("el-form-item",{staticClass:"is-required",style:e.actionFormItemStyle,attrs:{label:"表达式:","label-width":e.formLabelWidth,prop:"ac_expr_in"}},[a("div",{on:{dblclick:e.acExprInPopup}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.actionFormItemContentStyle,attrs:{"auto-complete":"off",readonly:""},model:{value:e.actionDialogForm.ac_expr,callback:function(t){e.$set(e.actionDialogForm,"ac_expr",t)},expression:"actionDialogForm.ac_expr"}}),e._v(" "),a("el-input",{style:e.actionFormItemContentStyle,attrs:{"auto-complete":"off",readonly:""},model:{value:e.actionDialogForm.ac_expr_in,callback:function(t){e.$set(e.actionDialogForm,"ac_expr_in",t)},expression:"actionDialogForm.ac_expr_in"}})],1)]),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",disabled:e.actionFormSureBtnDisabled,size:"large"},on:{click:function(t){e.submitActionForm("actionDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.actionDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("StatCondPicker",{ref:"acCondDialog",attrs:{statCond:e.actionDialogForm.ac_cond,statCondIn:e.actionDialogForm.ac_cond_in,txnId:e.txnIdParent,hideItems:["stat_fn","rule_func","ac_func"]},on:{valueCallback:e.acCondInValueCallBack}}),e._v(" "),a("StatCondPicker",{ref:"acExprDialog",attrs:{statCond:e.actionDialogForm.ac_expr,statCondIn:e.actionDialogForm.ac_expr_in,txnId:e.txnIdParent,hideItems:["stat_fn","rule_func"]},on:{valueCallback:e.acExprValueCallBack}})],1)],1)},staticRenderFns:[]};var lt=a("X4nt")(at,rt,!1,function(e){a("SMvj")},"data-v-584d6e48",null).exports,ot=[{label:"未认证",value:"2"},{label:"认证通过",value:"1"},{label:"认证未通过",value:"0"}],it={created:function(){this.datatypeOptions=ue.getCodeItems("tms.alarm.fraudtype")},mounted:function(){this.$nextTick(function(){this.initSelectData().then(this.sel())})},methods:{handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},handleCurrentRow:function(e){this.multipleSelection=e,1===e.length?this.btnStatus=!1:this.btnStatus=!0},handleSelectionChange:function(e){this.multipleSelection=e,1===e.length?this.sendBtnStatus=!1:e.length>1?this.sendBtnStatus=!1:this.sendBtnStatus=!0},selectFocus:function(e){"fraud_type"===e&&0===this.datatypeOptions.length&&(this.datatypeOptions=ue.getCodeItems("tms.alarm.fraudtype"))},formatter:function(e,t,a){switch(t.property){case"psstatus":return ue.rendCode("tms.alarm.process.status",a);case"ps_result":return ue.rendCode("tms.alarm.process.result",a);case"ps_type":return ue.rendCode("tms.alarm.process.type",a);case"txntime":case"opertime":return ue.rendDatetime(a);default:return a}},searchData:function(e){var t=this;this.$refs.queryShowForm.validate(function(e){e&&(s()(t.queryForm,t.queryShowForm),t.sel())})},sel:function(e){var t,a=this;t=e&&(e.pageindex||e.pagesize)?j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.queryShowForm,e):j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.queryShowForm),this.queryForm.queryDate&&this.queryForm.queryDate.length>1&&(t.operate_time=this.queryForm.queryDate[0].getTime(),t.end_time=this.queryForm.queryDate[1].getTime()),H.post({url:"/alarmevent/auditList",loading:!0,param:t,success:function(e){e.page&&a.bindGridData(e)}})},bindGridData:function(e){this.gridData=e.page.list,this.pageindex=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},openDialog:function(e,t){var a=this;this.listDialogVisible=!0;var r=t.txncode;this.vTxncode=r,H.post({url:"/alarmevent/audit",loading:!0,param:{TXN_CODE:r},success:function(e){console.log(e);var t=e.txnmap,r=t.fraud_type,l=t.execue_result,o=t.execue_info;e.actlist&&(a.actionData=e.actlist),e.pslist&&(a.executeData=e.pslist),j.trim(r)?a.actionForm.fraud_type=r:a.actionForm.fraud_type="",a.auditForm.PS_RESULT=l||"1",a.auditForm.PS_INFO=o||"",console.info(a.auditForm.PS_RESULT,a.auditForm.PS_INFO)}}),a.activeNames=["1","2"]},onSaveAudit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return!1;var r=j.extend({TXN_CODE:t.vTxncode,PS_TYPE:"2"},t.auditForm);H.post({url:"/alarmevent/saveAudit",loading:!0,param:r,success:function(e){a.$message({message:"审核成功。",type:"success"}),a.listDialogVisible=!1,a.sel()}})})},queryTxnInfo:function(e){this.selectedRow=e,this.$refs.txnDetail.open()},initDateRange:function(){var e=new Date;return e.setHours((new Date).getHours()-1),[e,new Date]},initSelectData:function(){var e=this;return this.selTree(),H.post({url:"/rule/disposal",param:{},success:function(t){e.disposalList=t.row}}),new Fe.a(function(e,t){e()})},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txntypeShow=l.join(","),this.queryShowForm.txntype=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},renderIsCorrect:function(e,t,a){switch(a){case"0":return"认证未通过";case"1":return"认证通过";case"2":return"未认证";default:return""}},handleChange:function(){}},data:function(){return{inline:!0,activeNames:["1","2"],clearable:!0,listDialogVisible:!1,actionForm:{fraud_type:""},auditForm:{PS_RESULT:"",PS_INFO:""},rules:{PS_RESULT:[{required:!0,message:"审核结果为空",trigger:"blur"}],PS_INFO:[{required:!0,message:"处理信息为空",trigger:"blur"},{min:3,max:255,message:"长度在3到255个字符",trigger:"blur"}]},gridData:[],actionData:[],executeData:[],vTxncode:"",pageindex:1,pagesize:10,total:0,datatypeOptions:[],selectedRow:{},showItem:["operate","strategy","count","user","handle","device","deviceFinger"],defaultTab:"",txntypeDialogVisible:!1,infoDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],queryFormShow:!1,queryShowForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",psstatus:"",queryDate:this.initDateRange()},queryForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",psstatus:"",queryDate:this.initDateRange()},queryRules:{ipaddr:[{validator:ee.checkFormIp,trigger:"blur"}]},disposalList:[],iscorrectList:ot}},watch:{},components:{"txn-detail":Ue}},nt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户号:",prop:"userid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.userid,callback:function(t){e.$set(e.queryShowForm,"userid",t)},expression:"queryShowForm.userid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户名称:",prop:"username"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.username,callback:function(t){e.$set(e.queryShowForm,"username",t)},expression:"queryShowForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"监控交易:",prop:"txntypeShow"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.queryShowForm.txntypeShow,callback:function(t){e.$set(e.queryShowForm,"txntypeShow",t)},expression:"queryShowForm.txntypeShow"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"时间范围:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:!e.queryFormShow,expression:"!queryFormShow"}],attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)]),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.gridData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"65",alert:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:function(a){e.openDialog(t.$index,t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"txncode",label:"流水号",width:"235",align:"left","class-name":"link-item"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row)}}},[e._v(e._s(t.row.txncode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userid",label:"客户号",width:"120",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"客户名称","min-width":"100",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txntime",label:"交易时间","min-width":"135",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控操作","min-width":"90",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"disposal",label:"处置方式","min-width":"80",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"psstatus",label:"处理状态","min-width":"80",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"assign_name",label:"分派人","min-width":"80",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"oper_name",label:"处理人","min-width":"80",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"opertime",label:"处理时间","min-width":"135",formatter:e.formatter}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{background:"","current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"报警事件审核",visible:e.listDialogVisible,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.listDialogVisible=t}}},[a("div",[a("el-form",{attrs:{"label-position":"right",model:e.actionForm,inline:e.inline}},[a("el-row",[a("el-col",{attrs:{span:3}},[a("div",[a("el-form-item",{attrs:{label:"欺诈类型"}})],1)]),e._v(" "),a("el-col",{attrs:{span:9}},[a("div",[a("el-form-item",{attrs:{prop:"fraud_type",clearable:""}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},on:{focus:function(t){e.selectFocus("fraud_type")}},model:{value:e.actionForm.fraud_type,callback:function(t){e.$set(e.actionForm,"fraud_type",t)},expression:"actionForm.fraud_type"}},e._l(e.datatypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)])],1)],1),e._v(" "),a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"处理动作信息",name:"1"}},[a("el-table",{attrs:{data:e.actionData,"highlight-current-row":"","max-height":"120","tooltip-effect":"dark"},on:{"selection-change":e.handleCurrentRow}},[a("el-table-column",{attrs:{prop:"ac_name",label:"动作名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_cond_in",label:"条件"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_expr_in",label:"表达式"}})],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"报警处理信息",name:"2"}},[a("el-table",{attrs:{data:e.executeData,"highlight-current-row":"","max-height":"120","tooltip-effect":"dark"},on:{"selection-change":e.handleCurrentRow}},[a("el-table-column",{attrs:{prop:"ps_time",label:"处理时间",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ps_type",label:"处理类型",width:"90",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"login_name",label:"处理人员",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ps_result",label:"处理结果",width:"90",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"ps_info",label:"处理信息"}})],1)],1)],1),e._v(" "),a("el-form",{ref:"auditForm",attrs:{"label-position":"right",model:e.auditForm,rules:e.rules}},[a("el-row",[a("el-col",{attrs:{span:3}},[a("div",[a("el-form-item",{attrs:{label:"审核结果",prop:"PS_RESULT"}})],1)]),e._v(" "),a("el-col",{attrs:{span:9}},[a("div",[a("el-form-item",[a("el-radio",{attrs:{label:"1"},model:{value:e.auditForm.PS_RESULT,callback:function(t){e.$set(e.auditForm,"PS_RESULT",t)},expression:"auditForm.PS_RESULT"}},[e._v("通过")]),e._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:e.auditForm.PS_RESULT,callback:function(t){e.$set(e.auditForm,"PS_RESULT",t)},expression:"auditForm.PS_RESULT"}},[e._v("不通过")])],1)],1)])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:3,rows:3}},[a("div",[a("el-form-item",{attrs:{label:"处理信息",prop:"PS_INFO"}})],1)]),e._v(" "),a("el-col",{attrs:{span:20}},[a("div",[a("el-input",{attrs:{type:"textarea",resize:"none",rows:3,"auto-complete":"off",placeholder:"请输入内容"},model:{value:e.auditForm.PS_INFO,callback:function(t){e.$set(e.auditForm,"PS_INFO",t)},expression:"auditForm.PS_INFO"}})],1)])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer",align:"left"},slot:"footer"},[a("el-button",{attrs:{data:"cancelBtn",icon:"el-icon-success",type:"primary"},on:{click:function(t){e.onSaveAudit("auditForm")}}},[e._v("提 交")]),e._v(" "),a("el-button",{attrs:{data:"cancelBtn",icon:"el-icon-arrow-left",type:"primary"},on:{click:function(t){e.listDialogVisible=!1}}},[e._v("返 回")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"监控交易",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("txn-detail",{ref:"txnDetail",attrs:{txn:e.selectedRow,defaultTab:e.defaultTab,showItem:e.showItem}})],1)},staticRenderFns:[]};var st=a("X4nt")(it,nt,!1,function(e){a("o6ER")},null,null).exports,ct={created:function(){this.sel()},methods:{handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},openDialog:function(e){this.flag=e,"edit"===e?(this.dialogTitle="编辑名单",this.status=!0,this.listDialogform=s()({},this.selectedRow)):"add"===e&&(this.dialogTitle="新建名单",this.status=!1,this.$refs.listDialogform?this.$refs.listDialogform.resetFields():this.listDialogform={rostername:"",rosterdesc:"",datatype:"",rostertype:"",iscache:"1",remark:""}),this.listDialogVisible=!0,this.$refs.listDialogform&&this.$refs.listDialogform.clearValidate()},handleSelectionChange:function(e){this.multipleSelection=e,1===e.length?(this.btnStatus=!1,this.delBtnStatus=!1):e.length>1?(this.btnStatus=!0,this.delBtnStatus=!1):(this.btnStatus=!0,this.delBtnStatus=!0)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"add"===t.flag?t.add():"edit"===t.flag&&t.update()})},bindGridData:function(e){this.gridData=e.page.list,this.pageindex=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},add:function(){var e=this;H.post({url:"/mgr/add",param:this.listDialogform,success:function(t){e.$message({type:"success",message:"创建成功"}),e.listDialogVisible=!1,e.sel()}})},del:function(){var e=this,t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/mgr/del",param:{del:[e.selectedRow]},success:function(e){t.$message({type:"success",message:"删除成功"}),t.sel()}})}).catch(function(){})},sel:function(e){var t,a=this;t=e&&(e.pageindex||e.pagesize)?s()({pageindex:this.pageindex,pagesize:this.pagesize},this.listForm,e):s()({pageindex:this.pageindex,pagesize:this.pagesize},this.listForm),H.post({url:"/mgr/list",param:t,success:function(e){e.page&&a.bindGridData(e)}})},update:function(){var e=this;H.post({url:"/mgr/mod",param:this.listDialogform,success:function(t){e.$message({type:"success",message:"编辑成功"}),e.listDialogVisible=!1,e.sel()}})},showValueList:function(){var e=this.selectedRow.rosterid,t=this.selectedRow.datatype;this.$router.push({name:"valuelist",params:{rosterid:e,datatype:t}})},importList:function(){this.fileList=[],this.importDialogVisible=!0},exportList:function(){0!==this.selectedRow.valuecount?this.exportDialogVisible=!0:this.$message("名单中没有名单值")},selectFocus:function(e){"datatype"===e&&0===this.datatypeOptions.length&&(this.datatypeOptions=ue.getCodeItems("tms.model.datatype.roster")),"rostertype"===e&&0===this.rostertypeOptions.length&&(this.rostertypeOptions=ue.getCodeItems("tms.mgr.rostertype"))},formatter:function(e,t,a){switch(t.property){case"datatype":return ue.rendCode("tms.model.datatype.roster",a);case"rostertype":return ue.rendCode("tms.mgr.rostertype",a);case"createtime":return ue.rendDatetime(a);case"iscache":return ue.rendCode("tms.mgr.iscache",a);default:return a}},submitUpload:function(){var e=this,t="."+this.file.name.split(".").pop(),a=this.selectedRow;this.uploadForm=new FormData,this.uploadForm.append("importFile",this.file.raw),this.uploadForm.append("rosterid",a.rosterid),this.uploadForm.append("rosterdesc",a.rosterdesc),this.uploadForm.append("format",t),H.post({url:"/mgr/import",param:e.uploadForm,success:function(t){e.importDialogVisible=!1,e.$message({type:"success",message:"导入成功"})}})},handleChange:function(e,t){this.fileList=[e],this.file=e},exportAction:function(e){var t=this.selectedRow,a="&rosterid="+t.rosterid+"&rosterdesc="+t.rosterdesc,r="/context/manager/mgr/export?"+(j.serializeObj(this.listForm)+a+"&flag="+e);window.open(r),this.exportDialogVisible=!1},handleRow:function(e,t,a){switch(this.selectedRow=t,a){case"edit":return this.openDialog("edit");case"del":return this.del();case"valueList":return this.showValueList();case"upload":return this.importList();case"download":return this.exportList();default:return}}},data:function(){return{inline:!0,clearable:!0,listForm:{rosterdesc:"",datatype:"",rostertype:""},gridData:[],pageindex:1,pagesize:10,total:100,listDialogVisible:!1,listDialogform:{rostername:"",rosterdesc:"",datatype:"",rostertype:"",iscache:"1",remark:""},status:!0,btnStatus:!0,delBtnStatus:!0,dialogTitle:"",formLabelWidth:"120px",datatypeOptions:[],rostertypeOptions:[],rules:{rostername:[{required:!0,message:"请输入名单英文名",trigger:"blur"},{max:32,message:"长度在32个字符以内",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"}],listFormFosterdesc:[{max:64,message:"长度在64个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],rosterdesc:[{required:!0,message:"请输入名单名称",trigger:"blur"},{max:64,message:"长度在64个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],datatype:[{required:!0,message:"请输入名单数据类型",trigger:"blur"}],rostertype:[{required:!0,message:"请输入名单类型",trigger:"blur"}],remark:[{max:512,message:"长度在512个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},multipleSelection:[],flag:"",importDialogVisible:!1,exportDialogVisible:!1,fileList:[],multiple:!1,selectedRow:{},closeOnClickModal:!1,showOverflow:!0}}},ut={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",id:"addBtn"},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"100px",model:e.listForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"名单名称",prop:"listFormFosterdesc"}},[a("el-input",{attrs:{clearable:e.clearable},model:{value:e.listForm.rosterdesc,callback:function(t){e.$set(e.listForm,"rosterdesc",t)},expression:"listForm.rosterdesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单类型"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},on:{focus:function(t){e.selectFocus("rostertype")}},model:{value:e.listForm.rostertype,callback:function(t){e.$set(e.listForm,"rostertype",t)},expression:"listForm.rostertype"}},e._l(e.rostertypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{ref:"selBtn",staticClass:"el-icon-search",attrs:{type:"primary",id:"selBtn"},on:{click:e.sel}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{staticClass:"scroll",attrs:{data:e.gridData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text",title:"编辑"},on:{click:function(a){e.handleRow(t.$index,t.row,"edit")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-delete",type:"text",title:"删除"},on:{click:function(a){e.handleRow(t.$index,t.row,"del")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-document",type:"text",title:"名单值"},on:{click:function(a){e.handleRow(t.$index,t.row,"valueList")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-upload",type:"text",title:"导入"},on:{click:function(a){e.handleRow(t.$index,t.row,"upload")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-download",type:"text",title:"导出"},on:{click:function(a){e.handleRow(t.$index,t.row,"download")}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rostername",label:"名单英文名",align:"left",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rosterdesc",label:"名单名称",align:"left",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"datatype",label:"名单数据类型",align:"left",width:"120",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"rostertype",label:"名单类型",align:"left",width:"120",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"valuecount",label:"值数量",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createtime",label:"创建时间",align:"left",width:"160",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"iscache",label:"是否缓存",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left","show-overflow-tooltip":e.showOverflow}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.listDialogVisible,width:"40%","close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.listDialogVisible=t}}},[a("el-form",{ref:"listDialogform",staticStyle:{"text-align":"left"},attrs:{model:e.listDialogform,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"名单英文名",prop:"rostername",data:"rostername"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:e.status},model:{value:e.listDialogform.rostername,callback:function(t){e.$set(e.listDialogform,"rostername",t)},expression:"listDialogform.rostername"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单名称",prop:"rosterdesc",data:"rosterdesc"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:e.status},model:{value:e.listDialogform.rosterdesc,callback:function(t){e.$set(e.listDialogform,"rosterdesc",t)},expression:"listDialogform.rosterdesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单数据类型",prop:"datatype",data:"datatype"}},[a("el-select",{attrs:{disabled:e.status,clearable:e.clearable},on:{focus:function(t){e.selectFocus("datatype")}},model:{value:e.listDialogform.datatype,callback:function(t){e.$set(e.listDialogform,"datatype",t)},expression:"listDialogform.datatype"}},e._l(e.datatypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"名单类型",prop:"rostertype",data:"rostertype"}},[a("el-select",{attrs:{disabled:e.status,clearable:e.clearable},on:{focus:function(t){e.selectFocus("rostertype")}},model:{value:e.listDialogform.rostertype,callback:function(t){e.$set(e.listDialogform,"rostertype",t)},expression:"listDialogform.rostertype"}},e._l(e.rostertypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否缓存",prop:"iscache",data:"iscache"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.listDialogform.iscache,callback:function(t){e.$set(e.listDialogform,"iscache",t)},expression:"listDialogform.iscache"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark",data:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.listDialogform.remark,callback:function(t){e.$set(e.listDialogform,"remark",t)},expression:"listDialogform.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary",data:"saveBtn"},on:{click:function(t){e.submitForm("listDialogform")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{data:"cancelBtn"},on:{click:function(t){e.listDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"名单管理导入",visible:e.importDialogVisible,"close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.importDialogVisible=t}}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/context/manager/mgr/import","on-change":e.handleChange,"file-list":e.fileList,multiple:e.multiple,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请上传XLS、XLSX、TXT或CSV格式的文件")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择导出名单格式",visible:e.exportDialogVisible,"close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.exportDialogVisible=t}}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.exportAction("txt")}}},[e._v("TXT")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.exportAction("csv")}}},[e._v("CSV")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.exportAction("xls")}}},[e._v("Excel2003及以下版本")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.exportAction("xlsx")}}},[e._v("Excel2007及以上版本")])],1)],1)},staticRenderFns:[]};var dt=a("X4nt")(ct,ut,!1,function(e){a("uLuI")},null,null).exports,mt={created:function(){this.sel()},methods:{handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},openDialog:function(e,t){this.listDialogVisible=!0,s()(this.listDialogform,this.selectRowNum2Str(t)),setTimeout(function(){self.listDialogform.rostertype=t.rostertype},300)},selectRowNum2Str:function(e){var t={};for(var a in s()(t,e),t)"number"==typeof t[a]&&(t[a]=t[a].toString());return t},handleSelectionChange:function(e){this.multipleSelection=e},bindGridData:function(e){this.gridData=e.page.list,this.pageindex=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},sel:function(e){var t,a=this;t=e&&(e.pageindex||e.pagesize)?j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.listForm,e):j.extend({pageindex:this.pageindex,pagesize:this.pagesize},this.listForm),H.post({url:"/mgrView/list",param:t,success:function(e){e.page&&a.bindGridData(e)}})},showValueList:function(e,t){var a=t.rosterid.toString();this.$router.push({name:"showValueList",params:{rosterid:a,datatype:"view"}})},selectFocus:function(e){"datatype"===e&&0===this.datatypeOptions.length&&(this.datatypeOptions=ue.getCodeItems("tms.model.datatype.roster")),"rostertype"===e&&0===this.rostertypeOptions.length&&(this.rostertypeOptions=ue.getCodeItems("tms.mgr.rostertype"))},formatter:function(e,t,a){switch(t.property){case"datatype":return ue.rendCode("tms.model.datatype.roster",a);case"rostertype":return ue.rendCode("tms.mgr.rostertype",a);case"createtime":return ue.rendDatetime(a);case"iscache":return ue.rendCode("tms.mgr.iscache",a);default:return a}}},data:function(){return{inline:!0,clearable:!0,listForm:{rosterdesc:"",datatype:"",rostertype:""},gridData:[],pageindex:1,pagesize:10,total:100,listDialogVisible:!1,listDialogform:{rostername:"",rosterdesc:"",datatype:"",rostertype:"",iscache:"1",remark:""},dialogTitle:"",formLabelWidth:"120px",datatypeOptions:[],rostertypeOptions:[],multipleSelection:[]}},props:["rosterid"]},pt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"100px",model:e.listForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"名单名称",prop:"listFormFosterdesc"}},[a("el-input",{model:{value:e.listForm.rosterdesc,callback:function(t){e.$set(e.listForm,"rosterdesc",t)},expression:"listForm.rosterdesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单类型"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},on:{focus:function(t){e.selectFocus("rostertype")}},model:{value:e.listForm.rostertype,callback:function(t){e.$set(e.listForm,"rostertype",t)},expression:"listForm.rostertype"}},e._l(e.rostertypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{ref:"selBtn",staticClass:"el-icon-search",attrs:{type:"primary",id:"selBtn"},on:{click:e.sel}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{attrs:{data:e.gridData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"number"==typeof t.row.rosterid,expression:"typeof(scope.row.rosterid)=='number'"}],attrs:{type:"text",icon:"el-icon-zoom-in",title:"查看"},on:{click:function(a){e.openDialog(t.$index,t.row)}}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"number"==typeof t.row.rosterid,expression:"typeof(scope.row.rosterid)=='number'"}],attrs:{type:"text",icon:"el-icon-document",title:"名单值"},on:{click:function(a){e.showValueList(t.$index,t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rostername",label:"名单英文名",align:"left",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rosterdesc",label:"名单名称",align:"left",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"datatype",label:"名单数据类型",align:"left",width:"120",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"rostertype",label:"名单类型",align:"left",width:"120",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"valuecount",label:"值数量",align:"left",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createtime",label:"创建时间",align:"left",width:"160",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"iscache",label:"是否缓存",align:"left",formatter:e.formatter}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查看名单",visible:e.listDialogVisible,width:"40%"},on:{"update:visible":function(t){e.listDialogVisible=t}}},[a("el-form",{ref:"listDialogform",staticStyle:{"text-align":"left"},attrs:{model:e.listDialogform,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"名单英文名",prop:"rostername",data:"rostername"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:e.listDialogform.rostername,callback:function(t){e.$set(e.listDialogform,"rostername",t)},expression:"listDialogform.rostername"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单名称",prop:"rosterdesc",data:"rosterdesc"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:e.listDialogform.rosterdesc,callback:function(t){e.$set(e.listDialogform,"rosterdesc",t)},expression:"listDialogform.rosterdesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名单数据类型",prop:"datatype",data:"datatype"}},[a("el-select",{attrs:{disabled:"",clearable:e.clearable},model:{value:e.listDialogform.datatype,callback:function(t){e.$set(e.listDialogform,"datatype",t)},expression:"listDialogform.datatype"}},e._l(e.datatypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"名单类型",prop:"rostertype",data:"rostertype"}},[a("el-select",{attrs:{disabled:"",clearable:e.clearable},model:{value:e.listDialogform.rostertype,callback:function(t){e.$set(e.listDialogform,"rostertype",t)},expression:"listDialogform.rostertype"}},e._l(e.rostertypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否缓存",prop:"iscache",data:"iscache",disabled:""}},[a("el-radio",{attrs:{label:"1",disabled:""},model:{value:e.listDialogform.iscache,callback:function(t){e.$set(e.listDialogform,"iscache",t)},expression:"listDialogform.iscache"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"0",disabled:""},model:{value:e.listDialogform.iscache,callback:function(t){e.$set(e.listDialogform,"iscache",t)},expression:"listDialogform.iscache"}},[e._v("否")])],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark",data:"remark"}},[a("el-input",{attrs:{type:"textarea",disabled:!0},model:{value:e.listDialogform.remark,callback:function(t){e.$set(e.listDialogform,"remark",t)},expression:"listDialogform.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{icon:"el-icon-arrow-left",type:"primary"},on:{click:function(t){e.listDialogVisible=!1}}},[e._v("返 回")])],1)],1)],1)],1)},staticRenderFns:[]},ft=a("X4nt")(mt,pt,!1,null,null,null).exports,ht={created:function(){this.getList(this.sel)},methods:{handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},bindGridData:function(e){this.gridData=e.page.list,this.pageindex=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},getList:function(e){self=this;var t={rosterid:this.$router.history.current.params.rosterid};H.post({url:"/mgr/get",param:t,success:function(t){self.listData=t.row;var a="名单值查看->"+t.row.rosterdesc;self.Hub.$emit("changeModeName",a),e&&e()}})},backList:function(){self.Hub.$emit("changeModeName","名单查看"),this.$router.push({name:"namelist"})},sel:function(e){var t,a=this,r={pageindex:this.pageindex,pagesize:this.pagesize,rosterid:this.listData.rosterid,datatype:this.listData.datatype};t=e&&(e.pageindex||e.pagesize)?j.extend(r,this.valueListForm,e):j.extend(r,this.valueListForm),H.post({url:"/mgr/valuelist",param:t,success:function(e){e.page&&a.bindGridData(e)}})}},data:function(){return{inline:!0,valueListForm:{rostervalue:""},listData:{rosterdesc:""},gridData:[],pageindex:1,pagesize:10,total:100,valueListDialogVisible:!1,valueListDialogform:{rostervalue:"",enabletime:(new Date).format("yyyy-MM-dd hh:mm:ss"),disabletime:"",remark:""},dialogTitle:"",multipleSelection:[],flag:"",valuecurrentRow:{},changeValueDialogVisible:!1,btnStatus:!0,delBtnStatus:!0}}},gt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{attrs:{data:"cancelBtn",icon:"el-icon-arrow-left"},on:{click:e.backList}},[e._v("返 回")]),e._v(" "),a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"100px",model:e.valueListForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"名单值"}},[a("el-input",{model:{value:e.valueListForm.rostervalue,callback:function(t){e.$set(e.valueListForm,"rostervalue",t)},expression:"valueListForm.rostervalue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.sel}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-table",{attrs:{data:e.gridData}},[a("el-table-column",{attrs:{prop:"rostervalue",label:"名单值",align:"left",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"enabletime",label:"开始时间",align:"left",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"disabletime",label:"结束时间",align:"left",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createtime",label:"创建时间",align:"left",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left",width:"300"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{background:"",label:"left","current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},staticRenderFns:[]},vt=a("X4nt")(ht,gt,!1,null,null,null).exports,bt={created:function(){this.getList(this.sel)},methods:{handleSizeChange:function(e){this.sel({pageindex:this.pageindex,pagesize:e})},handleCurrentChange:function(e){this.sel({pageindex:e,pagesize:this.pagesize})},openDialog:function(e){this.flag=e,this.dialogTitle="名单值管理->"+this.title,"edit"===e?this.valueListDialogform=s()({},this.selectedRow):"add"===e&&(this.$refs.valueListDialogform?this.$refs.valueListDialogform.resetFields():this.valueListDialogform={rostervalue:"",enabletime:(new Date).format("yyyy-MM-dd hh:mm:ss"),disabletime:"",remark:""}),this.valueListDialogVisible=!0,this.$refs.valueListDialogform&&this.$refs.valueListDialogform.clearValidate()},handleSelectionChange:function(e){this.multipleSelection=e,1===e.length?(this.btnStatus=!1,this.delBtnStatus=!1):e.length>1?(this.btnStatus=!0,this.delBtnStatus=!1):(this.btnStatus=!0,this.delBtnStatus=!0)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;"add"===t.flag?t.add():"edit"===t.flag&&t.update()})},bindGridData:function(e){this.gridData=e.page.list,this.pageindex=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},bindValueGridData:function(e){this.changeValueTableData=e.row},getList:function(e){self=this;var t={rosterid:this.$router.history.current.params.rosterid};H.post({url:"/mgr/get",param:t,success:function(t){self.listData=t.row;var a="名单值管理->"+t.row.rosterdesc;self.Hub.$emit("changeModeName",a),e&&e()}})},add:function(){var e=this,t=s()({rosterid:this.listData.rosterid,datatype:this.listData.datatype,rosterdesc:this.listData.rosterdesc},this.valueListDialogform);H.post({url:"/mgr/valueadd",param:t,success:function(t){e.$message({type:"success",message:"创建成功"}),e.valueListDialogVisible=!1,e.sel()}})},del:function(){var e=this,t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/mgr/valuedel",param:{postData:{del:[e.selectedRow]}},success:function(e){t.$message({type:"success",message:"删除成功"}),t.sel()}})}).catch(function(){})},sel:function(e){var t,a=this,r={pageindex:this.pageindex,pagesize:this.pagesize,rosterid:this.listData.rosterid,datatype:this.listData.datatype};t=e&&(e.pageindex||e.pagesize)?s()(r,this.valueListForm,e):s()(r,this.valueListForm),H.post({url:"/mgr/valuelist",param:t,success:function(e){e.page&&a.bindGridData(e)}})},update:function(){var e=this,t=s()({rosterid:this.listData.rosterid,datatype:this.listData.datatype,rosterdesc:this.listData.rosterdesc},this.valueListDialogform);H.post({url:"/mgr/valuemod",param:t,success:function(t){e.$message({type:"success",message:"编辑成功"}),e.valueListDialogVisible=!1,e.sel()}})},changeValue:function(){var e=this;H.post({url:"/mgr/changevalueget",param:{rosterid:this.listData.rosterid,datatype:this.listData.datatype,rostertype:this.listData.rostertype},success:function(t){e.bindValueGridData(t),e.changeValueDialogVisible=!0}})},constrast:function(){var e=this.selectedRow;H.post({url:"/mgr/changevalue",param:{rostervalueid:e.rostervalueid,rostervalue:e.rostervalue,rosterid:this.valuecurrentRow.rosterid+"||||"+this.valuecurrentRow.rosterdesc,rosteridold:this.listData.rosterid,rosterdescout:this.listData.rosterdesc},success:function(e){self.$message({type:"success",message:"值转换成功"}),self.changeValueDialogVisible=!1,self.sel()}})},handleCurrentChangeValueTable:function(e){this.valuecurrentRow=e},backList:function(){self.Hub.$emit("changeModeName","名单管理"),this.$router.push({name:"list"})},handleRow:function(e,t,a){switch(this.selectedRow=t,a){case"edit":return this.openDialog("edit");case"del":return this.del();case"changeValue":return this.changeValue();default:return}},formatter:function(e,t,a){switch(t.property){case"rostertype":return ue.rendCode("tms.mgr.rostertype",a);default:return a}}},data:function(){var e=this,t=function(t,a,r){return""===e.valueListDialogform.disabletime?r():Date.parse(e.valueListDialogform.enabletime)>Date.parse(e.valueListDialogform.disabletime)?"enabletime"===t.field?r(new Error("开始时间不得晚于结束时间")):"disabletime"===t.field?r(new Error("结束时间不得早于开始时间")):r():r()};return{inline:!0,valueListForm:{rostervalue:""},listData:{rosterdesc:""},gridData:[],pageindex:1,pagesize:10,total:100,valueListDialogVisible:!1,valueListDialogform:{rostervalue:"",enabletime:(new Date).format("yyyy-MM-dd hh:mm:ss"),disabletime:"",remark:""},dialogTitle:"",formLabelWidth:"100px",rules:{rostervalue:[{required:!0,message:"请输入名单英文名",trigger:"blur"},{max:64,message:"长度在64个字符以内",trigger:"blur"},{validator:function(t,a,r){var l=e.listData.datatype;return"ip"==l||ee.checkSpecialCode(a)?"ip"!=l||ee.isIP(a)?void r():r(new Error("IP名单值格式错误")):r(new Error("请不要输入特殊字符！如($,%)"))},trigger:"blur"},{validator:function(t,a,r){if(a===e.selectedRow.rostervalue)return r();H.post({url:"/mgr/checkRostervalue",param:{rostervalue:e.valueListDialogform.rostervalue},success:function(e){"false"===e.check_result?r(new Error("名单值已经存在")):r()}})},trigger:"blur"}],enabletime:[{required:!0,message:"开始日期不能为空",trigger:"blur"},{validator:t,trigger:"blur"}],disabletime:[{validator:t,trigger:"blur"}],remark:[{max:512,message:"长度在512个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},multipleSelection:[],flag:"",changeValueDialogVisible:!1,changeValueTableData:[],valuecurrentRow:{},btnStatus:!0,delBtnStatus:!0,selectedRow:{},closeOnClickModal:!1,showOverflow:!0}}},_t={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("el-button",{staticClass:"el-icon-back",attrs:{plain:""},on:{click:e.backList}},[e._v("返回")]),e._v(" "),a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"100px",model:e.valueListForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"名单值"}},[a("el-input",{model:{value:e.valueListForm.rostervalue,callback:function(t){e.$set(e.valueListForm,"rostervalue",t)},expression:"valueListForm.rostervalue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.sel}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{attrs:{data:e.gridData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text",title:"编辑"},on:{click:function(a){e.handleRow(t.$index,t.row,"edit")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-delete",type:"text",title:"删除"},on:{click:function(a){e.handleRow(t.$index,t.row,"del")}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-tickets",type:"text",title:"值转换"},on:{click:function(a){e.handleRow(t.$index,t.row,"changeValue")}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rostervalue",label:"名单值",align:"left","show-overflow-tooltip":e.showOverflow}}),e._v(" "),a("el-table-column",{attrs:{prop:"enabletime",label:"开始时间",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"disabletime",label:"结束时间",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createtime",label:"创建时间",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left","show-overflow-tooltip":e.showOverflow}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.pageindex,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.valueListDialogVisible,"close-on-click-modal":e.closeOnClickModal,width:"40%"},on:{"update:visible":function(t){e.valueListDialogVisible=t}}},[a("el-form",{ref:"valueListDialogform",staticStyle:{"text-align":"left"},attrs:{model:e.valueListDialogform,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"名单值",prop:"rostervalue"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.valueListDialogform.rostervalue,callback:function(t){e.$set(e.valueListDialogform,"rostervalue",t)},expression:"valueListDialogform.rostervalue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"enabletime"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.valueListDialogform.enabletime,callback:function(t){e.$set(e.valueListDialogform,"enabletime",t)},expression:"valueListDialogform.enabletime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"disabletime"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.valueListDialogform.disabletime,callback:function(t){e.$set(e.valueListDialogform,"disabletime",t)},expression:"valueListDialogform.disabletime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.valueListDialogform.remark,callback:function(t){e.$set(e.valueListDialogform,"remark",t)},expression:"valueListDialogform.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("valueListDialogform")}}},[e._v("保 存")]),e._v(" "),a("el-button",{on:{click:function(t){e.valueListDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"值转换",visible:e.changeValueDialogVisible,"close-on-click-modal":e.closeOnClickModal,width:"40%"},on:{"update:visible":function(t){e.changeValueDialogVisible=t}}},[a("el-table",{attrs:{data:e.changeValueTableData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChangeValueTable}},[a("el-table-column",{attrs:{prop:"rosterdesc",label:"名单名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"datatype",label:"名单数据类型",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rostertype",label:"名单类型",align:"left",formatter:e.formatter}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"left","margin-top":"18px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.constrast}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.changeValueDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]},yt=a("X4nt")(bt,_t,!1,null,null,null).exports,Ft=a("kfHR"),xt=a.n(Ft),wt={computed:{allPick:function(){var e=this.allDataList.map(function(e){return e.code_key}),t=new Ye.a(this.selectedRows);return 0===new Ye.a(e.filter(function(e){return!t.has(e)})).size},selectDisabled:function(){return this.disabled},selectCollapseTags:function(){return this.collapseTags}},data:function(){return{allDataList:[],selectedCached:[],selectedRows:[]}},props:{dataList:{type:Array,default:function(){return[]}},selectedList:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},collapseTags:{type:Boolean,default:!0}},mounted:function(){this.$nextTick(function(){this.allDataList=this.dataList,this.selectedRows=this.selectedList})},watch:{selectedRows:function(){this.value=this.selectedRows;var e=this.selectedRows.filter(function(e){return"&ALLPICK&"!==e});this.$emit("dataChange",e)},selectedList:function(){this.selectedRows=this.selectedList},dataList:function(){this.allDataList=this.dataList}},methods:{setRows:function(e){this.selectedRows=e},selectChange:function(e){var t=new Ye.a(this.selectedCached),a=new Ye.a(this.selectedRows),r=new Ye.a(this.selectedCached.filter(function(e){return!a.has(e)}));r.size>0&&(r.has("&ALLPICK&")?this.selectedRows=[]:this.selectedRows=this.selectedRows.filter(function(e){return"&ALLPICK&"!==e})),(r=new Ye.a(this.selectedRows.filter(function(e){return!t.has(e)}))).size>0&&(r.has("&ALLPICK&")?(this.selectedRows=[],this.selectedRows=this.allDataList.map(function(e){return e.code_key}),this.selectedRows.push("&ALLPICK&")):this.allPick&&this.selectedRows.push("&ALLPICK&")),this.selectedCached=[];var l=new Ye.a(this.selectedRows),o=[];l.has("&ALLPICK&")&&(o.push("&ALLPICK&"),l.delete("&ALLPICK&"),o=o.concat(xt()(l)),this.selectedRows=o),s()(this.selectedCached,this.selectedRows)}}},Dt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"query-form-item",attrs:{placeholder:"请选择",multiple:"","collapse-tags":e.selectCollapseTags,disabled:e.selectDisabled},on:{change:e.selectChange},model:{value:e.selectedRows,callback:function(t){e.selectedRows=t},expression:"selectedRows"}},[a("el-option",{key:"&ALLPICK&",attrs:{label:"全选",value:"&ALLPICK&"}}),e._v(" "),e._l(e.allDataList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})})],2)},staticRenderFns:[]};var St=a("X4nt")(wt,Dt,!1,function(e){a("v+RZ")},null,null).exports,kt={computed:{selectedList:function(){var e=this.tranDefForm.tab_disposal;return e&&""!==e.trim()?e.split(","):[]},saveVisible:function(){return this.readonly||this.editVisible},addFlag:function(){return"add"===this.tranDefForm.op},txnIdVisible:function(){return"1"!==this.tranDefForm.txn_type},channVisible:function(){var e=this.tranDefForm.par_chann;return!(null===e||""===e||void 0===e)},modelusedVisible:function(){return"add"===this.tranDefForm.op},formReadonly:function(){return this.readonly||"T"===this.tranDefForm.tab_name||""===this.tranDefForm.tab_name&&""===this.tranDefForm.op}},data:function(){var e=this;return{tabDisposalList:[],tabDisposalSelectedCached:[],modelUsedList:[{label:"不使用模型",value:"0"},{label:"模型学习期",value:"1"}],channelList:[{channelname:"全渠道",channelid:"0"}],tranDefForm:{parent_tab:"",tab_name:"",modelused_o:"",traindate:"",op:"",tab_desc:"",show_order:"",txn_type:"0",txnid:"",tab_disposal:"",chann:"",par_chann:"",txnffname:"",modelused:"",is_enable:"1"},formLabelWidth:"120px",rules:{txnid:[{max:20,message:"长度不能超过20个字符",trigger:"blur"},{validator:function(t,a,r){if("1"===e.tranDefForm.txn_type){if(""===a.trim())return r(new Error("当交易类型为交易时,交易识别标识不能为空"));if(!/^[a-zA-Z][\w]*$/.test(a))return r(new Error("请以字母开头，包括字母、数字和下划线"))}r()},trigger:"blur"}],chann:[{validator:function(t,a,r){var l=e;if(""===a.trim()&&"1"===l.tranDefForm.txn_type)return r(new Error("当交易类型为交易时,渠道不能为空"));r()},trigger:"blur"}],disposal:[{required:!0,message:"请选择处置策略",trigger:"blur"}],tab_desc:[{required:!0,message:"请输入名称",trigger:"blur"},{max:32,message:"长度不能超过32个字符",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"}],show_order:[{required:!0,message:"请输入顺序",trigger:"blur"},{pattern:/^(0|[1-9]\d{0,3})$/,message:"顺序必须为小于5位数的正整数",trigger:"blur"}]}}},props:["editVisible","readonly"],watch:{tranDefForm:{handler:function(e){"0"===e.txn_type&&(e.txnid="")},deep:!0}},methods:{addStatParamDataChange:function(e){this.tranDefForm.tab_disposal=e.join(",")},closeAddDialog:function(){this.$emit("listenToCloseDialog",!1)},reloadPage:function(e){this.$emit("listenToReloadPage",e)},resetForm:function(){this.$refs.tranDefForm.resetFields()},submitForm:function(){var e=this,t=e.tranDefForm,a=t.op;this.$refs.tranDefForm.validate(function(r){r&&H.post({url:"/trandef/save",loading:!0,param:t,success:function(t){t.success&&("add"===a?(e.$message.success("创建成功"),e.closeAddDialog()):e.$message.success("编辑成功"),e.reloadPage(a))},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})})},getModelUsedList:function(e){var t=ue.getCodeItems("tms.model.modelused"),a=e||this.tranDefForm.modelused;null!==a&&"0"!==a||t.pop(),this.modelUsedList=t}},components:{AllPickSelect:St}},Ct={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"tranDefForm",staticStyle:{"text-align":"left"},attrs:{model:e.tranDefForm,rules:e.rules,"label-suffix":"：","label-width":e.formLabelWidth}},[a("el-form-item",{staticClass:"hidden",attrs:{label:"",prop:"parent_tab"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tranDefForm.parent_tab,callback:function(t){e.$set(e.tranDefForm,"parent_tab",t)},expression:"tranDefForm.parent_tab"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"",prop:"tab_name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tranDefForm.tab_name,callback:function(t){e.$set(e.tranDefForm,"tab_name",t)},expression:"tranDefForm.tab_name"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"",prop:"modelused_o"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tranDefForm.modelused_o,callback:function(t){e.$set(e.tranDefForm,"modelused_o",t)},expression:"tranDefForm.modelused_o"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"",prop:"traindate"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tranDefForm.traindate,callback:function(t){e.$set(e.tranDefForm,"traindate",t)},expression:"tranDefForm.traindate"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"",prop:"op"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tranDefForm.op,callback:function(t){e.$set(e.tranDefForm,"op",t)},expression:"tranDefForm.op"}})],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"名称",prop:"tab_desc"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.formReadonly,clearable:""},model:{value:e.tranDefForm.tab_desc,callback:function(t){e.$set(e.tranDefForm,"tab_desc",t)},expression:"tranDefForm.tab_desc"}})],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"顺序",prop:"show_order"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.formReadonly,maxlength:4,clearable:""},model:{value:e.tranDefForm.show_order,callback:function(t){e.$set(e.tranDefForm,"show_order",t)},expression:"tranDefForm.show_order"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"交易类型"}},[a("el-radio",{attrs:{label:"0",disabled:e.formReadonly},model:{value:e.tranDefForm.txn_type,callback:function(t){e.$set(e.tranDefForm,"txn_type",t)},expression:"tranDefForm.txn_type"}},[e._v("交易组")]),e._v(" "),a("el-radio",{attrs:{label:"1",disabled:e.formReadonly},model:{value:e.tranDefForm.txn_type,callback:function(t){e.$set(e.tranDefForm,"txn_type",t)},expression:"tranDefForm.txn_type"}},[e._v("交易")])],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{class:{hidden:e.txnIdVisible},attrs:{label:"交易识别标识",prop:"txnid"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:e.formReadonly,clearable:""},model:{value:e.tranDefForm.txnid,callback:function(t){e.$set(e.tranDefForm,"txnid",t)},expression:"tranDefForm.txnid"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"处置策略","label-width":e.formLabelWidth,prop:"tab_disposal"}},[a("AllPickSelect",{attrs:{dataList:e.tabDisposalList,selectedList:e.selectedList,disabled:e.formReadonly,clearable:""},on:{dataChange:e.addStatParamDataChange}})],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"渠道名称",prop:"chann"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:e.formReadonly||e.channVisible,clearable:""},model:{value:e.tranDefForm.chann,callback:function(t){e.$set(e.tranDefForm,"chann",t)},expression:"tranDefForm.chann"}},e._l(e.channelList,function(e){return a("el-option",{key:e.channelid,attrs:{label:e.channelname,value:e.channelid}})}))],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"上级交易",prop:"txnffname"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:"readonly"},model:{value:e.tranDefForm.txnffname,callback:function(t){e.$set(e.tranDefForm,"txnffname",t)},expression:"tranDefForm.txnffname"}})],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{class:{hidden:e.modelusedVisible},attrs:{label:"模型状态",prop:"modelused"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:e.formReadonly,clearable:""},model:{value:e.tranDefForm.modelused,callback:function(t){e.$set(e.tranDefForm,"modelused",t)},expression:"tranDefForm.modelused"}},e._l(e.modelUsedList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{staticClass:"form-item",attrs:{span:12}},[a("el-form-item",{attrs:{label:"有效性"}},[a("el-switch",{attrs:{"active-text":"启用","inactive-text":"停用","active-value":"1","inactive-value":"0",disabled:e.formReadonly},model:{value:e.tranDefForm.is_enable,callback:function(t){e.$set(e.tranDefForm,"is_enable",t)},expression:"tranDefForm.is_enable"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"large",disabled:e.saveVisible},on:{click:e.submitForm}},[e._v("保存")]),e._v(" "),e.addFlag?a("el-button",{attrs:{size:"large"},on:{click:e.closeAddDialog}},[e._v("取消")]):e._e()],1)],1)],1)],1)],1)},staticRenderFns:[]};var Tt=null,It={create:function(){},computed:{txnIdParent:function(){return this.txnId},isVisibilityParent:function(){return this.isVisibility}},data:function(){return{formLabelWidth:"120px",editVisible:!0,addFormVisible:!1,addFormOrder:"1",rules:{a:""}}},props:["txnId","isVisibility","readonly"],mounted:function(){this.$nextTick(function(){Tt=this})},watch:{txnId:{handler:function(e,t){!0===Tt.isVisibilityParent&&Tt.initForm()}},isVisibility:{handler:function(e,t){!0===Tt.isVisibilityParent&&Tt.initForm()}}},methods:{initForm:function(){var e=this;""!==e.txnId&&(e.$refs.infoForm.resetForm(),H.post({url:"/trandef/edit_prepare",loading:!0,param:{tab_name:e.txnId},success:function(t){var a=t.infos;a.tab_name&&""!==a.tab_name&&"T"!==a.tab_name?e.editVisible=!1:e.editVisible=!0;var r="0";""!==a.txnid&&void 0!==a.txnid&&(r="1"),e.$refs.infoForm.getModelUsedList(a.modelused),e.$refs.infoForm.tranDefForm={parent_tab:a.parent_tab,tab_name:a.tab_name,modelused_o:a.modelused,traindate:a.traindate,op:"mod",tab_desc:a.tab_desc,show_order:a.show_order,txn_type:r,txnid:a.txnid,tab_disposal:a.tab_disposal,chann:a.chann,par_chann:a.par_chann,txnffname:a.par_tab_desc,modelused:a.modelused,is_enable:a.is_enable+""},e.$refs.infoForm.channelList=t.channs,e.getDisposal(t.infos.parent_tab,"infoForm")},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}}))},resetValidate:function(){this.$refs.addForm.$refs.tranDefForm.clearValidate()},syncDialogVisible:function(e){this.addFormVisible=e},resetForm:function(){var e=this,t=e.$refs.infoForm.tranDefForm,a=window.setInterval(function(){if(e.$refs.addForm){window.clearInterval(a);var r=t.chann?t.chann:"";e.$refs.addForm.channelList=e.$refs.infoForm.channelList,e.getDisposal(t.tab_name,"addForm"),e.$refs.addForm.tranDefForm={parent_tab:t.tab_name,tab_name:"",modelused_o:"",traindate:"",op:"add",tab_desc:"",show_order:e.addFormOrder,txn_type:"0",txnid:"",tab_disposal:"",chann:r,par_chann:r,txnffname:t.tab_desc,modelused:"0",is_enable:"1"}}},100)},getDisposal:function(e,t){var a=this;H.post({url:"/rule/disposal",param:{txn_id:e},success:function(e){var r=[],l=e.row;for(var o in l){var i={code_key:l[o].dp_code,code_value:l[o].dp_name};r.push(i)}a.$refs[t].tabDisposalList=r},fail:function(e){e.response.data.message&&a.$message.error(e.response.data.message)}})},delInfo:function(e){var t=this;this.$confirm("确定删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/trandef/save",loading:!0,param:e,success:function(e){e.success&&(t.$message.success("删除成功"),t.reloadPage("del"))},fail:function(e){t.$message.error(e.response.data.message)}})}).catch(function(){})},reloadPage:function(e){this.$emit("listenToReloadTree",e)}},components:{TrandefForm:a("X4nt")(kt,Ct,!1,function(e){a("kVwd")},null,null).exports}},$t={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("trandefForm",{ref:"infoForm",attrs:{editVisible:e.editVisible,readonly:e.readonly},on:{listenToReloadPage:e.reloadPage}}),e._v(" "),a("el-dialog",{attrs:{title:"新建交易",visible:e.addFormVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t},open:e.resetForm,close:e.resetValidate}},[a("trandefForm",{ref:"addForm",attrs:{editVisible:!1,readonly:e.readonly},on:{listenToCloseDialog:e.syncDialogVisible,listenToReloadPage:e.reloadPage}})],1)],1)},staticRenderFns:[]};var Lt=a("X4nt")(It,$t,!1,function(e){a("YuWS")},null,null).exports,qt={computed:{defalutTimeValue:function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),[e,e]}},data:function(){return{formItemContentStyle:{width:"180px"},dialogVisible:!1,paramsType:"",paramTypeReal:"",dateDataList:[],numDataList:[]}},props:{},mounted:function(){this.$nextTick(function(){})},watch:{},methods:{open:function(e,t){if(this.dialogVisible=!0,this.paramTypeReal=t,void 0===t||"datetime"!==t&&"time"!==t)if(this.paramsType="number",this.numDataList=[],e&&""!==e){var a=e.split("|"),r=!0,l=!1,o=void 0;try{for(var i,n=f()(a);!(r=(i=n.next()).done);r=!0){var s=i.value.split(",");this.numDataList.push(this.genNumberObj(s[0],s[1]))}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}}else this.numDataList.push(this.genNumberObj(null,null));else if(this.paramsType="date",this.dateDataList=[],e&&""!==e){var c=e.split("|"),u=!0,d=!1,m=void 0;try{for(var p,h=f()(c);!(u=(p=h.next()).done);u=!0){var g=p.value.split(","),v=this.str2Date(g[0]),b=this.str2Date(g[1]);this.dateDataList.push(this.genDateObj(v,b))}}catch(e){d=!0,m=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw m}}}else this.dateDataList.push(this.genDateObj(null,null))},callback:function(){if("date"===this.paramsType){for(var e=0;e<this.dateDataList.length;e++){var t=this.dateDataList[e];if(null!=t.dateArray){var a=t.dateArray[0],r=t.dateArray[1];if(a>=r)return void this.$message("第"+(e+1)+"行，开始时间必须小于结束时间");for(var l=0;l<e;l++){var o=this.dateDataList[l];if(null!=o.dateArray){var i=o.dateArray[0],n=o.dateArray[1];if(console.log(i.toLocaleString(),n.toLocaleString(),a.toLocaleString(),r.toLocaleString()),!(i<=a&&n<=a||i>=r&&n>=r))return void this.$message("第"+(e+1)+"行，时间区间与第"+(l+1)+"重复")}}}}for(var s=[],c=0;c<this.dateDataList.length;c++){var u=this.dateDataList[c];if(null!=u.dateArray){var d=this.formatDate(u.dateArray[0]),m=this.formatDate(u.dateArray[1]);s.push(d+","+m)}}this.$emit("valueCallback",s.join("|")),this.dialogVisible=!1}else{for(var p=0;p<this.numDataList.length;p++){var f=this.numDataList[p];if(null!=f.numberArray){var h=f.numberArray[0],g=f.numberArray[1],v=this.checkNum(h,p,!0);if(""!==v)return void this.$message(v);var b=this.checkNum(g,p,!1);if(""!==b)return void this.$message(b);var _=""===h?0:parseFloat(h);if(_>=(""===g?0:parseFloat(g)))return void this.$message("第("+(parseInt(p)+1)+")行：结束值必须大于开始值");if(p>0){var y=this.numDataList[p-1];if(null!=y.numberArray){var F=y.numberArray[1];if(_<(""===F?0:parseFloat(F)))return void this.$message("第("+(parseInt(p)+1)+")行：开始值不能小于上一行的结束值")}}}}for(var x=[],w=0;w<this.numDataList.length;w++){var D=this.numDataList[w];if(null!=D.numberArray){var S=D.numberArray[0],k=D.numberArray[1];x.push(S+","+k)}}this.$emit("valueCallback",x.join("|")),this.dialogVisible=!1}},str2Date:function(e){var t=e.split(":"),a=new Date;return a.setHours(t[0]),a.setMinutes(t[1]),a.setSeconds(t[2]),a},genDateObj:function(e,t){var a=Math.round(1e8*Math.random());return null!=e&&null!=t?{dateArray:[e,t],id:a}:{dateArray:null,id:a}},genNumberObj:function(e,t){var a=Math.round(1e8*Math.random());return null!=e&&null!=t?{numberArray:[e,t],id:a}:{numberArray:["",""],id:a}},delRow:function(e){"date"===this.paramsType?this.dateDataList.splice(this.dateDataList.findIndex(function(t){return t.id===e.id}),1):this.numDataList.splice(this.numDataList.findIndex(function(t){return t.id===e.id}),1)},addRow:function(){"date"===this.paramsType?this.dateDataList.push(this.genDateObj(null,null)):this.numDataList.push(this.genNumberObj(null,null))},formatDate:function(e){return e.getHours().toString()+":"+e.getMinutes().toString()+":"+e.getSeconds().toString()},checkNum:function(e,t,a){if(""===e&&(e="0"),"double"===this.paramTypeReal||"money"===this.paramTypeReal){if(""!==e&&!j.isNumber(e,"+",2))return"第("+(parseInt(t)+1)+")行："+(a?"开始值":"结束值")+"请输入非负小数（保留两位小数）或非负整数";if(e.length>15)return"第("+(parseInt(t)+1)+")行："+(a?"开始值":"结束值")+"不能超过15个字符"}else if("long"===this.paramTypeReal){if(""!==e&&!j.isNumber(e,"+","0"))return"第("+(parseInt(t)+1)+")行："+(a?"开始值":"结束值")+"请输入非负整数";if(e.length>15)return"第("+(parseInt(t)+1)+")行："+(a?"开始值":"结束值")+"不能超过15个字符"}return""}}},Pt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{ref:"StatCondDialog",attrs:{title:"参数配置",visible:e.dialogVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},["date"===e.paramsType?a("div",e._l(e.dateDataList,function(t,r){return a("div",{staticClass:"fn-param-item"},[a("el-time-picker",{attrs:{"is-range":"","default-value":e.defalutTimeValue,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:t.dateArray,callback:function(a){e.$set(t,"dateArray",a)},expression:"item.dateArray"}}),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(a){e.delRow(t)}}},[e._v("删 除")])],1)})):e._e(),e._v(" "),"number"===e.paramsType?a("div",["number"===e.paramsType?a("div",{staticClass:"fn-param-item"},[a("el-form",{staticStyle:{"text-align":"left"},attrs:{inline:!0}},e._l(e.numDataList,function(t,r){return a("div",{staticClass:"fn-param-item"},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off"},model:{value:t.numberArray[0],callback:function(a){e.$set(t.numberArray,0,a)},expression:"item.numberArray[0]"}}),e._v("\n          -\n          "),a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off"},model:{value:t.numberArray[1],callback:function(a){e.$set(t.numberArray,1,a)},expression:"item.numberArray[1]"}}),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(a){e.delRow(t)}}},[e._v("删 除")])],1)}))],1):e._e()]):e._e(),e._v(" "),a("div",{staticStyle:{"margin-top":"15px","text-align":"left"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.callback}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:e.addRow}},[e._v("增 加")])],1)])],1)},staticRenderFns:[]};var Rt=a("X4nt")(qt,Pt,!1,function(e){a("N74T")},null,null).exports,Vt=null,zt={create:function(){},computed:{txnIdParent:function(){return this.txnId},isVisibilityParent:function(){return this.isVisibility},tmTableData:function(){var e=this.expendNodeKey,t=this.tranModelList,a=[];for(var r in t)for(var l in t[r])if(t[r][l].length>0||Number(r)===t.length-1){var o=l.split("____");if(o&&2===o.length){if(a.push({tab_name:o[0],name:o[1],group_id:o[0],group_type:"group"}),-1===e.indexOf(o[0]))break;for(var i in t[r][l]){var n=t[r][l][i];n.group_type="item",a.push(n)}}}return a},tmFdNameList:function(){var e=this.tmForm.type,t=this.enableStoreFd,a=this.tmForm.fd_name;return this.getFdNameList(e,t,a)},codeDefaultList:function(){if("code"!==this.tmForm.type)return[];var e=this.tmForm.code;return this.tmForm.src_default="",ue.getCodeItems(e)},tmCodeVisible:function(){var e=this.tmForm.type;return!e||"CODE"!==e.toUpperCase()},tmFuncVisible:function(){return 0===this.tmFuncList.length},tmFuncList:function(){var e=this.tmForm.type,t=this.func,a=[];for(var r in t)t[r].func_type===e&&a.push({label:t[r].func_name,value:t[r].func_code});return a},tableData:function(){var e=this.expendTableKey,t=this.tableList,a=[];for(var r in t){var l=t[r];a.push(l),e.indexOf(l.group_id)>-1&&l.children&&(a=a.concat(l.children))}return a},canRefTabFdList:function(){var e=this.tableInfoForm.ref_tab_name,t=this.canRefTabFd,a=[];for(var r in t){var l=t[r];l.tab_name===e&&a.push({fd_name:l.fd_name,name:l.name})}return a},storeColumnList:function(){var e="",t=this.canRefTabFd,a=this.tableInfoForm.ref_fd_name;for(var r in t){if(t[r].fd_name===a){e=t[r].type;break}}var l=this.enableStoreFd,o=this.tableInfoForm.storecolumn;return""!==e&&l.length>0?this.getFdNameList(e,l,o):[]}},props:["txnId","isVisibility","txnName","readonly"],data:function(){var e=this;return{activeName:"1",op:"",toggleIcon:["el-icon-caret-bottom","el-icon-caret-right"],tranModelList:[],expendNodeKey:[],tmTitle:"",tmDialogVisible:!1,tmFormReadOnly:!0,selectTmRows:[],tmForm:{params1:"",params2:"",tab_name:"",name:"",ref_name:"",src_id:"",type:"",fd_name:"",code:"",src_default:"",genesisrul:""},tmTypeList:[],allStoreFd:[],enableStoreFd:[],tmCodeList:[],func:[],funcParam:[],dataTypeClassify:[{recap:"long",type:["long","time","datetime"]},{recap:"decimal",type:["double","money"]},{recap:"string",type:["string","devid","ip","userid","acc","code"]}],canRefTab:[],canRefFd:[],canRefTabFd:[],tableList:[],expendTableKey:[],tableTitle:"",tableDialogVisible:!1,tableFormReadOnly:!1,tableForm:{ref_id:"",tab_name:"",txn_order:"",ref_tab_name:"",ref_desc:"",src_expr:"",tab_desc:""},tableInfoDialogVisible:!1,tableInfoTitle:"",tableInfoFormReadOnly:!1,selectTableInfoRows:[],tableInfoForm:{op:"",ref_id:"",tab_name:"",ref_tab_name:"",ref_tab_desc:"",ref_fd_name:"",ref_desc:"",ref_name:"",src_cond:"",src_cond_in:"",src_expr:"",src_expr_in:"",storecolumn:"",tab_desc:""},formLabelWidth:"120px",tmRules:{name:[{required:!0,message:"请输入属性名称",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"},{max:50,message:"长度不能超过20个字符",trigger:"blur"}],ref_name:[{required:!0,message:"请输入属性代码",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{max:50,message:"长度不能超过20个字符",trigger:"blur"}],src_id:[{required:!0,message:"请输入数据来源",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],fd_name:[{required:!0,message:"请选择存储字段",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{validator:function(t,a,r){var l=e.tmFdNameList;for(var o in l)if(l[o].fd_name===a)return r();return r(new Error("存储字段对应类型和数据类型不一致"))},trigger:"blur"},{max:50,message:"长度不能超过20个字符",trigger:"blur"}],code:[{validator:ee.checkFormSpecialCode,trigger:"blur"},{validator:function(t,a,r){var l=e;return""===a.trim()&&"CODE"===l.tmForm.type.toUpperCase()?r(new Error("数据类型为代码类型时，关联代码集不能为空")):r()},trigger:"blur"},{max:50,message:"长度不能超过20个字符",trigger:"blur"}],src_default:[{validator:ee.checkFormSpecialCode,trigger:"blur"},{max:50,message:"长度不能超过20个字符",trigger:"blur"}],genesisrul:[{validator:function(t,a,r){if(""===j.trim(a))return r();var l=e.tmFuncList;for(var o in l)if(l[o].value===a)return r();return r(new Error("处理函数不存在"))},trigger:"blur"}],params1:[{max:20,message:"长度不能超过20个字符",trigger:"blur"},{validator:function(t,a,r){var l=e;if(l.paramsVisible(1))return r();if(""===j.trim(a))return r(new Error("请输入参数"));var o=l.funcParam,i=[];for(var n in o)o[n].func_code===l.tmForm.genesisrul&&i.push(o[n]);if(0===i.length)return r();i=j.orderList(i,"param_orderby");var s=l.dataTypeClassify,c=i[0].param_type;for(var u in s){var d=s[u];if(d.type.indexOf(c)>-1)if("long"===d.recap||"decimal"===d.recap){if("long"===d.recap&&!/^[0-9]*$/.test(a))return r(new Error("处理函数参数1只能填写非负整数"));if("decimal"===d.recap&&!/^\d+(\.\d+)?$/.test(a))return r(new Error("处理函数参数1只能填写非负数"));if(1*a+""!=a+"")return r(new Error("处理函数参数1所填数据的格式不正确"));if(""!==l.tmForm.params2){var m=Number(a);if(Number(l.tmForm.params2)<m)return r(new Error("处理函数参数1必须小于参数2"))}}else if("string"===d.recap&&('"'!==a.charAt(0)||'"'!==a.charAt(a.length-1)))return r(new Error("处理函数参数为字符类型，请使用双引号包裹，如：[\"' + value + '\"]"))}r()},trigger:"blur"}],params2:[{max:20,message:"长度不能超过20个字符",trigger:"blur"},{validator:function(t,a,r){var l=e;if(l.paramsVisible(2))return r();if(""===j.trim(a))return r(new Error("请输入参数"));var o=l.funcParam,i=[];for(var n in o)o[n].func_code===l.tmForm.genesisrul&&i.push(o[n]);if(0===i.length)return r();i=j.orderList(i,"param_orderby");var s=l.dataTypeClassify,c=i[0].param_type;for(var u in s){var d=s[u];if(d.type.indexOf(c)>-1)if("long"===d.recap||"decimal"===d.recap){if("long"===d.recap&&!/^[0-9]*$/.test(a))return r(new Error("处理函数参数1只能填写非负整数"));if("decimal"===d.recap&&!/^\d+(\.\d+)?$/.test(a))return r(new Error("处理函数参数2只能填写非负数"));if(1*a+""!=a+"")return r(new Error("处理函数参数2所填数据的格式不正确"));if(""!==l.tmForm.params1){var m=Number(l.tmForm.params1);if(Number(a)<m)return r(new Error("处理函数参数2必须大于参数1"))}}else if("string"===d.recap&&('"'!==a.charAt(0)||'"'!==a.charAt(a.length-1)))return r(new Error("处理函数参数为字符类型，请使用双引号包裹，如：[\"' + value + '\"]"))}r()},trigger:"blur"}]},tableRules:{ref_tab_name:[{required:!0,message:"请选择引用表",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"}],ref_desc:[{required:!0,message:"请输入引用描述",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"},{max:64,message:"长度不能超过64个字符",trigger:"blur"}],src_expr:[{required:!0,message:"请选择引用字段",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"}]},tableInfoRules:{ref_fd_name:[{required:!0,message:"请选择数据来源",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"}],ref_desc:[{required:!0,message:"请输入属性名称",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"},{max:64,message:"长度不能超过64个字符",trigger:"blur"}],ref_name:[{required:!0,message:"请输入属性代码",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],src_expr_in:[{validator:function(t,a,r){var l=e.tableInfoForm;return""===l.src_expr&&""!==l.src_cond?r(new Error("填写条件后，表达式不能为空")):r()},trigger:"blur"}]}}},mounted:function(){this.$nextTick(function(){Vt=this})},watch:{txnId:{handler:function(e,t){!0===Vt.isVisibilityParent&&Vt.initForm()}},isVisibility:{handler:function(e,t){!0===Vt.isVisibilityParent&&Vt.initForm()}}},methods:{initForm:function(){var e=this;e.activeName="1",H.post({url:"/tranmdl/query",loading:!0,toLowerCase:!1,param:{tab_name:e.txnId},success:function(t){var a=j.toggleObjKey(t),r=e.formatterResultList(t.txnfds);if(r){e.tranModelList=r;var l=[];for(var o in r)for(var i in r[o])l.push(i.split("____")[0]);e.expendNodeKey=l;var n=e.tableDataFormat(a.txn_ref_tab,a.txn_ref_fds);e.tableList=n.tableList,e.expendTableKey=n.expendKey,e.enableStoreFd=a.enablestorefd,e.allStoreFd=a.allstorefd}H.post({url:"/tranmdl/queryOf",param:{tab_name:e.txnId},success:function(t){e.tmCodeList=t.sourcetype,e.canRefTab=t.canreftable,e.canRefTabFd=t.reftblfd,e.func=t.func,e.funcParam=t.funcparam},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},initTmForm:function(){var e=this;H.post({url:"/tranmdl/query",loading:!0,toLowerCase:!1,param:{tab_name:e.txnId},success:function(t){var a=e.formatterResultList(t.txnfds);a&&(e.tranModelList=a)},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},initTableForm:function(){var e=this;H.post({url:"/tranmdl/query",loading:!0,toLowerCase:!1,param:{tab_name:e.txnId},success:function(t){var a=j.toggleObjKey(t),r=e.formatterResultList(t.txn_ref_tab),l=e.tableDataFormat(r,a.txn_ref_fds);e.tableList=l.tableList,e.enableStoreFd=a.enablestorefd,e.allStoreFd=a.allstorefd},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},groupHandle:function(e){var t=e.row,a=(e.column,e.rowIndex,e.columnIndex);if("group"===t.group_type)switch(a){case 1:return[1,9];default:return[0,0]}},groupClassName:function(e){var t=e.row;e.rowIndex;return"group"===t.group_type?"groupStyle":""},groupIcon:function(e,t){if("group"!==e.group_type)return"";var a=e.group_id;return t.indexOf(a)>-1?this.toggleIcon[0]:this.toggleIcon[1]},toggleListHandle:function(e,t){if("group"===e.group_type){var a=t.path,r=null;for(var l in a)"cell"===a[l].className&&(r=a[l]);if(null!==r){var o=e.group_id,i=this.expendNodeKey,n=this.toggleIcon,s=r.getElementsByTagName("i");s[0].getAttribute("class")===n[0]?i.indexOf(o)>-1&&i.splice(i.indexOf(o),1):s[0].getAttribute("class")===n[1]&&i.push(o),this.expendNodeKey=i}}},formatterCode:function(e,t){if(void 0===e.code||null===e.code||""===e.code)return"";var a=this.enableStoreFd;for(var r in a)if(a[r].category_id===e.code)return a[r].category_name;return e.code},paramsVisible:function(e){var t=this.func,a=this.tmForm.genesisrul;for(var r in t)if(t[r].func_code===a){var l=t[r].params;if(void 0!==l&&""!==l){var o=l.length<e;return o&&(this.tmForm["params"+e]=""),o}}return this.tmForm["params"+e]="",!0},getToolBtnVisible:function(e,t){return!!this.readonly||(t.tab_name!==this.txnId||t.is_sys+""=="1")},tmTypeChange:function(){this.tmForm.src_default="",this.tmForm.fd_name="",this.tmForm.code="",this.tmForm.genesisrul=""},genesisRulChange:function(){var e=this.$refs.tmForm.fields,t=["params1","params2"];for(var a in e)t.indexOf(e[a].prop)>-1&&e[a].resetField()},openTmDialog:function(){this.tmTypeList=ue.getCodeItems("tms.model.datatype"),this.getFuncList(),this.$refs.tmForm&&this.$refs.tmForm.resetFields()},getTmFdNameList:function(e){var t=this;H.post({url:"/tranmdl/queryAvailableStoreFd",param:{tab_name:t.txnId},success:function(e){t.enableStoreFd=e.enablestorefd},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})},getFuncList:function(){var e=this;H.post({url:"/tranmdl/queryFunWithParam",success:function(t){e.func=t.funwithparam},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},tmAddFunc:function(){this.activeName="1",this.tmTitle="新建交易模型",this.tmDialogVisible=!0,this.tmFormReadOnly=!1,this.op="add",this.tmForm={params1:"",params2:"",tab_name:this.txnId,name:"",ref_name:"",src_id:"",type:"",fd_name:"",code:"",src_default:"",genesisrul:""}},tmEditFunc:function(e,t){var a=this;a.tmTitle="编辑交易模型",a.tmDialogVisible=!0,a.tmFormReadOnly=!1,a.op="mod";var r="",l="",o="",i=t.genesisrul;if(""!==j.trim(i)){r=i.substring(0,i.indexOf("("));var n=i.substring(i.indexOf("(")+1,i.indexOf(")")).split(",");n.length>1&&(l=n[1]),n.length>2&&(o=n[2])}a.tmForm={params1:l,params2:o,tab_name:t.tab_name,name:t.name,ref_name:t.ref_name,src_id:t.src_id,type:t.type,fd_name:t.fd_name,code:t.code,src_default:t.src_default,genesisrul:r};var s=window.setInterval(function(){a.tmForm.params1===l&&a.tmForm.params2===o?window.clearInterval(s):a.tmForm.params1!==l?a.tmForm.params1=l:a.tmForm.params2=o},100);a.selectTmRows=[t]},submitTmForm:function(){var e=this,t=this;this.$refs.tmForm.validate(function(a){if(!a)return!1;var r=t.op,l=s()({},t.selectTmRows[0]),o=t.tmForm,i={};"mod"===r?(l.type!==o.type&&l.link.length>0&&e.$confirm("该字段已在自定义查询中引用，确认修改","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.link=""}).catch(function(){return!1}),i=s()({},l,o),i=s()(i,{old:l})):i=s()(i,o);var n="";""!==j.trim(i.genesisrul)&&(n=j.trim(i.genesisrul)+"(?",""!==j.trim(i.params1)&&(n=n+","+i.params1,""!==j.trim(i.params2)&&(n=n+","+i.params2)),n+=")"),i.genesisrul=n;var c={};c[r]=[i],H.post({url:"/tranmdl/saveModel",loading:!0,param:{postData:c},success:function(e){"mod"===r?t.$message.success("编辑成功"):t.$message.success("创建成功"),t.initTmForm(),t.getTmFdNameList(),t.tmDialogVisible=!1},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})})},tmDelFunc:function(e,t){var a=this;this.$confirm("确定删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={del:[t]};H.post({url:"/tranmdl/saveModel",loading:!0,param:{postData:e},success:function(e){a.$message.success("删除成功。"),a.initTmForm(),a.getTmFdNameList()},fail:function(e){e.response.data.message&&a.$message.error(e.response.data.message)}})}).catch(function(){return!1})},tmInfoFunc:function(e,t){this.tmTitle="交易模型信息",this.tmDialogVisible=!0,this.tmFormReadOnly=!0,this.op="info";var a="",r="",l="",o=t.genesisrul;if(""!==j.trim(o)){a=o.substring(0,o.indexOf("("));var i=o.substring(o.indexOf("(")+1,o.indexOf(")"));i.length>1&&(r=i[1]),i.length>2&&(l=i[2])}this.tmForm={params1:r,params2:l,tab_name:t.tab_name,name:t.name,ref_name:t.ref_name,src_id:t.src_id,type:t.type,fd_name:t.fd_name,code:t.code,src_default:t.src_default,genesisrul:a}},tableDataFormat:function(e,t){var a=[],r=[];for(var l in e)for(var o in e[l]){var i=o.split("____");if(i&&2===i.length)for(var n in e[l][o]){var s=e[l][o][n],c={tab_name:i[0],tab_desc:i[1],group_id:s.ref_id,group_name:i[1]+":["+s.ref_desc+"]",group_type:"group",info:s},u=[];for(var d in t)t[d].ref_id===s.ref_id&&u.push(t[d]);u.length>0&&(c.children=u),a.push(c),r.push(s.ref_id)}}return{tableList:a,expendKey:r}},tableGroupHandle:function(e){var t=e.row,a=(e.column,e.rowIndex,e.columnIndex);if("group"===t.group_type)switch(a){case 0:return[1,1];case 1:return[1,7];default:return[0,0]}},toggleTableHandle:function(e,t){if("group"===e.group_type){var a=t.path,r=null;for(var l in a)"cell"===a[l].className&&(r=a[l]);if(null!==r){var o=e.group_id,i=this.expendTableKey,n=this.toggleIcon,s=r.getElementsByTagName("i");s[0].getAttribute("class")===n[0]?i.indexOf(o)>-1&&i.splice(i.indexOf(o),1):s[0].getAttribute("class")===n[1]&&i.push(o),this.expendTableKey=i}}},tableOpenFunc:function(){var e=this;e.$refs.tableForm&&e.$refs.tableForm.resetFields(),e.tableForm.tab_desc=e.txnName,e.tableForm.tab_name=e.txnId,H.post({url:"/tranmdl/queryCanRefFd",param:{tab_name:this.txnId},success:function(t){e.canRefFd=t.canreffd},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},refTableNameChange:function(e){var t=this.canRefTab,a="";for(var r in t){var l=t[r];if(l.tab_name===e){a=l.tab_desc;break}}this.tableForm.ref_desc=a},tableAddFunc:function(){this.activeName="2",this.tableDialogVisible=!0,this.tableFormReadOnly=!1,this.tableTitle="新建引用表",this.tableForm={ref_id:"",tab_name:"",txn_order:"",ref_tab_name:"",ref_desc:"",src_expr:"",tab_desc:""}},tableEditFunc:function(e){if(e.group_type&&"group"===e.group_type)this.tableDialogVisible=!0,this.tableFormReadOnly=!1,this.tableTitle="编辑引用表",this.tableForm={ref_id:e.info.ref_id,tab_name:e.info.tab_name,txn_order:e.info.txn_order,ref_tab_name:e.info.ref_tab_name,ref_desc:e.info.ref_desc,src_expr:e.info.src_expr,tab_desc:e.info.tab_desc};else{this.tableInfoTitle="编辑行字段",this.tableInfoDialogVisible=!0,this.tableInfoFormReadOnly=!1;var t=e;this.tableInfoForm={op:"mod",ref_id:t.ref_id,tab_name:t.tab_name,ref_tab_name:t.ref_tab_name,ref_tab_desc:t.ref_tab_desc,ref_fd_name:t.ref_fd_name,ref_desc:t.ref_desc,ref_name:t.ref_name,src_cond:t.src_cond,src_cond_in:t.src_cond_in,src_expr:t.src_expr,src_expr_in:t.src_expr_in,storecolumn:t.storecolumn,tab_desc:t.tab_desc},this.selectTableInfoRows=[t]}},tableInfoFunc:function(e){if(e.group_type&&"group"===e.group_type)this.tableDialogVisible=!0,this.tableFormReadOnly=!0,this.tableTitle="查看引用表",this.tableForm={ref_id:e.info.ref_id,tab_name:e.info.tab_name,txn_order:e.info.txn_order,ref_tab_name:e.info.ref_tab_name,ref_desc:e.info.ref_desc,src_expr:e.info.src_expr,tab_desc:e.info.tab_desc};else{this.tableInfoTitle="查看行字段",this.tableInfoDialogVisible=!0,this.tableInfoFormReadOnly=!0;var t=e;this.tableInfoForm={ref_id:t.ref_id,tab_name:t.tab_name,ref_tab_name:t.ref_tab_name,ref_tab_desc:t.ref_tab_desc,ref_fd_name:t.ref_fd_name,ref_desc:t.ref_desc,ref_name:t.ref_name,src_cond:t.src_cond,src_cond_in:t.src_cond_in,src_expr:t.src_expr,src_expr_in:t.src_expr_in,storecolumn:t.storecolumn,tab_desc:t.tab_desc}}},submitTableForm:function(){var e=this;this.$refs.tableForm.validate(function(t){if(!t)return!1;var a="",r=e.tableForm.ref_id;a=""===j.trim(r)?"add":"mod";var l={},o=e.tableForm;l[a]=[o],H.post({url:"/tranmdl/saveModelRefTab",loading:!0,param:{postData:l},success:function(t){"add"===a?e.$message.success("创建成功"):e.$message.success("编辑成功"),e.tableDialogVisible=!1,e.initTableForm(),e.getTmFdNameList()},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})})},tableDelFunc:function(e){var t=this;t.$confirm("确定删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a="",r={};e.group_type&&"group"===e.group_type?(a="/tranmdl/saveModelRefTab",r={postData:{del:[e.info]}}):(a="/tranmdl/saveModelRefFd",r={postData:{del:[e]}}),H.post({url:a,loading:!0,param:r,success:function(e){t.$message.success("删除成功"),t.initTableForm(),t.getTmFdNameList()},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})}).catch(function(){return!1})},canRefTabFdChange:function(e){this.tableInfoForm.ref_name=e;var t=this.canRefTabFd,a="";for(var r in t)t[r].fd_name===e&&(a=t[r].name);this.tableInfoForm.ref_desc=a},statCondInValueCallBack:function(e){this.tableInfoForm.src_cond=e.stat_cond_value,this.tableInfoForm.src_cond_in=e.stat_cond_in},SrcExprInValueCallBack:function(e){this.tableInfoForm.src_expr=e.stat_cond_value,this.tableInfoForm.src_expr_in=e.stat_cond_in},tableSetFunc:function(e){this.tableInfoTitle="新建行字段",this.tableInfoDialogVisible=!0,this.tableInfoFormReadOnly=!1;var t=e.info;this.tableInfoForm={op:"add",ref_id:t.ref_id,tab_name:t.tab_name,ref_tab_name:t.ref_tab_name,ref_tab_desc:t.ref_desc,ref_fd_name:"",ref_desc:"",ref_name:"",src_cond:"",src_expr:"",src_cond_in:"",src_expr_in:"",storecolumn:"",tab_desc:t.tab_desc}},submitTableInfoForm:function(){var e=this,t=this;this.$refs.tableInfoForm.validate(function(a){if(!a)return!1;var r=e.tableInfoForm.op,l={},o=t.tableInfoForm,i=s()({},t.selectTableInfoRows[0]);o=s()(o,{old:i}),l[r]=[o],H.post({url:"/tranmdl/saveModelRefFd",loading:!0,param:{postData:l},success:function(e){"add"===r?t.$message.success("创建成功。"):t.$message.success("编辑成功。"),t.initTableForm(),t.getTmFdNameList(),t.tableInfoDialogVisible=!1},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})})},getFdNameList:function(e,t,a){var r=this.dataTypeClassify,l=!1,o=[];if(e&&t)for(var i in t){var n=t[i];for(var s in r){var c=r[s];-1!==c.type.indexOf(e)&&("long"===c.recap||"decimal"===c.recap?("double"!==e&&"long"!==e&&n.type===e&&(o.push(n),l=l||n.fd_name===a),"double"!==n.type&&"long"!==n.type||(o.push(n),l=l||n.fd_name===a)):"string"===c.recap&&"string"!==e&&n.type===e&&(o.push(n),l=l||n.fd_name===a),"string"===n.type&&(o.push(n),l=l||n.fd_name===a))}}if(!l&&""!==a){var u=this.allStoreFd;for(var d in u)u[d].fd_name===a&&o.splice(0,0,u[d])}return o},showStatCondDialog:function(){this.tableInfoFormReadOnly||(this.$refs.StatCondDialog.open(),this.$refs.StatCondDialog.setValue({stat_cond_value:this.tableInfoForm.src_cond,stat_cond_in:this.tableInfoForm.src_cond_in}))},showSrcExprDialog:function(){this.tableInfoFormReadOnly||(this.$refs.SrcExprDialog.open(),this.$refs.SrcExprDialog.setValue({stat_cond_value:this.tableInfoForm.src_expr,stat_cond_in:this.tableInfoForm.src_expr_in}))},formatterResultList:function(e){var t=[];for(var a in e){var r=e[a],l={};for(var o in r)l[o]=j.toggleObjKey(r[o]);t.push(l)}return t}},components:{StatCondPicker:et,FuncParamPicker:Rt}},Nt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"-15px"}},[a("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易模型")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",disabled:e.readonly},on:{click:function(t){t.stopPropagation(),e.tmAddFunc(t)}}},[e._v("新建")])],1)]),e._v(" "),a("div",[a("el-table",{ref:"tmTable",staticClass:"collapse-table-style",attrs:{data:e.tmTableData,"span-method":e.groupHandle,"row-class-name":e.groupClassName,"max-height":"550"},on:{"row-click":e.toggleListHandle}},[a("el-table-column",{attrs:{align:"left",width:"100px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit",disabled:e.getToolBtnVisible(t.$index,t.row),title:"编辑"},on:{click:function(a){e.tmEditFunc(t.$index,t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-delete",disabled:e.getToolBtnVisible(t.$index,t.row),title:"删除"},on:{click:function(a){e.tmDelFunc(t.$index,t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-zoom-in",title:"查看"},on:{click:function(a){e.tmInfoFunc(t.$index,t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"属性名称",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return["group"===t.row.group_type?a("i",{class:e.groupIcon(t.row,e.expendNodeKey)}):e._e(),e._v(" "),a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"属性代码",prop:"ref_name"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"数据来源",prop:"src_id"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"类型",prop:"type"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"存储字段",prop:"fd_name"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"关联代码集",prop:"code",formatter:e.formatterCode}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"默认值",prop:"src_default"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"处理函数",prop:"genesisrul"}})],1)],1)],2),e._v(" "),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("div",{staticStyle:{float:"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易模型引用")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{disabled:e.readonly},on:{click:function(t){t.stopPropagation(),e.tableAddFunc(t)}}},[e._v("新建")])],1)]),e._v(" "),a("div",[a("el-table",{ref:"refTable",staticClass:"collapse-table-style",attrs:{data:e.tableData,"span-method":e.tableGroupHandle,"row-class-name":e.groupClassName,"max-height":"335"},on:{"row-click":e.toggleTableHandle}},[a("el-table-column",{attrs:{align:"left",width:"125px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit",title:"编辑",disabled:e.readonly},on:{click:function(a){e.tableEditFunc(t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-delete",title:"删除",disabled:e.readonly},on:{click:function(a){e.tableDelFunc(t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-zoom-in",title:"查看"},on:{click:function(a){e.tableInfoFunc(t.row)}}}),e._v(" "),"group"===t.row.group_type?a("el-button",{attrs:{type:"text",icon:"el-icon-plus",title:"新建行字段",disabled:e.readonly},on:{click:function(a){e.tableSetFunc(t.row)}}}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"属性名称",prop:"ref_desc"},scopedSlots:e._u([{key:"default",fn:function(t){return["group"===t.row.group_type?a("i",{class:e.groupIcon(t.row,e.expendTableKey)}):e._e(),e._v(" "),"group"===t.row.group_type?a("span",[e._v(e._s(t.row.group_name))]):a("span",[e._v(e._s(t.row.ref_desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"属性代码",prop:"ref_name",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据来源",prop:"ref_fd_name",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"条件",prop:"src_cond_in",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"表达式",prop:"src_expr_in",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"存储字段",prop:"storecolumn",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"所属节点",prop:"tab_desc",align:"left"}})],1)],1)],2)],1),e._v(" "),a("el-dialog",{attrs:{title:e.tmTitle,visible:e.tmDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.tmDialogVisible=t},open:e.openTmDialog}},[a("el-form",{ref:"tmForm",attrs:{model:e.tmForm,"label-width":e.formLabelWidth,rules:e.tmRules}},[a("el-form-item",{staticClass:"hidden",attrs:{label:"交易名称",prop:"tab_name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tmForm.tab_name,callback:function(t){e.$set(e.tmForm,"tab_name",t)},expression:"tmForm.tab_name"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"属性名称",prop:"name"}},[a("el-input",{attrs:{disabled:e.tmFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tmForm.name,callback:function(t){e.$set(e.tmForm,"name",t)},expression:"tmForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"属性代码",prop:"ref_name"}},[a("el-input",{attrs:{disabled:e.tmFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tmForm.ref_name,callback:function(t){e.$set(e.tmForm,"ref_name",t)},expression:"tmForm.ref_name"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据来源",prop:"src_id"}},[a("el-input",{attrs:{disabled:e.tmFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tmForm.src_id,callback:function(t){e.$set(e.tmForm,"src_id",t)},expression:"tmForm.src_id"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-select",{attrs:{disabled:e.tmFormReadOnly,placeholder:"请选择",clearable:""},on:{change:e.tmTypeChange},model:{value:e.tmForm.type,callback:function(t){e.$set(e.tmForm,"type",t)},expression:"tmForm.type"}},e._l(e.tmTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"存储字段",prop:"fd_name"}},[a("el-select",{attrs:{disabled:e.tmFormReadOnly,placeholder:"请选择",clearable:""},model:{value:e.tmForm.fd_name,callback:function(t){e.$set(e.tmForm,"fd_name",t)},expression:"tmForm.fd_name"}},e._l(e.tmFdNameList,function(e){return a("el-option",{key:e.fd_name,attrs:{label:e.fd_name,value:e.fd_name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{class:{hidden:e.tmCodeVisible},attrs:{label:"关联代码集",prop:"code",disabled:e.tmFormReadOnly,required:!e.tmCodeVisible}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.tmForm.code,callback:function(t){e.$set(e.tmForm,"code",t)},expression:"tmForm.code"}},e._l(e.tmCodeList,function(e){return a("el-option",{key:e.category_id,attrs:{label:e.category_name,value:e.category_id}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{class:{hidden:e.tmFuncVisible},attrs:{label:"处理函数",prop:"genesisrul",disabled:e.tmFormReadOnly}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.genesisRulChange},model:{value:e.tmForm.genesisrul,callback:function(t){e.$set(e.tmForm,"genesisrul",t)},expression:"tmForm.genesisrul"}},e._l(e.tmFuncList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{class:{hidden:e.paramsVisible(1)},attrs:{label:"处理函数参数1",prop:"params1",disabled:e.tmFormReadOnly}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.tmForm.params1,callback:function(t){e.$set(e.tmForm,"params1",t)},expression:"tmForm.params1"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{class:{hidden:e.paramsVisible(2)},attrs:{label:"处理函数参数2",prop:"params2",disabled:e.tmFormReadOnly}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.tmForm.params2,callback:function(t){e.$set(e.tmForm,"params2",t)},expression:"tmForm.params2"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"默认值",prop:"src_default",disabled:e.tmFormReadOnly}},["CODE"===e.tmForm.type.toUpperCase()?a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.tmForm.src_default,callback:function(t){e.$set(e.tmForm,"src_default",t)},expression:"tmForm.src_default"}},e._l(e.codeDefaultList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):a("el-input",{attrs:{disabled:e.tmFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tmForm.src_default,callback:function(t){e.$set(e.tmForm,"src_default",t)},expression:"tmForm.src_default"}})],1)],1)],1),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.tmFormReadOnly,expression:"!tmFormReadOnly"}]},[a("el-col",{attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitTmForm}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.tmDialogVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.tableTitle,visible:e.tableDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.tableDialogVisible=t},open:e.tableOpenFunc}},[a("el-form",{ref:"tableForm",attrs:{model:e.tableForm,"label-width":e.formLabelWidth,rules:e.tableRules}},[a("el-form-item",{staticClass:"hidden",attrs:{label:"引用ID",prop:"ref_id"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableForm.ref_id,callback:function(t){e.$set(e.tableForm,"ref_id",t)},expression:"tableForm.ref_id"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"所属交易",prop:"tab_name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableForm.tab_name,callback:function(t){e.$set(e.tableForm,"tab_name",t)},expression:"tableForm.tab_name"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"排序",prop:"txn_order"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableForm.txn_order,callback:function(t){e.$set(e.tableForm,"txn_order",t)},expression:"tableForm.txn_order"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"引用表",prop:"ref_tab_name"}},[a("el-select",{attrs:{disabled:e.tableFormReadOnly,placeholder:"请选择",clearable:""},on:{change:e.refTableNameChange},model:{value:e.tableForm.ref_tab_name,callback:function(t){e.$set(e.tableForm,"ref_tab_name",t)},expression:"tableForm.ref_tab_name"}},e._l(e.canRefTab,function(e){return a("el-option",{key:e.tab_name,attrs:{label:e.tab_desc,value:e.tab_name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"引用描述",prop:"ref_desc"}},[a("el-input",{attrs:{readonly:e.tableFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tableForm.ref_desc,callback:function(t){e.$set(e.tableForm,"ref_desc",t)},expression:"tableForm.ref_desc"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"引用字段",prop:"src_expr"}},[a("el-select",{attrs:{disabled:e.tableFormReadOnly,placeholder:"请选择",clearable:""},model:{value:e.tableForm.src_expr,callback:function(t){e.$set(e.tableForm,"src_expr",t)},expression:"tableForm.src_expr"}},e._l(e.canRefFd,function(e){return a("el-option",{key:e.fd_name,attrs:{label:e.name,value:e.fd_name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属节点",prop:"tab_desc"}},[a("el-input",{attrs:{disabled:!0,"auto-complete":"off"},model:{value:e.tableForm.tab_desc,callback:function(t){e.$set(e.tableForm,"tab_desc",t)},expression:"tableForm.tab_desc"}})],1)],1)],1),e._v(" "),a("el-row",{class:{hidden:e.tableFormReadOnly}},[a("el-col",{attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitTableForm}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.tableDialogVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.tableInfoTitle,visible:e.tableInfoDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.tableInfoDialogVisible=t},open:e.tableOpenFunc}},[a("el-form",{ref:"tableInfoForm",attrs:{model:e.tableInfoForm,"label-width":e.formLabelWidth,rules:e.tableInfoRules}},[a("el-form-item",{staticClass:"hidden",attrs:{label:"引用ID",prop:"ref_id"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableInfoForm.ref_id,callback:function(t){e.$set(e.tableInfoForm,"ref_id",t)},expression:"tableInfoForm.ref_id"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"所属交易",prop:"tab_name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableInfoForm.tab_name,callback:function(t){e.$set(e.tableInfoForm,"tab_name",t)},expression:"tableInfoForm.tab_name"}})],1),e._v(" "),a("el-form-item",{staticClass:"hidden",attrs:{label:"引用表描述",prop:"ref_tab_desc"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.tableInfoForm.ref_tab_desc,callback:function(t){e.$set(e.tableInfoForm,"ref_tab_desc",t)},expression:"tableInfoForm.ref_tab_desc"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据来源",prop:"ref_fd_name"}},[a("el-select",{attrs:{disabled:e.tableInfoFormReadOnly,placeholder:"请选择",clearable:""},on:{change:e.canRefTabFdChange},model:{value:e.tableInfoForm.ref_fd_name,callback:function(t){e.$set(e.tableInfoForm,"ref_fd_name",t)},expression:"tableInfoForm.ref_fd_name"}},e._l(e.canRefTabFdList,function(e){return a("el-option",{key:e.fd_name,attrs:{label:e.name,value:e.fd_name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"属性名称",prop:"ref_desc"}},[a("el-input",{attrs:{readonly:e.tableInfoFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tableInfoForm.ref_desc,callback:function(t){e.$set(e.tableInfoForm,"ref_desc",t)},expression:"tableInfoForm.ref_desc"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"属性代码",prop:"ref_name"}},[a("el-input",{attrs:{readonly:e.tableInfoFormReadOnly,"auto-complete":"off",clearable:""},model:{value:e.tableInfoForm.ref_name,callback:function(t){e.$set(e.tableInfoForm,"ref_name",t)},expression:"tableInfoForm.ref_name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"条件",prop:"src_cond_in"}},[a("div",{on:{dblclick:e.showStatCondDialog}},[a("el-input",{attrs:{readonly:!0,"auto-complete":"off",clearable:""},model:{value:e.tableInfoForm.src_cond_in,callback:function(t){e.$set(e.tableInfoForm,"src_cond_in",t)},expression:"tableInfoForm.src_cond_in"}})],1)])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"表达式",prop:"src_expr_in"}},[a("div",{on:{dblclick:e.showSrcExprDialog}},[a("el-input",{attrs:{readonly:!0,"auto-complete":"off",clearable:""},model:{value:e.tableInfoForm.src_expr_in,callback:function(t){e.$set(e.tableInfoForm,"src_expr_in",t)},expression:"tableInfoForm.src_expr_in"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"存储字段",prop:"storecolumn"}},[a("el-select",{attrs:{disabled:e.tableInfoFormReadOnly,placeholder:"请选择",clearable:""},model:{value:e.tableInfoForm.storecolumn,callback:function(t){e.$set(e.tableInfoForm,"storecolumn",t)},expression:"tableInfoForm.storecolumn"}},e._l(e.storeColumnList,function(e){return a("el-option",{key:e.fd_name,attrs:{label:e.fd_name,value:e.fd_name}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属节点",prop:"tab_desc"}},[a("el-input",{attrs:{disabled:!0,"auto-complete":"off"},model:{value:e.tableInfoForm.tab_desc,callback:function(t){e.$set(e.tableInfoForm,"tab_desc",t)},expression:"tableInfoForm.tab_desc"}})],1)],1)],1),e._v(" "),a("el-row",{class:{hidden:e.tableInfoFormReadOnly}},[a("el-col",{attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitTableInfoForm}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.tableInfoDialogVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)],1),e._v(" "),a("StatCondPicker",{ref:"StatCondDialog",attrs:{statCond:e.tableInfoForm.src_cond,statCondIn:e.tableInfoForm.src_cond_in,txnId:e.txnId,hideItems:["rule_func","ac_func","stat_fn","roster_func","diy_func"]},on:{valueCallback:e.statCondInValueCallBack}}),e._v(" "),a("StatCondPicker",{ref:"SrcExprDialog",attrs:{statCond:e.tableInfoForm.src_expr,statCondIn:e.tableInfoForm.src_expr_in,txnId:e.txnId,hideItems:["rule_func","ac_func","stat_fn","roster_func","diy_func"]},on:{valueCallback:e.SrcExprInValueCallBack}})],1)},staticRenderFns:[]};var Et=null,Ot=[{recap:"long",type:["long","time","datetime"]},{recap:"double",type:["double","money"]},{recap:"string",type:["string","devid","ip","userid","acc","code","object"]}],At={computed:{readonlyParent:function(){return this.readonly},txnIdParent:function(){return this.txnId},isVisibilityParent:function(){return this.isVisibility},notSelectOne:function(){return 1!==this.selectedRows.length},hasSelectRow:function(){return this.selectedRows.length>0},formStatCondInName:function(){return"calculat_expressions"===this.dialogForm.stat_fn?"表达式:":"统计条件:"},StatCondInRequired:function(){return"calculat_expressions"===this.dialogForm.stat_fn},tableDataShow:function(){var e=this.queryShowForm.stat_name,t=this.queryShowForm.stat_desc,a=this.queryShowForm.stat_param,r=this.queryShowForm.stat_datafd,l=this.queryShowForm.stat_fn,o=this.queryShowForm.stat_valid;return this.tableData.filter(function(i){if(""!==e&&!i.stat_name.includes(e))return!1;if(""!==t&&!i.stat_desc.includes(t))return!1;if(null!=a&&a.length>0){for(var n=!1,s=0;s<a.length;s++)if(i.stat_param===a[s]){n=!0;break}if(!n)return!1}return(null==r||""===r||i.stat_datafd===r)&&((null==l||""===l||i.stat_fn===l)&&(null==o||""===o||i.stat_valid==o))})}},data:function(){return{modelName:"",isExpand:!1,tableData:[],allStoreFd:[],enableStoreFd:[],dialogTitle:"",refsDialogTitle:"引用点查看",dialogType:"",refsDialogVisible:!1,dialogVisible:!1,refsTreeData:[],defaultRefsTreeProps:{children:"children",label:"text"},formLabelWidth:"120px",formItemStyle:{width:"400px"},formItemContentStyle:{width:"250px"},queryFormShow:!1,queryShowForm:{stat_name:"",stat_desc:"",stat_param:"",stat_datafd:"",stat_fn:"",stat_valid:""},statParamInitList:[],dialogForm:this.initDialogForm(),dialogFormSureBtnDisabled:!1,statValidBtnDisabled:!1,allPickCollapse:!1,statCondInDictDialogForm:{},statParamList:[],statDataFdList:[],statFnList:[],coununitList:[],statValidList:[],resultCondList:[],datatypeCodeList:[],storecolumnCodeList:[],formStatDescShow:!0,formStatParamShow:!0,formStatFnShow:!0,formStatCondInShow:!0,formStatDatafdShow:!0,formFnParamShow:!0,formCoununitShow:!0,formCountroundShow:!0,formResultCondShow:!0,formDatatypeShow:!0,formStoreColumnShow:!0,formContinuesShow:!0,formStatUnresultShow:!0,formStatValidShow:!0,modDisabled:!1,viewDisabled:!1,dialogFormRules:{stat_desc:[{required:!0,message:"请输入统计描述",trigger:"blur"},{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacterHasPunctuation,trigger:"blur"}],stat_cond:[{validator:this.checkStatCond,trigger:"blur"}],stat_fn:[{required:!0,message:"请输入统计函数",trigger:"change"}],stat_param:[{validator:this.checkStatParam,trigger:"blur"}],stat_datafd:[{validator:this.checkStatDataFd,trigger:"change"}],fn_param:[{validator:this.checkFnParam,trigger:"change"}],coununit:[{validator:this.checkCoununit,trigger:"change"}],countround:[{validator:this.checkCountround,trigger:"blur"}],result_cond:[{validator:this.checkResultCond,trigger:"change"}],datatype:[{validator:this.checkDatatype,trigger:"change"}],stat_valid:[{validator:this.checkStatValid,trigger:"change"}]},currentPage:1,pageSize:10,total:0,selectedRows:[]}},props:["txnId","isVisibility","readonly"],mounted:function(){this.$nextTick(function(){Et=this})},watch:{txnId:function(e){!0===this.isVisibilityParent&&this.reloadData()},isVisibility:function(e){!0===this.isVisibilityParent&&this.reloadData()},"dialogForm.stat_fn":function(e){this.fnChangeEvent(),this.countroundChangeEvent()},"dialogForm.coununit":function(e){this.countroundChangeEvent()},"dialogForm.stat_datafd":function(e){this.datafdChangeEvent()}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderStatValidFilter:function(e){return ue.rendCode("tms.mgr.rulestatus",e)},statParamFilter:function(e){if(null===e||""===e)return"";var t=[],a=e.split(","),r=!0,l=!1,o=void 0;try{for(var i,n=f()(a);!(r=(i=n.next()).done);r=!0)for(var s=i.value,c=0;c<Et.statParamList.length;c++){var u=Et.statParamList[c];if(""!==s&&s===u.code_key){t.push(u.code_value);break}}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}return t.join(",")},statDataFdFilter:function(e){if(null===e||""===e)return"";var t=[],a=e.split(","),r=!0,l=!1,o=void 0;try{for(var i,n=f()(a);!(r=(i=n.next()).done);r=!0)for(var s=i.value,c=0;c<Et.statDataFdList.length;c++){var u=Et.statDataFdList[c];if(""!==s&&s===u.code_key){t.push(u.code_value);break}}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}return t.join(",")},statFnFilter:function(e){if(null===e||""===e)return"";var t=[],a=e.split(","),r=!0,l=!1,o=void 0;try{for(var i,n=f()(a);!(r=(i=n.next()).done);r=!0)for(var s=i.value,c=0;c<Et.statFnList.length;c++){var u=Et.statFnList[c];if(""!==s&&s===u.code_key){t.push(u.code_value);break}}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}return t.join(",")}},methods:{initDialogForm:function(){return{stat_desc:"",stat_param:"",stat_param_list:"",stat_fn:"",stat_cond:"",stat_cond_in:"",fn_param:"",stat_datafd:"",coununit:"",countround:"",result_cond:"",datatype:"",storecolumn:"",continues:0,stat_unresult:0,stat_valid:"1"}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},reloadData:function(){this.getStatParamSelectData(),this.statValidList=ue.getCodeItems("tms.mgr.rulestatus"),this.resultCondList=ue.getCodeItems("tms.stat.txnstatus"),this.datatypeCodeList=ue.getCodeItems("tms.stat.datatype"),this.coununitList=ue.getCodeItems("tms.stat.condunit")},getData:function(){var e=this,t={pageindex:this.currentPage,pagesize:this.pageSize,txnId:this.txnIdParent};H.post({url:"/stat/list",param:t,loading:!0,success:function(t){e.bindGridData(t),e.allStoreFd=t.allstorefd,e.enableStoreFd=t.enablestorefd}})},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},getStatParamSelectData:function(){var e=this;H.post({url:"/stat/txnFeature",param:{txn_id:this.txnIdParent},success:function(t){if(t.row){e.statParamList=[],e.statDataFdList=[];var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.row);!(a=(o=i.next()).done);a=!0){var n=o.value;e.statParamList.push(n),e.statDataFdList.push(n)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}e.statParamList.sort(function(e,t){return e.code_value.localeCompare(t.code_value,"zh")}),e.statDataFdList.sort(function(e,t){return e.code_value.localeCompare(t.code_value,"zh")}),H.post({url:"/stat/code",model:H.model.manager,param:{category_id:"tms.pub.func",args:2},success:function(t){if(t.row){e.statFnList=[];var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.row);!(a=(o=i.next()).done);a=!0){var n=o.value;e.statFnList.push(n)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}e.getData()}}})}}})},dialogOpenHandle:function(){this.formDatatypeShow=!1,this.fnChangeEventCommon(),this.countroundChangeEvent()},delData:function(e){var t=this;this.readonlyParent||this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={};e.del=t.selectedRows;var a={};a.postData=e,a.txnId=t.txnIdParent;var r=t;H.post({url:"/stat/save",loading:!0,param:a,success:function(e){r.getData(),r.$message.success("删除成功")}})})},statValidChange:function(e){if(!this.readonlyParent){var t={};this.statValidBtnDisabled=!0,t["valid-y"]=[e];var a={};a.postData=t,a.txnId=this.txnIdParent;var r=this,l="编辑成功";l=1===e.stat_valid?"已启用":"已停用",H.post({url:"/stat/save",loading:!0,param:a,success:function(e){r.statValidBtnDisabled=!1,r.$message.success(l)},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?r.$message.error(e.error.join("|")):r.$message.error(e.error),r.statValidBtnDisabled=!1},fail:function(){r.statValidBtnDisabled=!1}})}},openDialog:function(e,t){this.dialogType=e;var a=this;if("edit"===e)this.allPickCollapse=!1,this.dialogTitle="编辑交易统计",this.readonlyParent&&(this.dialogTitle="查看交易统计"),this.modDisabled=!0,this.viewDisabled=!1,s()(this.dialogForm,this.selectRowNum2Str(t)),setTimeout(function(){""!==a.dialogForm.stat_param&&(a.statParamInitList=t.stat_param.split(",")),a.dialogForm.fn_param=t.fn_param},300);else if("add"===e)this.allPickCollapse=!0,this.dialogTitle="新建交易统计",this.modDisabled=!1,this.viewDisabled=!1,this.dialogForm=this.initDialogForm(),this.statParamInitList=[];else if("view"===e){if(this.allPickCollapse=!1,this.dialogTitle="查看交易统计",1!==this.selectedRows.length)return void this.$message("请选择一行交易统计信息");this.viewDisabled=!0,this.modDisabled=!1,setTimeout(function(){""!==a.dialogForm.stat_param&&(a.statParamInitList=a.selectedRows[0].stat_param.split(",")),a.dialogForm.fn_param=a.selectedRows[0].fn_param},300),s()(this.dialogForm,this.selectRowNum2Str(this.selectedRows[0]))}this.dialogVisible=!0,this.dialogOpenHandle(),setTimeout(function(){a.$refs.dialogForm&&a.$refs.dialogForm.clearValidate()},100)},openRefsDialog:function(e){this.selTree(e),this.refsDialogVisible=!0},selectRowNum2Str:function(e){var t={};for(var a in s()(t,e),t)"number"==typeof t[a]&&(t[a]=t[a].toString());return t},submitForm:function(e){var t=this;this.readonlyParent||this.$refs[e].validate(function(e){if(e){t.dialogFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.dialogForm),r.stat_txn=t.txnIdParent,r.continues="1"==r.continues?"1":"0",r.stat_unresult="1"==r.stat_unresult?"1":"0",null!==r.stat_param&&r.stat_param.length>0&&(r.stat_param=r.stat_param.join(","));var l={},o="提交成功";"add"===t.dialogType?(l.add=[r],o="创建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,i.txnId=t.txnIdParent,H.post({url:"/stat/save",param:i,loading:!0,success:function(e){a.getData(),a.$message.success(o),a.dialogVisible=!1,a.dialogFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.dialogFormSureBtnDisabled=!1},fail:function(){a.dialogFormSureBtnDisabled=!1}})}})},fnParamPopup:function(){if(!this.readonlyParent&&!this.viewDisabled){var e=this.dialogForm.stat_fn,t=this.dialogForm.stat_datafd;if("rang_bin_dist"===e){var a=this.dialogForm.fn_param,r="",l=this.queryTxnFeature(t);l&&(r=l.type),this.$refs.FuncParamPickerDialog.open(a,r)}}},statCondInPopup:function(){this.readonlyParent||this.viewDisabled||(this.$refs.StatCondDialog.open(),this.$refs.StatCondDialog.setValue({stat_cond_value:this.dialogForm.stat_cond,stat_cond_in:this.dialogForm.stat_cond_in}))},statParamDataChange:function(e){this.queryShowForm.stat_param=e},addStatParamDataChange:function(e){this.dialogForm.stat_param=e,this.$refs.dialogForm.validateField("stat_param",function(e){})},statCondInValueCallBack:function(e){this.dialogForm.stat_cond=e.stat_cond_value,this.dialogForm.stat_cond_in=e.stat_cond_in},funcParamValueCallBack:function(e){this.dialogForm.fn_param=e},queryTxnFeature:function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=f()(this.statDataFdList);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.code_key===e)return i}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return null},changeFeatureTypeToDataType:function(e){var t=e,a=!0,r=!1,l=void 0;try{for(var o,i=f()(Ot);!(a=(o=i.next()).done);a=!0){var n=o.value;if(n.type.includes(e)){t=n.recap;break}}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}return t},getStorageFdByfdName:function(e,t){var a=null;if(e&&t){var r=!0,l=!1,o=void 0;try{for(var i,n=f()(e);!(r=(i=n.next()).done);r=!0){var s=i.value;if(s.fd_name===t){a=s;break}}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}}return a},getCanUseStorageFdByDataType:function(e,t){var a=[],r=this.enableStoreFd;if(!t){var l=this.selectedRows;if(l&&l.length>0){var o=l[0];if(o&&o.storecolumn){var i=this.allStoreFd,n=this.getStorageFdByfdName(i,o.storecolumn);n&&r.splice(0,0,n)}}}return a=a.concat(this.getEnableStorageFdByDataType(e,r))},getEnableStorageFdByDataType:function(e,t){var a=[];if(e&&t){var r=!0,l=!1,o=void 0;try{for(var i,n=f()(t);!(r=(i=n.next()).done);r=!0){var s=i.value,c=!0,u=!1,d=void 0;try{for(var m,p=f()(Ot);!(c=(m=p.next()).done);c=!0){var h=m.value;h.type.includes(e)&&("long"===h.recap||"double"===h.recap?("double"!==e&&s.type===e&&a.push({code_value:s.fd_name,code_key:s.fd_name}),"double"===s.type&&a.push({code_value:s.fd_name,code_key:s.fd_name})):"string"===h.recap&&"string"!==e&&s.type===e&&a.push({code_value:s.fd_name,code_key:s.fd_name}),"string"===s.type&&a.push({code_value:s.fd_name,code_key:s.fd_name}))}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}}return a},changeDialogForm:function(e){switch(e){case"calculat_expressions":this.dialogForm.stat_param="",this.dialogForm.stat_datafd="",this.dialogForm.coununit="",this.dialogForm.countround="",this.dialogForm.fn_param="",this.dialogForm.result_cond="",this.dialogForm.continues="",this.dialogForm.stat_unresult="",this.formStatParamShow=!1,this.formStatDatafdShow=!1,this.formCoununitShow=!1,this.formCountroundShow=!1,this.formFnParamShow=!1,this.formResultCondShow=!1,this.formContinuesShow=!1,this.formStatUnresultShow=!1;break;default:this.formStatParamShow=!0,this.formStatDatafdShow=!0,this.formCoununitShow=!0,this.formCountroundShow=!0,this.formFnParamShow=!0,this.formResultCondShow=!0,this.formContinuesShow=!0,this.formStatUnresultShow=!0}},fnChangeEventCommon:function(){var e=this.dialogForm;if("calculat_expressions"===e.stat_fn)this.changeDialogForm("calculat_expressions"),this.formDatatypeShow=!0;else if(this.changeDialogForm(),"rang_bin_dist"===e.stat_fn){var t=e.stat_datafd,a="";if(void 0!=t&&""!==t){var r=Et.queryTxnFeature(t);r&&(a=r.type),"datetime"===a||"time"===a||"double"===a||"money"===a||"long"===a?this.formFnParamShow=!0:(this.dialogForm.fn_param="",this.formFnParamShow=!1)}else this.dialogForm.fn_param="",this.formFnParamShow=!1}else"count"===e.stat_fn||"status"===e.stat_fn?(this.dialogForm.stat_datafd="",this.formStatDatafdShow=!1):this.formStatDatafdShow=!0,this.dialogForm.fn_param="",this.formFnParamShow=!1},fnChangeEvent:function(){var e=this.dialogForm;e.storecolumn="",this.fnChangeEventCommon();var t="";if("snapshot"===e.stat_fn){var a=e.stat_datafd,r=this.queryTxnFeature(a);r&&(t=this.changeFeatureTypeToDataType(r.type))}else{var l=!0,o=!1,i=void 0;try{for(var n,s=f()(this.statFnList);!(l=(n=s.next()).done);l=!0){var c=n.value;c.code_key===e.stat_fn&&(t=c.func_type)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}}"object"===t&&"calculat_expressions"===e.stat_fn?(e.datatype="",e.storecolumn="",e.datatype="",e.storecolumn="",this.formDatatypeShow=!0,t=""):(e.datatype=t,this.formDatatypeShow=!1,this.storecolumnCodeList=this.getCanUseStorageFdByDataType(t,!0))},countroundChangeEvent:function(){var e=this.dialogForm;"7"===e.coununit||"9"===e.coununit||"calculat_expressions"===e.stat_fn?(this.dialogForm.countround="",this.formCountroundShow=!1):this.formCountroundShow=!0},datafdChangeEvent:function(){var e=this.dialogForm;e.storecolumn="";var t=e.stat_fn,a=e.stat_datafd,r="",l=this.queryTxnFeature(a);if(l&&(r=l.type),"snapshot"===t){var o=this.changeFeatureTypeToDataType(r);e.datatype=o,this.storecolumnCodeList=this.getCanUseStorageFdByDataType(o,!0)}"rang_bin_dist"===t?"datetime"===r||"time"===r||"double"===r||"money"===r||"long"===r?(e.fn_param="",this.formFnParamShow=!0):(""!==a&&(this.$message("非时间类型、日期时间类型和非数值类型的统计目标，不能使用区间分布函数"),e.stat_datafd=""),e.stat_datafd="",e.fn_param="",this.formFnParamShow=!1):(e.fn_param="",this.formFnParamShow=!1)},checkStatCond:function(e,t,a){var r=this.dialogForm.stat_cond,l=this.formStatCondInName.replace(":","");return"calculat_expressions"===this.dialogForm.stat_fn&&""===r?a(new Error("请输入"+l)):""!==r&&r.length>512?a(new Error(l+"不能超过512个字符")):void a()},checkStatDataFd:function(e,t,a){var r=this.dialogForm.stat_fn;if(!("calculat_expressions"===this.dialogForm.stat_fn)&&"count"!==r&&"status"!==r&&""===this.dialogForm.stat_datafd)return a(new Error("请输入统计目标"));a()},checkStatParam:function(e,t,a){var r=this.dialogForm.stat_param,l=this.dialogForm.coununit;if(!("calculat_expressions"===this.dialogForm.stat_fn||0!==r.length&&""!==r))return a(new Error("请输入统计引用对象"));if(r.length>6)return a(new Error("统计引用对象最多选择6个"));if("9"===l){var o=!1,i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){if("SESSIONID"===c.value.toUpperCase()){o=!0;break}}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}if(!o)return a(new Error('单位为会话，必须包含"会话标识"'))}a()},checkFnParam:function(e,t,a){var r=this.dialogForm.stat_fn,l=this.dialogForm.fn_param;if("rang_bin_dist"===r){if(void 0===l||""===l)return a(new Error("请输入函数参数"));if(l.length>512)return a(new Error("函数参数在512个字符以内"))}a()},checkCoununit:function(e,t,a){var r=this.dialogForm.coununit;if(!("calculat_expressions"===this.dialogForm.stat_fn)&&""===r)return a(new Error("请输入单位"));a()},checkCountround:function(e,t,a){var r=this.dialogForm.coununit,l=this.dialogForm.countround;if(!("calculat_expressions"===this.dialogForm.stat_fn)&&"7"!==r&&"9"!==r){if(""===j.trim(l))return a(new Error("请输入周期"));if(!j.isNumber(l,"+","0")||parseInt(l)<1||parseInt(l)>100)return a(new Error("周期只能输入1-100的正整数"))}a()},checkResultCond:function(e,t,a){var r=this.dialogForm.result_cond;if(!("calculat_expressions"===this.dialogForm.stat_fn)&&""===j.trim(r))return a(new Error("请输入交易结果"));a()},checkDatatype:function(e,t,a){var r=this.dialogForm.datatype;if("calculat_expressions"===this.dialogForm.stat_fn&&""===j.trim(r))return a(new Error("请输入数据类型"));a()},checkStatValid:function(e,t,a){var r=this.dialogForm.stat_valid;if(!("calculat_expressions"===this.dialogForm.stat_fn)&&""===j.trim(r))return a(new Error("请输入有效性"));a()},selTree:function(e){var t=this;this.treeList=[],this.refsTreeData=[];var a={url:"/stat/refTree",param:{txnId:this.txnIdParent,statName:e.stat_name},loading:!0,success:function(e){e.list&&e.list.length>0&&(e.row=e.list,t.treeList=e.row,t.refsTreeData=t.formatTreeData(e.row))}};H.post(a)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid&&"-1"!==e[r].fid||void 0!==e[r].id&&null!==e[r].id&&""!==e[r].id&&t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a}},components:{AllPickSelect:St,StatCondPicker:et,FuncParamPicker:Rt}},Bt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,inline:!0}})],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",disabled:e.readonlyParent},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{plain:"",disabled:!e.hasSelectRow||e.readonlyParent},on:{click:e.delData}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"stat-query-box"},[a("el-input",{staticClass:"stat-query-form-item",attrs:{placeholder:"统计名称","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.stat_name,callback:function(t){e.$set(e.queryShowForm,"stat_name",t)},expression:"queryShowForm.stat_name"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),e._v(" "),a("el-input",{staticClass:"stat-query-form-item",attrs:{placeholder:"统计描述","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.stat_desc,callback:function(t){e.$set(e.queryShowForm,"stat_desc",t)},expression:"queryShowForm.stat_desc"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.tableDataShow},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonlyParent?e._e():a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openDialog("edit",t.row)}}}),e._v(" "),e.readonlyParent?a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view",title:"查看"},on:{click:function(a){e.openDialog("edit",t.row)}}}):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-location-outline",title:"引用点"},on:{click:function(a){e.openRefsDialog(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"stat_name",label:"统计名称",align:"left",width:"70"}}),e._v(" "),a("el-table-column",{attrs:{prop:"stat_desc",label:"统计描述",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"统计引用对象",align:"left",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statParamFilter")(t.row.stat_param)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"stat_datafd",label:"统计目标",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statDataFdFilter")(t.row.stat_datafd)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"统计函数",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statFnFilter")(t.row.stat_fn)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"storecolumn",label:"存储字段",align:"left",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{label:"有效性",align:"left",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:e.statValidBtnDisabled||e.readonlyParent},on:{change:function(a){e.statValidChange(t.row)}},model:{value:t.row.stat_valid,callback:function(a){e.$set(t.row,"stat_valid",a)},expression:"scope.row.stat_valid"}})]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,inline:!0,rules:e.dialogFormRules}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatDescShow,expression:"formStatDescShow"}],style:e.formItemStyle,attrs:{label:"统计描述:","label-width":e.formLabelWidth,prop:"stat_desc"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",maxlength:200,disabled:e.viewDisabled||e.readonlyParent},model:{value:e.dialogForm.stat_desc,callback:function(t){e.$set(e.dialogForm,"stat_desc",t)},expression:"dialogForm.stat_desc"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatParamShow,expression:"formStatParamShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"统计引用对象:","label-width":e.formLabelWidth,prop:"stat_param"}},[a("AllPickSelect",{style:e.formItemContentStyle,attrs:{collapseTags:e.allPickCollapse,selectedList:e.statParamInitList,dataList:e.statParamList,disabled:e.modDisabled||e.viewDisabled||e.readonlyParent},on:{dataChange:e.addStatParamDataChange}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatFnShow,expression:"formStatFnShow"}],style:e.formItemStyle,attrs:{label:"统计函数:","label-width":e.formLabelWidth,prop:"stat_fn"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.modDisabled||e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.stat_fn,callback:function(t){e.$set(e.dialogForm,"stat_fn",t)},expression:"dialogForm.stat_fn"}},e._l(e.statFnList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatCondInShow,expression:"formStatCondInShow"}],class:{"is-required":e.StatCondInRequired},style:e.formItemStyle,attrs:{label:e.formStatCondInName,"label-width":e.formLabelWidth,prop:"stat_cond"}},[a("div",{attrs:{disabled:e.viewDisabled},on:{dblclick:e.statCondInPopup}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.viewDisabled||e.readonlyParent},model:{value:e.dialogForm.stat_cond,callback:function(t){e.$set(e.dialogForm,"stat_cond",t)},expression:"dialogForm.stat_cond"}}),e._v(" "),a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.viewDisabled||e.readonlyParent},model:{value:e.dialogForm.stat_cond_in,callback:function(t){e.$set(e.dialogForm,"stat_cond_in",t)},expression:"dialogForm.stat_cond_in"}})],1)]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatDatafdShow,expression:"formStatDatafdShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"统计目标:","label-width":e.formLabelWidth,prop:"stat_datafd"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.modDisabled||e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.stat_datafd,callback:function(t){e.$set(e.dialogForm,"stat_datafd",t)},expression:"dialogForm.stat_datafd"}},e._l(e.statDataFdList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formFnParamShow,expression:"formFnParamShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"函数参数:","label-width":e.formLabelWidth,prop:"fn_param"}},[a("div",{on:{dblclick:e.fnParamPopup}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.viewDisabled||e.readonlyParent},model:{value:e.dialogForm.fn_param,callback:function(t){e.$set(e.dialogForm,"fn_param",t)},expression:"dialogForm.fn_param"}})],1)]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formCoununitShow,expression:"formCoununitShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"单位:","label-width":e.formLabelWidth,prop:"coununit"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.modDisabled||e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.coununit,callback:function(t){e.$set(e.dialogForm,"coununit",t)},expression:"dialogForm.coununit"}},e._l(e.coununitList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formCountroundShow,expression:"formCountroundShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"周期:","label-width":e.formLabelWidth,prop:"countround"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",disabled:e.viewDisabled||e.readonlyParent},model:{value:e.dialogForm.countround,callback:function(t){e.$set(e.dialogForm,"countround",t)},expression:"dialogForm.countround"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formResultCondShow,expression:"formResultCondShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"交易结果:","label-width":e.formLabelWidth,prop:"result_cond"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.result_cond,callback:function(t){e.$set(e.dialogForm,"result_cond",t)},expression:"dialogForm.result_cond"}},e._l(e.resultCondList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formDatatypeShow,expression:"formDatatypeShow"}],staticClass:"is-required",style:e.formItemStyle,attrs:{label:"数据类型:","label-width":e.formLabelWidth,prop:"datatype"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.datatype,callback:function(t){e.$set(e.dialogForm,"datatype",t)},expression:"dialogForm.datatype"}},e._l(e.datatypeCodeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStoreColumnShow,expression:"formStoreColumnShow"}],style:e.formItemStyle,attrs:{label:"存储字段:","label-width":e.formLabelWidth,prop:"storecolumn"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.viewDisabled||e.readonlyParent,clearable:""},model:{value:e.dialogForm.storecolumn,callback:function(t){e.$set(e.dialogForm,"storecolumn",t)},expression:"dialogForm.storecolumn"}},e._l(e.storecolumnCodeList,function(e){return a("el-option",{key:e.code_key,attrs:{label:e.code_value,value:e.code_key}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formContinuesShow,expression:"formContinuesShow"}],style:e.formItemStyle,attrs:{label:"连续:","label-width":e.formLabelWidth,prop:"continues"}},[a("el-switch",{attrs:{disabled:e.viewDisabled||e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.dialogForm.continues,callback:function(t){e.$set(e.dialogForm,"continues",t)},expression:"dialogForm.continues"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatUnresultShow,expression:"formStatUnresultShow"}],style:e.formItemStyle,attrs:{label:"事中:","label-width":e.formLabelWidth,prop:"stat_unresult"}},[a("el-switch",{attrs:{disabled:e.viewDisabled||e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.dialogForm.stat_unresult,callback:function(t){e.$set(e.dialogForm,"stat_unresult",t)},expression:"dialogForm.stat_unresult"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formStatValidShow,expression:"formStatValidShow"}],style:e.formItemStyle,attrs:{label:"有效性:","label-width":e.formLabelWidth,prop:"stat_valid"}},[a("el-switch",{attrs:{disabled:e.viewDisabled||e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.dialogForm.stat_valid,callback:function(t){e.$set(e.dialogForm,"stat_valid",t)},expression:"dialogForm.stat_valid"}})],1),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[e.readonlyParent?e._e():a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.viewDisabled,expression:"!viewDisabled"}],attrs:{type:"primary",disabled:e.dialogFormSureBtnDisabled,size:"large"},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.viewDisabled,expression:"!viewDisabled"}],attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1),e._v(" "),a("StatCondPicker",{ref:"StatCondDialog",attrs:{statCond:e.dialogForm.stat_cond,statCondIn:e.dialogForm.stat_cond_in,txnId:e.txnId,hideItems:["rule_func","ac_func"]},on:{valueCallback:e.statCondInValueCallBack}}),e._v(" "),a("FuncParamPicker",{ref:"FuncParamPickerDialog",on:{valueCallback:e.funcParamValueCallBack}}),e._v(" "),a("el-dialog",{attrs:{title:e.refsDialogTitle,visible:e.refsDialogVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.refsDialogVisible=t}}},[a("el-tree",{ref:"refsTree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.refsTreeData,"node-key":"id",props:e.defaultRefsTreeProps,"highlight-current":!0,"expand-on-click-node":!1}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[]};var Wt=null,Mt={data:function(){return{modelName:"",tableData:[],refsTableData:[],allStoreFd:[],enableStoreFd:[],dialogTitle:"",dialogTabActive:"dataMod",refsDialogTitle:"策略列表",dialogType:"",dialogVisible:!1,refsDialogVisible:!1,formLabelWidth:"120px",formItemStyle:{width:"400px"},formItemContentStyle:{width:"250px"},textareaContentStyle:{width:"665px"},queryFormShow:!1,queryShowForm:{rule_shortdesc:"",eval_type:"",disposal:"",rule_enable:""},dialogForm:this.initDialogForm(),actionDialogForm:this.initActionDialogForm(),dialogFormSureBtnDisabled:!1,ruleEnableBtnDisabled:!1,dialogFormRules:{rule_shortdesc:[{required:!0,message:"请输入规则名称",trigger:"blur"},{max:128,message:"长度在128个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacterHasPunctuation,trigger:"blur"}],rule_cond:[{required:!0,message:"请输入规则条件",trigger:"blur"},{max:1024,message:"长度在1024个字符以内",trigger:"blur"}],rule_cond_in:[{required:!0,message:"请输入规则条件",trigger:"blur"},{max:1024,message:"长度在1024个字符以内",trigger:"blur"}],eval_type:[{required:!0,message:"请输入评估类型",trigger:"change"}],disposal:[{required:!0,message:"请输入处置方式",trigger:"change"}],rule_desc:[{max:1024,message:"长度在1024个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"}],rule_score:[{required:!0,message:"请输入规则分值",trigger:"blur"},{validator:this.checkRuleScore,trigger:"blur"}]},selectedRows:[],disposalList:[],evalTypeList:[],ruleEnableList:[],currentPage:1,pageSize:10,total:0,actionTableData:[],acEnableBtnDisabled:!1,selectedRule:{},actionDialogVisible:!1,actionDialogTitle:"",actionFormSureBtnDisabled:!1,actionDialogType:"",actionRules:{ac_desc:[{required:!0,message:"请输入动作名称",trigger:"blur"},{max:128,message:"长度在128个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"}],ac_cond_in:[{validator:this.checkAcCond,trigger:"blur"}],ac_expr_in:[{validator:this.checkAcRxpr,trigger:"blur"}],ac_enable:[{required:!0,message:"请输入有效性",trigger:"change"}]}}},computed:{readonlyParent:function(){return this.readonly},txnIdParent:function(){return this.txnId},hasSelectRow:function(){return this.selectedRows.length>0},isVisibilityParent:function(){return this.isVisibility},tableDataShow:function(){var e=this.queryShowForm.rule_shortdesc,t=this.queryShowForm.eval_type,a=this.queryShowForm.disposal,r=this.queryShowForm.rule_enable;return this.tableData.filter(function(l){return!(""!==e&&!l.rule_shortdesc.includes(e))&&((null==t||""===t||l.eval_type===t)&&((null==a||""===a||l.disposal===a)&&(null==r||""===r||l.rule_enable==r)))})},actionTableDataShow:function(){return this.actionTableData}},filters:{renderDateTime:function(e){return j.renderDateTime(e)},evalTypeFilter:function(e){return ue.rendCode("tms.rule.evaltype",e)},ruleIsTestFilter:function(e){return ue.rendCode("common.is",e)},evalModeFilter:function(e){return ue.rendCode("tms.strategy.evalmode",e)},ruleExecModeFilter:function(e){return ue.rendCode("tms.strategy.rule_exec_mode",e)},stEnableFilter:function(e){return ue.rendCode("tms.mgr.rulestatus",e)},disposalFilter:function(e){var t=e,a=!0,r=!1,l=void 0;try{for(var o,i=f()(Wt.disposalList);!(a=(o=i.next()).done);a=!0){var n=o.value;if(""!==e&&e===n.dp_code){t=n.dp_name;break}}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}return t}},props:["txnId","isVisibility","readonly"],mounted:function(){this.$nextTick(function(){Wt=this})},watch:{txnId:function(e){!0===this.isVisibilityParent&&this.reloadData()},isVisibility:function(e){!0===this.isVisibilityParent&&this.reloadData()},"dialogForm.disposal":function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=f()(this.disposalList);!(t=(l=o.next()).done);t=!0){var i=l.value;if(""===e){this.dialogForm.rule_score="";break}if(e===i.dp_code){this.dialogForm.rule_score=i.default_score;break}}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}}},methods:{initDialogForm:function(){return{rule_shortdesc:"",rule_cond_in:"",rule_cond:"",eval_type:"",disposal:"",rule_score:"",rule_istest:"0",rule_enable:"1",rule_desc:""}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},initActionDialogForm:function(){return{ac_desc:"",ac_cond_in:"",ac_cond:"",ac_expr_in:"",ac_expr:"",ac_enable:"0"}},getData:function(){var e=this;console.log(this.currentPage),console.log(this.pageSize),H.post({url:"/rule/list",loading:!0,param:{RULE_TXN:this.txnIdParent,pageindex:this.currentPage,pagesize:this.pageSize,type:0,st_id:""},success:function(t){e.bindGridData(t)}})},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},reloadData:function(){var e=this;this.evalTypeList=ue.getCodeItems("tms.rule.evaltype"),this.ruleEnableList=ue.getCodeItems("tms.mgr.rulestatus"),H.post({url:"/rule/disposal",param:{txn_id:this.txnIdParent},success:function(t){e.disposalList=t.row,e.getData()}})},openDialog:function(e,t){this.dialogType=e;var a=this;"edit"===e?(this.dialogTabActive="dataMod",this.selectedRule=t,this.allPickCollapse=!0,this.dialogTitle="编辑交易规则",this.readonlyParent&&(this.dialogTitle="查看交易规则"),this.modDisabled=!0,s()(this.dialogForm,this.selectRowNum2Str(t)),this.getActionData()):"add"===e&&(this.dialogTabActive="dataMod",this.dialogTitle="新建交易规则",this.modDisabled=!1,this.dialogForm=this.initDialogForm()),this.dialogVisible=!0,setTimeout(function(){a.$refs.dialogForm&&a.$refs.dialogForm.clearValidate();try{"add"===e?a.$refs.dialogTab.$refs.nav.$el.parentNode.style.display="none":"edit"===e&&(a.$refs.dialogTab.$refs.nav.$el.parentNode.style.display="block")}catch(e){console.error(e)}},100)},copy:function(e){var t=this;this.readonlyParent||(console.log("row"),console.log(e),this.$confirm("确定复制?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r={};s()(r,e),r.rule_shortdesc=e.rule_shortdesc+"_复制",a.copy=[r];var l={};l.postData=a,l.txnId=t.txnIdParent;var o=t;H.post({url:"/rule/save",loading:!0,param:l,success:function(e){o.getData(),o.$message.success("复制成功")},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?o.$message.error(e.error.join("|")):o.$message.error(e.error),o.ruleEnableBtnDisabled=!1},fail:function(){o.ruleEnableBtnDisabled=!1}})}))},copyAction:function(e){var t=this;this.readonlyParent||this.$confirm("确定复制?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r={};if(s()(r,e),r.ac_desc=e.ac_desc+"_复制",r.ac_desc.length>128)t.$message({type:"error",message:"动作复制后动作名称超过128个字符，复制失败"});else{r.rule_txn=t.txnIdParent,r.rule_shortdesc=t.selectedRule.rule_shortdesc,a.copy=[r];var l={};l.postData=a,l.txnId=t.txnIdParent;var o=t;H.post({url:"/action/save",loading:!0,param:l,success:function(e){o.getActionData(),o.$message.success("复制成功")},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?o.$message.error(e.error.join("|")):o.$message.error(e.error)}})}})},delData:function(e){var t=this;this.readonlyParent||this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={};e.del=t.selectedRows;var a={};a.postData=e,a.txnId=t.txnIdParent;var r=t;H.post({url:"/rule/save",loading:!0,param:a,success:function(e){r.getData(),r.$message.success("删除成功")}})})},delActionData:function(e){var t=this;this.readonlyParent||this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r={};s()(r,e),r.rule_txn=t.txnIdParent,r.rule_shortdesc=t.selectedRule.rule_shortdesc,a.del=[r];var l={};l.postData=a,l.txnId=t.txnIdParent;var o=t;H.post({url:"/action/save",loading:!0,param:l,success:function(e){o.getActionData(),o.$message.success("删除成功")}})})},openRefsDialog:function(e){var t=this;H.post({url:"/strategy/refList",loading:!0,param:{RULE_ID:e.rule_id},success:function(e){t.refsTableData=e.row,t.refsDialogVisible=!0}})},ruleEnableChange:function(e){if(!this.readonlyParent){var t={};this.ruleEnableBtnDisabled=!0;var a="编辑成功";1===e.rule_enable?(a="已启用",t["valid-y"]=[e]):(a="已停用",t["valid-n"]=[e]);var r={};r.postData=t,r.txnId=this.txnIdParent;var l=this;H.post({url:"/rule/save",loading:!0,param:r,success:function(e){l.ruleEnableBtnDisabled=!1,l.$message.success(a)},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?l.$message.error(e.error.join("|")):l.$message.error(e.error),l.ruleEnableBtnDisabled=!1,l.getData()},fail:function(){l.ruleEnableBtnDisabled=!1}})}},acEnableChange:function(e){if(!this.readonlyParent){var t={};this.acEnableBtnDisabled=!0;var a={};s()(a,e),a.rule_txn=this.txnIdParent,a.rule_shortdesc=this.selectedRule.rule_shortdesc;var r="编辑成功";1===e.ac_enable?(r="已启用",t["valid-y"]=[a]):(r="已停用",t["valid-n"]=[a]);var l={};l.postData=t,l.txnId=this.txnIdParent;var o=this;H.post({url:"/action/save",loading:!0,param:l,success:function(e){o.acEnableBtnDisabled=!1,o.$message.success(r)},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?o.$message.error(e.error.join("|")):o.$message.error(e.error),o.acEnableBtnDisabled=!1,o.getActionData()},fail:function(){o.acEnableBtnDisabled=!1}})}},submitForm:function(e){var t=this;this.readonlyParent||this.$refs[e].validate(function(e){if(e){t.dialogFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.dialogForm),r.rule_txn=t.txnIdParent;var l={},o="提交成功";"add"===t.dialogType?(l.add=[r],o="创建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,i.txnId=t.txnIdParent,H.post({url:"/rule/save",loading:!0,param:i,success:function(e){a.getData(),a.$message.success(o),a.dialogVisible=!1,a.dialogFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.dialogFormSureBtnDisabled=!1},fail:function(){a.dialogFormSureBtnDisabled=!1}})}})},ruleCondInPopup:function(){this.readonlyParent||(this.$refs.RuleCondDialog.open(),this.$refs.RuleCondDialog.setValue({stat_cond_value:this.dialogForm.rule_cond,stat_cond_in:this.dialogForm.rule_cond_in}))},acCondInPopup:function(){this.readonlyParent||(this.$refs.acCondDialog.open(),this.$refs.acCondDialog.setValue({stat_cond_value:this.actionDialogForm.ac_cond,stat_cond_in:this.actionDialogForm.ac_cond_in}))},acExprInPopup:function(){this.readonlyParent||(this.$refs.acExprDialog.open(),this.$refs.acExprDialog.setValue({stat_cond_value:this.actionDialogForm.ac_expr,stat_cond_in:this.actionDialogForm.ac_expr_in}))},selectRowNum2Str:function(e){var t={};for(var a in s()(t,e),t)"number"==typeof t[a]&&(t[a]=t[a].toString());return t},ruleCondInValueCallBack:function(e){this.dialogForm.rule_cond=e.stat_cond_value,this.dialogForm.rule_cond_in=e.stat_cond_in,this.$refs.dialogForm.validateField("rule_cond_in",function(e){})},acCondInValueCallBack:function(e){this.actionDialogForm.ac_cond=e.stat_cond_value,this.actionDialogForm.ac_cond_in=e.stat_cond_in},acExprValueCallBack:function(e){this.actionDialogForm.ac_expr=e.stat_cond_value,this.actionDialogForm.ac_expr_in=e.stat_cond_in,this.$refs.actionDialogForm.validateField("ac_expr_in",function(e){})},checkRuleScore:function(e,t,a){return!j.isNumber(t,null,"0")||parseInt(t)<-100||parseInt(t)>100?a(new Error("周期只能输入-100-100的整数")):a()},openActionDialog:function(e,t){"edit"===e?(this.actionDialogTitle="编辑动作",this.readonlyParent&&(this.actionDialogTitle="查看动作"),s()(this.actionDialogForm,this.selectRowNum2Str(t))):"add"===e&&(this.actionDialogTitle="新建动作",this.actionDialogForm=this.initActionDialogForm()),this.actionDialogType=e,this.actionDialogVisible=!0},getActionData:function(){var e=this.selectedRule.rule_id,t=this;H.post({url:"/action/list",loading:!0,param:{rule_id:e},success:function(e){e.row&&(t.actionTableData=e.row.map(function(e){return e.ac_enable=parseInt(e.ac_enable),e}))},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?t.$message.error(e.error.join("|")):t.$message.error(e.error),t.dialogFormSureBtnDisabled=!1},fail:function(){t.dialogFormSureBtnDisabled=!1}})},submitActionForm:function(e){var t=this;this.readonlyParent||this.$refs[e].validate(function(e){if(e){t.actionFormSureBtnDisabled=!0;var a=t,r={};r.rule_id=t.selectedRule.rule_id,r.rule_shortdesc=t.selectedRule.rule_shortdesc,r.rule_txn=t.txnIdParent,s()(r,t.actionDialogForm),r.rule_txn=t.txnIdParent;var l={},o="提交成功";"add"===t.actionDialogType?(l.add=[r],o="新建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,i.txnId=t.txnIdParent,H.post({url:"/action/save",loading:!0,param:i,success:function(e){a.getActionData(),a.$message.success(o),a.actionDialogVisible=!1,a.actionFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.actionFormSureBtnDisabled=!1},fail:function(){a.actionFormSureBtnDisabled=!1}})}})},checkAcCond:function(e,t,a){var r=this.actionDialogForm.ac_cond;void 0!==r&&""!==r&&r.length>512&&a(new Error("长度在512个字符以内")),a()},checkAcRxpr:function(e,t,a){var r=this.actionDialogForm.ac_expr;void 0!==r&&""!==r?r.length>512&&a(new Error("长度在512个字符以内")):a(new Error("处理函数不能为空")),a()}},components:{StatCondPicker:et}},jt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",disabled:e.readonlyParent},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{plain:"",disabled:e.readonlyParent||!e.hasSelectRow},on:{click:e.delData}},[e._v("删除")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticClass:"rule-query-form-item",attrs:{placeholder:"规则名称","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.rule_shortdesc,callback:function(t){e.$set(e.queryShowForm,"rule_shortdesc",t)},expression:"queryShowForm.rule_shortdesc"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.tableDataShow},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonlyParent?a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view",title:"查看"},on:{click:function(a){e.openDialog("edit",t.row)}}}):e._e(),e._v(" "),e.readonlyParent?e._e():a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openDialog("edit",t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-document",title:"复制",disabled:e.readonlyParent},on:{click:function(a){e.copy(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rule_shortdesc",label:"规则名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"评估类型",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("evalTypeFilter")(t.row.eval_type)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"处置方式",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("disposalFilter")(t.row.disposal)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"action_count",label:"动作数量",align:"left",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否测试",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("ruleIsTestFilter")(t.row.rule_istest)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"有效性",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:e.ruleEnableBtnDisabled||e.readonlyParent},on:{change:function(a){e.ruleEnableChange(t.row)}},model:{value:t.row.rule_enable,callback:function(a){e.$set(t.row,"rule_enable",a)},expression:"scope.row.rule_enable"}})]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-tabs",{ref:"dialogTab",attrs:{type:"card"},model:{value:e.dialogTabActive,callback:function(t){e.dialogTabActive=t},expression:"dialogTabActive"}},[a("el-tab-pane",{attrs:{label:"数据编辑",name:"dataMod"}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,inline:!0,rules:e.dialogFormRules}},[a("el-form-item",{style:e.formItemStyle,attrs:{label:"规则名称:","label-width":e.formLabelWidth,prop:"rule_shortdesc"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",maxlength:128,disabled:e.readonlyParent},model:{value:e.dialogForm.rule_shortdesc,callback:function(t){e.$set(e.dialogForm,"rule_shortdesc",t)},expression:"dialogForm.rule_shortdesc"}})],1),e._v(" "),a("el-form-item",{staticClass:"is-required",style:e.formItemStyle,attrs:{label:"规则条件:","label-width":e.formLabelWidth,prop:"rule_cond_in"}},[a("div",{on:{dblclick:e.ruleCondInPopup}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.dialogForm.rule_cond_in,callback:function(t){e.$set(e.dialogForm,"rule_cond_in",t)},expression:"dialogForm.rule_cond_in"}}),e._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.dialogForm.rule_cond,callback:function(t){e.$set(e.dialogForm,"rule_cond",t)},expression:"dialogForm.rule_cond"}})],1)]),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"评估类型:","label-width":e.formLabelWidth,prop:"eval_type"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.readonlyParent,clearable:""},model:{value:e.dialogForm.eval_type,callback:function(t){e.$set(e.dialogForm,"eval_type",t)},expression:"dialogForm.eval_type"}},e._l(e.evalTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"处置方式:","label-width":e.formLabelWidth,prop:"disposal"}},[a("el-select",{style:e.formItemContentStyle,attrs:{placeholder:"请选择",disabled:e.readonlyParent,clearable:""},model:{value:e.dialogForm.disposal,callback:function(t){e.$set(e.dialogForm,"disposal",t)},expression:"dialogForm.disposal"}},e._l(e.disposalList,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"分值:","label-width":e.formLabelWidth,prop:"rule_score"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",disabled:e.readonlyParent},model:{value:e.dialogForm.rule_score,callback:function(t){e.$set(e.dialogForm,"rule_score",t)},expression:"dialogForm.rule_score"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"是否测试:","label-width":e.formLabelWidth,prop:"rule_istest"}},[a("el-switch",{attrs:{disabled:e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.dialogForm.rule_istest,callback:function(t){e.$set(e.dialogForm,"rule_istest",t)},expression:"dialogForm.rule_istest"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"有效性:","label-width":e.formLabelWidth,prop:"rule_enable"}},[a("el-switch",{attrs:{disabled:e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.dialogForm.rule_enable,callback:function(t){e.$set(e.dialogForm,"rule_enable",t)},expression:"dialogForm.rule_enable"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"规则描述:","label-width":e.formLabelWidth,prop:"rule_desc"}},[a("el-input",{style:e.textareaContentStyle,attrs:{type:"textarea",maxlength:1024,disabled:e.readonlyParent},model:{value:e.dialogForm.rule_desc,callback:function(t){e.$set(e.dialogForm,"rule_desc",t)},expression:"dialogForm.rule_desc"}})],1)],1),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[e.readonlyParent?e._e():a("el-button",{attrs:{type:"primary",disabled:e.dialogFormSureBtnDisabled,size:"large"},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1),e._v(" "),"edit"===e.dialogType?a("el-tab-pane",{attrs:{label:"动作列表",name:"actionList"}},[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:"",disabled:e.readonlyParent},on:{click:function(t){e.openActionDialog("add")}}},[e._v("新建")])],1),e._v(" "),a("el-table",{ref:"actionDataTable",staticStyle:{width:"100%"},attrs:{data:e.actionTableDataShow}},[a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonlyParent?a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view",title:"查看"},on:{click:function(a){e.openActionDialog("edit",t.row)}}}):e._e(),e._v(" "),e.readonlyParent?e._e():a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openActionDialog("edit",t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-document",title:"复制",disabled:e.readonlyParent},on:{click:function(a){e.copyAction(t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-delete",title:"删除",disabled:e.readonlyParent},on:{click:function(a){e.delActionData(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_desc",label:"动作名称",align:"left",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_cond_in",label:"动作条件",align:"left",width:"230"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ac_expr_in",label:"处理函数",align:"left",width:"230"}}),e._v(" "),a("el-table-column",{attrs:{label:"有效性",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:e.acEnableBtnDisabled||e.readonlyParent},on:{change:function(a){e.acEnableChange(t.row)}},model:{value:t.row.ac_enable,callback:function(a){e.$set(t.row,"ac_enable",a)},expression:"scope.row.ac_enable"}})]}}])})],1)],1):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:e.actionDialogTitle,visible:e.actionDialogVisible,width:"450px",modal:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.actionDialogVisible=t}}},[a("el-form",{ref:"actionDialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.actionDialogForm,rules:e.actionRules,inline:!0}},[a("el-form-item",{style:e.formItemStyle,attrs:{label:"动作名称:","label-width":e.formLabelWidth,prop:"ac_desc"}},[a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",maxlength:128,disabled:e.readonlyParent},model:{value:e.actionDialogForm.ac_desc,callback:function(t){e.$set(e.actionDialogForm,"ac_desc",t)},expression:"actionDialogForm.ac_desc"}})],1),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"动作条件:","label-width":e.formLabelWidth,prop:"ac_cond_in"}},[a("div",{on:{dblclick:e.acCondInPopup}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.actionDialogForm.ac_cond,callback:function(t){e.$set(e.actionDialogForm,"ac_cond",t)},expression:"actionDialogForm.ac_cond"}}),e._v(" "),a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.actionDialogForm.ac_cond_in,callback:function(t){e.$set(e.actionDialogForm,"ac_cond_in",t)},expression:"actionDialogForm.ac_cond_in"}})],1)]),e._v(" "),a("el-form-item",{staticClass:"is-required",style:e.formItemStyle,attrs:{label:"处理函数:","label-width":e.formLabelWidth,prop:"ac_expr_in"}},[a("div",{on:{dblclick:e.acExprInPopup}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.actionDialogForm.ac_expr,callback:function(t){e.$set(e.actionDialogForm,"ac_expr",t)},expression:"actionDialogForm.ac_expr"}}),e._v(" "),a("el-input",{style:e.formItemContentStyle,attrs:{"auto-complete":"off",readonly:"",disabled:e.readonlyParent},model:{value:e.actionDialogForm.ac_expr_in,callback:function(t){e.$set(e.actionDialogForm,"ac_expr_in",t)},expression:"actionDialogForm.ac_expr_in"}})],1)]),e._v(" "),a("el-form-item",{style:e.formItemStyle,attrs:{label:"有效性:","label-width":e.formLabelWidth,prop:"ac_enable"}},[a("el-switch",{attrs:{disabled:e.readonlyParent,"active-value":"1","inactive-value":"0"},model:{value:e.actionDialogForm.ac_enable,callback:function(t){e.$set(e.actionDialogForm,"ac_enable",t)},expression:"actionDialogForm.ac_enable"}})],1),e._v(" "),a("div",[a("el-form-item",{style:e.formItemStyle,attrs:{label:" ","label-width":e.formLabelWidth}},[e.readonlyParent?e._e():a("el-button",{attrs:{type:"primary",disabled:e.actionFormSureBtnDisabled,size:"large"},on:{click:function(t){e.submitActionForm("actionDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.actionDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("StatCondPicker",{ref:"acCondDialog",attrs:{statCond:e.actionDialogForm.ac_cond,statCondIn:e.actionDialogForm.ac_cond_in,txnId:e.txnIdParent,hideItems:["rule_func","ac_func"]},on:{valueCallback:e.acCondInValueCallBack}}),e._v(" "),a("StatCondPicker",{ref:"acExprDialog",attrs:{statCond:e.actionDialogForm.ac_expr,statCondIn:e.actionDialogForm.ac_expr_in,txnId:e.txnIdParent,hideItems:["rule_func"]},on:{valueCallback:e.acExprValueCallBack}})],1)],1),e._v(" "),a("StatCondPicker",{ref:"RuleCondDialog",attrs:{statCond:e.dialogForm.rule_cond,statCondIn:e.dialogForm.rule_cond_in,txnId:e.txnIdParent,hideItems:["rule_func"]},on:{valueCallback:e.ruleCondInValueCallBack}}),e._v(" "),a("el-dialog",{attrs:{title:e.refsDialogTitle,visible:e.refsDialogVisible,width:"1000px","close-on-click-modal":!1},on:{"update:visible":function(t){e.refsDialogVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.refsTableData}},[a("el-table-column",{attrs:{prop:"st_name",label:"策略名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tab_desc",label:"所属交易"}}),e._v(" "),a("el-table-column",{attrs:{label:"评估方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("evalModeFilter")(t.row.eval_mode)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"规则执行方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("ruleExecModeFilter")(t.row.rule_exec_mode)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"rule_count",label:"规则数量"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.createtime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"修改时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.modifytime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"有效性"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("stEnableFilter")(t.row.st_enable)))])]}}])})],1)],1)],1)},staticRenderFns:[]};var Ut={created:function(){this.selTree()},data:function(){return{toolBtn:{addBtn:!0,delBtn:!0},txnId:"",txnName:"",tabVisibility:{trandefVisibility:!0,tranmdlVisibility:!1,statVisibility:!1,ruleVisibility:!1},treeList:[],treeData:[],expendKey:["T"],defaultProps:{children:"children",label:"text"},activeName:"trandef"}},props:["readonly"],methods:{renderContent:function(e,t){var a=t.node;t.data,t.store;if(0===a.data.enable){var r=a.data.children;for(var l in r)r[l].enable=0;return e("span",{class:"el-tree-node__label disabledFlag"},[a.label])}return e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(e){var t=this,a=null,r=null;t.$refs.tree&&(r=t.$refs.tree.getCurrentNode(),a=r.id),H.post({url:"/trandef/query",success:function(l){if(l.list){t.treeList=l.list;var o=j.formatTreeData(l.list);t.treeData=o,""===t.txnId&&(t.txnId=o[0].id,t.txnName=o[0].text,a=o[0].id);var i=window.setInterval(function(){if(t.$refs.tree.setCurrentKey(a),t.$refs.tree.getCurrentKey()===a){var l=t.$refs.tree.getCurrentNode();switch(e){case"add":var o=null;for(var n in l.children){var s=!0,c=l.children[n];for(var u in r.children){if(r.children[u].id===c.id){s=!1;break}}if(s){o=c;break}}o&&(t.txnId=o.id,t.$refs.tree.setCurrentKey(o.id)),t.expendKey=[l.id];break;case"mod":t.expendKey=[l.fid];break;case"del":var d=t.$refs.tree.data;if(d.length>0){var m=d[0].id;t.expendKey=[r.fid],t.txnId=m,t.$refs.tree.setCurrentKey(m)}break;default:t.expendKey=[l.id]}t.showToolBtn(),window.clearInterval(i)}},100)}},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})},handleNodeClick:function(e,t){this.showToolBtn(),this.txnId=e.id,this.txnName=e.text,this.activeName="trandef",this.tabVisibility={trandefVisibility:!0,tranmdlVisibility:!1,statVisibility:!1,ruleVisibility:!1}},showToolBtn:function(e){if(e||(e=this.$refs.tab.value),"trandef"===e){var t=this.$refs.tree.getCurrentNode();t&&(this.toolBtn.addBtn=!(void 0===t.txnid||null===t.txnid||""===t.txnid.trim()),this.toolBtn.delBtn="T"===t.id)}else this.toolBtn.addBtn=!0,this.toolBtn.delBtn=!0},handleClick:function(e,t){switch(this.tabVisibility.trandefVisibility=!1,this.tabVisibility.tranmdlVisibility=!1,this.tabVisibility.statVisibility=!1,this.tabVisibility.ruleVisibility=!1,e.name){case"trandef":this.tabVisibility.trandefVisibility=!0;break;case"tranmdl":this.tabVisibility.tranmdlVisibility=!0;break;case"stat":this.tabVisibility.statVisibility=!0;break;case"rule":this.tabVisibility.ruleVisibility=!0}this.showToolBtn(e.name)},addFunc:function(){this.$refs.trandef.addFormVisible=!0;var e=this.$refs.tree.getCurrentNode().children;if(void 0===e||0===e.length)this.$refs.trandef.addFormOrder=1;else{var t=0;for(var a in e){var r=e[a];r.onum>t&&(t=r.onum)}this.$refs.trandef.addFormOrder=t+1}},delFunc:function(){var e=this.$refs.tree.getCurrentNode(),t={tab_name:e.id,op:"del",tab_desc:e.tab_desc};this.$refs.trandef.delInfo(t)}},components:{Trandef:Lt,Tranmdl:a("X4nt")(zt,Nt,!1,function(e){a("7bSW")},null,null).exports,Stat:a("X4nt")(At,Bt,!1,function(e){a("SKqd")},"data-v-ad40d75e",null).exports,Rule:a("X4nt")(Mt,jt,!1,function(e){a("plZM")},"data-v-09f317fa",null).exports}},Xt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"min-height":"400px","max-height":"700px"},attrs:{span:6}},[a("section",{directives:[{name:"show",rawName:"v-show",value:!e.readonly,expression:"!readonly"}],staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",staticStyle:{"margin-left":"5px"},attrs:{plain:"",disabled:e.toolBtn.addBtn},on:{click:e.addFunc}},[e._v("新建\n        ")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"0px"},attrs:{plain:"",disabled:e.toolBtn.delBtn},on:{click:e.delFunc}},[e._v("删除\n        ")])],1),e._v(" "),a("section",{staticClass:"section scroll"},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id",props:e.defaultProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),a("el-col",{staticStyle:{"min-height":"400px","max-height":"700px"},attrs:{span:18}},[a("section",{staticClass:"section"},[a("el-tabs",{ref:"tab",on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{staticStyle:{"padding-left":"10px"},attrs:{label:"交易定义",name:"trandef"}},[a("trandef",{ref:"trandef",attrs:{txnId:e.txnId,isVisibility:e.tabVisibility.trandefVisibility,readonly:e.readonly},on:{listenToReloadTree:e.selTree}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"交易模型定义",name:"tranmdl"}},[a("tranmdl",{attrs:{txnId:e.txnId,isVisibility:e.tabVisibility.tranmdlVisibility,txnName:e.txnName,readonly:e.readonly}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"交易统计",name:"stat"}},[a("stat",{attrs:{txnId:e.txnId,isVisibility:e.tabVisibility.statVisibility,readonly:e.readonly}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"交易规则",name:"rule"}},[a("rule",{attrs:{txnId:e.txnId,isVisibility:e.tabVisibility.ruleVisibility,readonly:e.readonly}})],1)],1)],1)])],1)],1)},staticRenderFns:[]};var Kt=a("X4nt")(Ut,Xt,!1,function(e){a("Achy")},null,null).exports,Gt={computed:{notSelectOne:function(){return 1!==this.selectedRows.length}},mounted:function(){this.$nextTick(function(){this.getData()})},data:function(){return{tableData:[]}},methods:{getData:function(){var e=this;H.post({url:"/auth/modelList",param:{},success:function(t){t.page&&(e.tableData=t.page.list)}})},showData:function(e){this.$router.push({name:"authDataList",query:{modelname:e}})}}},Ht={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"模块名称",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showData(t.row.modelname)}}},[e._v(e._s(t.row.modelname))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"count",label:"待授权信息数",align:"left"}})],1)],1)])},staticRenderFns:[]};var Qt=a("X4nt")(Gt,Ht,!1,function(e){a("PYOT")},null,null).exports,Yt={computed:{notSelectOne:function(){return 1!==this.selectedRows.length}},mounted:function(){this.$nextTick(function(){this.getData()})},data:function(){return{tableData:[]}},methods:{getData:function(){var e=this;H.post({url:"/auth/authQuery",param:{},success:function(t){t.page&&(e.tableData=t.page.list)}})},showData:function(e){this.$router.push({name:"authDataListShow",query:{modelname:e}})}}},Zt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"模块名称",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showData(t.row.modelname)}}},[e._v(e._s(t.row.modelname))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"count",label:"授权信息数",align:"left"}})],1)],1)])},staticRenderFns:[]};var Jt=a("X4nt")(Yt,Zt,!1,function(e){a("pWlQ")},null,null).exports,ea={computed:{notSelectOne:function(){return 1!==this.selectedRows.length},notSelect:function(){return 0===this.selectedRows.length},txnnameRowShow:function(){return"名单管理"!==this.modelName},subOperateNumShow:function(){return"名单管理"===this.modelName||"交易配置"===this.modelName},datavalueLink:function(){return!("名单管理"===this.modelName||"交易配置"===this.modelName)}},data:function(){return{modelName:"",tableData:[],dialogTitle:"授权意见",dictDialogVisible:!1,dialogForm:this.initDialogForm(),rules:{auth_status:[{required:!0,message:"请选择是否通过授权",trigger:"blur"}],auth_msg:[{required:!0,message:"请输入授权说明",trigger:"blur"},{max:2048,message:"长度在2048个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectRow:{},selectedRows:[]}},mounted:function(){this.$nextTick(function(){this.modelName=this.$route.query.modelname,this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)}},methods:{initDialogForm:function(){return{auth_status:"1",auth_msg:""}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},toCompare:function(e){var t={operate_name:e.orig_operatename,table_name:e.query_table_name,table_pk:e.query_table_pk,table_pkvalue:e.query_pkvalue,auth_id:e.auth_id,modelName:this.modelName,flag:1};this.$router.push({name:"authDataCompare",query:t})},addData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=[],l=[],o=[],i=[],n=[],s=(t.selectRow,!0),c=!1,u=void 0;try{for(var d,m=f()(t.selectedRows);!(s=(d=m.next()).done);s=!0){var p=d.value;r.push(p.auth_id),l.push(p.funcname),o.push(p.operatedata_value),void 0!==p.txnname&&""!==p.txnname&&i.push(p.txnname),void 0!==p.operatename&&""!==p.operatename&&n.push(p.operatename)}}catch(e){c=!0,u=e}finally{try{!s&&m.return&&m.return()}finally{if(c)throw u}}var h={AUTH_IDS:r.join(","),FUNCNAME:l.join(","),TXNNAME:i.join(","),OPERATENAME:n.join(","),OPERATEDATA_VALUE:o.join("~"),AUTH_STATUS:t.dialogForm.auth_status,AUTH_MSG:t.dialogForm.auth_msg};H.post({url:"/auth/modAuth",param:h,success:function(e){a.getData(),a.$message.success("授权成功"),a.dictDialogVisible=!1}})})},getData:function(){var e=this,t={modelName:this.modelName,pageindex:this.currentPage,pagesize:this.pageSize};H.post({url:"/auth/authList",param:t,success:function(t){t.page&&e.bindGridData(t)}})},showSub:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authSubDataList",query:t})},showLog:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authLogList",query:t})},auth:function(e){this.selectRow=e,this.dialogForm=this.initDialogForm(),this.dictDialogVisible=!0},submitForm:function(e){this.addData(e)},back:function(){this.$router.go(-1)}}},ta={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")]),e._v(" "),a("el-button",{staticClass:"el-icon-tickets",attrs:{plain:"",disabled:e.notSelect},on:{click:e.auth}},[e._v("授权")])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"left",type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.showSub(t.row)}}},[e._v("查看子操作")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.showLog(t.row)}}},[e._v("查看日志")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作数据",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.datavalueLink?a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.toCompare(t.row)}}},[e._v(e._s(t.row.datavalue))]):a("span",[e._v(e._s(t.row.datavalue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"auth_id",label:"授权编号",align:"left"}}),e._v(" "),e.txnnameRowShow?a("el-table-column",{attrs:{prop:"txnname",label:"所属交易",align:"left"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"operatename",label:"操作名称",align:"left"}}),e._v(" "),e.subOperateNumShow?a("el-table-column",{attrs:{prop:"sub_operate_num",label:"子操作个数",align:"left"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"real_name",label:"提交授权人",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"提交授权时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.proposer_time)))])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dictDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dictDialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"是否通过授权:","label-width":e.formLabelWidth,prop:"auth_status"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"2"},model:{value:e.dialogForm.auth_status,callback:function(t){e.$set(e.dialogForm,"auth_status",t)},expression:"dialogForm.auth_status"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"授权说明:","label-width":e.formLabelWidth,prop:"auth_msg"}},[a("el-input",{attrs:{type:"textarea",maxlength:2048},model:{value:e.dialogForm.auth_msg,callback:function(t){e.$set(e.dialogForm,"auth_msg",t)},expression:"dialogForm.auth_msg"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dictDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var aa=a("X4nt")(ea,ta,!1,function(e){a("spKm")},null,null).exports,ra={computed:{notSelectOne:function(){return 1!==this.selectedRows.length},notSelect:function(){return 0===this.selectedRows.length},txnnameRowShow:function(){return"名单管理"!==this.modelName}},data:function(){return{queryFormShow:!1,queryShowForm:{txnIdShow:"",txn_id:"",auth_status:"",queryDate:this.initDateRange()},queryForm:{txn_id:"",auth_status:"",queryDate:this.initDateRange()},txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],modelName:"",tableData:[],currentPage:1,pageSize:10,total:0,selectRow:{},selectedRows:[],authStatusList:[]}},mounted:function(){this.$nextTick(function(){this.modelName=this.$route.query.modelname,this.authStatusList=ue.getCodeItems("tms.auth.authstatus"),this.selTree(),this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderAuthStatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.auth.authstatus",e.toString())},renderOperateResult:function(e){return void 0===e||""===e?"":ue.rendCode("common.operateresult",e.toString())}},methods:{initDateRange:function(){return null},openTxnDialog:function(){this.txntypeDialogVisible=!0},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txnIdShow=l.join(","),this.queryShowForm.txn_id=o.join(",")},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},getData:function(){var e=this,t={modelName:this.modelName,pageindex:this.currentPage,pagesize:this.pageSize};s()(t,this.queryForm),this.queryForm.queryDate&&this.queryForm.queryDate.length>1&&this.queryForm.queryDate[0]&&this.queryForm.queryDate[1]&&(t.startDate=this.queryForm.queryDate[0].getTime(),t.endDate=this.queryForm.queryDate[1].getTime()),H.post({url:"/auth/dataquary",param:t,success:function(t){t.page&&e.bindGridData(t)}})},showLog:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authLogList",query:t})},searchData:function(){s()(this.queryForm,this.queryShowForm),this.getData()},back:function(){this.$router.go(-1)}}},la={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,inline:!0}},[a("el-form-item",{attrs:{label:"所属交易:",prop:"txn_id"}},[a("div",{on:{click:e.openTxnDialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.queryShowForm.txnIdShow,callback:function(t){e.$set(e.queryShowForm,"txnIdShow",t)},expression:"queryShowForm.txnIdShow"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"授权状态:",prop:"auth_status"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.auth_status,callback:function(t){e.$set(e.queryShowForm,"auth_status",t)},expression:"queryShowForm.auth_status"}},e._l(e.authStatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"提交授权时间:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchData}},[e._v("查询")])],1),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1)],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.showLog(t.row)}}},[e._v("查看日志")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作数据",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.operatedata_value))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"orig_operatename",label:"操作名称",align:"left"}}),e._v(" "),e.txnnameRowShow?a("el-table-column",{attrs:{prop:"txnname",label:"所属交易",align:"left"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{label:"授权状态",align:"left",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderAuthStatus")(t.row.auth_status)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"auth_msg",label:"授权说明",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"提交授权时间",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.proposer_time)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"缓存刷新结果",align:"left",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderOperateResult")(t.row.refresh_status)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"refresh_info",label:"缓存刷新信息",align:"left",width:"100"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"所属交易",visible:e.txntypeDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var oa=a("X4nt")(ra,la,!1,function(e){a("FWz2")},null,null).exports,ia={computed:{notSelectOne:function(){return 1!==this.selectedRows.length},txnnameRowShow:function(){return"名单管理"!==this.modelName},subOperateNumShow:function(){return"名单管理"===this.modelName||"交易配置"===this.modelName},datavalueLink:function(){return!("名单管理"===this.modelName||"交易配置"===this.modelName)}},data:function(){return{authId:"",modelName:"",tableData:[],dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectedRows:[]}},mounted:function(){this.$nextTick(function(){this.modelName=this.$route.query.modelName,this.authId=this.$route.query.authId,this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderOperateResult:function(e){return void 0===e||""===e?"":ue.rendCode("common.operateresult",e.toString())}},methods:{handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},getData:function(){var e=this,t={authId:this.authId,pageindex:this.currentPage,pagesize:this.pageSize};H.post({url:"/auth/toLog",param:t,success:function(t){t.page&&e.bindGridData(t)}})},back:function(){this.$router.go(-1)}}},na={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"real_name",label:"操作员",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"login_name",label:"用户名",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.operate_time)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"func_name",label:"所属功能",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作结果",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderOperateResult")(t.row.operate_result)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"operate_data",label:"操作数据",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var sa=a("X4nt")(ia,na,!1,function(e){a("hZda")},null,null).exports,ca={computed:{notSelectOne:function(){return 1!==this.selectedRows.length}},data:function(){return{modelName:"",authId:"",tableData:[],dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectedRows:[]}},mounted:function(){this.$nextTick(function(){this.modelName=this.$route.query.modelName,this.authId=this.$route.query.authId,this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)}},methods:{handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},datavalueLink:function(e){return"TMS_COM_MTRAIN"!==e.table_name},toCompare:function(e){var t={operate_name:e.operate_name,table_name:e.table_name,table_pk:e.table_pk,table_pkvalue:e.table_pkvalue,auth_id:e.auth_id,modelName:this.modelName,flag:1};this.$router.push({name:"authDataCompare",query:t})},getData:function(){var e=this,t={authId:this.authId,pageindex:this.currentPage,pagesize:this.pageSize};H.post({url:"/auth/listSubOperate",param:t,success:function(t){t.page&&e.bindGridData(t)}})},back:function(){this.$router.go(-1)}}},ua={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作数据",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.datavalueLink(t.row)?a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.toCompare(t.row)}}},[e._v(e._s(t.row.operatedata_value))]):a("span",[e._v(e._s(t.row.operatedata_value))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"is_main",label:"是否为初始操作",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operate_name",label:"子操作名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"real_name",label:"操作人",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.operate_time)))])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var da=a("X4nt")(ca,ua,!1,function(e){a("j5m4")},null,null).exports,ma={mounted:function(){this.$nextTick(function(){this.modelName=this.$route.query.modelName,this.tableName=this.$route.query.table_name,this.tablePk=this.$route.query.table_pk,this.tablePkvalue=this.$route.query.table_pkvalue,this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderDate:function(e){return j.renderDate(e)}},data:function(){return{modelName:"",tableName:"",tablePk:"",tablePkvalue:"",tableData:[]}},methods:{getData:function(){var e=this,t={table_name:this.tableName,table_pk:this.tablePk,table_pkvalue:this.tablePkvalue};H.post({url:"/auth/dataCompare",param:t,success:function(t){t.page&&(e.tableData=t.page.list)}})},back:function(){this.$router.go(-1)}}},pa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"col_num",label:"序号",align:"left",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"field_name",label:"属性名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"新值",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{"red-span":t.row.new_value!==t.row.old_value}},["date"===t.row.type?a("span",[e._v(e._s(e._f("renderDate")(t.row.new_value)))]):"datetime"===t.row.type?a("span",[e._v(e._s(e._f("renderDateTime")(t.row.new_value)))]):a("span",[e._v(e._s(t.row.new_value))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"旧值",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{"green-span":t.row.new_value!==t.row.old_value}},["date"===t.row.type?a("span",[e._v(e._s(e._f("renderDate")(t.row.old_value)))]):"datetime"===t.row.type?a("span",[e._v(e._s(e._f("renderDateTime")(t.row.old_value)))]):a("span",[e._v(e._s(t.row.old_value))])])]}}])})],1)],1)])},staticRenderFns:[]};var fa=a("X4nt")(ma,pa,!1,function(e){a("JG4Z")},"data-v-dc87b732",null).exports,ha={computed:{categoryIdReadonly:function(){return"edit"===this.dialogType},notSelectOne:function(){return 1!==this.selectedRows.length}},data:function(){var e=this;return{inline:!0,dialogTitle:"",infoDialogTitle:"",dictDialogVisible:!1,infoDialogVisible:!1,formLabelWidth:"130px",dialogType:"",infoDialogType:"",currentPage:1,pageSize:10,total:0,queryShowForm:{category_id:"",category_name:""},queryForm:{category_id:"",category_name:""},dictData:[],dictInfoData:[],dictInfoShow:!1,selectedRows:[],selectRow:{},showDictInfoRow:{},dictDialogForm:this.initDialogForm(),dictInfoDialogForm:{code_id:"",category_id:"",code_key:"",code_value:"",onum:"",info:""},queryRules:{category_id:[{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],category_name:[{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},rules:{category_id:[{required:!0,message:"请输入代码类别key",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"},{validator:function(t,a,r){"edit"===e.dialogType&&e.selectRow.category_id===a?r():H.post({url:"/codedict/check/categoryId",param:{categoryId:a},success:function(e){if(!1===e.checkresult)return r(new Error("该代码类别key已存在"));r()}})},trigger:"blur"}],category_name:[{required:!0,message:"请输入代码类别value",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],category_sql:[{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],info:[{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},infoRules:{category_id:[{required:!0,message:"请输入代码类别key",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],code_key:[{required:!0,message:"请输入代码key",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],code_value:[{required:!0,message:"请输入代码value",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],onum:[{pattern:/^(0|[1-9]\d{0,2})$/,message:"顺序最多只能输入3位数字"}],info:[{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]}}},mounted:function(){this.$nextTick(function(){this.getData()})},methods:{initDialogForm:function(){return{category_id:"",category_name:"",category_sql:"",info:""}},initInfoDialogForm:function(){return{category_id:"",code_key:"",code_value:"",onum:"",info:""}},searchData:function(e){this.dictInfoShow=!1,s()(this.queryForm,this.queryShowForm),this.getData()},getData:function(){var e=this,t={pageindex:this.currentPage,pagesize:this.pageSize};this.dictInfoShow=!1;var a=j.toggleObjKey(this.queryForm,"upper");s()(t,a),H.post({url:"/codedict/category/list",param:t,success:function(t){t.page&&e.bindGridData(t)}})},addData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictDialogForm;H.post({url:"/codedict/category/add",param:r,success:function(e){a.getData(),a.$message.success("创建成功"),a.dictDialogVisible=!1,ue.getCodeData("reload")}})})},addInfoData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictInfoDialogForm;H.post({url:"/codedict/code/add",param:r,success:function(e){a.handleSelectionChange(a.showDictInfoRow),a.$message.success("创建成功"),a.infoDialogVisible=!1,ue.getCodeData("reload")}})})},delData:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/codedict/category/del",param:{categoryId:e.category_id},success:function(e){t.$message.success("删除成功"),t.getData(),ue.getCodeData("reload")}})})},delInfoData:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/codedict/code/del",param:{codeId:e.code_id},success:function(e){t.$message.success("删除成功"),t.handleSelectionChange(t.showDictInfoRow),ue.getCodeData("reload")}})})},updData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictDialogForm;H.post({url:"/codedict/category/update",param:r,success:function(e){a.getData(),a.$message.success("编辑成功"),a.dictDialogVisible=!1,ue.getCodeData("reload")}})})},updInfoData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictInfoDialogForm;H.post({url:"/codedict/code/update",param:r,success:function(e){a.handleSelectionChange(a.showDictInfoRow),a.$message.success("编辑成功"),a.infoDialogVisible=!1,ue.getCodeData("reload")}})})},showData:function(e){this.$router.push({name:"codeDictInfo",query:{category_id:e.category_id}})},submitForm:function(e){"add"===this.dialogType?this.addData(e):"edit"===this.dialogType&&this.updData(e)},infoSubmitForm:function(e){"add"===this.infoDialogType?this.addInfoData(e):"edit"===this.infoDialogType&&this.updInfoData(e)},bindGridData:function(e){this.dictData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){if(null!=e){this.dictInfoShow=!0,this.showDictInfoRow=e;var t=this,a={categoryId:this.showDictInfoRow.category_id,pageindex:1,pagesize:2147483647};H.post({url:"/codedict/category/codelist",param:a,success:function(e){e.page&&(t.dictInfoData=e.page.list)}})}else this.dictInfoShow=!1},openDialog:function(e,t){this.dialogType=e,"edit"===e?(this.selectRow=t,this.dialogTitle="编辑代码类别",s()(this.dictDialogForm,t)):"add"===e&&(this.dialogTitle="新建代码类别",this.dictDialogForm=this.initDialogForm()),this.dictDialogVisible=!0,this.$refs.dictDialogForm&&this.$refs.dictDialogForm.clearValidate()},openInfoDialog:function(e,t){this.infoDialogType=e,"edit"===e?(this.infoDialogTitle="编辑字典信息",s()(this.dictInfoDialogForm,t)):"add"===e&&(this.infoDialogTitle="新建字典信息",this.dictInfoDialogForm=this.initInfoDialogForm(),this.dictInfoDialogForm.category_id=this.showDictInfoRow.category_id),this.infoDialogVisible=!0,this.$refs.dictInfoDialogForm&&this.$refs.dictInfoDialogForm.clearValidate()}}},ga={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"toolbar"},[a("div",{staticStyle:{float:"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")])],1),e._v(" "),a("div",{staticStyle:{float:"right","margin-right":"10px"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50,placeholder:"请输入搜索内容",clearable:""},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchData("queryShowForm")}},model:{value:e.queryShowForm.category_id,callback:function(t){e.$set(e.queryShowForm,"category_id",t)},expression:"queryShowForm.category_id"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)]),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dictData,"highlight-current-row":""},on:{"current-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openDialog("edit",t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-delete",title:"删除"},on:{click:function(a){e.delData(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"category_id",label:"代码类别key",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"category_name",label:"代码类别value",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),a("el-col",{staticStyle:{"border-right":"1px solid #eee"},attrs:{span:12}},[a("div",{staticClass:"toolbar"},[a("div",{staticStyle:{float:"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openInfoDialog("add")}}},[e._v("新建")])],1)]),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.dictInfoShow,expression:"dictInfoShow"}],staticStyle:{width:"100%"},attrs:{data:e.dictInfoData}},[a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.openInfoDialog("edit",t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-delete",title:"删除"},on:{click:function(a){e.delInfoData(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"code_key",label:"代码key",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code_value",label:"代码value",align:"left"}})],1)],1)])],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dictDialogVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.dictDialogVisible=t}}},[a("el-form",{ref:"dictDialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dictDialogForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"代码类别key:","label-width":e.formLabelWidth,prop:"category_id"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:e.categoryIdReadonly,maxlength:50},model:{value:e.dictDialogForm.category_id,callback:function(t){e.$set(e.dictDialogForm,"category_id",t)},expression:"dictDialogForm.category_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码类别value:","label-width":e.formLabelWidth,prop:"category_name"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictDialogForm.category_name,callback:function(t){e.$set(e.dictDialogForm,"category_name",t)},expression:"dictDialogForm.category_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码类别sql:","label-width":e.formLabelWidth,prop:"category_sql"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictDialogForm.category_sql,callback:function(t){e.$set(e.dictDialogForm,"category_sql",t)},expression:"dictDialogForm.category_sql"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息:","label-width":e.formLabelWidth,prop:"info"}},[a("el-input",{attrs:{type:"textarea",maxlength:200},model:{value:e.dictDialogForm.info,callback:function(t){e.$set(e.dictDialogForm,"info",t)},expression:"dictDialogForm.info"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitForm("dictDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dictDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1),e._v(" "),a("el-dialog",{staticStyle:{"text-align":"left"},attrs:{title:e.infoDialogTitle,visible:e.infoDialogVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.infoDialogVisible=t}}},[a("el-form",{ref:"dictInfoDialogForm",attrs:{model:e.dictInfoDialogForm,rules:e.infoRules}},[a("el-form-item",{attrs:{label:"代码类别key:","label-width":e.formLabelWidth,prop:"category_id"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0,maxlength:50},model:{value:e.dictInfoDialogForm.category_id,callback:function(t){e.$set(e.dictInfoDialogForm,"category_id",t)},expression:"dictInfoDialogForm.category_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码key:","label-width":e.formLabelWidth,prop:"code_key"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictInfoDialogForm.code_key,callback:function(t){e.$set(e.dictInfoDialogForm,"code_key",t)},expression:"dictInfoDialogForm.code_key"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码value:","label-width":e.formLabelWidth,prop:"code_value"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictInfoDialogForm.code_value,callback:function(t){e.$set(e.dictInfoDialogForm,"code_value",t)},expression:"dictInfoDialogForm.code_value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"顺序:","label-width":e.formLabelWidth,prop:"onum"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:3},model:{value:e.dictInfoDialogForm.onum,callback:function(t){e.$set(e.dictInfoDialogForm,"onum",t)},expression:"dictInfoDialogForm.onum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息:","label-width":e.formLabelWidth,prop:"info"}},[a("el-input",{attrs:{type:"textarea",maxlength:200},model:{value:e.dictInfoDialogForm.info,callback:function(t){e.$set(e.dictInfoDialogForm,"info",t)},expression:"dictInfoDialogForm.info"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.infoSubmitForm("dictInfoDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.infoDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var va=a("X4nt")(ha,ga,!1,function(e){a("qWO/")},null,null).exports,ba={computed:{notSelectOne:function(){return 1!==this.selectedRows.length}},data:function(){return{tableData:[],dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectedRows:[],categoryId:"",dictDialogForm:{code_id:"",category_id:"",code_key:"",code_value:"",onum:"",info:""},rules:{category_id:[{required:!0,message:"请输入代码类别key",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],code_key:[{required:!0,message:"请输入代码key",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],code_value:[{required:!0,message:"请输入代码value",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],onum:[{pattern:/^[1-9]\d{0,2}$/,message:"顺序最多只能输入3位数字"}],info:[{max:200,message:"长度在200个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]}}},mounted:function(){this.$nextTick(function(){this.categoryId=this.$route.query.category_id,this.getData()})},methods:{handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},initDialogForm:function(){return{category_id:"",code_key:"",code_value:"",onum:"",info:""}},openDialog:function(e,t){this.dialogType=e,"edit"===e?(this.dialogTitle="编辑字典信息",s()(this.dictDialogForm,t)):"add"===e&&(this.dialogTitle="新建字典信息",this.dictDialogForm=this.initDialogForm(),this.dictDialogForm.category_id=this.categoryId),this.dictDialogVisible=!0,this.$refs.dictDialogForm&&this.$refs.dictDialogForm.clearValidate()},submitForm:function(e){"add"===this.dialogType?this.addData(e):"edit"===this.dialogType&&this.updData(e)},addData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictDialogForm;H.post({url:"/codedict/code/add",param:r,success:function(e){a.getData(),a.$message.success("添加成功"),a.dictDialogVisible=!1}})})},getData:function(){var e=this,t={categoryId:this.categoryId,pageindex:this.currentPage,pagesize:this.pageSize};H.post({url:"/codedict/category/codelist",param:t,success:function(t){t.page&&e.bindGridData(t)}})},delData:function(e){var t=this,a=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/codedict/code/del",param:{codeId:e.code_id},success:function(e){a.$message.success("删除成功"),a.getData()}})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},updData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=t,r=t.dictDialogForm;H.post({url:"/codedict/code/update",param:r,success:function(e){a.getData(),a.$message.success("编辑成功"),a.dictDialogVisible=!1}})})},back:function(){this.$router.push({name:"codedict"})}}},_a={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-back",attrs:{type:"primary"},on:{click:function(t){e.back()}}},[e._v("返回")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.openDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.delData(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"category_id",label:"类别代码",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"category_name",label:"类别名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code_key",label:"代码key",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code_value",label:"代码value",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dictDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dictDialogVisible=t}}},[a("el-form",{ref:"dictDialogForm",attrs:{model:e.dictDialogForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"代码类别key:","label-width":e.formLabelWidth,prop:"category_id"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!0,maxlength:50},model:{value:e.dictDialogForm.category_id,callback:function(t){e.$set(e.dictDialogForm,"category_id",t)},expression:"dictDialogForm.category_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码key:","label-width":e.formLabelWidth,prop:"code_key"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictDialogForm.code_key,callback:function(t){e.$set(e.dictDialogForm,"code_key",t)},expression:"dictDialogForm.code_key"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"代码value:","label-width":e.formLabelWidth,prop:"code_value"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50},model:{value:e.dictDialogForm.code_value,callback:function(t){e.$set(e.dictDialogForm,"code_value",t)},expression:"dictDialogForm.code_value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"顺序:","label-width":e.formLabelWidth,prop:"onum"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:3},model:{value:e.dictDialogForm.onum,callback:function(t){e.$set(e.dictDialogForm,"onum",t)},expression:"dictDialogForm.onum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息:","label-width":e.formLabelWidth,prop:"info"}},[a("el-input",{attrs:{type:"textarea",maxlength:200},model:{value:e.dictDialogForm.info,callback:function(t){e.$set(e.dictDialogForm,"info",t)},expression:"dictDialogForm.info"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dictDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("dictDialogForm")}}},[e._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var ya=a("X4nt")(ba,_a,!1,function(e){a("pp4P")},null,null).exports,Fa=null,xa={computed:{timeCountShow:function(){return 0!==this.timeCount},timeCountStr:function(){var e=0,t=0,a=0;return(e=parseInt(this.timeCount/60/60))<10&&(e="0"+e),(t=parseInt(this.timeCount/60%60))<10&&(t="0"+t),(a=parseInt(this.timeCount%60))<10&&(a="0"+a),e+":"+t+":"+a},IPProgressStatus:function(){return 100===this.IPProgress?"success":""},cityProgressStatus:function(){return 100===this.cityProgress?"success":""},cardProgressStatus:function(){return 100===this.cardProgress?"success":""},mobileProgressStatus:function(){return 100===this.mobileProgress?"success":""}},data:function(){return{timeCount:0,IPProgressShow:!1,cityProgressShow:!1,cardProgressShow:!1,mobileProgressShow:!1,IPProgress:0,cityProgress:0,cardProgress:0,mobileProgress:0,upload_url:"higitech",uploadForm:new FormData,rules:{}}},methods:{submitForm:function(){this.uploadForm=new FormData;var e=!1,t=!1,a=!1,r=!1,l="",o="",i="",n="";try{var s=this.$refs.importIPFile.$data.uploadFiles,c=this.$refs.importCityFile.$data.uploadFiles,u=this.$refs.importCardFile.$data.uploadFiles,d=this.$refs.importMobileFile.$data.uploadFiles;s&&s[0]&&(e=!0,l=s[0].name),c&&c[0]&&(t=!0,o=c[0].name),u&&u[0]&&(a=!0,i=u[0].name),d&&d[0]&&(r=!0,n=d[0].name)}catch(e){console.log(e)}if(e)if(t)if(a)if(r)if(l.endsWith(".csv"))if(o.endsWith(".csv"))if(i.endsWith(".csv"))if(n.endsWith(".csv")){this.$refs.importIPFile.submit(),this.$refs.importCityFile.submit(),this.$refs.importCardFile.submit(),this.$refs.importMobileFile.submit();var m=this;this.progressReset(),this.timeCount=0;try{window.clearInterval(Fa)}catch(e){}e&&(this.IPProgressShow=!0),t&&(this.cityProgressShow=!0),a&&(this.cardProgressShow=!0),r&&(this.mobileProgressShow=!0),H.post({url:"/ip/import",param:m.uploadForm,success:function(e){m.uploadForm=new FormData,H.post({url:"/ip/recordImpInfo",param:{},success:function(){Fa=window.setInterval(m.getImportProgress,1e3)}})},error:function(e){m.uploadForm=new FormData,m.$message.error(e.error),m.progressReset();try{window.clearInterval(Fa)}catch(e){}},fail:function(e){m.uploadForm=new FormData,m.$message.error("导入文件发生错误"),console.log(e),m.progressReset();try{window.clearInterval(Fa)}catch(e){}}})}else this.$message("手机号段文件必须为csv文件");else this.$message("身份证号段文件必须为csv文件");else this.$message("城市代码文件必须为csv文件");else this.$message("IP地址文件必须为csv文件");else this.$message("请选择手机号段文件");else this.$message("请选择身份证号段文件");else this.$message("请选择城市代码文件");else this.$message("请选择IP地址文件")},getImportProgress:function(){var e=this;H.post({url:"/ip/getProgress",param:{},success:function(t){var a=t.errorinfo,r=t.ipprogress,l=t.cityprogress,o=t.cardprogress,i=t.mobileprogress;if(console.log(r+"-"+l+"-"+o+"-"+i),e.IPProgress=r,e.cityProgress=l,e.cardProgress=o,e.mobileProgress=i,j.isEmpty(a)||(e.$message.error(a),console.log("clear timer"),window.clearInterval(Fa)),e.timeCount++,30===e.timeCount&&0===r&&0===l&&0===o&&0===i&&(e.$message.error("导入文件发生错误"),window.clearInterval(Fa)),!j.isEmpty(a)||!(r<100||l<100||o<100||i<100))try{console.log("clear timer"),window.clearInterval(Fa)}catch(e){console.log(e)}}})},progressReset:function(){this.IPProgress=0,this.cityProgress=0,this.cardProgress=0,this.mobileProgress=0,this.IPProgressShow=!1,this.cityProgressShow=!1,this.cardProgressShow=!1,this.mobileProgressShow=!1},importIPFile:function(e){return this.uploadForm.append("importIPFile",e),this.$refs.importIPFile.abort(),!1},importCityFile:function(e){return this.uploadForm.append("importCityFile",e),this.$refs.importIPFile.abort(),!1},importCardFile:function(e){return this.uploadForm.append("importCardFile",e),this.$refs.importIPFile.abort(),!1},importMobileFile:function(e){return this.uploadForm.append("importMobileFile",e),this.$refs.importIPFile.abort(),!1},importIPFileFinish:function(){return!1},importCityFileFinish:function(){return!1},importCardFileFinish:function(){return!1},importMobileFileFinish:function(){return!1}}},wa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("IP地址维护")]),e._v(" "),a("el-row",{staticClass:"ip-content-box"},[e.timeCountShow?a("el-alert",{staticClass:"time-tip",attrs:{title:e.timeCountStr,type:"success",closable:!1,center:""}}):e._e(),e._v(" "),a("el-col",{attrs:{span:6}},[e.IPProgressShow?a("el-progress",{staticClass:"progress-box",attrs:{"text-inside":!0,"stroke-width":18,percentage:e.IPProgress,status:e.IPProgressStatus}}):e._e(),e._v(" "),a("el-container",[a("el-main",[a("el-upload",{ref:"importIPFile",staticClass:"ip-file-upload ipaddr-fie-upload",attrs:{accept:".csv",name:"importIPFileInput",drag:"",action:e.upload_url,limit:1,multiple:!1,"auto-upload":!1,"before-upload":e.importIPFile,"on-success":e.importIPFileFinish,"on-error":e.importIPFileFinish}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[a("em",[e._v("IP地址文件")])]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请导入csv文件")])])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[e.cityProgressShow?a("el-progress",{staticClass:"progress-box",attrs:{"text-inside":!0,"stroke-width":18,percentage:e.cityProgress,status:e.cityProgressStatus}}):e._e(),e._v(" "),a("el-container",[a("el-main",[a("el-upload",{ref:"importCityFile",staticClass:"ip-file-upload ipaddr-fie-upload",attrs:{accept:".csv",name:"importCityFileInput",drag:"",action:e.upload_url,limit:1,multiple:!1,"auto-upload":!1,"before-upload":e.importCityFile,"on-success":e.importCityFileFinish,"on-error":e.importCityFileFinish}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[a("em",[e._v("城市代码文件")])]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请导入csv文件")])])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[e.cardProgressShow?a("el-progress",{staticClass:"progress-box",attrs:{"text-inside":!0,"stroke-width":18,percentage:e.cardProgress,status:e.cardProgressStatus}}):e._e(),e._v(" "),a("el-container",[a("el-main",[a("el-upload",{ref:"importCardFile",staticClass:"ip-file-upload ipaddr-fie-upload",attrs:{accept:".csv",name:"importCardFileInput",drag:"",action:e.upload_url,limit:1,multiple:!1,"auto-upload":!1,"before-upload":e.importCardFile,"on-success":e.importCardFileFinish,"on-error":e.importCardFileFinish}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[a("em",[e._v("身份证号段文件")])]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请导入csv文件")])])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[e.mobileProgressShow?a("el-progress",{staticClass:"progress-box",attrs:{"text-inside":!0,"stroke-width":18,percentage:e.mobileProgress,status:e.mobileProgressStatus}}):e._e(),e._v(" "),a("el-container",[a("el-main",[a("el-upload",{ref:"importMobileFile",staticClass:"ip-file-upload ipaddr-fie-upload",attrs:{accept:".csv",name:"importMobileFileInput",drag:"",action:e.upload_url,limit:1,multiple:!1,"auto-upload":!1,"before-upload":e.importMobileFile,"on-success":e.importMobileFileFinish,"on-error":e.importMobileFileFinish}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[a("em",[e._v("手机号段文件")])]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请导入csv文件")])])],1)],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"50px"}},[a("el-button",{staticClass:"submit-btn",attrs:{type:"success"},on:{click:function(t){e.submitForm()}}},[e._v("确定")])],1),e._v(" "),a("el-row")],1)},staticRenderFns:[]};var Da=a("X4nt")(xa,wa,!1,function(e){a("70tm")},null,null).exports,Sa={created:function(){this.selLog(),this.selFunc()},methods:{handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selLog()},handleCurrentChange:function(e){this.currentPage=e,this.selLog()},handleSelectionChange:function(e){this.multipleSelection=e},bindGridData:function(e){this.logData=e.page.list,this.currentPage=e.page.index,this.pagesize=e.page.size,this.total=e.page.total},selFunc:function(){var e=this;H.post({url:"/func/getAll",success:function(t){e.funcList=t.row},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},searchFunc:function(){this.currentPage=1,this.selLog()},selLog:function(){var e=this,t="",a="";null!==e.value6&&e.value6.length>0&&(t=e.value6[0],a=e.value6[1]),H.post({url:"/log/list",loading:!0,param:{operator_name:e.logForm.operator_name,operate_func:e.logForm.operate_func,operate_time:t,end_time:a,pageindex:e.currentPage,pagesize:e.pagesize},success:function(t){t.page&&e.bindGridData(t)},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},formatterDate:function(e,t){return j.renderDateTime(e.operate_time)},renderResult:function(e,t){return ue.rendCode("common.operateresult",e.operate_result)}},data:function(){return{inline:!0,value6:[],funcList:[],logForm:{operator_name:"",operate_func:"",operate_time:"",end_time:""},logData:[],currentPage:1,pagesize:10,total:0,formLabelWidth:"100px",multipleSelection:[],flag:""}}},ka={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-form",{staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"80px",model:e.logForm,inline:e.inline}},[a("el-form-item",{attrs:{label:"操作员",prop:"operator_name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.logForm.operator_name,callback:function(t){e.$set(e.logForm,"operator_name",t)},expression:"logForm.operator_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"操作时间",prop:"real_name"}},[a("el-date-picker",{attrs:{clearable:"",type:"datetimerange","range-separator":"到","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.value6,callback:function(t){e.value6=t},expression:"value6"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{attrs:{data:e.logData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"real_name",label:"操作员",align:"left",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"login_name",label:"用户名",align:"left",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operate_time",label:"操作时间",align:"left",width:"135",formatter:e.formatterDate}}),e._v(" "),a("el-table-column",{attrs:{prop:"func_name",label:"所属功能",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operate_result",label:"操作结果",align:"left",width:"120",formatter:e.renderResult}}),e._v(" "),a("el-table-column",{attrs:{prop:"operate_data",label:"操作数据",align:"left"}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var Ca=a("X4nt")(Sa,ka,!1,function(e){a("bXmk")},null,null).exports,Ta={computed:{tableDataShow:function(){var e=this.queryShowForm.app_id;return this.tableData.filter(function(t){return!(""!==e&&!t.app_id.includes(e))})}},data:function(){return{activeName:"appList",tableData:[],dialogTitle:"授权意见",dialogVisible:!1,dialogForm:this.initDialogForm(),dialogFormSureBtnDisabled:!1,rules:{app_id:[{required:!0,message:"请输入采集方式代码",trigger:"blur"},{pattern:/^(0|[1-9]\d{0,9})$/,message:"采集方式代码最多只能输入10位数字"}],app_name:[{required:!0,message:"请输入采集方式名称",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],max_devices:[{required:!0,message:"请输入最多设备数",trigger:"blur"},{pattern:/^(0|[1-9]\d{0,2})$/,message:"最多设备数只能为1~100间的整数",trigger:"blur"},{validator:this.maxDevicesValid,trigger:"blur"}],threshold:[{required:!0,message:"请输入匹配阀值",trigger:"blur"},{validator:this.thresholdValid,trigger:"blur"}],cookiename:[{required:!0,message:"请输入Cookie名称",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],token_type:[{required:!0,message:"请输入设备标识生成方式",trigger:"blur"}]},queryShowForm:{app_id:""},queryForm:{app_id:""},formLabelWidth:"150px",dialogType:"",currentPage:1,pageSize:10,total:0,selectRow:{},selectedRows:[],tokenList:[]}},mounted:function(){this.$nextTick(function(){this.tokenList=ue.getCodeItems("tms.dfp.token_type"),this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},tokenRender:function(e){return void 0===e||""===e?"":ue.rendCode("tms.dfp.token_type",e)}},methods:{handleTabClick:function(e,t){},maxDevicesValid:function(e,t,a){if(parseInt(t)>100||parseInt(t)<1)return a(new Error("最多设备数只能为1~100间的整数"));a()},thresholdValid:function(e,t,a){if(!j.isNumber(t,"+","2")||parseFloat(t)>1||parseFloat(t)<=0)return a(new Error("匹配阀值需是0-1之间的两位小数"));a()},initDialogForm:function(){return{app_id:"",app_name:"",max_devices:"",threshold:"",cookiename:"",token_type:""}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.dialogFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.dialogForm),r=j.toggleObjKey(r,"upper");var l={},o="提交成功";"add"===t.dialogType?(l.add=[r],o="创建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,H.post({url:"/dfp/appSave",param:i,success:function(e){a.getData(),a.$message.success(o),a.dialogVisible=!1,a.dialogFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.dialogFormSureBtnDisabled=!1},fail:function(){a.dialogFormSureBtnDisabled=!1}})})},getData:function(){var e=this;H.post({url:"/dfp/appList",param:{},success:function(t){t.row&&t.row.length>0&&(e.tableData=t.row)}})},delData:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r=j.toggleObjKey(e,"upper");a.del=[r];var l={};l.postData=a;var o=t;H.post({url:"/dfp/appSave",param:l,success:function(e){o.getData(),o.$message.success("删除成功")}})})},showSub:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authSubDataList",query:t})},openDialog:function(e,t){this.dialogType=e;var a=this;"add"===e?this.dialogForm=this.initDialogForm():"edit"===e&&(this.dialogForm=this.initDialogForm(),s()(this.dialogForm,t)),this.dialogVisible=!0,setTimeout(function(){a.$refs.dialogForm&&a.$refs.dialogForm.clearValidate()},100)},searchData:function(){},back:function(){this.$router.go(-1)}}},Ia={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-input",{staticClass:"dfp-app-list-form-item",attrs:{placeholder:"采集方式名称","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.app_id,callback:function(t){e.$set(e.queryShowForm,"app_id",t)},expression:"queryShowForm.app_id"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataShow}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.openDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.delData(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"app_id",label:"采集方式代码",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"app_name",label:"采集方式名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"max_devices",label:"最多设备数",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"threshold",label:"匹配阀值",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cookiename",label:"Cookie名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"设备标识生成方式",align:"left",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("tokenRender")(t.row.token_type)))])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,rules:e.rules}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.dialogType,expression:"dialogType == 'add'"}],attrs:{label:"采集方式代码:","label-width":e.formLabelWidth,prop:"app_id"}},[a("el-input",{model:{value:e.dialogForm.app_id,callback:function(t){e.$set(e.dialogForm,"app_id",t)},expression:"dialogForm.app_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"采集方式名称:","label-width":e.formLabelWidth,prop:"app_name"}},[a("el-input",{model:{value:e.dialogForm.app_name,callback:function(t){e.$set(e.dialogForm,"app_name",t)},expression:"dialogForm.app_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"最多设备数:","label-width":e.formLabelWidth,prop:"max_devices"}},[a("el-input",{model:{value:e.dialogForm.max_devices,callback:function(t){e.$set(e.dialogForm,"max_devices",t)},expression:"dialogForm.max_devices"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"匹配阀值:","label-width":e.formLabelWidth,prop:"threshold"}},[a("el-input",{model:{value:e.dialogForm.threshold,callback:function(t){e.$set(e.dialogForm,"threshold",t)},expression:"dialogForm.threshold"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Cookie名称:","label-width":e.formLabelWidth,prop:"cookiename"}},[a("el-input",{model:{value:e.dialogForm.cookiename,callback:function(t){e.$set(e.dialogForm,"cookiename",t)},expression:"dialogForm.cookiename"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备标识生成方式:","label-width":e.formLabelWidth,prop:"token_type"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.dialogForm.token_type,callback:function(t){e.$set(e.dialogForm,"token_type",t)},expression:"dialogForm.token_type"}},e._l(e.tokenList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large",disabled:e.dialogFormSureBtnDisabled},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var $a={computed:{tableDataShow:function(){var e=this.queryShowForm.prop_name;return this.tableData.filter(function(t){return!(""!==e&&!t.prop_name.includes(e))})}},data:function(){return{activeName:"appList",tableData:[],dialogTitle:"授权意见",dialogVisible:!1,dialogForm:this.initDialogForm(),dialogFormSureBtnDisabled:!1,rules:{prop_id:[{required:!0,message:"请输入属性ID",trigger:"blur"},{pattern:/^(0|[1-9]\d{0,9})$/,message:"属性ID最多只能输入10位数字"}],prop_name:[{required:!0,message:"请输入属性名称",trigger:"blur"},{max:60,message:"长度在60个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}],prop_comment:[{max:500,message:"长度在500个字符以内",trigger:"blur"},{validator:ee.checkFormSpecialCode,trigger:"blur"}]},queryShowForm:{prop_name:""},queryForm:{prop_name:""},formLabelWidth:"150px",dialogType:"",currentPage:1,pageSize:10,total:0,selectRow:{},selectedRows:[],tokenList:[]}},mounted:function(){this.$nextTick(function(){this.tokenList=ue.getCodeItems("tms.dfp.token_type"),this.getData()})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},tokenRender:function(e){return void 0===e||""===e?"":ue.rendCode("tms.dfp.token_type",e)}},methods:{handleTabClick:function(e,t){},maxDevicesValid:function(e,t,a){if(parseInt(t)>100||parseInt(t)<1)return a(new Error("最多设备数只能为1~100间的整数"));a()},thresholdValid:function(e,t,a){if(!j.isNumber(t,"+","2")||parseFloat(t)>1||parseFloat(t)<=0)return a(new Error("匹配阀值需是0-1之间的两位小数"));a()},initDialogForm:function(){return{prop_id:"",prop_name:"",prop_comment:""}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.dialogFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.dialogForm),r=j.toggleObjKey(r,"upper");var l={},o="提交成功";"add"===t.dialogType?(l.add=[r],o="创建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,H.post({url:"/dfp/proSave",param:i,success:function(e){a.getData(),a.$message.success(o),a.dialogVisible=!1,a.dialogFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.dialogFormSureBtnDisabled=!1},fail:function(){a.dialogFormSureBtnDisabled=!1}})})},getData:function(){var e=this;H.post({url:"/dfp/proList",param:{},success:function(t){t.row&&t.row.length>0&&(e.tableData=t.row)}})},delData:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r=j.toggleObjKey(e,"upper");a.del=[r];var l={};l.postData=a;var o=t;H.post({url:"/dfp/proSave",param:l,success:function(e){o.getData(),o.$message.success("删除成功")}})})},showSub:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authSubDataList",query:t})},openDialog:function(e,t){this.dialogType=e;var a=this;"add"===e?this.dialogForm=this.initDialogForm():"edit"===e&&(this.dialogForm=this.initDialogForm(),s()(this.dialogForm,t)),this.dialogVisible=!0,setTimeout(function(){a.$refs.dialogForm&&a.$refs.dialogForm.clearValidate()},100)},searchData:function(){},back:function(){this.$router.go(-1)}}},La={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-input",{staticClass:"dfp-app-list-form-item",attrs:{placeholder:"属性名称","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.prop_name,callback:function(t){e.$set(e.queryShowForm,"prop_name",t)},expression:"queryShowForm.prop_name"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataShow}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.openDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.delData(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_id",label:"属性ID",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_name",label:"属性名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_comment",label:"属性说明",align:"left"}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,rules:e.rules}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.dialogType,expression:"dialogType == 'add'"}],attrs:{label:"属性ID:","label-width":e.formLabelWidth,prop:"prop_id"}},[a("el-input",{model:{value:e.dialogForm.prop_id,callback:function(t){e.$set(e.dialogForm,"prop_id",t)},expression:"dialogForm.prop_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"属性名称:","label-width":e.formLabelWidth,prop:"prop_name"}},[a("el-input",{model:{value:e.dialogForm.prop_name,callback:function(t){e.$set(e.dialogForm,"prop_name",t)},expression:"dialogForm.prop_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"属性说明:","label-width":e.formLabelWidth,prop:"prop_comment"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.dialogForm.prop_comment,callback:function(t){e.$set(e.dialogForm,"prop_comment",t)},expression:"dialogForm.prop_comment"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large",disabled:e.dialogFormSureBtnDisabled},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var qa={computed:{tableDataShow:function(){var e=this.queryShowForm.app_id;return this.tableData.filter(function(t){return!(""!==e&&!t.app_id.includes(e))})},propIdListShow:function(){var e=new Ye.a,t=[],a=this.dialogForm.app_id,r=this.dialogForm.prop_id;if(!a)return[];var l=!0,o=!1,i=void 0;try{for(var n,s=f()(this.tableData);!(l=(n=s.next()).done);l=!0){var c=n.value;c.app_id===a&&t.push(c)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}var u=!0,d=!1,m=void 0;try{for(var p,h=f()(this.propIdList);!(u=(p=h.next()).done);u=!0){var g=p.value,v=g.prop_id;v===r&&e.add(g);var b=!1,_=!0,y=!1,F=void 0;try{for(var x,w=f()(t);!(_=(x=w.next()).done);_=!0){if(v===x.value.prop_id){b=!0;break}}}catch(e){y=!0,F=e}finally{try{!_&&w.return&&w.return()}finally{if(y)throw F}}b||e.add(g)}}catch(e){d=!0,m=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw m}}return xt()(e)},storeColumnListShow:function(){var e=this.dialogForm.app_id;if(!e)return[];var t=this.dialogForm.storecolumn,a=new Ye.a,r=[],l=!0,o=!1,i=void 0;try{for(var n,s=f()(this.tableData);!(l=(n=s.next()).done);l=!0){var c=n.value;c.app_id===e&&r.push(c)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}var u=!0,d=!1,m=void 0;try{for(var p,h=f()(this.storeColumnList);!(u=(p=h.next()).done);u=!0){var g=p.value,v=g.value;v===t&&a.add(g);var b=!1,_=!0,y=!1,F=void 0;try{for(var x,w=f()(r);!(_=(x=w.next()).done);_=!0){if(v===x.value.storecolumn){b=!0;break}}}catch(e){y=!0,F=e}finally{try{!_&&w.return&&w.return()}finally{if(y)throw F}}b||a.add(g)}}catch(e){d=!0,m=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw m}}return xt()(a)}},data:function(){return{activeName:"appList",tableData:[],dialogTitle:"授权意见",dialogVisible:!1,dialogForm:this.initDialogForm(),dialogFormSureBtnDisabled:!1,rules:{app_id:[{required:!0,message:"请输入采集方式",trigger:"blur"}],prop_id:[{required:!0,message:"请输入属性名称",trigger:"blur"}],weight:[{required:!0,message:"请输入权重",trigger:"blur"},{validator:this.weightValid,trigger:"blur"}],storecolumn:[{required:!0,message:"请输入存储字段",trigger:"blur"}],is_token:[{required:!0,message:"请输入参与指纹运算",trigger:"blur"}]},queryShowForm:{app_id:""},queryForm:{app_id:""},formLabelWidth:"150px",dialogType:"",currentPage:1,pageSize:10,total:0,selectRow:{},selectedRows:[],isTokenList:[],storeColumnList:[],appIdList:[],propIdList:[]}},mounted:function(){this.$nextTick(function(){this.storeColumnList=ue.getCodeItems("tms.dfp.storecolumn"),this.isTokenList=ue.getCodeItems("tms.dfp.is_token"),this.getData()})},watch:{"dialogForm.prop_id":function(e){""===e&&(this.dialogForm.prop_name="",this.dialogForm.prop_comment="");var t=!0,a=!1,r=void 0;try{for(var l,o=f()(this.propIdList);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.prop_id===e){this.dialogForm.prop_name=i.prop_name,this.dialogForm.prop_comment=i.prop_comment;break}}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}}},filters:{renderDateTime:function(e){return j.renderDateTime(e)}},methods:{handleTabClick:function(e,t){},weightValid:function(e,t,a){return parseFloat(t)>=0?String(Math.round(parseFloat(t))).length>8?a(new Error("权重不能超过8位数")):void a():a(new Error("权重必须为正数"))},formatter:function(e,t,a){switch(t.property){case"is_token":return ue.rendCode("tms.dfp.is_token",a);case"storecolumn":return ue.rendCode("tms.dfp.storecolumn",a);default:return a}},maxDevicesValid:function(e,t,a){if(parseInt(t)>100||parseInt(t)<1)return a(new Error("最多设备数只能为1~100间的整数"));a()},thresholdValid:function(e,t,a){if(!j.isNumber(t,"+","2")||parseFloat(t)>1||parseFloat(t)<=0)return a(new Error("匹配阀值需是0-1之间的两位小数"));a()},initDialogForm:function(){return{id:"",prop_name:"",app_id:"",app_name:"",prop_id:"",weight:"",storecolumn:"",is_token:"",prop_comment:""}},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleSelectionChange:function(e){this.selectedRows=e},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.dialogFormSureBtnDisabled=!0;var a=t,r={};s()(r,t.dialogForm),r=j.toggleObjKey(r,"upper");var l={},o="提交成功";"add"===t.dialogType?(l.add=[r],o="创建成功"):(l.mod=[r],o="编辑成功");var i={};i.postData=l,H.post({url:"/dfp/appProSave",param:i,success:function(e){a.getData(),a.$message.success(o),a.dialogVisible=!1,a.dialogFormSureBtnDisabled=!1},error:function(e){e&&e.error&&"object"===m()(e.error)&&e.error.length>0?a.$message.error(e.error.join("|")):a.$message.error(e.error),a.dialogFormSureBtnDisabled=!1},fail:function(){a.dialogFormSureBtnDisabled=!1}})})},getData:function(){var e=this;H.post({url:"/dfp/appProList",param:{},success:function(t){t.row&&t.row.length>0&&(e.tableData=t.row,e.appIdList=t.applist,e.propIdList=t.prolist)}})},delData:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={},r=j.toggleObjKey(e,"upper");a.del=[r];var l={};l.postData=a;var o=t;H.post({url:"/dfp/appProSave",param:l,success:function(e){o.getData(),o.$message.success("删除成功")}})})},showSub:function(e){var t={authId:e.auth_id,modelName:this.modelName};this.$router.push({name:"authSubDataList",query:t})},openDialog:function(e,t){this.dialogType=e;var a=this;"add"===e?(this.selectRow={},this.dialogForm=this.initDialogForm()):"edit"===e&&(this.dialogForm=this.initDialogForm(),s()(this.dialogForm,t),this.selectRow=t),this.dialogVisible=!0,setTimeout(function(){a.$refs.dialogForm&&a.$refs.dialogForm.clearValidate()},100)},searchData:function(){},back:function(){this.$router.go(-1)}}},Pa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left",height:"30px"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")]),e._v(" "),a("div",{staticStyle:{float:"right","padding-right":"15px"}},[a("el-input",{staticClass:"dfp-app-list-form-item",attrs:{placeholder:"采集方式名称","auto-complete":"off",clearable:""},model:{value:e.queryShowForm.app_id,callback:function(t){e.$set(e.queryShowForm,"app_id",t)},expression:"queryShowForm.app_id"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),a("div",[a("section",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataShow}},[a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.openDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.delData(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"app_name",label:"采集方式",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_name",label:"属性名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"weight",label:"权重",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"storecolumn",label:"存储字段",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"is_token",label:"参与指纹运算",align:"left",formatter:e.formatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"prop_comment",label:"属性说明",align:"left"}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"采集方式:","label-width":e.formLabelWidth,prop:"app_id"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.dialogForm.app_id,callback:function(t){e.$set(e.dialogForm,"app_id",t)},expression:"dialogForm.app_id"}},e._l(e.appIdList,function(e){return a("el-option",{key:e.app_id,attrs:{label:e.app_name,value:e.app_id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"属性名称:","label-width":e.formLabelWidth,prop:"prop_id"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.dialogForm.prop_id,callback:function(t){e.$set(e.dialogForm,"prop_id",t)},expression:"dialogForm.prop_id"}},e._l(e.propIdListShow,function(e){return a("el-option",{key:e.prop_id,attrs:{label:e.prop_name,value:e.prop_id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"权重:","label-width":e.formLabelWidth,prop:"weight"}},[a("el-input",{model:{value:e.dialogForm.weight,callback:function(t){e.$set(e.dialogForm,"weight",t)},expression:"dialogForm.weight"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"存储字段:","label-width":e.formLabelWidth,prop:"storecolumn"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.dialogForm.storecolumn,callback:function(t){e.$set(e.dialogForm,"storecolumn",t)},expression:"dialogForm.storecolumn"}},e._l(e.storeColumnListShow,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"参与指纹运算:","label-width":e.formLabelWidth,prop:"is_token"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.dialogForm.is_token,callback:function(t){e.$set(e.dialogForm,"is_token",t)},expression:"dialogForm.is_token"}},e._l(e.isTokenList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"属性说明:","label-width":e.formLabelWidth,prop:"prop_comment"}},[a("el-input",{attrs:{type:"textarea",readonly:!0},model:{value:e.dialogForm.prop_comment,callback:function(t){e.$set(e.dialogForm,"prop_comment",t)},expression:"dialogForm.prop_comment"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large",disabled:e.dialogFormSureBtnDisabled},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var Ra={computed:{},data:function(){return{activeName:"appList"}},mounted:function(){this.$nextTick(function(){})},methods:{handleTabClick:function(e,t){}},components:{"dfp-app-list":a("X4nt")(Ta,Ia,!1,function(e){a("YgSa")},null,null).exports,"dfp-pro-list":a("X4nt")($a,La,!1,function(e){a("nX4X")},null,null).exports,"dfp-app-pro-list":a("X4nt")(qa,Pa,!1,function(e){a("U3Vv")},null,null).exports}},Va={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"采集方式定义",name:"appList"}},[a("dfp-app-list")],1),e._v(" "),a("el-tab-pane",{attrs:{label:"属性定义",name:"proList"}},[a("dfp-pro-list")],1),e._v(" "),a("el-tab-pane",{attrs:{label:"采集方式属性定义",name:"appProList"}},[a("dfp-app-pro-list")],1)],1)],1)},staticRenderFns:[]};var za=a("X4nt")(Ra,Va,!1,function(e){a("7tEl")},null,null).exports,Na={created:function(){var e=this,t=function(e){return new Fe.a(function(t,a){H.get({url:e,model:H.model.timer,success:function(e){e.list?t(e.list):t([])},error:function(e){a(new Error(e))},fail:function(e){a(new Error(e))}})})},a=t("/timer/classes").then(function(t){e.classOptions=t},function(e){console.error(e)}),r=t("/timer/groups").then(function(t){e.groupOptions=t},function(e){console.error(e)});Fe.a.all([a,r]).then(function(t){e.sel()}).catch(function(e){console.error(e)})},data:function(){var e=this;return{timeData:[],formLabelWidth:"100px",timerForm:{name:"",cron:"",className:"",group:"",status:"PAUSED",description:""},timerDialogForm:{name:"",cron:"",className:"",group:"",status:"NORMAL",description:""},flag:"",timerDialogVisible:!1,rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{max:50,message:"长度在50个字符以内",trigger:"blur"},{validator:function(t,a,r){return"add"===e.flag?e.checkName(e.timerDialogForm.name,r):"edit"===e.flag&&a!==e.selectedRow.name?e.checkName(e.timerForm.name,r):r()},trigger:"blur"}],cron:[{required:!0,message:"请输入时间表达式",trigger:"blur"},{validator:function(e,t,a){H.post({url:"/timer/check-cron",model:H.model.timer,param:{cron:t},success:function(e){!1===e.row?a(new Error("请输入合法的时间表达式")):a()}})},trigger:"blur"}],className:[{required:!0,message:"请选择所属类",trigger:"blur"}],group:[{max:100,message:"长度在100个字符以内",trigger:"blur"}],description:[{max:300,message:"长度在300个字符以内",trigger:"blur"}]},selectedRow:{},classOptions:[],groupOptions:[],clearable:!0,closeOnClickModal:!1}},methods:{sel:function(){var e=this;H.get({url:"/timer/list",model:H.model.timer,toLowerCase:!1,success:function(t){t.list&&(e.timeData=t.list,t.list.length>0&&e.setCurrent(e.timeData[0]))}})},add:function(){var e=this;H.post({url:"/timer/add",loading:!0,model:H.model.timer,param:this.timerDialogForm,success:function(t){e.$message({message:"创建成功",type:"success"}),e.timerDialogVisible=!1,e.sel()}})},update:function(){var e=this;H.post({url:"/timer/update",loading:!0,model:H.model.timer,param:this.timerForm,success:function(t){e.$message({message:"编辑成功",type:"success"}),e.sel()}})},handleDelete:function(e,t){var a=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/timer/delete",loading:!0,model:H.model.timer,param:t,success:function(e){a.$message({type:"success",message:"删除成功"}),a.sel()}})}).catch(function(){})},openDialog:function(e){this.flag=e,"add"===e&&(this.$refs.timerDialogForm?this.$refs.timerDialogForm.resetFields():this.timerDialogForm={name:"",cron:"",className:"",group:"",status:"NORMAL",description:""}),this.timerDialogVisible=!0,this.$refs.timerDialogForm&&this.$refs.timerDialogForm.clearValidate()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"add"===t.flag?t.add():"edit"===t.flag&&t.update()})},checkName:function(e,t){H.post({url:"/timer/check-name",model:H.model.timer,param:{name:e},success:function(e){!1===e.row?t(new Error("任务名称已被占用")):t()}})},statusChange:function(){var e=this;"NORMAL"===this.timerForm.status?H.post({url:"/timer/resume",model:H.model.timer,param:{taskId:this.timerForm.taskid},success:function(t){e.$message({message:"启动成功",type:"success"})}}):"PAUSED"===this.timerForm.status&&H.post({url:"/timer/pause",model:H.model.timer,param:{taskId:this.timerForm.taskid},success:function(t){e.$message({message:"停止成功",type:"success"})}})},formatter:function(e,t,a){switch(t.property){case"className":return j.renderCellValue(this.classOptions,a);case"group":return j.renderCellValue(this.groupOptions,a);default:return a}},handleCurrentChange:function(e){this.flag="edit",this.timerForm=s()({},e),this.selectedRow=e},setCurrent:function(e){this.$refs.timeTable.setCurrentRow(e)}}},Ea={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"min-height":"85%"}},[a("div",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){e.openDialog("add")}}},[e._v("新建")])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{height:"400px"},attrs:{span:9}},[a("section",{staticClass:"section"},[a("el-table",{ref:"timeTable",attrs:{data:e.timeData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"text",title:"删除"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"任务名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"group",label:"任务组",align:"left",formatter:e.formatter}})],1)],1)]),e._v(" "),a("el-col",{staticStyle:{height:"400px"},attrs:{span:15}},[a("section",{staticClass:"section"},[a("el-form",{ref:"timerForm",staticStyle:{margin:"20px 20px 0px 10px"},attrs:{model:e.timerForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"任务名称","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.timerForm.name,callback:function(t){e.$set(e.timerForm,"name",t)},expression:"timerForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"时间表达式","label-width":e.formLabelWidth,prop:"cron"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.timerForm.cron,callback:function(t){e.$set(e.timerForm,"cron",t)},expression:"timerForm.cron"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"类名","label-width":e.formLabelWidth,prop:"className"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},model:{value:e.timerForm.className,callback:function(t){e.$set(e.timerForm,"className",t)},expression:"timerForm.className"}},e._l(e.classOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"任务组","label-width":e.formLabelWidth,prop:"group"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},model:{value:e.timerForm.group,callback:function(t){e.$set(e.timerForm,"group",t)},expression:"timerForm.group"}},e._l(e.groupOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启动","label-width":e.formLabelWidth,prop:"status"}},[a("el-switch",{attrs:{"active-value":"NORMAL","inactive-value":"PAUSED"},on:{change:function(t){e.statusChange()}},model:{value:e.timerForm.status,callback:function(t){e.$set(e.timerForm,"status",t)},expression:"timerForm.status"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息","label-width":e.formLabelWidth,prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.timerForm.description,callback:function(t){e.$set(e.timerForm,"description",t)},expression:"timerForm.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("timerForm")}}},[e._v("保 存")])],1)],1)],1)])],1),e._v(" "),a("el-dialog",{attrs:{title:"新建定时任务",visible:e.timerDialogVisible,width:"35%","close-on-click-modal":e.closeOnClickModal},on:{"update:visible":function(t){e.timerDialogVisible=t}}},[a("el-form",{ref:"timerDialogForm",attrs:{model:e.timerDialogForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"任务名称","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.timerDialogForm.name,callback:function(t){e.$set(e.timerDialogForm,"name",t)},expression:"timerDialogForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"时间表达式","label-width":e.formLabelWidth,prop:"cron"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.timerDialogForm.cron,callback:function(t){e.$set(e.timerDialogForm,"cron",t)},expression:"timerDialogForm.cron"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"类名","label-width":e.formLabelWidth,prop:"className"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},model:{value:e.timerDialogForm.className,callback:function(t){e.$set(e.timerDialogForm,"className",t)},expression:"timerDialogForm.className"}},e._l(e.classOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"任务组","label-width":e.formLabelWidth,prop:"group"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:e.clearable},model:{value:e.timerDialogForm.group,callback:function(t){e.$set(e.timerDialogForm,"group",t)},expression:"timerDialogForm.group"}},e._l(e.groupOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启动","label-width":e.formLabelWidth,prop:"status"}},[a("el-switch",{attrs:{"active-value":"NORMAL","inactive-value":"PAUSED"},model:{value:e.timerDialogForm.status,callback:function(t){e.$set(e.timerDialogForm,"status",t)},expression:"timerDialogForm.status"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述信息","label-width":e.formLabelWidth,prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.timerDialogForm.description,callback:function(t){e.$set(e.timerDialogForm,"description",t)},expression:"timerDialogForm.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("timerDialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{on:{click:function(t){e.timerDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)},staticRenderFns:[]};var Oa=a("X4nt")(Na,Ea,!1,function(e){a("hkA8")},null,null).exports,Aa=a("cUn4"),Ba=a.n(Aa),Wa={computed:{selectOneNode:function(){return 1===this.selectedTreeData.length},canNotDel:function(){return 1!==this.selectedTreeData.length||this.selectedTreeData[0].root},showRight:function(){return!!this.selectedNode}},data:function(){return{formLabelWidth:"60px",dialogTitle:"",uploadDialogTitle:"导入配置",uploadAction:"/zookeeper/import",uploadDialogVisible:!1,uploadDialogTips:"",dialogVisible:!1,dialogType:"",dialogForm:{label:"",value:""},uploadForm:new FormData,rules:{label:[{required:!0,message:"请输入Name",trigger:"blur"}]},treeProps:{label:"label",children:"children",isLeaf:"leaf"},selectedNode:null,tableData:[],selectedTableData:[],selectedTreeData:[],treeParentMap:new Ba.a}},mounted:function(){this.$nextTick(function(){})},methods:{initDialogForm:function(){return{label:"",value:""}},importNode:function(){this.uploadDialogTips=this.selectedTreeData[0].path,this.uploadForm=new FormData,this.uploadDialogVisible=!0},importFile:function(e){return this.uploadForm.append("zkFile",e),this.$refs.importFile.abort(),!1},importFileFinish:function(){},submitUploadForm:function(){var e=this;this.uploadForm=new FormData;var t=!1,a="";try{var r=this.$refs.importFile.$data.uploadFiles;if(r&&r[0]&&(t=!0,a=r[0].name),!t)return void this.$message.info("请选择配置文件");if(!a.endsWith(".properties"))return void this.$message.info("配置文件必须为properties文件");this.$refs.importFile.submit(),this.uploadForm.append("rootPath",this.uploadDialogTips),H.post({url:"/zookeeper/import",loading:!0,param:e.uploadForm,success:function(t){e.uploadForm=new FormData,e.uploadDialogVisible=!1,e.$message({message:"导入成功",type:"success",duration:1e3,onClose:function(){window.location.reload()}})},error:function(t){e.uploadForm=new FormData,e.$message.error(t.error)},fail:function(t){e.uploadForm=new FormData,e.$message.error("导入文件发生错误"),console.log(t)}})}catch(e){console.log(e)}},addNode:function(){this.dialogForm=this.initDialogForm(),this.dialogVisible=!0,this.dialogType="node"},addPropNode:function(){this.dialogForm=this.initDialogForm(),this.dialogVisible=!0,this.dialogType="prop"},editPropNode:function(e){s()(this.dialogForm,e),this.dialogVisible=!0,this.dialogType="propEdit"},delNode:function(){var e=this;if(!this.selectedTreeData[0].isRoot){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/zookeeper/delete",loading:!0,param:[{path:e.selectedTreeData[0].path}],success:function(e){t.$message.success("删除成功");var a=t.treeParentMap.get(t.selectedTreeData[0].path).subList,r=[],l=!0,o=!1,i=void 0;try{for(var n,s=f()(a);!(l=(n=s.next()).done);l=!0){var c=n.value;c.path!==t.selectedTreeData[0].path&&r.push(c)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}t.treeParentMap.get(t.selectedTreeData[0].path).subList=r,t.$refs.tree.updateKeyChildren(t.treeParentMap.get(t.selectedTreeData[0].path).path,r),t.selectedTreeData=[],t.tableData=[]}})})}},delPropData:function(){var e=this,t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=[],r=!0,l=!1,o=void 0;try{for(var i,n=f()(e.selectedTableData);!(r=(i=n.next()).done);r=!0){var s=i.value;a.push({path:s.path})}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}H.post({url:"/zookeeper/delete",loading:!0,param:a,success:function(e){t.$message.success("删除成功");var r=[],l=!0,o=!1,i=void 0;try{for(var n,s=f()(t.tableData);!(l=(n=s.next()).done);l=!0){var c=n.value,u=!1,d=!0,m=!1,p=void 0;try{for(var h,g=f()(a);!(d=(h=g.next()).done);d=!0){var v=h.value;c.path===v.path&&(u=!0)}}catch(e){m=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(m)throw p}}u||r.push(c)}}catch(e){o=!0,i=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw i}}t.tableData=r}})})},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e)if("node"===t.dialogType){var r=t.selectedTreeData[0].path+"/"+t.dialogForm.label,l={label:t.dialogForm.label,path:r,type:t.dialogType};H.post({url:"/zookeeper/set",loading:!0,param:l,success:function(e){a.dialogVisible=!1;var t=a.selectedTreeData[0].subList;t&&(t.push({label:a.dialogForm.label,path:r}),a.$refs.tree.updateKeyChildren(a.selectedTreeData[0].path,t)),a.treeParentMap.set(r,a.selectedTreeData[0]),a.$message.success("新建成功")}})}else{var o=t.selectedNode.path+"/"+t.dialogForm.label,i={label:t.dialogForm.label,value:t.dialogForm.value,path:o,type:t.dialogType};H.post({url:"/zookeeper/set",loading:!0,param:i,success:function(e){if(a.dialogVisible=!1,"prop"===a.dialogType)a.tableData.push({label:i.label,path:i.path,value:i.value}),a.$message.success("新建成功");else{var t=!0,r=!1,l=void 0;try{for(var n,s=f()(a.tableData);!(t=(n=s.next()).done);t=!0){var c=n.value;if(c.path===o){c.value=i.value;break}}}catch(e){r=!0,l=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw l}}a.$message.success("编辑成功")}}})}})},nodeClick:function(e){this.selectedNode=e,this.tableData=e.valueList},treeCheckChange:function(e,t,a){this.selectedTreeData=this.$refs.tree.getCheckedNodes()},tableSelectionChange:function(e){this.selectedTableData=e},loadNode1:function(e,t){var a=this,r={};0!==e.level&&(r=e.data),H.post({url:"/zookeeper/list",param:r,success:function(r){if(0===e.level)t(r.row);else{var l=r.row,o=[],i=[],n=!0,s=!1,c=void 0;try{for(var u,d=f()(l);!(n=(u=d.next()).done);n=!0){var m=u.value;a.treeParentMap.set(m.path,e.data),m.leaf?o.push(m):i.push(m)}}catch(e){s=!0,c=e}finally{try{!n&&d.return&&d.return()}finally{if(s)throw c}}e.data.valueList=o,e.data.subList=i,a.tableData=o,t(i)}}})}}},Ma={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"min-height":"400px","max-height":"700px"},attrs:{span:6}},[a("section",{staticClass:"toolbar"},[a("el-button",{staticClass:"el-icon-plus",staticStyle:{"margin-left":"5px"},attrs:{plain:"",disabled:!e.selectOneNode},on:{click:e.addNode}},[e._v("新建\n        ")]),e._v(" "),a("el-button",{staticClass:"el-icon-upload2",staticStyle:{"margin-left":"5px"},attrs:{plain:"",disabled:!e.selectOneNode},on:{click:e.importNode}},[e._v("导入\n        ")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"0px"},attrs:{plain:"",disabled:e.canNotDel},on:{click:e.delNode}},[e._v("删除\n        ")])],1),e._v(" "),a("section",{staticClass:"section scroll"},[a("el-tree",{ref:"tree",attrs:{props:e.treeProps,load:e.loadNode1,"check-strictly":!0,"node-key":"path","show-checkbox":"",lazy:""},on:{"node-click":e.nodeClick,"check-change":e.treeCheckChange}})],1)]),e._v(" "),a("el-col",{staticStyle:{"min-height":"400px","max-height":"700px"},attrs:{span:18}},[a("section",{staticClass:"table"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showRight,expression:"showRight"}]},[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:e.addPropNode}},[e._v("新建")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{plain:"",disabled:0===this.selectedTableData.length},on:{click:e.delPropData}},[e._v("删除")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.tableSelectionChange}},[a("el-table-column",{attrs:{align:"left",type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.editPropNode(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"label",label:"Name",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"value",label:"Value",align:"left"}})],1)],1)])])],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"330px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"dialogForm",staticStyle:{"text-align":"left"},attrs:{model:e.dialogForm,rules:e.rules,inline:!0}},[a("el-form-item",{attrs:{label:"Name:","label-width":e.formLabelWidth,prop:"label"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:50,readonly:"propEdit"===e.dialogType},model:{value:e.dialogForm.label,callback:function(t){e.$set(e.dialogForm,"label",t)},expression:"dialogForm.label"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"prop"===e.dialogType||"propEdit"===e.dialogType,expression:"dialogType === 'prop' || dialogType === 'propEdit'"}],attrs:{label:"Value:","label-width":e.formLabelWidth,prop:"value"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.dialogForm.value,callback:function(t){e.$set(e.dialogForm,"value",t)},expression:"dialogForm.value"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitForm("dialogForm")}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.uploadDialogTitle,visible:e.uploadDialogVisible,"close-on-click-modal":!1,width:"400px"},on:{"update:visible":function(t){e.uploadDialogVisible=t}}},[a("h3",[e._v("正在导入的节点路径为"),a("span",{staticStyle:{color:"red"}},[e._v(e._s(e.uploadDialogTips))])]),e._v(" "),a("el-upload",{ref:"importFile",attrs:{accept:".properties",name:"importFileInput",drag:"",action:e.uploadAction,limit:1,multiple:!1,"auto-upload":!1,"before-upload":e.importFile,"on-success":e.importFileFinish,"on-error":e.importFileFinish}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[a("em",[e._v("导入配置文件")])]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请导入properties文件")])]),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitUploadForm}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.uploadDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var ja=a("X4nt")(Wa,Ma,!1,function(e){a("xSip")},null,null).exports,Ua={data:function(){var e=this;return{channelData:[],dialogVisible:!1,dialogTitle:"",channelForm:{op:"",channelid:"",channelname:"",orderby:""},rules:{channelid:[{required:!0,message:"请输入渠道编号",trigger:"blur"},{max:32,message:"长度在32个字符以内",trigger:"blur"},{validator:ee.checkFormEnSpecialCharacter,trigger:"blur"},{validator:function(t,a,r){var l=e.channelData,o=a;if("add"===e.channelForm.op)for(var i in l)if(l[i].channelid===o)return r(new Error("渠道编号已被占用"));r()},trigger:"blur"}],channelname:[{required:!0,message:"请输入渠道名称",trigger:"blur"},{max:32,message:"长度在32个字符以内",trigger:"blur"},{validator:ee.checkFormZhSpecialCharacter,trigger:"blur"},{validator:function(t,a,r){var l=e.channelData,o=e.channelForm.op,i=e.channelForm.channelid,n=a;if("add"===o){for(var s in l)if(l[s].channelname===n)return r(new Error("渠道名称已被占用"))}else for(var c in l){var u=l[c];if(u.channelname===n&&u.channelid!==i)return r(new Error("渠道名称已被占用"))}r()},trigger:"blur"}],orderby:[{required:!0,message:"请输入顺序",trigger:"blur"},{validator:function(t,a,r){if(!/^(0|[1-9]\d{0,3})$/.test(a))return r(new Error("[顺序]必须为小于10000的正整数"));var l=e.channelData,o=e.channelForm.op,i=e.channelForm.channelid,n=Number(a);if("add"===o){for(var s in l)if(l[s].orderby===n)return r(new Error("顺序已被占用"))}else for(var c in l){var u=l[c];if(u.orderby===n&&u.channelid!==i)return r(new Error("顺序已被占用"))}r()},trigger:"blur"}]}}},computed:{addFlag:function(){return"add"===this.channelForm.op}},mounted:function(){this.$nextTick(function(){this.selChannel()})},methods:{selChannel:function(){var e=this;H.post({url:"/channel/list",loading:!0,success:function(t){e.channelData=t.list},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})},resetForm:function(){this.$refs.channelForm.resetFields()},addChannel:function(){this.dialogVisible=!0,this.dialogTitle="新建渠道";var e=this.getChannelOrder(),t=this.makeChannelId(e);this.channelForm={op:"add",channelid:t,channelname:"",orderby:e},this.rules.channelid[0].required=!0},editChannel:function(e){var t=this;t.dialogVisible=!0,t.dialogTitle="编辑渠道",t.channelForm.op="mod",t.rules.channelid[0].required=!1,H.post({url:"/channel/getChannel",loading:!0,param:{channelid:e.channelid},success:function(e){t.channelForm=e.info}})},submitFunc:function(){var e=this;this.$refs.channelForm.validate(function(t){if(t){var a="",r="";"add"===e.channelForm.op?(a="/channel/add",r="创建"):(a="/channel/mod",r="编辑"),H.post({url:a,loading:!0,param:e.channelForm,success:function(t){switch(t.result){case"success":e.$message.success(r+"成功"),e.dialogVisible=!1;break;case"failed":e.$message.success(r+"失败"),e.dialogVisible=!1;break;case"has":e.$message.success("属性重复");break;case"error":e.$message.success(r+"异常"),e.dialogVisible=!1;break;default:e.$message.success(r+"异常"),e.dialogVisible=!1}e.selChannel()},fail:function(t){t.response.data.message&&e.$message.error(t.response.data.message)}})}})},delChannel:function(e){var t=this;this.$confirm("确定删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){H.post({url:"/channel/del",loading:!0,param:{channelid:e.channelid},success:function(e){switch(e.result){case"sucess":t.$message.success("删除成功");break;case"has":t.$message.info("渠道被交易使用，不允许删除");break;case"failed":t.$message.error("删除失败");break;default:t.$message.error("删除异常")}t.selChannel()},fail:function(e){e.response.data.message&&t.$message.error(e.response.data.message)}})}).catch(function(){})},getChannelInfo:function(e){var t=this.channelData,a=[];for(var r in t){var l=t[r];"add"===e.op?l.channelid!==e.channelid&&l.channelname!==e.channelname&&l.orderby!==e.orderby||a.push(l):l.channelid===e.channelid||l.channelname!==e.channelname&&l.orderby!==e.orderby||(a.push(l),console.info(l))}return console.info(t),a},getChannelOrder:function(){var e=1,t=this.channelData;for(var a in t){var r=t[a],l=Number(r.orderby);l>e&&(e=l)}return e+1},makeChannelId:function(e){var t="CH";return e<10&&(t+="0"),t+=e}}},Xa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"toolbar"},[a("div",{staticStyle:{float:"left"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:e.addChannel}},[e._v("新建")])],1)])])],1),e._v(" "),a("section",{staticClass:"table"},[a("el-table",{attrs:{data:e.channelData}},[a("el-table-column",{attrs:{label:"操作",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){e.editChannel(t.row)}}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0===t.row.num,expression:"scope.row.num === 0"}],attrs:{type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(a){e.delChannel(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"channelid",label:"渠道编号",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channelname",label:"渠道名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"orderby",label:"顺序",align:"left"}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[a("el-form",{ref:"channelForm",attrs:{model:e.channelForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"渠道编号",prop:"channelid"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:!e.addFlag,clearable:""},model:{value:e.channelForm.channelid,callback:function(t){e.$set(e.channelForm,"channelid",t)},expression:"channelForm.channelid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"渠道名称",prop:"channelname"}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.channelForm.channelname,callback:function(t){e.$set(e.channelForm,"channelname",t)},expression:"channelForm.channelname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"顺序",prop:"orderby"}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.channelForm.orderby,callback:function(t){e.$set(e.channelForm,"orderby",t)},expression:"channelForm.orderby"}})],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary",size:"large"},on:{click:e.submitFunc}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"large"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var Ka=a("X4nt")(Ua,Xa,!1,function(e){a("5b3A")},null,null).exports,Ga=[{label:"未认证",value:"2"},{label:"认证通过",value:"1"},{label:"认证未通过",value:"0"}],Ha=[{label:"否",value:0},{label:"是",value:1}],Qa={data:function(){var e=this;return{txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],tnxEventTableData:[],queryFormShow:!1,queryShowForm:{ruleid:"",txncode:"",userid:"",username:"",ipaddr:"",deviceid:"",sessionid:"",txntype:"",disposal:"",iseval:"",iscorrect:"",confirmrisk:"",txnstatus:"",txntime:[],operate_time:"",end_time:"",location:"",countrycode:"",regioncode:"",citycode:""},isAssessmentList:Ha,isCorrectList:Ga,confirmRiskList:[],countryCodeList:[],regionCodeList:[],cityCodeList:[],txnStatusList:[],disposalList:[],currentPage:1,pageSize:10,total:0,selectedRow:{},showItem:["operate","strategy","count","user","device","deviceFinger","session"],defaultTab:"",queryRules:{txncode:[{max:32,message:"长度在32个字符以内",trigger:"blur"}],userid:[{max:32,message:"长度在32个字符以内",trigger:"blur"}],username:[{max:32,message:"长度在32个字符以内",trigger:"blur"}],ipaddr:[{max:16,message:"长度在16个字符以内",trigger:"blur"},{validator:ee.checkFormIp,trigger:"blur"}],deviceid:[{max:32,message:"长度在32个字符以内",trigger:"blur"}],sessionid:[{max:64,message:"长度在64个字符以内",trigger:"blur"}],txntime:[{validator:function(t,a,r){var l=e;if(!l.queryShowForm.txncode){if(!a||2!==a.length)return r(new Error("流水号与时间范围不能同时为空"));var o=a[0],i=(a[1]-o)/864e5,n=l.queryShowForm.userid,s=l.queryShowForm.username,c=l.queryShowForm.ipaddr,u=l.queryShowForm.deviceid,d=l.queryShowForm.sessionid;if(n||s||c||u||d){if(i>30)return r(new Error("时间范围不能超过1个月(30天)"))}else if(i>1)return r(new Error("时间范围不能超过1天"))}r()},trigger:"blur"}]}}},created:function(){var e=this.initDateRange();this.queryShowForm.txntime=e,this.getTxnEventTableData({operate_time:e[0].getTime(),end_time:e[1].getTime(),pageindex:1,pagesize:this.pageSize})},mounted:function(){this.$nextTick(function(){var e=this;e.txnStatusList=ue.getCodeItems("tms.common.txnstatus"),e.confirmRiskList=ue.getCodeItems("tms.confirmrisk.status"),this.selTree(),H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countryCodeList=t.row}}),H.post({url:"/rule/disposal",param:{},success:function(t){e.disposalList=t.row}})})},watch:{"queryShowForm.txntime":function(e){var t="",a="";e&&2===e.length&&(t=e[0].getTime(),a=e[1].getTime()),this.queryShowForm.operate_time=t,this.queryShowForm.end_time=a},"queryShowForm.countrycode":function(e){var t=this;t.searchForm.regioncode="",H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regionCodeList=e.row}})},"queryShowForm.regioncode":function(e){var t=this;t.searchForm.citycode="",H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.cityCodeList=e.row}})}},methods:{bindGridData:function(e){this.tnxEventTableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getTxnEventTableData()},handleCurrentChange:function(e){this.currentPage=e,this.getTxnEventTableData()},getTxnEventTableData:function(e){var t=this,a=e||s()({pageindex:this.currentPage,pagesize:this.pageSize},t.queryShowForm);H.post({url:"/query/tnxEvent/result",loading:!0,param:a,success:function(e){!0===e.success&&t.bindGridData(e)},fail:function(e){console.error("请求操作时间列表失败",e)},error:function(e){console.error("请求操作时间列表异常",e)}})},searchData:function(){var e=this;this.$refs.queryShowForm.validate(function(t){if(!t)return e.$message("查询条件不符合规则，请按提示重新输入"),!1;var a=s()({pageindex:1,pagesize:e.pageSize},e.queryShowForm);e.getTxnEventTableData(a)})},initDateRange:function(){var e=new Date;return e.setHours((new Date).getHours()-1),[e,new Date]},renderDateTime:function(e,t,a){return j.renderDateTime(a)},renderIsEval:function(e,t,a){switch(a){case"0":return"未评估";case"1":return"已评估";default:return""}},renderIsModelRisk:function(e,t,a){switch(a){case"0":return"规则风险";case"1":return"模型风险";default:return""}},renderIsCorrect:function(e,t,a){switch(a){case"0":return"认证未通过";case"1":return"认证通过";case"2":return"未认证";default:return""}},renderConfirmRisk:function(e,t,a){return ue.rendCode("tms.confirmrisk.status",a)},renderTxnStatus:function(e,t,a){return ue.rendCode("tms.common.txnstatus",a)},queryTxnInfo:function(e,t){var a=this;a.selectedRow=e,a.defaultTab=t;var r=0,l=window.setInterval(function(){t===a.defaultTab&&(window.clearInterval(l),a.$refs.txnDetail.open()),r>10&&a.$message("网络异常，请刷新后重试"),r++},100)},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txntype=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a}},components:{"txn-detail":Ue}},Ya={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],staticClass:"more-query"},[a("el-form",{ref:"queryShowForm",attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户号:",prop:"userid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.userid,callback:function(t){e.$set(e.queryShowForm,"userid",t)},expression:"queryShowForm.userid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户名称:",prop:"username"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.username,callback:function(t){e.$set(e.queryShowForm,"username",t)},expression:"queryShowForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"IP地址:",prop:"ipaddr"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.ipaddr,callback:function(t){e.$set(e.queryShowForm,"ipaddr",t)},expression:"queryShowForm.ipaddr"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备信息:",prop:"deviceid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.deviceid,callback:function(t){e.$set(e.queryShowForm,"deviceid",t)},expression:"queryShowForm.deviceid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"会话标识:",prop:"sessionid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.sessionid,callback:function(t){e.$set(e.queryShowForm,"sessionid",t)},expression:"queryShowForm.sessionid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"监控操作:",prop:"txntype"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.queryShowForm.txntype,callback:function(t){e.$set(e.queryShowForm,"txntype",t)},expression:"queryShowForm.txntype"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"处置方式:",prop:"disposal"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.disposal,callback:function(t){e.$set(e.queryShowForm,"disposal",t)},expression:"queryShowForm.disposal"}},e._l(e.disposalList,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否评估:",prop:"iseval"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.iseval,callback:function(t){e.$set(e.queryShowForm,"iseval",t)},expression:"queryShowForm.iseval"}},e._l(e.isAssessmentList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"认证状态:",prop:"iscorrect"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.iscorrect,callback:function(t){e.$set(e.queryShowForm,"iscorrect",t)},expression:"queryShowForm.iscorrect"}},e._l(e.isCorrectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"人工确认风险:",prop:"confirmrisk"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.confirmrisk,callback:function(t){e.$set(e.queryShowForm,"confirmrisk",t)},expression:"queryShowForm.confirmrisk"}},e._l(e.confirmRiskList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"操作状态:",prop:"txnstatus"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.txnstatus,callback:function(t){e.$set(e.queryShowForm,"txnstatus",t)},expression:"queryShowForm.txnstatus"}},e._l(e.txnStatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围:",prop:"txntime"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.txntime,callback:function(t){e.$set(e.queryShowForm,"txntime",t)},expression:"queryShowForm.txntime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.countrycode,callback:function(t){e.$set(e.queryShowForm,"countrycode",t)},expression:"queryShowForm.countrycode"}},e._l(e.countryCodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.regioncode,callback:function(t){e.$set(e.queryShowForm,"regioncode",t)},expression:"queryShowForm.regioncode"}},e._l(e.regionCodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.citycode,callback:function(t){e.$set(e.queryShowForm,"citycode",t)},expression:"queryShowForm.citycode"}},e._l(e.cityCodeList,function(e){return a("el-option",{key:e.citycode,attrs:{label:e.cityname,value:e.citycode}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchData}},[e._v("搜索")])],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.queryFormShow,expression:"!queryFormShow"}],staticClass:"toolbar"},[a("el-form",{ref:"queryShowForm",staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"时间范围:",prop:"txntime"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.txntime,callback:function(t){e.$set(e.queryShowForm,"txntime",t)},expression:"queryShowForm.txntime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{attrs:{data:e.tnxEventTableData}},[a("el-table-column",{attrs:{prop:"txncode",label:"流水号",align:"left",fixed:"","min-width":"120px","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row,"operate")}}},[e._v(e._s(t.row.txncode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userid",label:"客户号",align:"left",fixed:"","min-width":"115px","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row,"user")}}},[e._v(e._s(t.row.userid))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"sessionid",label:"会话标识",align:"left","min-width":"100px","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row,"session")}}},[e._v(e._s(t.row.sessionid))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控操作",align:"left","min-width":"100px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txntime",label:"操作时间",align:"left",formatter:e.renderDateTime,"min-width":"100px","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"location",label:"地理信息",align:"left","min-width":"100px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceid",label:"设备信息",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row,"device")}}},[e._v(e._s(t.row.deviceid))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ipaddr",label:"IP地址",align:"left","min-width":"112px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"iseval",label:"是否评估",align:"left",formatter:e.renderIsEval}}),e._v(" "),a("el-table-column",{attrs:{prop:"ismodelrisk",label:"风险类型",align:"left",formatter:e.renderIsModelRisk}}),e._v(" "),a("el-table-column",{attrs:{prop:"hitrulenum",label:"规则命中数",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.queryTxnInfo(t.row,"strategy")}}},[e._v(e._s(t.row.hitrulenum))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"score",label:"风险分值",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"iscorrect",label:"认证状态",align:"left",formatter:e.renderIsCorrect}}),e._v(" "),a("el-table-column",{attrs:{prop:"disposal",label:"处置方式",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"confirmrisk",label:"人工确认风险",align:"left",formatter:e.renderConfirmRisk,"min-width":"105px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnstatus",label:"操作状态",align:"left",formatter:e.renderTxnStatus}})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"监控交易",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("txn-detail",{ref:"txnDetail",attrs:{txn:e.selectedRow,defaultTab:e.defaultTab,showItem:e.showItem}})],1)},staticRenderFns:[]};var Za=a("X4nt")(Qa,Ya,!1,function(e){a("mIwb")},"data-v-ac4b0166",null).exports,Ja=[{label:"未认证",value:"2"},{label:"认证通过",value:"1"},{label:"认证未通过",value:"0"}],er={name:"alarmEventQuery",data:function(){return{txntypeDialogVisible:!1,infoDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],queryFormShow:!1,queryShowForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryForm:{txncode:"",userid:"",username:"",deviceid:"",ipaddr:"",txntype:"",txntypeShow:"",disposal:"",iscorrect:"",txnstatus:"",psstatus:"",countrycode:"",regioncode:"",citycode:"",queryDate:this.initDateRange()},queryRules:{ipaddr:[{validator:ee.checkFormIp,trigger:"blur"}]},dialogTitle:"",dictDialogVisible:!1,formLabelWidth:"130px",dialogType:"",currentPage:1,pageSize:10,total:0,selectedRow:{},tabActiveName:"operate",tableData:[],txntypeList:[],disposalList:[],iscorrectList:Ja,txnstatusList:[],psstatusList:[],countrycodeList:[],regioncodeList:[],citycodeList:[]}},watch:{"queryShowForm.countrycode":function(e){var t=this;t.searchForm.regioncode="",H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regioncodeList=e.row}})},"queryShowForm.regioncode":function(e){var t=this;t.searchForm.citycode="",H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.citycodeList=e.row}})}},mounted:function(){this.$nextTick(function(){var e=this;this.initSelectData().then(function(){H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countrycodeList=t.row}})}).then(this.getData())})},filters:{renderDateTime:function(e){return j.renderDateTime(e)},renderTxnstatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.common.txnstatus",e)},renderIscorrect:function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=f()(Ja);!(t=(l=o.next()).done);t=!0){var i=l.value;if(i.value===e)return i.label}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return""},renderPsStatus:function(e){return void 0===e||""===e?"":ue.rendCode("tms.alarm.process.status",e)}},methods:{initDateRange:function(){var e=new Date;return e.setHours((new Date).getHours()-1),[e,new Date]},initSelectData:function(){this.txnstatusList=ue.getCodeItems("tms.common.txnstatus"),this.psstatusList=ue.getCodeItems("tms.alarm.process.status");var e=this;return this.selTree(),H.post({url:"/rule/disposal",param:{},success:function(t){e.disposalList=t.row}}),new Fe.a(function(e,t){e()})},searchData:function(e){var t=this;this.$refs.queryShowForm.validate(function(e){e&&(s()(t.queryForm,t.queryShowForm),t.getData())})},getData:function(){var e=this,t={pageindex:this.currentPage,pagesize:this.pageSize,queryId:4004};s()(t,this.queryForm),this.queryForm.queryDate&&this.queryForm.queryDate.length>1&&(t.startDate=this.queryForm.queryDate[0].getTime(),t.endDate=this.queryForm.queryDate[1].getTime()),H.post({url:"/query/alarmEvent/result",model:H.model.dualaudit,param:t,success:function(t){t.page&&e.bindGridData(t)}})},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.queryShowForm.txntypeShow=l.join(","),this.queryShowForm.txntype=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeList=t.list,e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},showAlarmEventInfo:function(e){this.selectedRow=e,this.infoDialogVisible=!0;this.$refs.txnDetail.open()},handleInfoOpen:function(){},setQueryShowForm:function(e){this.queryShowForm=e}},components:{"txn-detail":Ue}},tr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.queryFormShow,expression:"queryFormShow"}],staticClass:"more-query"},[a("el-form",{ref:"queryShowForm",staticStyle:{"text-align":"left"},attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,rules:e.queryRules,inline:!0}},[a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户号:",prop:"userid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.userid,callback:function(t){e.$set(e.queryShowForm,"userid",t)},expression:"queryShowForm.userid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户名称:",prop:"username"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.username,callback:function(t){e.$set(e.queryShowForm,"username",t)},expression:"queryShowForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备标识:",prop:"deviceid"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.deviceid,callback:function(t){e.$set(e.queryShowForm,"deviceid",t)},expression:"queryShowForm.deviceid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"IP地址:",prop:"ipaddr"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.ipaddr,callback:function(t){e.$set(e.queryShowForm,"ipaddr",t)},expression:"queryShowForm.ipaddr"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"监控交易:",prop:"txntypeShow"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.queryShowForm.txntypeShow,callback:function(t){e.$set(e.queryShowForm,"txntypeShow",t)},expression:"queryShowForm.txntypeShow"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"处置方式:",prop:"disposal"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.disposal,callback:function(t){e.$set(e.queryShowForm,"disposal",t)},expression:"queryShowForm.disposal"}},e._l(e.disposalList,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处置结果:",prop:"iscorrect"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.iscorrect,callback:function(t){e.$set(e.queryShowForm,"iscorrect",t)},expression:"queryShowForm.iscorrect"}},e._l(e.iscorrectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"操作状态:",prop:"txnstatus"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.txnstatus,callback:function(t){e.$set(e.queryShowForm,"txnstatus",t)},expression:"queryShowForm.txnstatus"}},e._l(e.txnstatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处理状态:",prop:"psstatus"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},model:{value:e.queryShowForm.psstatus,callback:function(t){e.$set(e.queryShowForm,"psstatus",t)},expression:"queryShowForm.psstatus"}},e._l(e.psstatusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.countrycode,callback:function(t){e.$set(e.queryShowForm,"countrycode",t)},expression:"queryShowForm.countrycode"}},e._l(e.countrycodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.regioncode,callback:function(t){e.$set(e.queryShowForm,"regioncode",t)},expression:"queryShowForm.regioncode"}},e._l(e.regioncodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryShowForm.citycode,callback:function(t){e.$set(e.queryShowForm,"citycode",t)},expression:"queryShowForm.citycode"}},e._l(e.citycodeList,function(e){return a("el-option",{key:e.citycode,attrs:{label:e.cityname,value:e.citycode}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.queryFormShow,expression:"!queryFormShow"}],staticClass:"toolbar"},[a("el-form",{ref:"queryShowForm",staticClass:"toolbar-form",attrs:{"label-position":"right","label-width":"120px",model:e.queryShowForm,inline:!0}},[a("el-form-item",{attrs:{label:"时间范围:",prop:"queryDate"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryShowForm.queryDate,callback:function(t){e.$set(e.queryShowForm,"queryDate",t)},expression:"queryShowForm.queryDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"流水号:",prop:"txncode"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",maxlength:32,clearable:""},model:{value:e.queryShowForm.txncode,callback:function(t){e.$set(e.queryShowForm,"txncode",t)},expression:"queryShowForm.txncode"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.queryFormShow=!e.queryFormShow}}},[e._v("更多")]),e._v(" "),a("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"section"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"流水号",align:"left","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showAlarmEventInfo(t.row)}}},[e._v(e._s(t.row.txncode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userid",label:"客户号",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"客户名称",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控交易",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.txntime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作状态",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderTxnstatus")(t.row.txnstatus)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"disposal",label:"处置方式",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"oper_name",label:"处理人员",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"处理时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.opertime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"audit_name",label:"审核人员",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{label:"审核时间",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderDateTime")(t.row.audittime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"处理状态",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("renderPsStatus")(t.row.psstatus)))])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"监控交易",visible:e.txntypeDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("txn-detail",{ref:"txnDetail",attrs:{txn:e.selectedRow}})],1)},staticRenderFns:[]};var ar=a("X4nt")(er,tr,!1,function(e){a("Wh1g")},"data-v-0de8bf5e",null).exports;var rr={GenOption:function(e){var t=e.op_legend_data,a=e.op_x_data,r=e.op_series,l=e.chartID||"chartdiv",o=e.magicType||["line","bar","stack","tiled"],i={title:e.title||{},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{x:"left",data:t},toolbox:{show:!0,orient:"vertical",x:"right",y:"center",feature:{dataView:{show:!0,readOnly:!0},magicType:{show:!0,type:o},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:e.xAxis||[{type:"category",axisLabel:{interval:0},data:a}],yAxis:[{type:"value"}],series:r};a.length>8&&(i.dataZoom||(i.dataZoom={}),i.dataZoom.orient="horizontal",i.dataZoom.show=!0,i.dataZoom.end=8/a.length*100,i.grid||(i.grid={}),i.grid.x=60,i.grid.y=30,i.grid.y2=70);var n=document.getElementById(l).clientWidth/110,s=(t.length+n)/n;return i.grid||(i.grid={}),i.grid.y=25*s,i}};var lr={ReportPrint:function(e){var t=j.extend({queryBox:{queryTitle:"查询标题",queryForm:[{label:"",value:""}]},chartBox:{chartTitle:"图表标题",chartForm:[{label:"",value:""}],chartDiv:"chartdiv",chartUrl:null},tablebBox:{tableTitle:"表格标题",columns:[{name:null,dataIndex:null,items:[{name:null,dataIndex:null}]}],tableData:[]},minWidth:960,width:window.innerWidth,height:window.innerHeight},e),a=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>打印视图</title><style type="text/css" media="screen,print">',"body,p,span,div,li,td,input,textarea,select{font-family:sans-serif; font-size:9pt;}",".title{text-align: left; font-weight: bold; line-height: 22px; padding:3px;}",".table{ border:1px solid #999; border-collapse:collapse; width:100%;}",".table th,.table td{ border:1px solid #999; border-collapse:collapse; padding:3px;}",".table th{line-height:20px;}</style></head><body>",'<div><input type="button" value="打印" onclick="this.style.display=\'none\';window.print();this.style.display=\'block\';" /></div>',function(){var e=[];if(t.queryBox&&(e.push('<table class="table"><caption class="title">'+t.queryBox.queryTitle+"</caption>"),e.push('<colgroup><col width="15%" /><col width="35%" /><col width="15%" /><col width="35%" /></colgroup>'),e.push("<tbody>"),t.queryBox.queryForm&&r(t.queryBox.queryForm,e,!0,2),e.push("</tbody></table>")),t.chartBox&&(e.push('<table class="table"><caption class="title">'+t.chartBox.chartTitle+"</caption><tbody>"),t.chartBox.chartForm&&r(t.chartBox.chartForm,e,!1,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "),t.chartBox.chartUrl)){var a='<img src="'+t.chartBox.chartUrl+'" >';a=a.replace("&amp;","&").replace(/<param name=\"play\"[^<]+>/i,""),e.push('<tr><td align="center">'+a+"</td></tr>")}if(t.tablebBox){var l=t.tablebBox.columns;e.push('<table class="table"><caption class="title">'+t.tablebBox.tableTitle+"</caption><thead><tr>");for(var o="<tr>",i=0;i<l.length;i++){var n=l[i],s=n.items;if(s){e.push('<th colspan="'+s.length+'">'+n.name+"</th>");for(var c=0;c<s.length;c++)o+="<th>"+s[c].name+"</th>"}else e.push('<th rowspan="2">'+n.name+"</th>")}e.push("</tr>"),e.push(o),e.push("</tr>");for(var u=t.tablebBox.tableData,d=0;d<u.length;d++){e.push("<tr>");for(var i=0;i<l.length;i++){var n=l[i],s=n.items;if(s)for(var c=0;c<s.length;c++)e.push("<td>"+u[d][s[c].dataIndex]+"</td>");else e.push("<td>"+u[d][n.dataIndex]+"</td>")}e.push("</tr>")}e.push("</tbody></table>")}return e.join("")}(),"</body></html>"];function r(e,t,a,r){var l=0;a||t.push("<tr><td>");for(var o=0;o<e.length;o++){var i=e[o];a?(l%r==0&&t.push("<tr>"),t.push("<td>"+i.label+"： </td>"),t.push("<td>"+i.value+"</td>"),l%r==r-1&&t.push("</tr>"),l++):t.push(i.label+"： "+i.value+r)}a||t.push("</td></tr>")}!function(){console.info(window),t.width<t.minWidth&&(t.width=t.minWidth);var e=window.open("","win1","width="+t.width+",height="+t.height+",location=no,menubar=yes,toolbar=no,menubar=no,scrollbars=yes, resizable=yes,location=no, status=no"),r=e.document;r.writeln(a.join("")),r.close(),e.focus()}()}},or=void 0,ir={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["chart","table"],tableColumns:[],tableData:[],currentPage:1,pageSize:10,total:0,reportTypeList:[{label:"日报",value:"dayreport"},{label:"月报",value:"monthreport"},{label:"年报",value:"yearreport"}],countryCodeList:[],regionCodeList:[],cityCodeList:[],targetList:[{label:"总数",value:"_NUM"},{label:"欺诈数",value:"_FRAUDNUMBER"},{label:"非欺诈数",value:"_NONFRAUDNUMBER"}],topList:[{label:"前5名",value:"5"},{label:"前10名",value:"10"},{label:"前20名",value:"20"},{label:"前30名",value:"30"}],searchForm:{txnIds:"",reporttype:"dayreport",duraSeparator:[],yearDate:"",monthDate:"",startTime:"",endTime:"",countrycode:"",regioncode:"",citycode:""},filterForm:{ps:["PS01"],target:["_NUM"],tops:"10"}}},created:function(){},mounted:function(){this.$nextTick(function(){var e=this;H.post({url:"/report/txn/getCountry",param:{},success:function(t){e.countryCodeList=t.countrylist}}),or=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTableColumn(),this.selTable()})},watch:{"searchForm.duraSeparator":function(e){switch(this.datePickerType){case"daterange":e&&2===e.length&&(this.searchForm.startTime=j.renderDate(e[0].getTime()),this.searchForm.endTime=j.renderDate(e[1].getTime()));break;case"month":var t=new Date(e),a=t.getMonth()+1;a<10&&(a="0"+a),this.searchForm.monthDate=t.getFullYear().toString()+a;break;case"year":var r=new Date(e);this.searchForm.yearDate=r.getFullYear().toString()}},"searchForm.countrycode":function(e){var t=this;t.searchForm.regioncode="",H.post({url:"/report/txn/getRegion",param:{countryCode:e},success:function(e){t.regionCodeList=e.reglist}})},"searchForm.regioncode":function(e){var t=this;t.searchForm.citycode="",H.post({url:"/report/txn/getCity",param:{regionCode:e},success:function(e){t.cityCodeList=e.citylist}})}},methods:{handleChange:function(e){},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTableColumn:function(){var e=this;H.post({url:"/report/txn/getPS",loading:!0,params:{},success:function(t){e.tableColumns=t.list}})},selTable:function(){var e=this,t=s()({},e.searchForm,e.filterForm);H.post({url:"/report/txn/list",loading:!0,param:t,success:function(t){e.bindGridData(t),e.getChart()}})},searchFunc:function(){this.selTable()},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(this.searchForm.startTime="",this.searchForm.endTime="",this.searchForm.monthDate="",this.searchForm.yearDate="",this.searchForm.duraSeparator=null,e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnIds=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},connectString:function(e,t){return(e+t).toLowerCase()},filterFunc:function(){this.getChart()},getChart:function(){var e=this.getOptionV();or.setOption(e)},getOptionV:function(){for(var e=this.tableData,t=this.filterForm.ps,a=this.getPsText(t),r=this.filterForm.target,l=this.getTargetText(r),o=this.filterForm.tops,i=e,n=[],s=[],c=[],u=a,d=t,m=l,p=r,f=0;f<u.length;f++)for(var h=0;h<m.length;h++)n.push(u[f]+"-"+m[h]),c.push({name:u[f]+"-"+m[h],ps:d[f]+p[h],itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]});i.sort(function(e,t){for(var a=0,r=0,l=0;l<d.length;l++)if(p.indexOf("_NUM")>-1)a+=parseInt(e[d[l]+"_NUM"]),r+=parseInt(t[d[l]+"_NUM"]);else for(var o=0;o<p.length;o++)a+=parseInt(e[d[l]+p[o]]),r+=parseInt(t[d[l]+p[o]]);return r-a});var g=1;for(f=0;f<i.length&&!(s.length>=o);f++)if("REPORTTXNTOTAL"!==i[f].txnid){g%2==0?s.push("\n"+i[f].txnname):s.push(i[f].txnname);for(h=0;h<c.length;h++){var v=i[f][c[h].ps.toLowerCase()];null!=v&&c[h].data.push(v)}g++}var b={};return b.op_legend_data=n,b.op_x_data=s,b.op_series=c,b.chartID="chartdiv",rr.GenOption(b)},getPsText:function(){var e=[],t=this.filterForm.ps,a=this.tableColumns;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.dp_code){e.push(i.dp_name);break}}}return e},getTargetText:function(){var e=[],t=this.filterForm.target,a=this.targetList;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.value){e.push(i.label);break}}}return e},exportFunc:function(){var e=this.searchForm;console.info(e);var t="/report/txn/export?"+j.serializeObj(e);H.syncGet({url:t})},printFunc:function(){var e=this.searchForm,t=this.filterForm,a={};a.queryBox={queryTitle:"交易报警信息查询",queryForm:[{label:"交易名称",value:e.txnIds},{label:"报表类型",value:this.getReportTypeName(e.reporttype)},{label:"日期范围",value:this.getQueryDataRange()},{label:"地区名称",value:this.getLocation()}]},a.chartBox={chartTitle:"交易报警信息展示图",chartForm:[{label:"处置类型",value:this.getPsText()},{label:"监控指标",value:this.getTargetText()},{label:"排名设置",value:t.tops}],chartUrl:or.getDataURL()},a.tablebBox={tableTitle:"交易报警信息列表",columns:[],tableData:[]};var r=this.tableColumns,l=[{name:"交易名称",dataIndex:"txnname"},{name:"交易总数",dataIndex:"txnnumber"}];for(var o in r){var i=r[o];l.push({name:i.dp_name,dataIndex:null,items:[{name:"总数",dataIndex:this.connectString(i.dp_code,"_rate")},{name:"欺诈数",dataIndex:this.connectString(i.dp_code,"_fraudrate")},{name:"非欺诈数",dataIndex:this.connectString(i.dp_code,"_nonfraudrate")}]})}a.tablebBox.columns=l,a.tablebBox.tableData=this.tableData,lr.ReportPrint(a)},getReportTypeName:function(e){var t=this.reportTypeList;for(var a in t){var r=t[a];if(r.value===e)return r.label}return e},getQueryDataRange:function(){var e=this.searchForm,t=e.duraSeparator;return t&&2===t.length?e.startTime+"至"+e.endTime:""},getLocation:function(){var e="",t=this.searchForm,a=t.countrycode;if(a){var r=this.countryCodeList,l=t.regioncode,o=l;for(var i in r)r[i].countrycode===a&&(o=r[i].countryname);if(e+=o,l){var n=this.regionCodeList,s=t.citycode,c=l;for(var u in n)n[u].regioncode===l&&(c=n[u].regionname);if(e=e+"-"+c,s){var d=this.cityCodeList,m=s;for(var p in d)d[p].citycode===s&&(m=d[p].cityname);e=e+"-"+m}}}return e}}},nr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"交易报警信息查询",name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnIds"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.searchForm.txnIds,callback:function(t){e.$set(e.searchForm,"txnIds",t)},expression:"searchForm.txnIds"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"报表类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.searchForm.reporttype,callback:function(t){e.$set(e.searchForm,"reporttype",t)},expression:"searchForm.reporttype"}},e._l(e.reportTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{clearable:"",type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.countrycode,callback:function(t){e.$set(e.searchForm,"countrycode",t)},expression:"searchForm.countrycode"}},e._l(e.countryCodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.regioncode,callback:function(t){e.$set(e.searchForm,"regioncode",t)},expression:"searchForm.regioncode"}},e._l(e.regionCodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.citycode,callback:function(t){e.$set(e.searchForm,"citycode",t)},expression:"searchForm.citycode"}},e._l(e.cityCodeList,function(e){return a("el-option",{key:e.citycode,attrs:{label:e.cityname,value:e.citycode}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"交易报警信息展示图",name:"chart"}},[a("div",[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"处置类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},model:{value:e.filterForm.ps,callback:function(t){e.$set(e.filterForm,"ps",t)},expression:"filterForm.ps"}},e._l(e.tableColumns,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"监控指标"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},on:{change:e.reportTypeChange},model:{value:e.filterForm.target,callback:function(t){e.$set(e.filterForm,"target",t)},expression:"filterForm.target"}},e._l(e.targetList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"排名设置"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.filterForm.tops,callback:function(t){e.$set(e.filterForm,"tops",t)},expression:"filterForm.tops"}},e._l(e.topList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.filterFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1)]),e._v(" "),a("el-collapse-item",{attrs:{title:"交易报警信息列表",name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易报警信息列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"txnname",label:"交易名称",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnnumber",label:"交易总数",width:"150"}}),e._v(" "),e._l(e.tableColumns,function(t){return a("el-table-column",{key:t.dp_code,attrs:{label:t.dp_name,align:"center"}},[a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_rate"),label:"总数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_fraudrate"),label:"欺诈数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_nonfraudrate"),label:"非欺诈数",width:"120"}})],1)})],2)],1)],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var sr=a("X4nt")(ir,nr,!1,function(e){a("Kz57")},"data-v-7396d76b",null).exports,cr={name:"txnDetail",computed:{},data:function(){return{visibleFlag:!1,defaultTreeProps:{children:"children",label:"tab_desc"},defaultExpendKey:["T"],defaultCheckKey:[],treeData:[]}},props:[],methods:{open:function(e){this.visibleFlag=!0;var t=[];e&&j.isArray(e)&&e.length>0&&(t=e),this.defaultCheckKey=t,this.init(t)},init:function(){var e=this;H.post({url:"/trandef/queryRuleTree",loading:!0,success:function(t){e.treeData=e.formatTreeData(t.list)}})},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},submitFunc:function(){var e=this.$refs.tree.getCheckedNodes(),t=[],a=[],r=!0,l=!1,o=void 0;try{for(var i,n=f()(e);!(r=(i=n.next()).done);r=!0){var s=i.value;s.children&&s.children.length>0||(t.push(s.tab_desc),a.push(s.tab_name+""))}}catch(e){l=!0,o=e}finally{try{!r&&n.return&&n.return()}finally{if(l)throw o}}this.$emit("listenToSubmit",{name:t,value:a})}}},ur={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"规则名称",visible:e.visibleFlag,width:"450px","close-on-click-modal":!1},on:{"update:visible":function(t){e.visibleFlag=t},close:e.submitFunc}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto","max-height":"500px"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.defaultExpendKey,"default-checked-keys":e.defaultCheckKey,"expand-on-click-node":!1,"render-content":e.renderContent}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.visibleFlag=!1}}},[e._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var dr=void 0,mr={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["chart","table"],queryTitle:"规则报警信息查询",chartTitle:"规则报警信息展示图",tableTitle:"规则报警信息列表",charData:[],tableData:[],currentPage:1,pageSize:10,total:0,reportTypeList:[{label:"日报",value:"dayreport"},{label:"月报",value:"monthreport"},{label:"年报",value:"yearreport"}],targetList:[{label:"交易执行次数",value:"TRIGGERNUM"},{label:"规则命中数",value:"HITNUM"},{label:"规则命中率",value:"HITRATE"},{label:"交易执行占比",value:"TRIGGERRATE"},{label:"命中占比",value:"HITNUMRATE"}],topList:[{label:"前5名",value:"5"},{label:"前10名",value:"10"},{label:"前20名",value:"20"},{label:"前30名",value:"30"}],searchForm:{txnIds:"",ruleName:"",reporttype:"dayreport",duraSeparator:[],yearDate:"",monthDate:"",startTime:"",endTime:""},filterForm:{ruleNameSelect:[],ruleNameStr:"",target:"TRIGGERNUM",tops:"10"}}},created:function(){},mounted:function(){this.$nextTick(function(){dr=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTable()})},watch:{},methods:{handleChange:function(e){},bindGridData:function(e){this.tableData=e.page.list,this.currentPage=e.page.index,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTable:function(){var e=this,t=s()({pagesize:e.pageSize,pageindex:e.currentPage},e.searchForm,e.filterForm);H.post({url:"/report/rule/list",loading:!0,param:t,success:function(t){e.bindGridData(t),e.getChart()}})},searchFunc:function(){this.selTable()},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(this.searchForm.startTime="",this.searchForm.endTime="",this.searchForm.monthDate="",this.searchForm.yearDate="",this.searchForm.duraSeparator=null,e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnIds=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},getChart:function(){var e=this;H.post({url:"/report/rule/showChart",success:function(t){t.chartdata&&(e.charData=t.chartdata)}});var t=e.getOptionV();dr.setOption(t)},getOptionV:function(){var e=this.charData,t=this.filterForm.target,a=this.getTargetText(),r=e,l=[];l.push(a);for(var o=[],i=[],n=1,s=[],c=0;c<r.length;c++){var u=r[c].rulename+"["+r[c].txnname+"]";n%2==0?o.push("\n"+u):o.push(u),s.push(r[c][t]),n++}i.push({name:a,itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:s});var d={};return d.op_legend_data=l,d.op_x_data=o,d.op_series=i,d.chartID="chartdiv",d.magicType=["line","bar"],d.xAxis=[{type:"category",axisLabel:{interval:0,formatter:function(e){var t=e,a=e.indexOf("[");return-1!==a&&(t=t.substring(0,a)),t}},data:o}],rr.GenOption(d)},getTargetText:function(){var e=[],t=this.filterForm.target,a=this.targetList;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.value){e.push(i.label);break}}}return e},exportFunc:function(){var e=s()(this.searchForm,this.filterForm);console.info(e);var t="/report/rule/export?"+j.serializeObj(e);H.syncGet({url:t})},printFunc:function(){var e=this.searchForm,t=this.filterForm,a={};a.queryBox={queryTitle:this.queryTitle,queryForm:[{label:"交易名称",value:e.txnIds},{label:"规则名称",value:e.ruleName},{label:"报表类型",value:this.getReportTypeName(e.reporttype)},{label:"日期范围",value:this.getQueryDataRange()}]},a.chartBox={chartTitle:this.chartTitle,chartForm:[{label:"监控指标",value:this.getTargetText()},{label:"排名设置",value:t.tops},{label:"规则名称",value:t.tops}],chartUrl:dr.getDataURL()},a.tablebBox={tableTitle:this.tableTitle,columns:[],tableData:[]};a.tablebBox.columns=[{name:"规则名称",dataIndex:"rulename"},{name:"监控交易名称",dataIndex:"txnname"},{name:"交易执行次数",dataIndex:"triggernum"},{name:"规则命中数",dataIndex:"hitnum"},{name:"规则命中率",dataIndex:"hitrate"},{name:"交易执行占比",dataIndex:"triggerrate"},{name:"命中占比",dataIndex:"hitnumrate"}],a.tablebBox.tableData=this.tableData,lr.ReportPrint(a)},getReportTypeName:function(e){var t=this.reportTypeList;for(var a in t){var r=t[a];if(r.value===e)return r.label}return e},getQueryDataRange:function(){var e=this.searchForm,t=e.duraSeparator;return t&&2===t.length?e.startTime+"至"+e.endTime:""},renderPercent:function(e,t,a){return a+"%"},getRuleName:function(e){this.filterForm.ruleNameStr=e.name.join(","),this.filterForm.ruleNameSelect=e.value},openRuleTree:function(){var e=this.filterForm.ruleNameSelect;this.$refs.txnTree.open(e)}},components:{txn_rule:a("X4nt")(cr,ur,!1,function(e){a("wveC")},null,null).exports}},pr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:e.queryTitle,name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnIds"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.searchForm.txnIds,callback:function(t){e.$set(e.searchForm,"txnIds",t)},expression:"searchForm.txnIds"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"规则名称:",prop:"ruleName"}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",clearable:""},model:{value:e.searchForm.ruleName,callback:function(t){e.$set(e.searchForm,"ruleName",t)},expression:"searchForm.ruleName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"报表类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.searchForm.reporttype,callback:function(t){e.$set(e.searchForm,"reporttype",t)},expression:"searchForm.reporttype"}},e._l(e.reportTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{clearable:"",type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:e.chartTitle,name:"chart"}},[a("div",[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"监控指标"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择"},on:{change:e.reportTypeChange},model:{value:e.filterForm.target,callback:function(t){e.$set(e.filterForm,"target",t)},expression:"filterForm.target"}},e._l(e.targetList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"排名设置"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.filterForm.tops,callback:function(t){e.$set(e.filterForm,"tops",t)},expression:"filterForm.tops"}},e._l(e.topList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"规则名称"}},[a("div",{on:{click:e.openRuleTree}},[a("el-input",{attrs:{readonly:""},model:{value:e.filterForm.ruleNameStr,callback:function(t){e.$set(e.filterForm,"ruleNameStr",t)},expression:"filterForm.ruleNameStr"}})],1)]),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1)]),e._v(" "),a("el-collapse-item",{attrs:{title:e.tableTitle,name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易报警信息列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"rulename",label:"规则名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnname",label:"监控交易名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"triggernum",label:"交易执行次数"}}),e._v(" "),a("el-table-column",{attrs:{prop:"hitnum",label:"规则命中数"}}),e._v(" "),a("el-table-column",{attrs:{prop:"hitrate",label:"规则命中率",formatter:e.renderPercent}}),e._v(" "),a("el-table-column",{attrs:{prop:"triggerrate",label:"交易执行占比",formatter:e.renderPercent}}),e._v(" "),a("el-table-column",{attrs:{prop:"hitnumrate",label:"命中占比",formatter:e.renderPercent}})],1)],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("txn_rule",{ref:"txnTree",on:{listenToSubmit:e.getRuleName}})],1)},staticRenderFns:[]};var fr=a("X4nt")(mr,pr,!1,function(e){a("XX0n")},"data-v-2d1fde1a",null).exports,hr=void 0,gr={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["chart","table"],tableColumns:[],tableData:[],currentPage:1,pageSize:10,total:0,reportTypeList:[{label:"日报",value:"dayreport"},{label:"月报",value:"monthreport"},{label:"年报",value:"yearreport"}],countryCodeList:[],regionCodeList:[],cityCodeList:[],targetList:[{label:"总数",value:"_NUM"},{label:"欺诈数",value:"_FRAUDNUMBER"},{label:"非欺诈数",value:"_NONFRAUDNUMBER"}],topList:[{label:"前5名",value:"5"},{label:"前10名",value:"10"},{label:"前20名",value:"20"},{label:"前30名",value:"30"}],searchForm:{txnIds:"",reporttype:"dayreport",duraSeparator:[],yearDate:"",monthDate:"",startTime:"",endTime:"",countrycode:"",regioncode:""},filterForm:{ps:["PS01"],target:["_NUM"],tops:"10"}}},created:function(){},mounted:function(){this.$nextTick(function(){var e=this;H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countryCodeList=t.row}}),hr=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTableColumn(),this.selTable()})},watch:{"searchForm.duraSeparator":function(e){switch(this.datePickerType){case"daterange":e&&2===e.length&&(this.searchForm.startTime=j.renderDate(e[0].getTime()),this.searchForm.endTime=j.renderDate(e[1].getTime()));break;case"month":var t=new Date(e),a=t.getMonth()+1;a<10&&(a="0"+a),this.searchForm.monthDate=t.getFullYear().toString()+a;break;case"year":var r=new Date(e);this.searchForm.yearDate=r.getFullYear().toString()}},"searchForm.countrycode":function(e){var t=this;H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regionCodeList=e.row}})}},methods:{handleChange:function(e){},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTableColumn:function(){var e=this;H.post({url:"/report/txn/getPS",loading:!0,params:{},success:function(t){e.tableColumns=t.list}})},selTable:function(){var e=this,t=s()({},e.searchForm,e.filterForm);H.post({url:"/report/area/list",loading:!0,param:t,success:function(t){var a=!0,r=!1,l=void 0;try{for(var o,i=f()(t.page.list);!(a=(o=i.next()).done);a=!0){var n=o.value;n.cityname&&(n.regionname=n.cityname)}}catch(e){r=!0,l=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw l}}console.log(t),e.bindGridData(t),e.getChart()}})},searchFunc:function(){this.selTable()},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(this.searchForm.startTime="",this.searchForm.endTime="",this.searchForm.monthDate="",this.searchForm.yearDate="",this.searchForm.duraSeparator=null,e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnIds=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},connectString:function(e,t){return(e+t).toLowerCase()},filterFunc:function(){this.getChart()},getChart:function(){var e=this.getOptionV();hr.setOption(e)},getOptionV:function(){for(var e=this.tableData,t=this.filterForm.ps,a=this.getPsText(t),r=this.filterForm.target,l=this.getTargetText(r),o=this.filterForm.tops,i=e,n=[],s=[],c=[],u=a,d=t,m=l,p=r,f=0;f<u.length;f++)for(var h=0;h<m.length;h++)n.push(u[f]+"-"+m[h]),c.push({name:u[f]+"-"+m[h],ps:d[f]+p[h],itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]});i.sort(function(e,t){for(var a=0,r=0,l=0;l<d.length;l++)if(p.indexOf("_NUM")>-1)a+=parseInt(e[d[l]+"_NUM"]),r+=parseInt(t[d[l]+"_NUM"]);else for(var o=0;o<p.length;o++)a+=parseInt(e[d[l]+p[o]]),r+=parseInt(t[d[l]+p[o]]);return r-a});var g=1;for(f=0;f<i.length&&!(s.length>=o);f++)if("REPORTTXNTOTAL"!==i[f].txnid){g%2==0?s.push("\n"+i[f].regionname):s.push(i[f].regionname);for(h=0;h<c.length;h++){var v=i[f][c[h].ps.toLowerCase()];null!=v&&c[h].data.push(v)}g++}var b={};return b.op_legend_data=n,b.op_x_data=s,b.op_series=c,b.chartID="chartdiv",rr.GenOption(b)},getPsText:function(){var e=[],t=this.filterForm.ps,a=this.tableColumns;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.dp_code){e.push(i.dp_name);break}}}return e},getTargetText:function(){var e=[],t=this.filterForm.target,a=this.targetList;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.value){e.push(i.label);break}}}return e},exportFunc:function(){var e=this.searchForm;console.info(e);var t="/report/area/export?"+j.serializeObj(e);H.syncGet({url:t})},printFunc:function(){var e=this.searchForm,t=this.filterForm,a={};a.queryBox={queryTitle:"地区报警信息查询",queryForm:[{label:"交易名称",value:e.txnIds},{label:"报表类型",value:this.getReportTypeName(e.reporttype)},{label:"日期范围",value:this.getQueryDataRange()},{label:"地区名称",value:this.getLocation()}]},a.chartBox={chartTitle:"地区报警信息展示图",chartForm:[{label:"处置类型",value:this.getPsText()},{label:"监控指标",value:this.getTargetText()},{label:"排名设置",value:t.tops}],chartUrl:hr.getDataURL()},a.tablebBox={tableTitle:"地区报警信息列表",columns:[],tableData:[]};var r=this.tableColumns,l=[{name:"地区名称",dataIndex:"regionname"},{name:"交易总数",dataIndex:"txnnumber"}];for(var o in r){var i=r[o];l.push({name:i.dp_name,dataIndex:null,items:[{name:"总数",dataIndex:this.connectString(i.dp_code,"_rate")},{name:"欺诈数",dataIndex:this.connectString(i.dp_code,"_fraudrate")},{name:"非欺诈数",dataIndex:this.connectString(i.dp_code,"_nonfraudrate")}]})}a.tablebBox.columns=l,a.tablebBox.tableData=this.tableData,lr.ReportPrint(a)},getReportTypeName:function(e){var t=this.reportTypeList;for(var a in t){var r=t[a];if(r.value===e)return r.label}return e},getQueryDataRange:function(){var e=this.searchForm,t=e.duraSeparator;return t&&2===t.length?e.startTime+"至"+e.endTime:""},getLocation:function(){var e="",t=this.searchForm,a=t.countrycode;if(a){var r=this.countryCodeList,l=t.regioncode,o=l;for(var i in r)r[i].countrycode===a&&(o=r[i].countryname);if(e+=o,l){var n=this.regionCodeList,s=t.citycode,c=l;for(var u in n)n[u].regioncode===l&&(c=n[u].regionname);if(e=e+"-"+c,s){var d=this.cityCodeList,m=s;for(var p in d)d[p].citycode===s&&(m=d[p].cityname);e=e+"-"+m}}}return e}}},vr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"地区报警信息查询",name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnIds"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.searchForm.txnIds,callback:function(t){e.$set(e.searchForm,"txnIds",t)},expression:"searchForm.txnIds"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"报表类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.searchForm.reporttype,callback:function(t){e.$set(e.searchForm,"reporttype",t)},expression:"searchForm.reporttype"}},e._l(e.reportTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{clearable:"",type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.countrycode,callback:function(t){e.$set(e.searchForm,"countrycode",t)},expression:"searchForm.countrycode"}},e._l(e.countryCodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.regioncode,callback:function(t){e.$set(e.searchForm,"regioncode",t)},expression:"searchForm.regioncode"}},e._l(e.regionCodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"地区报警信息展示图",name:"chart"}},[a("div",[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"处置类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},model:{value:e.filterForm.ps,callback:function(t){e.$set(e.filterForm,"ps",t)},expression:"filterForm.ps"}},e._l(e.tableColumns,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"监控指标"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},on:{change:e.reportTypeChange},model:{value:e.filterForm.target,callback:function(t){e.$set(e.filterForm,"target",t)},expression:"filterForm.target"}},e._l(e.targetList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"排名设置"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.filterForm.tops,callback:function(t){e.$set(e.filterForm,"tops",t)},expression:"filterForm.tops"}},e._l(e.topList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.filterFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1)]),e._v(" "),a("el-collapse-item",{attrs:{title:"地区报警信息列表",name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("地区报警信息列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"regionname",label:"地区名称",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnnumber",label:"交易总数",width:"150"}}),e._v(" "),e._l(e.tableColumns,function(t){return a("el-table-column",{key:t.dp_code,attrs:{label:t.dp_name,align:"center"}},[a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_rate"),label:"总数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_fraudrate"),label:"欺诈数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_nonfraudrate"),label:"非欺诈数",width:"120"}})],1)})],2)],1)],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var br=a("X4nt")(gr,vr,!1,function(e){a("hiVg")},"data-v-5d356572",null).exports,_r=void 0,yr={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["chart","table"],tableColumns:[],tableData:[],currentPage:1,pageSize:10,total:0,reportTypeList:[{label:"日报",value:"dayreport"},{label:"月报",value:"monthreport"},{label:"年报",value:"yearreport"}],countryCodeList:[],regionCodeList:[],cityCodeList:[],targetList:[{label:"总数",value:"_NUM"},{label:"欺诈数",value:"_FRAUDNUMBER"},{label:"非欺诈数",value:"_NONFRAUDNUMBER"}],topList:[{label:"前5名",value:"5"},{label:"前10名",value:"10"},{label:"前20名",value:"20"},{label:"前30名",value:"30"}],searchForm:{txnIds:"",reporttype:"dayreport",duraSeparator:[],yearDate:"",monthDate:"",startTime:"",endTime:"",countrycode:"",regioncode:"",citycode:""},filterForm:{ps:["PS01"],target:["_NUM"],tops:"10"}}},created:function(){},mounted:function(){this.$nextTick(function(){var e=this;H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countryCodeList=t.row}}),_r=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTableColumn(),this.selTable()})},watch:{"searchForm.duraSeparator":function(e){switch(this.datePickerType){case"daterange":e&&2===e.length&&(this.searchForm.startTime=j.renderDate(e[0].getTime()),this.searchForm.endTime=j.renderDate(e[1].getTime()));break;case"month":var t=new Date(e),a=t.getMonth()+1;a<10&&(a="0"+a),this.searchForm.monthDate=t.getFullYear().toString()+a;break;case"year":var r=new Date(e);this.searchForm.yearDate=r.getFullYear().toString()}},"searchForm.countrycode":function(e){var t=this;H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regionCodeList=e.row}})},"searchForm.regioncode":function(e){var t=this;H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.cityCodeList=e.row}})}},methods:{handleChange:function(e){},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTableColumn:function(){var e=this;H.post({url:"/report/txn/getPS",loading:!0,params:{},success:function(t){e.tableColumns=t.list}})},selTable:function(){var e=this,t=s()({},e.searchForm,e.filterForm);H.post({url:"/report/date/list",loading:!0,param:t,success:function(t){console.log(t),e.bindGridData(t),e.getChart()}})},searchFunc:function(){this.selTable()},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(this.searchForm.startTime="",this.searchForm.endTime="",this.searchForm.monthDate="",this.searchForm.yearDate="",this.searchForm.duraSeparator=null,e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnIds=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},connectString:function(e,t){return(e+t).toLowerCase()},filterFunc:function(){this.getChart()},getChart:function(){var e=this.getOptionV();_r.setOption(e)},getOptionV:function(){for(var e=this.tableData,t=this.filterForm.ps,a=this.getPsText(t),r=this.filterForm.target,l=this.getTargetText(r),o=this.filterForm.tops,i=e,n=[],s=[],c=[],u=a,d=t,m=l,p=r,f=0;f<u.length;f++)for(var h=0;h<m.length;h++)n.push(u[f]+"-"+m[h]),c.push({name:u[f]+"-"+m[h],ps:d[f]+p[h],itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]});i.sort(function(e,t){for(var a=0,r=0,l=0;l<d.length;l++)if(p.indexOf("_NUM")>-1)a+=parseInt(e[d[l]+"_NUM"]),r+=parseInt(t[d[l]+"_NUM"]);else for(var o=0;o<p.length;o++)a+=parseInt(e[d[l]+p[o]]),r+=parseInt(t[d[l]+p[o]]);return r-a});var g=1;for(f=0;f<i.length&&!(s.length>=o);f++)if("REPORTTXNTOTAL"!==i[f].txnid){g%2==0?s.push("\n"+i[f].alertdate):s.push(i[f].alertdate);for(h=0;h<c.length;h++){var v=i[f][c[h].ps.toLowerCase()];null!=v&&c[h].data.push(v)}g++}var b={};return b.op_legend_data=n,b.op_x_data=s,b.op_series=c,b.chartID="chartdiv",rr.GenOption(b)},getPsText:function(){var e=[],t=this.filterForm.ps,a=this.tableColumns;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.dp_code){e.push(i.dp_name);break}}}return e},getTargetText:function(){var e=[],t=this.filterForm.target,a=this.targetList;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.value){e.push(i.label);break}}}return e},exportFunc:function(){var e=this.searchForm;console.info(e);var t="/report/date/export?"+j.serializeObj(e);H.syncGet({url:t})},printFunc:function(){alert("打印")}}},Fr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"日期报警信息查询",name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnIds"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.searchForm.txnIds,callback:function(t){e.$set(e.searchForm,"txnIds",t)},expression:"searchForm.txnIds"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"报表类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.searchForm.reporttype,callback:function(t){e.$set(e.searchForm,"reporttype",t)},expression:"searchForm.reporttype"}},e._l(e.reportTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{clearable:"",type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.countrycode,callback:function(t){e.$set(e.searchForm,"countrycode",t)},expression:"searchForm.countrycode"}},e._l(e.countryCodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.regioncode,callback:function(t){e.$set(e.searchForm,"regioncode",t)},expression:"searchForm.regioncode"}},e._l(e.regionCodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.citycode,callback:function(t){e.$set(e.searchForm,"citycode",t)},expression:"searchForm.citycode"}},e._l(e.cityCodeList,function(e){return a("el-option",{key:e.citycode,attrs:{label:e.cityname,value:e.citycode}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"日期报警信息展示图",name:"chart"}},[a("div",[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"处置类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},model:{value:e.filterForm.ps,callback:function(t){e.$set(e.filterForm,"ps",t)},expression:"filterForm.ps"}},e._l(e.tableColumns,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"监控指标"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},on:{change:e.reportTypeChange},model:{value:e.filterForm.target,callback:function(t){e.$set(e.filterForm,"target",t)},expression:"filterForm.target"}},e._l(e.targetList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"排名设置"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.filterForm.tops,callback:function(t){e.$set(e.filterForm,"tops",t)},expression:"filterForm.tops"}},e._l(e.topList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.filterFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1)]),e._v(" "),a("el-collapse-item",{attrs:{title:"日期报警信息列表",name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易报警信息列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"alertdate",label:"日期",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"txnnumber",label:"交易总数",width:"150"}}),e._v(" "),e._l(e.tableColumns,function(t){return a("el-table-column",{key:t.dp_code,attrs:{label:t.dp_name,align:"center"}},[a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_rate"),label:"总数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_fraudrate"),label:"欺诈数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_nonfraudrate"),label:"非欺诈数",width:"120"}})],1)})],2)],1)],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var xr=a("X4nt")(yr,Fr,!1,function(e){a("O6In")},"data-v-17c13f82",null).exports,wr=void 0,Dr={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["search","chart","table"],tableData:[],currentPage:1,pageSize:10,total:0,reportTypeList:[{label:"日报",value:"dayreport"},{label:"月报",value:"monthreport"},{label:"年报",value:"yearreport"}],countryCodeList:[],regionCodeList:[],cityCodeList:[],targetList:[{label:"调用次数",value:"_NUMBER"},{label:"平均时间",value:"_RUNTIME_AVG"},{label:"最大时间",value:"_RUNTIME_MAX"},{label:"最小时间",value:"_RUNTIME_MIN"},{label:"平均TPM",value:"_TPM_AVG"},{label:"最大TPM",value:"_TPM_MAX"},{label:"最小TPM",value:"_TPM_MIN"}],topList:[{label:"前5名",value:"5"},{label:"前10名",value:"10"},{label:"前20名",value:"20"},{label:"前30名",value:"30"}],searchForm:{txnIds:"",reporttype:"dayreport",duraSeparator:[new Date,new Date],startTime:"",endTime:""},filterForm:{target:"_NUMBER",tops:10}}},created:function(){},mounted:function(){wr=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTable()},watch:{"searchForm.duraSeparator":function(e){this.datePickerType;var t="",a="";e&&2===e.length&&(t=e[0].getTime(),a=e[1].getTime()),this.searchForm.startTime=t,this.searchForm.endTime=a}},methods:{handleChange:function(e){console.log(e)},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTable:function(){var e=this,t=s()(e.searchForm,e.filterForm);console.log(t),H.post({url:"/report/txnTime/list",loading:!0,param:t,success:function(t){e.bindGridData(t),e.getChart()}})},exportFunc:function(){var e=this.searchForm;console.info(e);var t="/report/txnTime/export?"+j.serializeObj(e);H.syncGet({url:t})},printFunc:function(){alert("打印")},searchFunc:function(){var e=s()(this.searchForm,this.filterForm);console.info(e),this.selTable()},filterFunc:function(){this.getChart()},getChart:function(){var e=this.getOptionV();wr.setOption(e)},getOptionV:function(){var e=this.tableData,t=this.filterForm.target,a=this.getTargetText(t);console.log(a);for(var r=this.filterForm.tops,l=e,o=[],i=[],n=[],s=a,c=t,u=0;u<2;u++)for(var d=0;d<s.length;d++){var m;0==u?o.push("风险评估"):o.push("交易确认"),console.log(c[d]),"_NUMBER"==c[d]&&(console.log(),m=0==u?{name:s[d],ps:"risk_cfm_number",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_number",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_RUNTIME_AVG"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_runtime_avg",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_runtime_avg",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_RUNTIME_MAX"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_runtime_max",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_runtime_max",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_RUNTIME_MIN"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_runtime_min",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_runtime_min",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_TPM_AVG"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_tpm_avg",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_tpm_avg",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_TPM_MAX"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_tpm_max",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_tpm_max",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),"_TPM_MIN"==c[d]&&(m=0==u?{name:s[d],ps:"risk_cfm_tpm_min",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}:{name:s[d],ps:"risk_eval_tpm_min",itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]}),void 0!=m&&n.push(m)}console.log(n);var p=1;for(u=0;u<l.length&&!(i.length>=r);u++)if("REPORTTXNTOTAL"!==l[u].txnid){p%2==0?i.push("\n"+l[u].txnname):i.push(l[u].txnname);for(d=0;d<n.length;d++){var f=l[u][n[d].ps.toLowerCase()];null!=f&&n[d].data.push(f)}p++}var h={};return h.op_legend_data=o,h.op_x_data=i,h.op_series=n,h.chartID="chartdiv",rr.GenOption(h)},getTargetText:function(){var e=[];return e.push(this.filterForm.target),e},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}console.info(e)},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnIds=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[a.label]):e("span",{class:"el-tree-node__label"},[a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},connectString:function(e,t){return(e+t).toLowerCase()}}},Sr={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"交易运行效率查询",name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnIds"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:"",clearable:""},model:{value:e.searchForm.txnIds,callback:function(t){e.$set(e.searchForm,"txnIds",t)},expression:"searchForm.txnIds"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"交易运行效率展示图",name:"chart"}},[a("div",[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"监控指标"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择"},on:{change:e.reportTypeChange},model:{value:e.filterForm.target,callback:function(t){e.$set(e.filterForm,"target",t)},expression:"filterForm.target"}},e._l(e.targetList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"排名设置"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:""},on:{change:e.reportTypeChange},model:{value:e.filterForm.tops,callback:function(t){e.$set(e.filterForm,"tops",t)},expression:"filterForm.tops"}},e._l(e.topList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.filterFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1)]),e._v(" "),a("el-collapse-item",{attrs:{title:"交易运行效率列表",name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易运行效率列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"txnname",label:"交易名称",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"风险评估",align:"center"}},[a("el-table-column",{attrs:{prop:"risk_cfm_number",label:"调用次数",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_runtime_avg",label:"平均时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_runtime_max",label:"最大时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_runtime_min",label:"最小时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_tpm_avg",label:"平均TPM",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_tpm_max",label:"最大TPM",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_cfm_tpm_min",label:"最小TPM",width:"120",align:"center"}})],1),e._v(" "),a("el-table-column",{attrs:{label:"交易确认",align:"center"}},[a("el-table-column",{attrs:{prop:"risk_eval_number",label:"调用次数",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_runtime_avg",label:"平均时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_runtime_max",label:"最大时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_runtime_min",label:"最小时间",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_tpm_avg",label:"平均TPM",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_tpm_max",label:"最大TPM",width:"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"risk_eval_tpm_min",label:"最小TPM",width:"120",align:"center"}})],1)],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{"current-page":e.currentPage,"page-sizes":[10,25,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var kr=a("X4nt")(Dr,Sr,!1,function(e){a("T3Is")},null,null).exports,Cr=void 0,Tr={data:function(){return{datePickerType:"daterange",txntypeDialogVisible:!1,defaultTreeProps:{children:"children",label:"tab_desc"},expendKey:["T"],treeData:[],activeNames:["search","chart","table"],tableColumns:[],tableData:[],currentPage:1,pageSize:10,total:0,countryCodeList:[],regionCodeList:[],cityCodeList:[],qzTypeList:[],searchForm:{txnids:"",duraSeparator:[new Date,new Date],startTime:"",endTime:"",countrycode:"",regioncode:"",citycode:"",target:"_FRAUDNUMBER"},filterForm:{ps:"PS01",fdType:""}}},created:function(){},mounted:function(){this.$nextTick(function(){var e=this;H.post({url:"/monitor/alarm/get_all_country",param:{},success:function(t){e.countryCodeList=t.row}}),Cr=this.$echarts.init(document.getElementById("chartdiv")),this.selTree(),this.selTableColumn(),this.selTable()})},watch:{"searchForm.duraSeparator":function(e){switch(this.datePickerType){case"daterange":e&&2===e.length&&(this.searchForm.startTime=j.renderDate(e[0].getTime()),this.searchForm.endTime=j.renderDate(e[1].getTime()));break;case"month":var t=new Date(e),a=t.getMonth()+1;a<10&&(a="0"+a),this.searchForm.monthDate=t.getFullYear().toString()+a;break;case"year":var r=new Date(e);this.searchForm.yearDate=r.getFullYear().toString()}},"searchForm.countrycode":function(e){var t=this;H.post({url:"/monitor/alarm/get_region_by_country",param:{country:e},success:function(e){t.regionCodeList=e.row}})},"searchForm.regioncode":function(e){var t=this;H.post({url:"/monitor/alarm/get_city_by_region",param:{region:e},success:function(e){t.cityCodeList=e.row}})}},methods:{handleChange:function(e){console.log(e)},bindGridData:function(e){this.tableData=e.page.list,this.pageSize=e.page.size,this.total=e.page.total},handleSizeChange:function(e){this.currentPage=e,this.selTable()},handleCurrentChange:function(e){this.currentPage=e,this.selTable()},selTableColumn:function(){var e=this;H.post({url:"/report/txn/getPS",params:{},success:function(t){e.tableColumns=t.list}})},selTable:function(){var e=this,t=s()(e.searchForm,e.filterForm);H.post({url:"/report/fraud/list",params:t,success:function(t){for(var a in e.bindGridData(t),e.getChart(),t.page.list)e.qzTypeList.push(a.FRAUDTYPE)}})},searchFunc:function(){this.selTable()},filterFunc:function(){this.getChart()},openTxnTypedialog:function(){this.txntypeDialogVisible=!0},reportTypeChange:function(e){switch(this.searchForm.startTime="",this.searchForm.endTime="",this.searchForm.monthDate="",this.searchForm.yearDate="",e){case"dayreport":this.datePickerType="daterange";break;case"monthreport":this.datePickerType="month";break;case"yearreport":this.datePickerType="year";break;default:this.datePickerType="daterange"}console.info(e)},handleCheckChange:function(e,t,a){var r=this.$refs.tree.getCheckedNodes(),l=[],o=[],i=!0,n=!1,s=void 0;try{for(var c,u=f()(r);!(i=(c=u.next()).done);i=!0){var d=c.value;l.push(d.tab_desc),o.push(d.tab_name)}}catch(e){n=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw s}}this.searchForm.txnids=o.join(",")},renderContent:function(e,t){var a=t.node;t.data,t.store;return 0===a.data.enable?e("span",{class:"el-tree-node__label disabledFlag"},[" ",a.label]):e("span",{class:"el-tree-node__label"},[" ",a.label])},selTree:function(){var e=this,t={url:"/trandef/query",success:function(t){t.list&&(e.treeData=e.formatTreeData(t.list))}};H.post(t)},formatTreeData:function(e,t){var a=[];if(void 0===t||0===t.length)for(var r in t=[],e)e[r].text=e[r].code_value+"("+e[r].code_key+")",void 0!==e[r].fid&&null!==e[r].fid&&""!==e[r].fid||t.push(e[r]);for(var l in 0===t.length&&(console.error("根节点不存在，请确认树结构是否正确"),console.info("树结构的根节点是fid不存在（或为空）的节点，否则需手动添加指定得根节点（参数）")),t){var o=t[l];o.children=i(e,o.id),a.push(o)}function i(e,t){var a=[];for(var r in e){var l=e[r];l.fid===t&&(l.children=i(e,l.id),a.push(l))}return a}return a},connectString:function(e,t){return(e+t).toLowerCase()},getChart:function(){var e=this.getOptionV();Cr.setOption(e)},getOptionV:function(){var e=this.tableData,t=this.filterForm.ps,a=this.getPsText(t),r=this.filterForm.fdType,l=this.getQzText(r),o=e,i=[],n=[],s=[],c=a,u=t,d=["欺诈数"],m=["_FRAUDNUMBER"];n=l;for(var p=l,f=0;f<n.length;f++)(f+1)%2==0&&(n[f]="\n"+n[f]);for(var h=0;h<c.length;h++)for(var g=0;g<d.length;g++)i.push(c[h]),s.push({name:c[h],ps:u[h]+m[g],itemStyle:{normal:{label:{show:!0,position:"insideRight"}}},type:"bar",data:[]});for(var v=0;v<o.length;v++)if(p.indexOf(o[v].FRAUDTYPE)>-1)for(var b=0;b<s.length;b++){var _=o[v][s[b].ps];null!==_&&s[b].data.push(_)}var y={};return y.op_legend_data=i,y.op_x_data=n,y.op_series=s,y.chartID="chartdiv",console.log(y),rr.GenOption(y)},getPsText:function(){var e=[],t=this.filterForm.ps,a=this.tableColumns;for(var r in t){var l=t[r];for(var o in a){var i=a[o];if(l===i.dp_code){e.push(i.dp_name);break}}}return e},getQueryDataRange:function(){var e=this.searchForm,t=e.duraSeparator;return t&&2===t.length?e.startTime+"至"+e.endTime:""},getLocation:function(){var e="",t=this.searchForm,a=t.countrycode;if(a){var r=this.countryCodeList,l=t.regioncode,o=l;for(var i in r)r[i].countrycode===a&&(o=r[i].countryname);if(e+=o,l){var n=this.regionCodeList,s=t.citycode,c=l;for(var u in n)n[u].regioncode===l&&(c=n[u].regionname);if(e=e+"-"+c,s){var d=this.cityCodeList,m=s;for(var p in d)d[p].citycode===s&&(m=d[p].cityname);e=e+"-"+m}}}return e},exportFunc:function(){var e=this.searchForm;console.info(e);var t="/report/fraud/export?"+j.serializeObj(e);H.syncGet({url:t})},getQzText:function(){return[]},printFunc:function(){var e=this.searchForm,t=(this.filterForm,{});t.queryBox={queryTitle:"欺诈报警信息查询",queryForm:[{label:"交易名称",value:e.txnIds},{label:"日期范围",value:this.getQueryDataRange()},{label:"地区名称",value:this.getLocation()}]},t.chartBox={chartTitle:"欺诈报警信息展示图",chartForm:[{label:"欺诈类型",value:this.getQzText()},{label:"处置类型",value:this.getPsText()}],chartUrl:Cr.getDataURL()},t.tablebBox={tableTitle:"欺诈报警信息列表",columns:[],tableData:[]};var a=this.tableColumns,r=[{name:"欺诈类型",dataIndex:"fraudtype"}];for(var l in a){var o=a[l];r.push({name:o.dp_name,dataIndex:null,items:[{name:"总数",dataIndex:this.connectString(o.dp_code,"num")},{name:"欺诈数",dataIndex:this.connectString(o.dp_code,"_fraudnumber")},{name:"非欺诈数",dataIndex:this.connectString(o.dp_code,"_nonfraudnumber")}]})}t.tablebBox.columns=r,t.tablebBox.tableData=this.tableData,console.log(t),lr.ReportPrint(t)}}},Ir={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"欺诈报警信息查询",name:"search"}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易名称:",prop:"txnids"}},[a("div",{on:{click:e.openTxnTypedialog}},[a("el-input",{staticClass:"alarm-event-query-form-item",attrs:{"auto-complete":"off",readonly:""},model:{value:e.searchForm.txnids,callback:function(t){e.$set(e.searchForm,"txnids",t)},expression:"searchForm.txnids"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"日期范围"}},[a("el-date-picker",{attrs:{type:e.datePickerType,editable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.duraSeparator,callback:function(t){e.$set(e.searchForm,"duraSeparator",t)},expression:"searchForm.duraSeparator"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地理位置:",prop:"countrycode"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.countrycode,callback:function(t){e.$set(e.searchForm,"countrycode",t)},expression:"searchForm.countrycode"}},e._l(e.countryCodeList,function(e){return a("el-option",{key:e.countrycode,attrs:{label:e.countryname,value:e.countrycode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.regioncode,callback:function(t){e.$set(e.searchForm,"regioncode",t)},expression:"searchForm.regioncode"}},e._l(e.regionCodeList,function(e){return a("el-option",{key:e.regioncode,attrs:{label:e.regionname,value:e.regioncode}})})),e._v(" "),a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.citycode,callback:function(t){e.$set(e.searchForm,"citycode",t)},expression:"searchForm.citycode"}},e._l(e.cityCodeList,function(e){return a("el-option",{key:e.citycode,attrs:{label:e.cityname,value:e.citycode}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchFunc}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("el-collapse-item",{attrs:{title:"欺诈报警信息展示图",name:"chart"}},[a("el-form",{ref:"filterForm",attrs:{inline:!0,model:e.filterForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"欺诈类型:"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},model:{value:e.filterForm.fdType,callback:function(t){e.$set(e.filterForm,"fdType",t)},expression:"filterForm.fdType"}},e._l(e.qzTypeList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"处置类型"}},[a("el-select",{staticClass:"alarm-event-query-form-item",attrs:{multiple:"",placeholder:"请选择"},model:{value:e.filterForm.ps,callback:function(t){e.$set(e.filterForm,"ps",t)},expression:"filterForm.ps"}},e._l(e.tableColumns,function(e){return a("el-option",{key:e.dp_code,attrs:{label:e.dp_name,value:e.dp_code}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.filterFunc}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartdiv"}})],1),e._v(" "),a("el-collapse-item",{attrs:{title:"欺诈报警信息列表",name:"table"}},[a("template",{slot:"title"},[a("div",{staticStyle:{margin:"10px","text-align":"left"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("交易报警信息列表")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.exportFunc(t)}}},[e._v("导出")]),e._v(" "),a("el-button",{staticClass:"el-icon-plus",attrs:{plain:""},on:{click:function(t){t.stopPropagation(),e.printFunc(t)}}},[e._v("打印")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"fraudtype",label:"欺诈类型",width:"150"}}),e._v(" "),e._l(e.tableColumns,function(t){return a("el-table-column",{key:t.dp_code,attrs:{label:t.dp_name,align:"center"}},[a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_num"),label:"总数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_fraudnumber"),label:"欺诈数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:e.connectString(t.dp_code,"_nonfraudnumber"),label:"非欺诈数",width:"120"}})],1)})],2)],1)],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"交易名称",visible:e.txntypeDialogVisible,width:"400px"},on:{"update:visible":function(t){e.txntypeDialogVisible=t}}},[a("el-tree",{ref:"tree",staticStyle:{"overflow-y":"auto"},attrs:{data:e.treeData,"node-key":"id","show-checkbox":"",props:e.defaultTreeProps,"highlight-current":!0,"default-expanded-keys":e.expendKey,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"large"},on:{click:function(t){e.txntypeDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var $r=a("X4nt")(Tr,Ir,!1,function(e){a("Y0tp")},null,null).exports,Lr={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("h1",[this._v("404")]),this._v(" "),t("h2",[this._v("找不到该页面")])])}]};var qr=a("X4nt")({},Lr,!1,function(e){a("nHtw")},null,null).exports;r.default.use(i.a);var Pr=new i.a({mode:"history",base:j.getWebRootPath(),linkActiveClass:"active",routes:[{path:"/login_vue",name:"login",component:Z},{path:"/",name:"main",component:re,meta:{requireAuth:!0},children:[{path:"user_vue",name:"user",component:pe},{path:"role_vue",name:"role",component:ge},{path:"func_vue",name:"func",component:_e},{path:"valuelist_vue",name:"valuelist",component:yt},{path:"showValueList_vue",name:"showValueList",component:vt},{path:"list_vue",name:"list",component:dt},{path:"namelist_vue",name:"namelist",component:ft},{path:"alarmEventSend_vue",name:"alarmEventSend",component:He},{path:"alarmeventExecute_vue",name:"alarmeventExecute",component:lt},{path:"alarmeventAudit_vue",name:"alarmeventAudit",component:st},{path:"txn_vue",name:"txn",component:Kt},{path:"authCenter_vue",name:"authCenter",component:Qt},{path:"authCenterShow_vue",name:"authCenterShow",component:Jt},{path:"authDataCompare_vue",name:"authDataCompare",component:fa},{path:"authDataList_vue",name:"authDataList",component:aa},{path:"authDataListShow_vue",name:"authDataListShow",component:oa},{path:"authLogList_vue",name:"authLogList",component:sa},{path:"authSubDataList_vue",name:"authSubDataList",component:da},{path:"codedict_vue",name:"codedict",component:va},{path:"codeDictInfo_vue",name:"codeDictInfo",component:ya},{path:"ipaddr_vue",name:"ipaddr",component:Da},{path:"log_vue",name:"log",component:Ca},{path:"txnEventQuery_vue",name:"txnEventQuery",component:Za},{path:"alarmEventQuery_vue",name:"alarmEventQuery",component:ar},{path:"txnListReport_vue",name:"txnListReport",component:sr},{path:"ruleListReport_vue",name:"ruleListReport",component:fr},{path:"areaListReport_vue",name:"areaListReport",component:br},{path:"fraudListReport_vue",name:"fraudListReport",component:$r},{path:"dateListReport_vue",name:"dateListReport",component:xr},{path:"reportTxnTimeList_vue",name:"reportTxnTimeList",component:kr},{path:"time_vue",name:"time",component:Oa},{path:"dfp_vue",name:"dfp",component:za},{path:"zkAdmin_vue",name:"zkAdmin",component:ja},{path:"channel_vue",name:"channel",component:Ka}]},{path:"*",name:"notFound",component:qr}]}),Rr={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"slide-fade"}},[t("router-view")],1)],1)},staticRenderFns:[]};var Vr=a("X4nt")({name:"app"},Rr,!1,function(e){a("lY7+")},null,null).exports,zr=a("7VF+"),Nr=a.n(zr);a("briU");r.default.use(o.a,{size:"small"}),r.default.prototype.$axios=u.a,r.default.prototype.$echarts=Nr.a,r.default.config.productionTip=!1;var Er=new r.default;r.default.prototype.Hub=Er,new r.default({el:"#app",router:Pr,beforeCreate:function(){ue.getCodeData()},template:"<App/>",components:{App:Vr}})},"NV/4":function(e,t){},O6In:function(e,t){},PYOT:function(e,t){},RWDL:function(e,t){},SKqd:function(e,t){},SMvj:function(e,t){},T3Is:function(e,t){},TyaY:function(e,t){},U3Vv:function(e,t){},Wh1g:function(e,t){},X5WZ:function(e,t){},XX0n:function(e,t){},Y0tp:function(e,t){},YHXL:function(e,t){},YgSa:function(e,t){},YuWS:function(e,t){},bXmk:function(e,t){},bqlI:function(e,t){},"dLq/":function(e,t){},hZda:function(e,t){},hiVg:function(e,t){},hkA8:function(e,t){},htzw:function(e,t){},j5m4:function(e,t){},kVwd:function(e,t){},"lY7+":function(e,t){},mIwb:function(e,t){},nHtw:function(e,t){},nX4X:function(e,t){},o6ER:function(e,t){},pWlQ:function(e,t){},plZM:function(e,t){},pp4P:function(e,t){},"qWO/":function(e,t){},spKm:function(e,t){},srFV:function(e,t){},uLuI:function(e,t){},"v+RZ":function(e,t){},wveC:function(e,t){},xSip:function(e,t){}},[0]);
//# sourceMappingURL=app.41d728d46926caa04975.js.map