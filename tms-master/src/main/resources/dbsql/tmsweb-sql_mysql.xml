<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<!-- sql命名规范:tms +模块名称(dp,rule,stat)+sql名称 -->
<properties>
	
	<!-- 查询服务器列表 -->
	<entry key="TMS.SERVER.LIST"><![CDATA[SELECT T.* FROM TMS_RUN_SERVER T WHERE (TIMESTAMPDIFF(SECOND, T.ACTIVETIME, NOW()) * 1000) < T.PINGDELAY  AND T.SERVTYPE=?]]></entry>
	
	<!--============实时运行监控开始==============-->
	<!-- 实时告警监控SQL -->
	<entry key="tms.monitor.s_alert_chart"><![CDATA[ SELECT FROM_UNIXTIME(TIME / (1000), '%H:%i') TIMEID, NUM0 + NUM2 + NUM5 + NUM7 + NUM9 NUMALL,NUM0, NUM2, NUM5,NUM7, NUM9  FROM (SELECT TIME,SUM(ALERT_NUM0) NUM0,SUM(ALERT_NUM1) NUM2,SUM(ALERT_NUM2) NUM5,SUM(ALERT_NUM3) NUM7,SUM(ALERT_NUM4) NUM9 FROM TMS_MONITOR_RISK_STAT WHERE TIME BETWEEN :oneHourAgoTime AND :currentTime  GROUP BY TIME) t]]></entry>
	<!-- 规则运行监控SQL -->
	<entry key="tms.monitor.s_rule_temp_chart"><![CDATA[SELECT rule.rule_shortdesc ruledesc,t.txntype,t.txnnum,t.numhits,t.avgexec,(CASE txnnum WHEN 0 THEN 0 ELSE IFNULL(round(numhits * 100 / txnnum, 2), 0) END) rulerate FROM (select t1.TXNID txntype,t1.ruleid,t1.TXNNUM + IFNULL(t2.TXNNUM, 0) txnnum,t1.numhits,t1.avgexec from (SELECT TXNID,ruleid,SUM(Trig_number) txnnum,SUM(Hit_number) numhits,SUM(Trig_number * Rule_runtime_avg) / SUM(Trig_number) avgexec  FROM TMS_MONITOR_RULE_STAT s where exists(select 1 from tms_com_rule r where s.ruleid = r.RULE_ID) and time BETWEEN :oneHourAgoTime AND :currentTime GROUP BY TXNID, ruleid) t1 left join (SELECT TXNID, SUM(Trig_number) txnnum FROM TMS_MONITOR_RULE_STAT s where s.RULEID = '-1' and time BETWEEN :oneHourAgoTime AND :currentTime GROUP BY TXNID) t2 on t1.txnid = t2.txnid) t, tms_com_rule rule WHERE t.ruleid = rule.rule_id AND t.txnnum != 0 AND rule.rule_shortdesc LIKE CONCAT('%', :ruleName , '%')]]></entry>
	<entry key="tms.monitor.s_rule_hour_chart"><![CDATA[SELECT rule.rule_shortdesc ruledesc, t.txntype, t.txnnum, t.numhits, t.avgexec, (CASE txnnum WHEN 0 THEN 0 ELSE IFNULL(round(numhits * 100 / txnnum, 2), 0) END) rulerate FROM  (select t1.TXNID txntype,t1.ruleid,t1.TXNNUM+IFNULL(t2.TXNNUM,0) txnnum,t1.numhits,t1.avgexec from (SELECT TXNID, ruleid, SUM(Trig_number) txnnum, SUM(Hit_number) numhits, SUM(Trig_number * Rule_runtime_avg) / SUM(Trig_number) avgexec FROM TMS_MONITOR_RULE_STAT s  where exists (select 1 from tms_com_rule r where s.ruleid = r.RULE_ID ) and time BETWEEN :hourAgoTime AND :currentTime  GROUP BY TXNID, ruleid) t1 left join (SELECT TXNID, SUM(Trig_number) txnnum FROM TMS_MONITOR_RULE_STAT s  where s.RULEID='-1' and time BETWEEN :hourAgoTime AND :currentTime GROUP BY TXNID) t2 on t1.txnid=t2.txnid)  t,tms_com_rule rule WHERE     t.ruleid = rule.rule_id AND t.txnnum != 0 AND rule.rule_shortdesc LIKE CONCAT('%', :ruleName, '%')]]></entry>
	<!-- 交易运行监控SQL -->
<!-- 	<entry key="tms.monitor.s_txn_temp_chart"><![CDATA[SELECT *  FROM (SELECT tt.txntype,(SELECT tab.tab_desc FROM tms_dp_channel channel, tms_com_tab tab WHERE channel.channelid = tab.chann AND tab.tab_name = tt.txntype) TXNNAME,tt.numtxns NUMTXNS,IFNULL(round((tt.numtxnsuccess * 100) / tt.numtxns,2),0) TXNSUCCESSRATE,IFNULL(round((tt.numtxnalert * 100) / numtxns, 2),0) TXNALERTRATE,tt.avgexectimes AVGEXECTIMES FROM (SELECT Txnid txntype,SUM(Txn_number) numtxns,SUM(Alert_number) numtxnalert, SUM(Txn_sus_number) numtxnsuccess,SUM(Txn_number * Txn_runtime_avg) / SUM(Txn_number) avgexectimes FROM TMS_MONITOR_TXN_STAT WHERE Time BETWEEN :oneHourAgoTime AND :currentTime GROUP BY Channelid, TXNID) tt) tmp]]></entry> -->
<!-- 	<entry key="tms.monitor.s_txn_hour_chart"><![CDATA[select * from (select tt.txntype,(select tab.tab_desc from tms_dp_channel channel,tms_com_tab tab where channel.channelid=tab.chann and tab.tab_name=tt.txntype) TXNNAME,tt.numtxns NUMTXNS, IFNULL(round((tt.numtxnsuccess*100)/tt.numtxns,2),0) TXNSUCCESSRATE,IFNULL(round((tt.numtxnalert*100)/numtxns,2),0) TXNALERTRATE, tt.avgexectimes AVGEXECTIMES from (SELECT Txnid txntype, SUM(Txn_number) numtxns, SUM(Alert_number) numtxnalert, SUM(Txn_sus_number) numtxnsuccess, SUM(Txn_number * Txn_runtime_avg) / SUM(Txn_number) avgexectimes FROM TMS_MONITOR_TXN_STAT WHERE Time BETWEEN :hourAgoTime AND :currentTime GROUP BY Channelid, TXNID) tt) tmp]]></entry> -->
	<entry key="tms.monitor.s_txn_temp_chart"><![CDATA[SELECT *  FROM (	SELECT TXNID TXNTYPE,SUM(TXN_NUMBER) NUMTXNS FROM TMS_MONITOR_TXN_AREA_STAT	WHERE TIME BETWEEN :oneHourAgoTime AND :currentTime	GROUP BY TXNID) tmp]]></entry>
	<entry key="tms.monitor.s_txn_hour_chart"><![CDATA[SELECT *  FROM (	SELECT TXNID TXNTYPE,SUM(TXN_NUMBER) NUMTXNS FROM TMS_MONITOR_TXN_AREA_STAT	WHERE TIME BETWEEN :hourAgoTime    AND :currentTime	GROUP BY TXNID) tmp]]></entry>
	<!-- 欺诈类型监控SQL -->
	<entry key="tms.monitor.s_fraud_temp_chart"><![CDATA[SELECT *  FROM (SELECT FRAUD_TYPE FRAUDTYPE,SUM(FRAUD_NUMBER) FRAUDNUMBER FROM TMS_MONITOR_TXN_FRAUD_STAT	WHERE TIME BETWEEN :oneHourAgoTime AND :currentTime	AND FRAUD_NUMBER > 0 GROUP BY FRAUD_TYPE) tmp]]></entry>
	<entry key="tms.monitor.s_fraud_hour_chart"><![CDATA[SELECT *  FROM (SELECT FRAUD_TYPE FRAUDTYPE,SUM(FRAUD_NUMBER) FRAUDNUMBER FROM TMS_MONITOR_TXN_FRAUD_STAT	WHERE TIME BETWEEN :hourAgoTime AND :currentTime	AND FRAUD_NUMBER > 0 GROUP BY FRAUD_TYPE) tmp]]></entry>
	
	<!-- 地图监控SQL -->
	<entry key="tms.monitor.s_map_temp_chart"><![CDATA[SELECT S.*,C.CITYNAME,C.LATITUDE,C.LONGITUDE,K.DP_NAME DISPOSALNAME FROM ( SELECT DS.COUNTRYCODE,DS.CITYCODE,DS.REGIONCODE,DS.DISPOSAL FROM TMS_MONITOR_TXN_DP_STAT DS WHERE DS.CITYCODE IS NOT NULL) S LEFT JOIN  TMS_MGR_CITY C ON S.CITYCODE = C.CITYCODE	LEFT JOIN (SELECT DP_CODE,DP_NAME FROM TMS_COM_DISPOSAL) K	ON S.DISPOSAL = K.DP_CODE]]></entry>
		
	<!-- 风险数据统计SQL -->
	<entry key="tms.monitor.s_risk_temp_chart"><![CDATA[SELECT '用户数' STNAME, count(DISTINCT traffic.userid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK ='1' and traffic.TXNTIME BETWEEN :oneHourAgoTime AND :currentTime UNION ALL SELECT '会话数' STNAME, count(DISTINCT traffic.sessionid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK ='1' and traffic.TXNTIME BETWEEN :oneHourAgoTime AND :currentTime UNION ALL SELECT '访问IP数' STNAME, count(DISTINCT traffic.ipaddr) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK ='1' and traffic.TXNTIME BETWEEN :oneHourAgoTime AND :currentTime UNION ALL SELECT '访问设备数' STNAME, count(DISTINCT traffic.deviceid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK ='1' and traffic.TXNTIME BETWEEN :oneHourAgoTime AND :currentTime]]></entry>
	<entry key="tms.monitor.s_risk_hour_chart"><![CDATA[SELECT '用户数' STNAME, count(DISTINCT traffic.userid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK = '1' AND traffic.TXNTIME BETWEEN :hourAgoTime AND :currentTime UNION ALL SELECT '会话数' STNAME, count(DISTINCT traffic.sessionid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK = '1' AND traffic.TXNTIME BETWEEN :hourAgoTime AND :currentTime UNION ALL SELECT '访问IP数' STNAME, count(DISTINCT traffic.ipaddr) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK = '1' AND traffic.TXNTIME BETWEEN :hourAgoTime AND :currentTime UNION ALL SELECT '访问设备数' STNAME, count(DISTINCT traffic.deviceid) STVALUE FROM tms_run_trafficdata traffic WHERE traffic.ISRISK = '1' AND traffic.TXNTIME BETWEEN :hourAgoTime AND :currentTime]]></entry>
	<!--============实时运行监控结束==============-->
	
	
	<!-- 通用sql -->
	<entry key="tms.common.systime"><![CDATA[SELECT DATE_FORMAT(NOW(),'%Y-%m-%d %H:%i:%s') DBSYSTIME FROM DUAL]]></entry>
	<entry key="tms.common.sequenceid"><![CDATA[select nextval('${SEQUENCENAME}') SEQUENCEID]]></entry>
	<entry key="tms.common.truncatetable"><![CDATA[truncate table ${TABLENAME}]]></entry>


	
	<!--======================运行报表开始==========================-->
	<!-- 交易报表sql -->
	<!-- <entry key="report.txn.list"><![CDATA[SELECT a.*, (CASE WHEN b.SUMTXN = '0' THEN 0 ELSE IFNULL(ROUND(a.TXNNUMBER * 100 / b.SUMTXN, 2), 0) END) TXNRATE, (CASE WHEN b.SUMALERT = '0' THEN 0 ELSE IFNULL(ROUND(a.ALERTNUMBER * 100 / b.SUMALERT, 2), 0) END) AS SUMALERTRATE FROM (SELECT s.TXNID, s.CHANNELID, s.CHANNELNAME, s.ALERTNUMBER, s.TXNNUMBER, s.ALERTSUSNUMBER, IFNULL(ROUND(s.ALERTNUMBER * 100 / s.TXNNUMBER, 2), 0) TXNALERTRATE, IFNULL(ROUND(s.ALERTSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) SUSRATE, AVGTIME, s.MAXTIME, s.MINTIME, IFNULL(ROUND(s.BLOCKNUMBER * 100 / s.ALERTNUMBER, 2), 0) BLOCKRATE, IFNULL(ROUND(s.HANGNUMBER * 100 / s.ALERTNUMBER, 2), 0) HANGRATE, IFNULL(ROUND(s.AUTHNUMBER * 100 / s.ALERTNUMBER, 2), 0) AUTHRATE, IFNULL(ROUND(s.ALARMNUMBER * 100 / s.ALERTNUMBER, 2), 0) ALERTRATE, IFNULL(ROUND(s.DEFECTNUMBER * 100 / s.ALERTNUMBER, 2), 0) DEFRATE, IFNULL(ROUND(s.ERRORNUMBER * 100 / s.ALERTNUMBER, 2), 0) ERRORRATE FROM (SELECT MAX(t.TXNID) TXNID, MAX(t.TXNNAME) TXNNAME, MAX(t.CHANNELID) CHANNELID, MAX(t.CHANNELNAME) CHANNELNAME, IFNULL(SUM(r.ALERT_NUMBER), 0) ALERTNUMBER, IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER, IFNULL(SUM(r.ALERT_SUS_NUMBER), 0) ALERTSUSNUMBER, IFNULL(ROUND(SUM(r.TXN_RUNTIME_AVG * r.TXN_NUMBER) / SUM(r.TXN_NUMBER), 2), 0) AVGTIME, IFNULL(ROUND(MAX(r.TXN_RUNTIME_MAX), 2), 0) MAXTIME, IFNULL(ROUND(MIN(r.TXN_RUNTIME_MIN), 2), 0) MINTIME, IFNULL(SUM(r.BLOCK_NUMBER), 0) BLOCKNUMBER, IFNULL(SUM(r.HANG_NUMBER), 0) HANGNUMBER, IFNULL(SUM(r.AUTH_NUMBER), 0) AUTHNUMBER, IFNULL(SUM(r.ALARM_NUMBER), 0) ALARMNUMBER, IFNULL(SUM(r.DEFECT_NUMBER), 0) DEFECTNUMBER, IFNULL(SUM(r.ERROR_NUMBER), 0) ERRORNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r LEFT JOIN (SELECT t.TAB_NAME TXNID, t.TAB_DESC TXNNAME, t.CHANN CHANNELID, r.CHANNELNAME CHANNELNAME FROM REPORT_THEME_PUB_TXN t LEFT JOIN REPORT_THEME_PUB_CHANNEL R ON t.CHANN = r.CHANNELID) t ON r.TXNID = t.TXNID WHERE 1 = 1]]></entry> -->
	<!-- mod by v1.5云版本 -->
	<entry key="report.txn.list"><![CDATA[SELECT s.* FROM (	SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM (SELECT MAX(r.TXNID) TXNID,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM,IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER	FROM REPORT_THEME_TXN_STAR_ALERT r	WHERE 1 = 1 ]]></entry>
	<entry key="report.txn.fraud.list"><![CDATA[GROUP BY r.TXNID,r.DISPOSAL) a LEFT JOIN (  SELECT MAX(r.TXNID) TXNID,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM report_theme_txn_fraud_star r	WHERE 1 = 1]]></entry>
	<!-- 规则报表sql -->
	<entry key="report.rule.list"><![CDATA[select a.*,(case when b.TRIGGERSUM = '0' then  0 else IFNULL(ROUND(a.TRIGGERNUM * 100 / b.TRIGGERSUM, 2), 0) end) TRIGGERRATE, (case when b.HITSUM = '0' then 0 else IFNULL(round(a.HITNUM * 100 / b.HITSUM, 2), 0) end) as HITNUMRATE from (select a1.*, IFNULL(a2.TRIGGERNUMBER, 0) TRIGGERNUM, (case when IFNULL(a2.TRIGGERNUMBER, 0) = '0' then 0 else IFNULL(round(a1.HITNUM * 100 / IFNULL(a2.TRIGGERNUMBER, 0), 2), 0) end) HITRATE from (select r.RULE_SHORTDESC RULENAME, txn.TAB_NAME TXNID,IFNULL(r.RULE_SCORE,0) SCORE, IFNULL(SUM(al.HIT_NUMBER),0) HITNUM, IFNULL(round(SUM(al.RULE_RUNTIME_AVG*al.TRIGGER_NUMBER)/SUM(al.TRIGGER_NUMBER),2),0) AVGTIME, IFNULL(round(max(al.RULE_RUNTIME_MAX),2),0) MAXTIME, IFNULL(round(min(al.RULE_RUNTIME_MIN),2),0) MINTIME from REPORT_THEME_RULE_STAR_ALERT al inner join REPORT_THEME_PUB_TXN txn on al.TXNID=txn.TAB_NAME inner join REPORT_THEME_PUB_RULE r on al.RULEID=r.RULE_ID inner join REPORT_THEME_PUB_CHANNEL c on txn.CHANN=c.CHANNELID where 1=1 ]]></entry>
	<!-- 日期报表sql -->
	<!-- <entry key="report.date.list"><![CDATA[ SELECT a.*, (CASE WHEN b.SUMTXN = '0' THEN 0 ELSE IFNULL(ROUND(a.TXNNUMBER * 100 / b.SUMTXN, 2), 0) END) TXNRATE, (CASE WHEN b.SUMALERT = '0' THEN 0 ELSE IFNULL(ROUND(a.ALERTNUMBER * 100 / b.SUMALERT, 2), 0) END) AS ALERTNUMRATE FROM (SELECT s.ALERTDATE, s.ALERTNUMBER, s.TXNNUMBER, s.TXNALERTRATE, s.ALERTSUSNUMBER, IFNULL(ROUND(s.ALERTSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) SUSRATE, s.AVGTIME, s.MAXTIME, s.MINTIME, IFNULL(ROUND(s.BLOCKSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) BLOCKRATE, IFNULL(ROUND(s.HANGSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) HANGRATE, IFNULL(ROUND(s.AUTHSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) AUTHRATE, IFNULL(ROUND(s.ALARMSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) ALERTRATE, IFNULL(ROUND(s.DEFECTSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) DEFRATE, IFNULL(ROUND(s.ERRORSUSNUMBER * 100 / s.ALERTNUMBER, 2), 0) ERRORRATE FROM (SELECT DATE_FORMAT(r.TIME, '%Y-%m-%d') ALERTDATE, IFNULL(SUM(r.ALERT_NUMBER), 0) ALERTNUMBER, IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER, IFNULL(ROUND(SUM(r.ALERT_NUMBER) * 100 / SUM(r.TXN_NUMBER), 2), 0) TXNALERTRATE, IFNULL(SUM(r.ALERT_SUS_NUMBER), 0) ALERTSUSNUMBER, IFNULL(ROUND(SUM(r.TXN_RUNTIME_AVG * r.TXN_NUMBER) / SUM(r.TXN_NUMBER), 2), 0) AVGTIME, IFNULL(ROUND(MAX(r.TXN_RUNTIME_MAX), 2), 0) MAXTIME, IFNULL(ROUND(MIN(r.TXN_RUNTIME_MIN), 2), 0) MINTIME, IFNULL(SUM(r.BLOCK_NUMBER), 0) BLOCKSUSNUMBER, IFNULL(SUM(r.HANG_NUMBER), 0) HANGSUSNUMBER, IFNULL(SUM(r.AUTH_NUMBER), 0) AUTHSUSNUMBER, IFNULL(SUM(r.ALARM_NUMBER), 0) ALARMSUSNUMBER, IFNULL(SUM(r.DEFECT_NUMBER), 0) DEFECTSUSNUMBER, IFNULL(SUM(r.ERROR_NUMBER), 0) ERRORSUSNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1 = 1 ]]></entry> -->
	<entry key="report.date.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM (SELECT DATE_FORMAT(r.TIME, '%Y-%m-%d') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM,	IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1=1 ]]></entry>
	<entry key="report.date.fraud.list"><![CDATA[) a LEFT JOIN (  SELECT DATE_FORMAT(r.TIME, '%Y-%m-%d') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r	WHERE 1 = 1]]></entry>
	<!-- 日期报表(按天统计)sql -->
	<entry key="report.date.day.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM (SELECT CONCAT(DATE_FORMAT(r.TIME, '%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月', DATE_FORMAT(r.TIME, '%d'), '日') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM,	IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1=1 ]]></entry>
	<entry key="report.date.day.fraud.list"><![CDATA[) a LEFT JOIN (SELECT CONCAT(DATE_FORMAT(r.TIME, '%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月', DATE_FORMAT(r.TIME, '%d'), '日') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r	WHERE 1 = 1]]></entry>
	<entry key="report.date.day.list.groupby"><![CDATA[ group by DATE_FORMAT(r.TIME,'%Y') ,DATE_FORMAT(r.TIME,'%m') ,DATE_FORMAT(r.TIME,'%d'),r.DISPOSAL ]]></entry>
	<!-- 日期报表(按周统计)sql -->
	<entry key="report.date.week.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM(SELECT CONCAT(DATE_FORMAT(r.TIME, '%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月第', CAST((DATE_FORMAT(r.TIME, '%u') - DATE_FORMAT(DATE_FORMAT(r.TIME, '%Y-%m-"01"'),  '%u') + 1) AS CHAR), '周 ') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM,	IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1=1 ]]></entry>
	<entry key="report.date.week.fraud.list"><![CDATA[) a LEFT JOIN (SELECT CONCAT(DATE_FORMAT(r.TIME, '%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月第', CAST((DATE_FORMAT(r.TIME, '%u') - DATE_FORMAT(DATE_FORMAT(r.TIME, '%Y-%m-"01"'),  '%u') + 1) AS CHAR), '周 ') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM report_theme_txn_fraud_star r	WHERE 1 = 1]]></entry>
	<entry key="report.date.week.list.groupby"><![CDATA[ GROUP BY DATE_FORMAT(r.TIME,'%Y'),DATE_FORMAT(r.TIME,'%m'),(DATE_FORMAT(r.TIME,'%u')-DATE_FORMAT(DATE_FORMAT(r.TIME, '%Y-%m-"01"'),  '%u')+1),r.DISPOSAL ]]></entry>
	<!-- 日期报表(按月统计)sql -->
	<entry key="report.date.month.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM(SELECT CONCAT(DATE_FORMAT(r.TIME,'%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月 ') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM,	IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1=1 ]]></entry>
	<entry key="report.date.month.fraud.list"><![CDATA[) a LEFT JOIN (SELECT CONCAT(DATE_FORMAT(r.TIME,'%Y'), '年', DATE_FORMAT(r.TIME, '%m'), '月 ') ALERTDATE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r	WHERE 1 = 1]]></entry>
	<entry key="report.date.month.list.groupby"><![CDATA[ GROUP BY DATE_FORMAT(r.TIME,'%Y'),DATE_FORMAT(r.TIME, '%m'),r.DISPOSAL ]]></entry>
	
	<entry key="report.date.txn.star.alert"><![CDATA[ SELECT SUM(r.TXN_NUMBER) SUMTXN, IFNULL(SUM(r.ALERT_NUMBER), 0) SUMALERT FROM REPORT_THEME_TXN_STAR_ALERT r WHERE 1 = 1 ]]></entry>
	
	<!-- 地区报表sql -->
	<entry key="report.area.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM(SELECT MAX(re.REGIONNAME) REGIONNAME, re.REGIONCODE REGIONCODE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM, IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r JOIN REPORT_THEME_PUB_REGION re ON r.REGIONCODE = re.REGIONCODE WHERE 1 = 1 ]]></entry>
	<entry key="report.area.fraud.list"><![CDATA[) a LEFT JOIN (SELECT r.REGIONCODE REGIONCODE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r	WHERE 1 = 1]]></entry>
	<entry key="report.city.list"><![CDATA[ SELECT s.* FROM (SELECT a.*,IFNULL(b.FRAUDNUMBER, 0) FRAUDNUMBER ,IFNULL(b.NONFRAUDNUMBER, 0) NONFRAUDNUMBER FROM(SELECT MAX(rc.CITYNAME) CITYNAME,r.CITYCODE CITYCODE,MAX(r.DISPOSAL) DISPOSAL,IFNULL(SUM(r.DISPOSAL_NUM), 0) DISPOSALNUM, IFNULL(SUM(r.TXN_NUMBER), 0) TXNNUMBER FROM REPORT_THEME_TXN_STAR_ALERT r JOIN REPORT_THEME_PUB_CITY rc ON R.CITYCODE=rc.CITYCODE WHERE 1=1 ]]></entry>
	<entry key="report.city.fraud.list"><![CDATA[) a LEFT JOIN (SELECT r.CITYCODE CITYCODE,MAX(r.DISPOSAL) DISPOSAL,SUM(IF(r.FRAUD_TYPE='00',0,r.FRAUD_NUMBER)) FRAUDNUMBER,SUM(IF(r.FRAUD_TYPE='00',r.FRAUD_NUMBER,0)) NONFRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r	WHERE 1 = 1]]></entry>
	
	<!-- 模型评价报表导出sql -->
	<entry key="report.riskmodel.export"><![CDATA[ SELECT M.TXNID,M.STARTDATE,MAX(M.F1SCORE) M_FLSCORE_MAX,MIN(M.F1SCORE) M_FLSCORE_MIN,CAST(AVG(M.F1SCORE) AS DECIMAL(6,2)) M_FLSCORE_AVG , 0 R_FLSCORE_MAX,0 R_FLSCORE_MIN,0 R_FLSCORE_AVG FROM TMS_COM_MTRAINHIS M ]]></entry>

	<!-- 模型评价报表查询sql -->
	<entry key="report.riskmodel.list"><![CDATA[ SELECT M.TXNID,M.STARTDATE,MAX(M.F1SCORE) M_FLSCORE_MAX,MIN(M.F1SCORE) M_FLSCORE_MIN,round(AVG(M.F1SCORE),2) M_FLSCORE_AVG , 0 R_FLSCORE_MAX,0 R_FLSCORE_MIN,0 R_FLSCORE_AVG FROM TMS_COM_MTRAINHIS M WHERE M.TXNID = :TXNID ]]></entry>
	
	<!-- 欺诈类型报表查询 -->
	<entry key="report.fraud.list"><![CDATA[ SELECT s.* FROM (SELECT r.FRAUD_TYPE FRAUDTYPE,MAX(r.DISPOSAL) DISPOSAL,	IFNULL(SUM(r.FRAUD_NUMBER), 0) FRAUDNUMBER FROM REPORT_THEME_TXN_FRAUD_STAR r WHERE 1=1 ]]></entry>
	
	<!-- 交易运行效率 -->
	<entry key="report.txn.time.list"><![CDATA[ SELECT  r.TXNID,IFNULL(SUM(r.RISK_EVAL_NUMBER), 0) RISK_EVAL_NUMBER,IFNULL(AVG(r.RISK_EVAL_RUNTIME_AVG), 0) RISK_EVAL_RUNTIME_AVG, IFNULL(MAX(r.RISK_EVAL_RUNTIME_MAX), 0) RISK_EVAL_RUNTIME_MAX,IFNULL(MIN(r.RISK_EVAL_RUNTIME_MIN), 0) RISK_EVAL_RUNTIME_MIN,IFNULL(AVG(r.RISK_EVAL_TPM_AVG), 0) RISK_EVAL_TPM_AVG,IFNULL(MAX(r.RISK_EVAL_TPM_MAX), 0) RISK_EVAL_TPM_MAX,IFNULL(MIN(r.RISK_EVAL_TPM_MIN), 0) RISK_EVAL_TPM_MIN,IFNULL(SUM(r.RISK_CFM_NUMBER), 0) RISK_CFM_NUMBER,IFNULL(AVG(r.RISK_CFM_RUNTIME_AVG), 0) RISK_CFM_RUNTIME_AVG,IFNULL(MAX(r.RISK_CFM_RUNTIME_MAX), 0) RISK_CFM_RUNTIME_MAX,IFNULL(MIN(r.RISK_CFM_RUNTIME_MIN), 0) RISK_CFM_RUNTIME_MIN,IFNULL(AVG(r.RISK_CFM_TPM_AVG), 0) RISK_CFM_TPM_AVG,IFNULL(MAX(r.RISK_CFM_TPM_MAX), 0) RISK_CFM_TPM_MAX,IFNULL(MIN(r.RISK_CFM_TPM_MIN), 0) RISK_CFM_TPM_MIN FROM report_theme_txn_time_stat r  WHERE 1=1 ]]></entry>
	
	<!--======================运行报表结束==========================-->
	
	<!-- 自定义查询  -->
	
	<!--  查询交易下最大的统计名称+1 -->
	<entry key="tms.stat.queryMaxStatName"><![CDATA[ SELECT CONCAT('S', CAST(IFNULL((MAX(CAST(SUBSTR(STAT_NAME,2,LENGTH(STAT_NAME)-1) AS UNSIGNED INT)) + 1),1) AS CHAR)) MAXSTATNAME FROM TMS_COM_STAT]]></entry>
	
	<!--  查询交易下最大的规则名称+1 -->
	<entry key="tms.rule.queryMaxRuleName"><![CDATA[ select CONCAT('R' , CAST(IFNULL((max(CAST(substr(RULE_NAME,2,length(RULE_NAME)-1) AS UNSIGNED INT)) + 1),0) AS CHAR)) maxRuleName from TMS_COM_RULE where RULE_TXN=?]]></entry>
	
	<!-- IP地址维护 -->
	<!-- 向TMS_MGR_LOB表中插入数据 -->
	<entry key="tms.ip.insertMgrLog">insert into %s(ID,NAME,DATA) values(1,'IPData',empty_blob())</entry>

	<entry key="tms.auth.query"><![CDATA[ select auth.*,record.real_oper from tms_mgr_authinfo auth,tms_mgr_authrecord record  where record.auth_id = auth.auth_id and query_pkvalue =? and module_id='tranConf' and auth_status='0' and record.real_oper = 'd' and record.is_main = '1']]></entry>
	
	<entry key="tms.roster.namelist"><![CDATA[ AND ROSTER.ROSTERDESC like CONCAT('%',:ROSTERDESC,'%')]]></entry>
	
	<!-- 反洗钱SQL语句begin -->
	<entry key="tms.aml.translist"><![CDATA[ SELECT traffic.* FROM tms_run_trafficdata traffic LEFT JOIN tms_run_ruletrig ruletrig ON traffic.TXNCODE = ruletrig.TXNCODE LEFT JOIN tms_run_user u ON u.userid = traffic.userid WHERE 1 = 1 ]]></entry>
	<entry key="tms.aml.amllist"><![CDATA[SELECT t.*, date_format(str_to_date(t.CREATETIME, '%y%m%d%k%i%s'), '%y-%m-%d %k:%i:%s') tCREATETIME, date_format(str_to_date(t.MODIFYTIME, '%y%m%d%k%i%s'), '%y-%m-%d %k:%i:%s') tMODIFYTIME FROM TMS_AML_MESSAGE t WHERE t.ISEXPORT = '1']]></entry>
	<!-- 反洗钱SQL语句end -->
</properties>
